# Guia Completo do Comando `test` no Dart CLI

O **Dart CLI** (Interface de Linha de Comando do Dart) oferece diversos comandos para auxiliar no desenvolvimento de aplicações Dart. Um dos comandos mais importantes para garantir a qualidade do código é o comando `test`, que permite executar testes automatizados em seu projeto.

Neste guia, exploraremos em detalhes o comando `test`, incluindo seu propósito, opções de parâmetros, sintaxe de uso, restrições e exemplos práticos.

---

## Sumário

- [O que é o comando `test` e para que serve?](#o-que-é-o-comando-test-e-para-que-serve)
- [Sintaxe de Uso](#sintaxe-de-uso)
- [Opções e Parâmetros](#opções-e-parâmetros)
  - [`--name` ou `-n`](#--name-ou--n)
  - [`--plain-name`](#--plain-name)
  - [`--tags` e `--exclude-tags`](#--tags-e---exclude-tags)
  - [`--platform` ou `-p`](#--platform-ou--p)
  - [`--concurrency` ou `-j`](#--concurrency-ou--j)
  - [`--timeout`](#--timeout)
  - [`--coverage`](#--coverage)
  - [`--test-randomize-ordering-seed`](#--test-randomize-ordering-seed)
  - [`--reporter`](#--reporter)
  - [`--color` e `--no-color`](#--color-e---no-color)
  - [`--help` ou `-h`](#--help-ou--h)
- [Restrições de Uso](#restrições-de-uso)
- [Exemplos Práticos](#exemplos-práticos)
- [Boas Práticas e Dicas Adicionais](#boas-práticas-e-dicas-adicionais)
- [Conclusão](#conclusão)

---

## O que é o comando `test` e para que serve?

O comando `test` do Dart CLI é utilizado para executar testes automatizados escritos para aplicativos e pacotes Dart. Ele permite que os desenvolvedores verifiquem o comportamento do código, garantam que novas alterações não quebrem funcionalidades existentes e mantenham a qualidade geral do software.

**Principais funcionalidades:**

- Executar testes unitários e de integração.
- Filtrar quais testes executar.
- Executar testes em diferentes plataformas (VM, browser, etc.).
- Gerar relatórios de cobertura de código.
- Personalizar o comportamento dos testes com diversas opções.

---

## Sintaxe de Uso

A sintaxe básica do comando `test` é:

```bash
dart test [options] [<directory|file>|<package_selector>:<name_selector> ...]
```

- **`[options]`**: Opções e parâmetros que modificam o comportamento do comando.
- **`[<directory|file>]`**: Opcionalmente, especifica diretórios ou arquivos de teste a serem executados.
- **`<package_selector>:<name_selector>`**: Filtra testes por nome de pacote e teste.

---

## Opções e Parâmetros

### `--name` ou `-n`

#### O que é e para que serve?

- **Propósito:** Executa apenas os testes cujo nome corresponde a um padrão específico.
- **Quando utilizar:** Quando você deseja executar um subconjunto de testes que correspondem a um determinado padrão de nome.

#### Sintaxe de uso

```bash
dart test --name <pattern>
```

ou

```bash
dart test -n <pattern>
```

#### Exemplos

```bash
dart test --name "calculadora soma"
```

Executa apenas os testes que possuem "calculadora soma" no nome.

#### Restrições de uso

- O padrão é sensível a maiúsculas e minúsculas.
- Usa expressões regulares para correspondência.

---

### `--plain-name`

#### O que é e para que serve?

- **Propósito:** Semelhante a `--name`, mas o padrão é interpretado literalmente, não como expressão regular.
- **Quando utilizar:** Quando você quer correspondência exata de nomes sem usar regex.

#### Sintaxe de uso

```bash
dart test --plain-name <string>
```

#### Exemplos

```bash
dart test --plain-name "Teste de Login"
```

Executa testes cujo nome é exatamente "Teste de Login".

#### Restrições de uso

- Não suporta caracteres curingas ou regex.
- Sensível a maiúsculas e minúsculas.

---

### `--tags` e `--exclude-tags`

#### O que é e para que serve?

- **`--tags`:** Executa apenas testes marcados com as tags especificadas.
- **`--exclude-tags`:** Exclui testes que possuem as tags especificadas.
- **Quando utilizar:** Para categorizar e filtrar testes usando tags.

#### Sintaxe de uso

```bash
dart test --tags <tag1,tag2>
dart test --exclude-tags <tag3>
```

#### Exemplos

```bash
dart test --tags unidade
```

Executa apenas testes marcados com a tag `unidade`.

```bash
dart test --exclude-tags integração
```

Executa todos os testes, exceto os marcados com `integração`.

#### Restrições de uso

- As tags devem ser definidas nos testes usando o pacote `test`.
- Não há suporte para expressões regulares em tags.

---

### `--platform` ou `-p`

#### O que é e para que serve?

- **Propósito:** Especifica em qual plataforma os testes serão executados.
- **Quando utilizar:** Quando você precisa testar em ambientes específicos (por exemplo, VM do Dart, navegadores, etc.).

#### Sintaxe de uso

```bash
dart test --platform <platform>
```

ou

```bash
dart test -p <platform>
```

#### Plataformas Suportadas

- `vm`: Máquina virtual do Dart (padrão).
- `chrome`: Navegador Chrome.
- `firefox`: Navegador Firefox.
- `safari`: Navegador Safari.
- `node`: Ambiente Node.js.
- Outros podem ser adicionados via plugins.

#### Exemplos

```bash
dart test --platform chrome
```

Executa os testes no navegador Chrome.

```bash
dart test -p vm,chrome
```

Executa os testes tanto na VM do Dart quanto no Chrome.

#### Restrições de uso

- É necessário ter as plataformas configuradas corretamente.
- Para testar em navegadores, pode ser necessário instalar dependências adicionais.

---

### `--concurrency` ou `-j`

#### O que é e para que serve?

- **Propósito:** Define o número máximo de testes que podem ser executados em paralelo.
- **Quando utilizar:** Para controlar a carga de testes simultâneos, especialmente em máquinas com recursos limitados.

#### Sintaxe de uso

```bash
dart test --concurrency <threads>
```

ou

```bash
dart test -j <threads>
```

#### Exemplos

```bash
dart test --concurrency 1
```

Executa os testes um de cada vez.

```bash
dart test -j 4
```

Executa até 4 testes em paralelo.

#### Restrições de uso

- O valor padrão geralmente é o número de núcleos da CPU.
- Valores muito altos podem levar a sobrecarga do sistema.

---

### `--timeout`

#### O que é e para que serve?

- **Propósito:** Define o tempo máximo que um teste pode levar antes de ser encerrado.
- **Quando utilizar:** Para evitar que testes travados bloqueiem a suite de testes.

#### Sintaxe de uso

```bash
dart test --timeout <time>
```

#### Formatos de Tempo

- Especificado em segundos (`30s`), minutos (`2m`), horas (`1h`), etc.

#### Exemplos

```bash
dart test --timeout 1m
```

Define o tempo limite de 1 minuto para cada teste.

#### Restrições de uso

- Se um teste exceder o tempo limite, ele falhará.
- Pode ser sobrescrito individualmente em testes específicos.

---

### `--coverage`

#### O que é e para que serve?

- **Propósito:** Gera relatórios de cobertura de código.
- **Quando utilizar:** Para medir quanto do seu código está sendo exercitado pelos testes.

#### Sintaxe de uso

```bash
dart test --coverage=<directory>
```

#### Exemplos

```bash
dart test --coverage=coverage
```

Gera relatórios na pasta `coverage`.

#### Restrições de uso

- Disponível apenas ao testar na VM do Dart.
- Ferramentas adicionais podem ser necessárias para visualizar os relatórios.

---

### `--test-randomize-ordering-seed`

#### O que é e para que serve?

- **Propósito:** Randomiza a ordem de execução dos testes usando uma seed específica.
- **Quando utilizar:** Para detectar dependências entre testes que possam causar flakiness.

#### Sintaxe de uso

```bash
dart test --test-randomize-ordering-seed <seed>
```

#### Exemplos

```bash
dart test --test-randomize-ordering-seed 42
```

Executa os testes em ordem aleatória baseada na seed `42`.

#### Restrições de uso

- Uma seed de `0` desativa a randomização.
- A seed deve ser um inteiro não negativo.

---

### `--reporter`

#### O que é e para que serve?

- **Propósito:** Especifica o formato de saída dos resultados dos testes.
- **Quando utilizar:** Para integrar com ferramentas de CI/CD ou para preferências pessoais de visualização.

#### Sintaxe de uso

```bash
dart test --reporter <reporter>
```

#### Tipos de Reporter

- `compact` (padrão): Exibe uma saída compacta.
- `expanded`: Exibe detalhes completos de cada teste.
- `json`: Saída em formato JSON.
- `junit`: Formato compatível com JUnit XML.
- Outros podem estar disponíveis via pacotes.

#### Exemplos

```bash
dart test --reporter expanded
```

Exibe informações detalhadas sobre cada teste.

```bash
dart test --reporter json > results.json
```

Exporta os resultados em JSON para um arquivo.

#### Restrições de uso

- Alguns reportes podem não ser compatíveis com todas as opções.
- O formato JSON é útil para integração com outras ferramentas.

---

### `--color` e `--no-color`

#### O que é e para que serve?

- **`--color`:** Força a saída colorida.
- **`--no-color`:** Desativa a saída colorida.
- **Quando utilizar:** Para controlar a formatação da saída, especialmente em ambientes que não suportam cores.

#### Sintaxe de uso

```bash
dart test --color
dart test --no-color
```

#### Exemplos

```bash
dart test --no-color
```

Executa os testes sem cores na saída.

#### Restrições de uso

- Útil em sistemas ou terminais que não suportam ANSI colors.
- Por padrão, o Dart CLI detecta automaticamente se deve usar cores.

---

### `--help` ou `-h`

#### O que é e para que serve?

- **Propósito:** Exibe informações de ajuda sobre o comando `test`.
- **Quando utilizar:** Quando precisar de um lembrete rápido sobre opções disponíveis.

#### Sintaxe de uso

```bash
dart test --help
```

ou

```bash
dart test -h
```

#### Exemplos

```bash
dart test --help
```

Exibe a ajuda completa do comando `test`.

---

## Restrições de Uso

- **Ambiente de Teste:** Certifique-se de que todas as dependências e plataformas necessárias estejam configuradas.
- **Versão do SDK:** Algumas opções podem não estar disponíveis em versões mais antigas do Dart SDK.
- **Compatibilidade de Pacotes:** Verifique se os pacotes utilizados são compatíveis com as versões do Dart e do pacote `test`.
- **Execução em Navegadores:** Testes em navegadores podem exigir configurações adicionais e não são suportados em todos os ambientes.

---

## Exemplos Práticos

### Executar Todos os Testes

```bash
dart test
```

Executa todos os testes encontrados na pasta `test/`.

### Executar Testes em um Arquivo Específico

```bash
dart test test/calculadora_test.dart
```

Executa os testes definidos no arquivo `calculadora_test.dart`.

### Executar Testes com Nome Específico

```bash
dart test --name "Teste de Soma"
```

Executa testes que correspondem ao padrão "Teste de Soma".

### Executar Testes Marcados com uma Tag

```bash
dart test --tags rápida
```

Executa testes marcados com a tag `rápida`.

### Executar Testes em Paralelo com Limite de Conexões

```bash
dart test --concurrency 2
```

Executa até 2 testes simultaneamente.

### Gerar Relatório de Cobertura

```bash
dart test --coverage=coverage
```

Executa os testes e gera relatórios de cobertura na pasta `coverage`.

### Randomizar Ordem de Execução dos Testes

```bash
dart test --test-randomize-ordering-seed random
```

Randomiza a ordem dos testes usando uma seed aleatória.

---

## Boas Práticas e Dicas Adicionais

- **Organização dos Testes:** Mantenha seus testes bem organizados na pasta `test/` para facilitar a execução e manutenção.
- **Uso de Tags:** Utilize tags para categorizar testes (por exemplo, `lento`, `rápido`, `integração`) e facilitar a seleção.
- **Dependências Isoladas:** Escreva testes independentes para evitar flakiness e facilitar a paralelização.
- **Automatização:** Integre o comando `dart test` em seus scripts de CI/CD para garantir a qualidade contínua do código.
- **Cobertura de Código:** Utilize a opção `--coverage` regularmente para monitorar a cobertura e identificar áreas não testadas.
- **Atualizações Regulares:** Mantenha o Dart SDK e o pacote `test` atualizados para aproveitar as últimas funcionalidades e correções.

---

## Conclusão

O comando `test` do Dart CLI é uma ferramenta essencial para garantir a qualidade e confiabilidade de suas aplicações Dart. Compreender suas opções e parâmetros permite personalizar a execução dos testes de acordo com as necessidades do projeto, otimizar o fluxo de trabalho e integrar eficientemente com outras ferramentas e ambientes.

Esperamos que este guia tenha fornecido um entendimento profundo do comando `test` e que você possa aplicá-lo eficazmente em seus projetos.

---

**Referências:**

- [Documentação Oficial do Dart - Testing](https://dart.dev/guides/testing)
- [Pacote `test` no Pub.dev](https://pub.dev/packages/test)
- [Guia de Testes Unitários no Dart](https://dart.dev/guides/testing/unit-testing)

---

**Nota:** As informações apresentadas são baseadas no Dart SDK até a data de corte de conhecimento em setembro de 2021. Para informações atualizadas, consulte a documentação oficial do Dart.