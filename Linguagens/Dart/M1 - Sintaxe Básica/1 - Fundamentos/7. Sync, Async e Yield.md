# Explicação de `sync*`, `async*`, `yield` e `yield*` no Dart

No Dart, as palavras-chave `sync*`, `async*`, `yield` e `yield*` são utilizadas em **funções geradoras** (generators). Essas funções permitem produzir sequências de valores de forma **preguiçosa** (lazy), ou seja, os valores são gerados conforme a demanda, em vez de serem todos gerados de uma vez.

---

## Sumário

- [Introdução aos Generators](#introdução-aos-generators)
- [`sync*` - Funções Geradoras Síncronas](#sync---funções-geradoras-síncronas)
  - [O que é e para que serve?](#o-que-é-e-para-que-serve-sync)
  - [Quando utilizar?](#quando-utilizar-sync)
  - [Sintaxe de uso](#sintaxe-de-uso-sync)
  - [Exemplo](#exemplo-sync)
  - [Restrições de uso](#restrições-de-uso-sync)
- [`async*` - Funções Geradoras Assíncronas](#async---funções-geradoras-assíncronas)
  - [O que é e para que serve?](#o-que-é-e-para-que-serve-async)
  - [Quando utilizar?](#quando-utilizar-async)
  - [Sintaxe de uso](#sintaxe-de-uso-async)
  - [Exemplo](#exemplo-async)
  - [Restrições de uso](#restrições-de-uso-async)
- [`yield` - Produção de Valores](#yield---produção-de-valores)
  - [O que é e para que serve?](#o-que-é-e-para-que-serve-yield)
  - [Quando utilizar?](#quando-utilizar-yield)
  - [Sintaxe de uso](#sintaxe-de-uso-yield)
  - [Exemplo](#exemplo-yield)
  - [Restrições de uso](#restrições-de-uso-yield)
- [`yield*` - Delegação para Outro Gerador](#yield---delegação-para-outro-gerador)
  - [O que é e para que serve?](#o-que-é-e-para-que-serve-yield-1)
  - [Quando utilizar?](#quando-utilizar-yield-1)
  - [Sintaxe de uso](#sintaxe-de-uso-yield-1)
  - [Exemplo](#exemplo-yield-1)
  - [Restrições de uso](#restrições-de-uso-yield-1)
- [Considerações Finais](#considerações-finais)

---

## Introdução aos Generators

**Generators** são funções especiais que permitem criar iteradores de forma simplificada. Em vez de retornar todos os valores de uma vez, um generator produz valores sob demanda, o que é útil para trabalhar com sequências grandes ou infinitas.

Existem dois tipos de generators no Dart:

1. **Geradores Síncronos (`sync*`):** Retornam um `Iterable<T>`.
2. **Geradores Assíncronos (`async*`):** Retornam um `Stream<T>`.

---

## `sync*` - Funções Geradoras Síncronas

### O que é e para que serve?

- **`sync*`** é utilizado para definir uma **função geradora síncrona**.
- Serve para criar uma função que retorna um `Iterable<T>`, permitindo que você itere sobre uma sequência de valores gerados sob demanda.

### Quando utilizar?

- Quando você precisa gerar uma sequência de valores de forma síncrona.
- Útil para criar iteráveis personalizados sem a necessidade de implementar a interface `Iterable` manualmente.
- Ideal para sequências finitas e quando a geração dos valores não envolve operações assíncronas.

### Sintaxe de uso

```dart
Iterable<Tipo> nomeDaFuncao(parametros) sync* {
  // Corpo da função
  yield valor;
}
```

### Exemplo

```dart
Iterable<int> numerosParesAte(int max) sync* {
  for (int i = 0; i <= max; i++) {
    if (i % 2 == 0) {
      yield i;
    }
  }
}

void main() {
  for (var numero in numerosParesAte(10)) {
    print(numero);
  }
}
```

**Saída:**

```
0
2
4
6
8
10
```

### Restrições de uso

- Não é possível usar `await` dentro de uma função `sync*`.
- A função deve retornar um `Iterable<T>`.
- Não pode ser usada para operações que envolvam processamento assíncrono.

---

## `async*` - Funções Geradoras Assíncronas

### O que é e para que serve?

- **`async*`** é utilizado para definir uma **função geradora assíncrona**.
- Serve para criar uma função que retorna um `Stream<T>`, permitindo que você emita valores de forma assíncrona.

### Quando utilizar?

- Quando você precisa gerar uma sequência de valores que são obtidos ou produzidos de forma assíncrona.
- Útil para trabalhar com fluxos de dados, como eventos, leitura de arquivos ou respostas de rede.
- Ideal para sequências onde os valores são produzidos em momentos diferentes ou dependem de operações assíncronas.

### Sintaxe de uso

```dart
Stream<Tipo> nomeDaFuncao(parametros) async* {
  // Corpo da função
  yield valor;
}
```

### Exemplo

```dart
Stream<int> contarAte(int max) async* {
  for (int i = 1; i <= max; i++) {
    await Future.delayed(Duration(seconds: 1)); // Simula uma operação assíncrona
    yield i;
  }
}

void main() async {
  await for (var numero in contarAte(5)) {
    print(numero);
  }
}
```

**Saída (com 1 segundo de intervalo entre os números):**

```
1
2
3
4
5
```

### Restrições de uso

- A função deve retornar um `Stream<T>`.
- Pode utilizar `await` e outras operações assíncronas dentro do corpo da função.
- Deve ser consumida usando `await for` ou ouvindo o stream com `listen`.

---

## `yield` - Produção de Valores

### O que é e para que serve?

- **`yield`** é usado dentro de uma função geradora para produzir um **único valor**.
- Serve para enviar um valor de volta ao chamador e pausar a execução da função até que o próximo valor seja solicitado.

### Quando utilizar?

- Sempre que você quiser emitir um valor dentro de um generator.
- Cada chamada a `yield` produz um valor para o iterador ou stream resultante.

### Sintaxe de uso

```dart
yield valor;
```

### Exemplo

Veja os exemplos anteriores das funções `sync*` e `async*`, onde `yield` é usado para produzir valores.

**Exemplo com `sync*`:**

```dart
Iterable<int> fibonacci(int n) sync* {
  int a = 0, b = 1;
  for (int i = 0; i < n; i++) {
    yield a;
    int temp = a;
    a = b;
    b = temp + b;
  }
}

void main() {
  for (var numero in fibonacci(7)) {
    print(numero);
  }
}
```

**Saída:**

```
0
1
1
2
3
5
8
```

### Restrições de uso

- `yield` só pode ser usado dentro de funções marcadas com `sync*` ou `async*`.
- Não pode ser usado em funções normais ou em funções apenas marcadas com `async`.

---

## `yield*` - Delegação para Outro Gerador

### O que é e para que serve?

- **`yield*`** é usado para **delegar** parte da geração de valores a outro generator ou iterable.
- Serve para incluir todos os valores de outro iterable ou stream no seu generator atual, como se fossem parte dele.

### Quando utilizar?

- Quando você quer reutilizar a lógica de outro generator ou iterable dentro do seu generator.
- Útil para dividir generators complexos em partes menores e mais gerenciáveis.

### Sintaxe de uso

```dart
yield* outroIterableOuStream;
```

### Exemplo

**Exemplo com `sync*`:**

```dart
Iterable<int> numerosNaturaisAte(int max) sync* {
  yield* numerosParesAte(max);
  yield* numerosImparesAte(max);
}

Iterable<int> numerosParesAte(int max) sync* {
  for (int i = 0; i <= max; i += 2) {
    yield i;
  }
}

Iterable<int> numerosImparesAte(int max) sync* {
  for (int i = 1; i <= max; i += 2) {
    yield i;
  }
}

void main() {
  for (var numero in numerosNaturaisAte(5)) {
    print(numero);
  }
}
```

**Saída:**

```
0
2
4
1
3
5
```

### Restrições de uso

- O tipo do iterable ou stream que você está delegando deve ser compatível com o tipo retornado pela função geradora.
- `yield*` só pode ser usado dentro de funções marcadas com `sync*` ou `async*`.
- Ao usar `yield*` em um `async*`, o objeto delegado deve ser um `Stream`, e em um `sync*`, deve ser um `Iterable`.

---

## Considerações Finais

- **Eficiência de Memória:** Generators são eficientes em termos de memória, pois os valores são gerados conforme necessário.
- **Iteração Sob Demanda:** Útil para trabalhar com sequências potencialmente infinitas ou muito grandes.
- **Consumo de Generators:**
  - **`sync*` (`Iterable`):** Consumido com loops `for-in`.
  - **`async*` (`Stream`):** Consumido com loops `await for` ou ouvindo com `stream.listen()`.
- **Tratamento de Erros:** Você pode usar blocos `try-catch` dentro de generators para tratar exceções.
- **Não Confundir `async*` com `async`:** Funções `async` retornam um único `Future`, enquanto `async*` retornam um `Stream` que pode emitir múltiplos valores ao longo do tempo.
- **Combinação de Generators:** Use `yield*` para combinar generators e criar sequências mais complexas.

---

**Exemplo Completo com Tratamento de Erros:**

```dart
Stream<int> numerosComErro() async* {
  try {
    for (int i = 1; i <= 5; i++) {
      if (i == 3) throw Exception('Erro no número $i');
      yield i;
    }
  } catch (e) {
    yield -1; // Emite um valor especial em caso de erro
  }
}

void main() async {
  await for (var numero in numerosComErro()) {
    print(numero);
  }
}
```

**Saída:**

```
1
2
-1
```

---

**Referências:**

- [Documentação Oficial do Dart - Generators](https://dart.dev/guides/language/language-tour#generators)
- [Tutorial sobre Streams e Generators](https://medium.com/flutter-comunidade-br/entendendo-streams-e-funções-assíncronas-em-dart-ff8de300f8a4)

---

Espero que esta explicação detalhada tenha esclarecido o uso de `sync*`, `async*`, `yield` e `yield*` no Dart. Essas ferramentas são poderosas para manipular sequências de dados de forma eficiente e flexível.