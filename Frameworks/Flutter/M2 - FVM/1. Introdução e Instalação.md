

O **FVM (Flutter Version Management)** é uma ferramenta que facilita a gestão de múltiplas versões do Flutter em um único ambiente. Ele é amplamente utilizado em projetos que necessitam de compatibilidade com versões diferentes do SDK Flutter, permitindo que os desenvolvedores alternem rapidamente entre essas versões e garantam consistência em diferentes projetos.

**Link:** [Overview – FVM](https://fvm.app/documentation/getting-started)

### O que é e para que serve o FVM?

O **FVM** é uma ferramenta de gerenciamento de versões do Flutter, similar ao `nvm` para Node.js. Ele permite que você instale, gerencie e troque rapidamente entre versões diferentes do SDK Flutter, tanto para projetos individuais quanto de forma global.

A principal utilidade do FVM é:

1. **Gerenciamento de múltiplas versões**: Em projetos onde diferentes versões do Flutter são necessárias, o FVM evita conflitos, permitindo a coexistência de várias versões no mesmo sistema.
2. **Consistência do projeto**: Permite que cada projeto defina a versão específica do Flutter que será usada, mantendo a consistência em ambientes de CI/CD ou entre diferentes colaboradores.
3. **Facilidade no upgrade/downgrade**: Trocar de versão do SDK Flutter é rápido, sem a necessidade de reinstalar todo o SDK manualmente.

#### Exemplo de Uso
Você pode ter dois projetos usando versões diferentes do Flutter: um usando o `Flutter 2.10.0` e outro usando o `Flutter 3.0.0`. O FVM permite que cada projeto utilize a versão correta sem que seja necessário reconfigurar o ambiente global do Flutter.

### Quando utilizar o FVM?

O FVM é indicado para qualquer situação onde o gerenciamento de versões do Flutter pode ser um problema ou onde múltiplas versões são necessárias. Isso é especialmente útil em:

- **Projetos com equipes grandes**: Onde diferentes desenvolvedores podem estar utilizando versões diferentes do SDK.
- **Ambientes de Integração Contínua (CI/CD)**: Garantir que os pipelines utilizem a mesma versão do Flutter que foi utilizada no desenvolvimento local.
- **Projetos que não podem ser migrados** para a versão mais recente do Flutter por questões de compatibilidade com dependências ou bibliotecas.

### Como instalar o FVM no Windows utilizando Chocolatey?

Chocolatey é um gerenciador de pacotes para Windows que facilita a instalação de ferramentas como o FVM. Aqui está o processo detalhado para instalar o FVM no Windows utilizando o Chocolatey.

#### Passo 1: Instalar Chocolatey

Caso você ainda não tenha o Chocolatey instalado, você pode fazê-lo através do terminal (CMD) como administrador, executando o seguinte comando:

```cmd
Set-ExecutionPolicy Bypass -Scope Process -Force; `
[System.Net.ServicePointManager]::SecurityProtocol = [System.Net.ServicePointManager]::SecurityProtocol -bor 3072; `
iex ((New-Object System.Net.WebClient).DownloadString('https://community.chocolatey.org/install.ps1'))
```

#### Passo 2: Instalar o FVM via Chocolatey

Com o Chocolatey instalado, você pode instalar o FVM com o seguinte comando no terminal:

```cmd
choco install fvm
```

Isso irá instalar o FVM no seu sistema, permitindo que você comece a gerenciar versões do Flutter. Por padrão, o diretório `.fvm` será criado no diretório padrão do usuário.

### Como instalar o FVM mantendo o `.fvm` em um diretório padrão (Windows com Chocolatey)?

Para manter o diretório `.fvm` no local padrão (geralmente dentro do diretório do usuário), basta seguir o processo de instalação padrão do FVM, conforme descrito acima. O diretório onde o FVM armazenará as versões do Flutter será, por padrão:

```
C:\Users\SeuUsuario\fvm
```

Esse comportamento padrão não exige configuração adicional, e o FVM automaticamente criará e utilizará esse diretório para armazenar as versões do SDK Flutter.

### Como instalar o FVM mantendo o `.fvm` em um diretório específico (Windows com Chocolatey)?

Se você deseja configurar um diretório específico onde o FVM armazenará as versões do Flutter, você pode configurar a variável de ambiente `FVM_HOME` para apontar para o local desejado antes de instalar o FVM.

#### Passo 1: Definir o diretório específico

Primeiro, escolha o diretório onde você deseja armazenar as versões do Flutter, por exemplo:

```
D:\Ferramentas\Flutter\fvm
```

#### Passo 2: Configurar a variável de ambiente

No Windows, siga estes passos:

1. Abra o **Painel de Controle** e vá em **Sistema**.
2. Selecione **Configurações avançadas do sistema**.
3. Clique em **Variáveis de Ambiente**.
4. Em **Variáveis do Sistema**, clique em **Novo**.
5. Nomeie a nova variável como `FVM_CACHE_PATH` e defina o valor como o caminho do diretório desejado:

```
D:\Ferramentas\Flutter\fvm
```

#### Passo 3: Instalar o FVM

Agora, com a variável de ambiente configurada, execute o comando de instalação do FVM via Chocolatey:

```cmd
choco install fvm
```

Com isso, o FVM irá armazenar todas as versões do Flutter no diretório definido na variável `FVM_CACHE_PATH`.

### Restrições de Uso

Embora o FVM seja uma ferramenta poderosa, ele possui algumas restrições e considerações importantes:

1. **Versão do Flutter e Compatibilidade com o Projeto**: É crucial garantir que a versão selecionada para o projeto seja compatível com todas as dependências utilizadas. Algumas bibliotecas podem ser incompatíveis com versões mais recentes ou mais antigas do Flutter.
   
2. **Configuração do CI/CD**: Quando usando FVM em ambientes de Integração Contínua, é necessário configurar corretamente o pipeline para utilizar a versão correta do Flutter. Certifique-se de que o ambiente de CI/CD tem o FVM instalado e configurado.

3. **Manutenção de Versões**: Múltiplas versões do Flutter podem ocupar uma quantidade significativa de espaço em disco, especialmente se você tiver vários projetos utilizando diferentes versões.

4. **Alterações em Versionamento Global**: Se você configurar o FVM para um projeto específico, lembre-se de que ele altera o comportamento padrão do Flutter somente para aquele projeto. Se você tentar rodar `flutter` fora do contexto de um projeto gerenciado pelo FVM, o sistema utilizará a versão global do Flutter, que pode não ser a versão correta para aquele projeto.

### Exemplo de Arquivo `fvm_config.json`

O arquivo `fvm_config.json` define a versão do Flutter que será usada por determinado projeto. Um exemplo desse arquivo seria:

```json
{
  "flutterSdkVersion": "2.10.5"
}
```

Esse arquivo deve estar localizado na raiz do projeto e é automaticamente gerado quando você seleciona uma versão do Flutter utilizando o comando FVM.

### Comandos Úteis do FVM

Aqui estão alguns comandos úteis que você pode usar com o FVM:

- **Instalar uma versão específica do Flutter**:

```bash
fvm install 3.0.0
```

- **Configurar uma versão do Flutter para o projeto atual**:

```bash
fvm use 3.0.0
```

- **Verificar a versão do Flutter utilizada em um projeto**:

```bash
fvm flutter --version
```

- **Listar todas as versões do Flutter instaladas**:

```bash
fvm list
```

- **Remover uma versão específica do Flutter**:

```bash
fvm remove 2.10.5
```

### Considerações Finais

O **FVM** é uma ferramenta essencial para projetos Flutter que requerem a gestão de múltiplas versões do SDK. Ele facilita o trabalho em equipes e ambientes de CI/CD, mantendo a consistência e compatibilidade entre versões. Sua instalação e configuração são relativamente simples, e o gerenciamento do SDK através dele traz uma série de benefícios para o desenvolvimento e manutenção de projetos.