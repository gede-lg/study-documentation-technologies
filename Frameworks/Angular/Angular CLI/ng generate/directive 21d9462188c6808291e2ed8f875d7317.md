# directive

**Título:**

**Desvendando `ng generate directive` no Angular CLI: Guia Completo e Prático**

---

### 1. Introdução

O comando `ng generate directive` (ou seu atalho `ng g d`) faz parte do Angular CLI e automatiza a criação de **directives**, estruturas fundamentais para estender o comportamento ou a aparência de elementos HTML e componentes Angular. Neste guia, exploraremos cada detalhe desse comando, desde sua base teórica até exemplos completos de uso.

---

### 2. Sumário

1. [Conceitos Fundamentais](https://chatgpt.com/c/685bd1e4-9d88-8013-9f64-1ff6bede9ffc#conceitos-fundamentais)
2. [Sintaxe e Uso](https://chatgpt.com/c/685bd1e4-9d88-8013-9f64-1ff6bede9ffc#sintaxe-e-uso)
3. [Restrições de Uso](https://chatgpt.com/c/685bd1e4-9d88-8013-9f64-1ff6bede9ffc#restricoes-de-uso)
4. [Argumentos](https://chatgpt.com/c/685bd1e4-9d88-8013-9f64-1ff6bede9ffc#argumentos)
5. [Opções](https://chatgpt.com/c/685bd1e4-9d88-8013-9f64-1ff6bede9ffc#opcoes)
    - Schematic-specific
    - Global
6. [Melhores Práticas e Casos de Uso](https://chatgpt.com/c/685bd1e4-9d88-8013-9f64-1ff6bede9ffc#melhores-praticas-e-casos-de-uso)
7. [Exemplos Completos](https://chatgpt.com/c/685bd1e4-9d88-8013-9f64-1ff6bede9ffc#exemplos-completos)
8. [Tópicos Adicionais](https://chatgpt.com/c/685bd1e4-9d88-8013-9f64-1ff6bede9ffc#topicos-adicionais)
9. [Tópicos Relacionados para Aprofundamento](https://chatgpt.com/c/685bd1e4-9d88-8013-9f64-1ff6bede9ffc#topicos-relacionados-para-aprofundamento)

---

### 3. Conceitos Fundamentais

- **O que é uma Directive?**
    - Uma *directive* é uma classe que adiciona comportamento a elementos do DOM: altera estilo, responde a eventos ou modifica a estrutura DOM (no caso de *structural directives* como `ngIf` e `ngFor`).
- **Tipos de Directives:**
    - **Attribute Directives:** Mudam a aparência ou comportamento de um elemento (ex.: `ngClass`, `ngStyle`).
    - **Structural Directives:** Alteram o layout do DOM adicionando ou removendo elementos (ex.: `ngIf`, `ngFor`).
- **Por que usar o Angular CLI?**
    - Garante consistência no nome de arquivos e nas anotações (decorators).
    - Já injeta boilerplate com imports e testes configurados.
    - Facilita configurações avançadas (e.g., standalone directives).

---

### 4. Sintaxe e Uso

```bash
# Forma completa
ng generate directive <name> [options]

# Atalho
ng g d <name> [options]

```

- **`<name>`** pode incluir caminho:
    
    ```bash
    ng g d shared/highlight
    
    ```
    
    Gera `src/app/shared/highlight.directive.ts` e registra no módulo mais próximo.
    

---

### 5. Restrições de Uso

- **Quando NÃO usar `ng generate directive`:**
    - Para estender componentes (usar `ng generate component`).
    - Para lógica meramente de transformação de dados (usar *pipes*).
    - Em projetos que adotam apenas *standalone* e não querem gerenciar módulos – prefira criar manualmente para controlar imports.
- **Por que evitar em módulos múltiplos sem especificar `-module`:**
    - O CLI pode não localizar corretamente o NgModule alvo e falhar ao importar.

---

### 6. Argumentos

| Argumento | Descrição | Tipo |
| --- | --- | --- |
| `name` | Nome da directive (e da classe e arquivos gerados). Pode incluir path relativo. | string |

---

### 7. Opções

### 7.1 Schematic-specific

Todas as opções listadas a seguir são específicas para o *schematic* `directive` ([angular.dev](https://angular.dev/cli/generate/directive)):

| Opção | Alias | Descrição | Tipo | Default |
| --- | --- | --- | --- | --- |
| `--export` | – | Exporta automaticamente a directive no NgModule especificado, permitindo uso em outros módulos. | boolean | false |
| `--flat` | – | Se `true`, gera arquivos no diretório atual; se `false`, cria uma pasta com o nome da directive. | boolean | true |
| `--module` | `-m` | Especifica o NgModule para declaração da directive. Se omitido, o CLI busca o módulo mais próximo no caminho. | string | — |
| `--prefix` | `-p` | Define o prefixo do seletor. Ex.: prefixo `app` + nome `highlight` → `<appHighlight>`. | string | configurado em `angular.json` |
| `--project` | – | Escolhe o projeto no workspace onde a directive será criada (útil em monorepos). | string | diretório atual |
| `--selector` | – | Define manualmente o seletor HTML da directive. Se omitido, é gerado a partir de `prefix` + `name`. | string | gerado |
| `--skip-import` | – | Não importa automaticamente a directive no NgModule. | boolean | false |
| `--skip-tests` | – | Não gera o arquivo de teste `.spec.ts`. | boolean | false |
| `--standalone` | – | Gera a directive como standalone, sem necessidade de declaração em NgModule. | boolean | true |
| `--type` | – | Sufixo customizado para o nome do arquivo. Ex.: `--type=directive` gera `nome.directive.ts`. | string | — |

### 7.2 Global (herdadas de `ng generate`)

Estas opções funcionam com **qualquer** schematic quando usadas junto de `ng generate` ([angular.dev](https://angular.dev/cli/generate)):

| Opção | Alias | Descrição | Tipo | Default |
| --- | --- | --- | --- | --- |
| `--defaults` | – | Desabilita prompts interativos, assumindo valores padrão para todas opções. | boolean | false |
| `--dry-run` | `-d` | Simula a geração sem criar arquivos, relatando ações que seriam executadas. | boolean | false |
| `--force` | – | Força sobrescrição de arquivos existentes sem confirmação. | boolean | false |
| `--help` | – | Exibe ajuda para o comando no console. | boolean | — |
| `--interactive` | – | Habilita prompts interativos para opções sem valor definido. | boolean | true |

---

### 8. Melhores Práticas e Casos de Uso

- **Nomenclatura Consistente:**
    - Use nomes descritivos e kebab-case (e.g., `highlight-text`).
- **Modularização:**
    - Agrupe directives relacionadas em pastas e módulos dedicados.
- **Standalone vs NgModule:**
    - Para aplicações modernas, prefira `-standalone true` e importe as directives diretamente em componentes que as utilizam.
- **Testes:**
    - Mantenha `-skip-tests=false` para garantir cobertura de unit tests.
- **Registro Manual (quando necessário):**
    - Em projetos com múltiplos módulos, utilize `-skip-import=true` e registre manualmente para evitar imports incorretos.
- **Uso de `flat=false`:**
    - Crie pastas próprias para cada directive em grandes projetos, melhorando organização.

---

### 9. Exemplos Completos

### 9.1 Criando uma Directive Standalone

```bash
ng g d highlighter \
  --standalone true \
  --selector=appHighlighter \
  --skip-tests

```

- **Resultado**:
    - `src/app/highlighter.directive.ts` (directive standalone)
    - Sem arquivo de teste.

```
import { Directive, ElementRef, HostListener, Input } from '@angular/core';

@Directive({
  standalone: true,
  selector: '[appHighlighter]'
})
export class HighlighterDirective {
  @Input() appHighlighter = '';

  constructor(private el: ElementRef) {}

  @HostListener('mouseenter')
  onMouseEnter() {
    this.highlight(this.appHighlighter || 'yellow');
  }

  @HostListener('mouseleave')
  onMouseLeave() {
    this.highlight('');
  }

  private highlight(color: string) {
    this.el.nativeElement.style.backgroundColor = color;
  }
}

```

### 9.2 Geração e Registro Clássico em NgModule

```bash
ng g d shared/card \
  --module=app.module.ts \
  --export \
  --flat=false

```

- **Arquivos criados:**
    - `src/app/shared/card/card.directive.ts`
    - `src/app/shared/card/card.directive.spec.ts`
- **Registro automático em `AppModule`:**
    
    ```
    @NgModule({
      declarations: [CardDirective],
      exports: [CardDirective],
      …
    })
    export class AppModule { }
    
    ```
    

---

### 10. Tópicos Adicionais

- Lifecycle hooks em directives (`OnInit`, `OnDestroy`, etc.).
- Diretrizes estruturais customizadas com `TemplateRef` e `ViewContainerRef`.
- Directive Composition API (Angular ≥15).
- Integração com `Renderer2` para maior segurança DOM.

---

### 11. Tópicos Relacionados para Aprofundamento

- **`ng generate component`**: criação de componentes sob medida.
- **`ng generate pipe`**: geração de pipes para transformação de dados.
- **Criação de Schematics personalizados**: estender o CLI.
- **Angular Standalone Components & Directives**: evolução do modelo de módulos.
- **Testes avançados em Directives**: uso de `ComponentHarness` e `TestBed`.

---

Com este guia, você tem em mãos tudo o que precisa para dominar o `ng generate directive` no Angular CLI, desde a fundamentação teórica até exemplos práticos e completas listas de opções. Bom desenvolvimento!