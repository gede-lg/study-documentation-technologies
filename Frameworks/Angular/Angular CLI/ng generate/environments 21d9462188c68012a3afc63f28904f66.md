# environments

**Título:**

Gerando e Configurando Arquivos de Ambiente com a CLI do Angular

---

## Introdução

No desenvolvimento de aplicações Angular, muitas vezes precisamos alterar valores de configuração (URLs de API, flags de recurso, chaves de serviço) dependendo do ambiente de execução (desenvolvimento, homologação, produção, etc.). O comando `ng generate environments` da Angular CLI automatiza a criação e registro dos arquivos de ambiente em seu projeto, configurando também as substituições de arquivos (file replacements) no **`angular.json`** para cada build target. ([angular.dev](https://angular.dev/cli/generate/environments), [angular.dev](https://angular.dev/tools/cli/environments?utm_source=chatgpt.com))

---

## Sumário

1. [Conceitos Fundamentais](https://chatgpt.com/c/685bd1e4-9d88-8013-9f64-1ff6bede9ffc#conceitos-fundamentais)
2. [Sintaxe e Uso](https://chatgpt.com/c/685bd1e4-9d88-8013-9f64-1ff6bede9ffc#sintaxe-e-uso)
3. [Restrições de Uso](https://chatgpt.com/c/685bd1e4-9d88-8013-9f64-1ff6bede9ffc#restricoes-de-uso)
4. [Argumentos](https://chatgpt.com/c/685bd1e4-9d88-8013-9f64-1ff6bede9ffc#argumentos)
5. [Opções](https://chatgpt.com/c/685bd1e4-9d88-8013-9f64-1ff6bede9ffc#opcoes)
    - Schematic-específicas
    - Globais do Angular CLI
6. [Melhores Práticas e Casos de Uso](https://chatgpt.com/c/685bd1e4-9d88-8013-9f64-1ff6bede9ffc#melhores-praticas-e-casos-de-uso)
7. [Exemplos Completos](https://chatgpt.com/c/685bd1e4-9d88-8013-9f64-1ff6bede9ffc#exemplos-completos)
8. [Tópicos Adicionais](https://chatgpt.com/c/685bd1e4-9d88-8013-9f64-1ff6bede9ffc#topicos-adicionais)
9. [Para Aprofundar](https://chatgpt.com/c/685bd1e4-9d88-8013-9f64-1ff6bede9ffc#para-aprofundar)

---

## Conceitos Fundamentais

- **Arquivos de Ambiente:** são módulos TypeScript (por exemplo, `environment.ts`, `environment.prod.ts`) que exportam um objeto `environment` contendo variáveis de configuração específicas do ambiente. ([angular.dev](https://angular.dev/tools/cli/environments?utm_source=chatgpt.com))
- **Substituições de Arquivo (File Replacements):** parte do builder de aplicações em `angular.json` que, para cada configuração (`development`, `production`, `staging` etc.), troca o arquivo base por um arquivo específico daquele ambiente. Isso garante que, ao executar `ng build --configuration staging`, o Angular substitua `src/environments/environment.ts` por `src/environments/environment.staging.ts`. ([angular.dev](https://angular.dev/tools/cli/environments?utm_source=chatgpt.com))
- **Esquemáticos (Schematics):** mecanismos por trás dos comandos `ng generate`, que inspecionam um JSON Schema e geram ou modificam arquivos no projeto de acordo com as opções fornecidas. ([angular.dev](https://angular.dev/tools/cli/schematics?utm_source=chatgpt.com))

---

## Sintaxe e Uso

```bash
ng generate environments [options]

```

- **O que faz:** cria a pasta `src/environments/` (se ainda não existir), gera o boilerplate de arquivos de ambiente e atualiza o `angular.json` com as configurações de `fileReplacements`. ([angular.dev](https://angular.dev/cli/generate/environments), [angular.dev](https://angular.dev/tools/cli/environments?utm_source=chatgpt.com))
- **Fluxo típico de uso:**
    1. No terminal, dentro do diretório do seu workspace Angular, execute `ng generate environments`.
    2. Edite os arquivos recém-criados (`environment.development.ts`, `environment.production.ts`, etc.) para ajustar as variáveis de seu projeto.
    3. Construa com `ng build --configuration=<nome_do_ambiente>` para aplicar as substituições.

---

## Restrições de Uso

- **Versões do Angular CLI:** em versões anteriores à v15, o comando não existia por padrão e resultava em erro `A collection and schematic is required during execution`. ([github.com](https://github.com/angular/angular-cli/issues/24624?utm_source=chatgpt.com))
- **Projetos sem Angular CLI:** monorepos gerenciados por outras ferramentas (Nx, Bazel) podem ter estratégias diferentes de ambiente; o esquema pode não se aplicar diretamente.
- **Gestão de Segredos:** *não* armazene informações sensíveis (chaves-secretas, tokens) em arquivos de ambiente do front-end, pois eles ficam embutidos no bundle final e podem vazar. ([medium.com](https://medium.com/%40philip.mutua/setting-up-environment-variables-for-an-angular-application-from-scratch-737028f8b7b3?utm_source=chatgpt.com))

---

## Argumentos

| Argumento | Tipo | Descrição |
| --- | --- | --- |
| `project` | string | Nome do projeto (conforme definido em `angular.json`) onde os arquivos de ambiente serão criados ou atualizados. ([angular.dev](https://angular.dev/cli/generate/environments)) |

---

## Opções

### Esquemático-específicas

- `-project <string>`
    
    Define explicitamente em qual projeto (em workspaces com múltiplos projetos) o schematic deve atuar. ([angular.dev](https://angular.dev/cli/generate/environments))
    

### Globais do Angular CLI

Estas opções se aplicam a *todos* os comandos `ng generate`: ([vskills.in](https://www.vskills.in/certification/tutorial/angular-cli-2/?utm_source=chatgpt.com))

| Opção | Alias | Tipo | Descrição |
| --- | --- | --- | --- |
| `--dry-run` | `-d` | boolean | Executa sem gravar alterações, mostrando o que seria feito. |
| `--force` | `-f` | boolean | Força sobrescrita de arquivos existentes. |

Além disso, comandos Angular CLI suportam (em geral) flags como:

- `-help` / `h`: exibe ajuda.
- `-defaults`: usa valores padrão sem prompt interativo.
- `-no-interactive`: desativa prompts.
- `-skip-install`: pulas instalações automáticas de dependências.
    
    *(Para ver todas as globais, rode `ng help`)*
    

---

## Melhores Práticas e Casos de Uso

1. **Manter Simplicidade:** crie apenas os ambientes realmente necessários (ex.: development, staging, production). Demais variações podem ser controladas por variáveis de ambiente no servidor de CI/CD. ([angular.dev](https://angular.dev/tools/cli/environments?utm_source=chatgpt.com))
2. **Versão de Produção como Padrão:** configure o `defaultConfiguration` no seu `angular.json` para `production`, reduzindo riscos de builds de teste em produção.
3. **Revisão de fileReplacements:** sempre verifique se as substituições de arquivo estão corretas após gerar novos ambientes.
4. **Segurança:** nunca inclua segredos; use variáveis de ambiente do servidor para injetar configurações sensíveis no build process. ([medium.com](https://medium.com/%40philip.mutua/setting-up-environment-variables-for-an-angular-application-from-scratch-737028f8b7b3?utm_source=chatgpt.com))
5. **CI/CD Integrado:** configure seu pipeline (GitHub Actions, GitLab CI, Jenkins) para chamar `ng build --configuration=<env>` e implantar automaticamente.

---

## Exemplos Completos

### 1. Estrutura Gerada

```
my-angular-app/
├── src/
│   └── environments/
│       ├── environment.ts
│       ├── environment.development.ts
│       └── environment.production.ts
├── angular.json
└── ...

```

### 2. Comando de Geração

```bash
ng generate environments --project=my-angular-app

```

### 3. angular.json (trecho)

```json
"projects": {
  "my-angular-app": {
    "architect": {
      "build": {
        "configurations": {
          "production": {
            "fileReplacements": [
              {
                "replace": "src/environments/environment.ts",
                "with": "src/environments/environment.production.ts"
              }
            ],
            ...
          },
          "development": {
            "fileReplacements": [
              {
                "replace": "src/environments/environment.ts",
                "with": "src/environments/environment.development.ts"
              }
            ]
          }
        }
      }
    }
  }
}

```

Nesse contexto, ao executar:

```bash
ng build --configuration=development

```

o Angular substituirá automaticamente o arquivo de ambiente base pelo específico, garantindo que sua aplicação carregue as configurações corretas por ambiente. ([angular.dev](https://angular.dev/tools/cli/environments?utm_source=chatgpt.com))

---

## Tópicos Adicionais

- **`defaultConfiguration` no `angular.json`:** como definir o comportamento padrão de `ng serve` e `ng build`.
- **Uso de variáveis de ambiente do sistema** em aplicações Angular com plugins como `dotenv`.
- **Escrevendo Schematics customizados** para estender funcionalidades de geração de ambiente.

---

## Para Aprofundar

- **`ng build --configuration`** – opções avançadas de build por ambiente.
- **Custom Webpack** – integrar configurações especiais de ambiente com `@angular-builders/custom-webpack`.
- **Segurança em aplicações front-end** – boas práticas para gestão de segredos.
- **Angular DevKit Schematics** – desenvolvendo seus próprios generators.
- **Continuous Deployment** – pipelines CI/CD para múltiplos ambientes.

Com essas diretrizes, você terá um entendimento completo de como o `ng generate environments` funciona, suas limitações e como usá-lo de forma eficiente em projetos Angular de qualquer escala.