# guard

**Título:**

Dominando o Comando `ng generate guard` no Angular CLI: Guia Completo

---

## Introdução

O comando `ng generate guard` do Angular CLI permite criar rapidamente *route guards* em seu projeto, integrando-se diretamente ao sistema de roteamento do Angular para controlar o acesso a partes específicas da aplicação antes de uma rota ser ativada ([angular.io](https://angular.io/guide/router?utm_source=chatgpt.com), [angular.dev](https://angular.dev/cli/generate/guard)).

---

## Sumário

1. [Conceitos Fundamentais](https://chatgpt.com/c/685bd1e4-9d88-8013-9f64-1ff6bede9ffc#conceitos-fundamentais)
2. [Sintaxe e Uso](https://chatgpt.com/c/685bd1e4-9d88-8013-9f64-1ff6bede9ffc#sintaxe-e-uso)
3. [Restrições de Uso](https://chatgpt.com/c/685bd1e4-9d88-8013-9f64-1ff6bede9ffc#restricoes-de-uso)
4. [Argumentos](https://chatgpt.com/c/685bd1e4-9d88-8013-9f64-1ff6bede9ffc#argumentos)
5. [Opções](https://chatgpt.com/c/685bd1e4-9d88-8013-9f64-1ff6bede9ffc#opcoes)
    - Específicas ao *schematic*
    - Globais do Angular CLI
6. [Melhores Práticas e Casos de Uso](https://chatgpt.com/c/685bd1e4-9d88-8013-9f64-1ff6bede9ffc#melhores-praticas-e-casos-de-uso)
7. [Exemplos Completos](https://chatgpt.com/c/685bd1e4-9d88-8013-9f64-1ff6bede9ffc#exemplos-completos)
8. [Tópicos Adicionais](https://chatgpt.com/c/685bd1e4-9d88-8013-9f64-1ff6bede9ffc#topicos-adicionais)
9. [Tópicos Relacionados para Aprofundamento](https://chatgpt.com/c/685bd1e4-9d88-8013-9f64-1ff6bede9ffc#topicos-relacionados-para-aprofundamento)

---

## Conceitos Fundamentais

- **Route Guards:** Serviços que implementam interfaces do módulo `@angular/router` para decidir se uma rota pode ser ativada, desativada ou combinada, permitindo proteger fluxos de navegação ([medium.com](https://medium.com/%40sehban.alam/everything-you-need-to-know-about-angular-guards-768c21ddbe2b?utm_source=chatgpt.com), [angular.io](https://angular.io/api/router/CanActivate?utm_source=chatgpt.com)).
- **Interfaces Principais:**
    - `CanActivate` – controla se uma rota pode ser carregada ([angular.io](https://angular.io/api/router/CanActivate?utm_source=chatgpt.com)).
    - `CanActivateChild` – controla acesso a rotas-filhas.
    - `CanDeactivate` – confirma se o usuário pode deixar a rota atual ([angular.io](https://angular.io/guide/glossary?utm_source=chatgpt.com)).
    - `CanMatch` – determina se uma rota corresponde ao padrão de navegação.
- **Funcionamento:** Ao navegar, o Angular invoca o(s) método(s) do guard, que retornam `boolean`, `UrlTree`, `Observable<boolean|UrlTree>` ou `Promise<boolean|UrlTree>`. Se todos permitirem, a navegação prossegue; caso contrário, é interrompida ou redirecionada.

---

## Sintaxe e Uso

```bash
# Forma completa
ng generate guard <nome-do-guard> [opções]

# Forma abreviada
ng g guard <nome-do-guard> [opções]

```

No exemplo abaixo, criamos um guard chamado `auth` no diretório `src/app/guards`:

```bash
ng generate guard guards/auth --implements CanActivate --skip-tests

```

Isso gerará os arquivos:

- `src/app/guards/auth.guard.ts`
- `src/app/guards/auth.guard.spec.ts` (será omitido se usar `-skip-tests`) ([angular.dev](https://angular.dev/cli/generate/guard)).

---

## Restrições de Uso

- **Não para Busca de Dados:** Evite carregar dados pesados nos guards; utilize *resolvers* (interface `Resolve`) para pré-carregar informações antes da ativação da rota ([angular.io](https://angular.io/api/router/Resolve?utm_source=chatgpt.com), [angular.io](https://angular.io/guide/lazy-loading-ngmodules?utm_source=chatgpt.com)).
- **Não exagere na Lógica:** Guards devem ser rápidos e determinísticos. Lógica de negócio complexa deve residir em serviços dedicados.
- **Não substituir AuthService:** O guard deve delegar validações a serviços de autenticação/autorização, não implementar diretamente regras de negócio.

---

## Argumentos

| Argumento | Tipo | Descrição |
| --- | --- | --- |
| `name` | string | Nome do guard. Usado para gerar a classe e o arquivo de testes (e.g., `auth.guard.ts`). |

> (angular.dev)
> 

---

## Opções

### Específicas ao *schematic* `guard`

| Opção | Alias | Tipo | Padrão | Descrição |
| --- | --- | --- | --- | --- |
| `--flat` | — | boolean | `true` | Cria os arquivos no nível atual em vez de dentro de uma pasta com o nome do guard. |
| `--functional` | — | boolean | `true` | Gera o guard como função (`CanActivateFn`, etc.) em vez de classe. |
| `--implements` | `--guardType` | array | — | Tipos de guard a implementar: `CanActivate`, `CanActivateChild`, `CanDeactivate`, `CanMatch`. |
| `--project` | — | string | — | Projeto onde o guard será criado (útil em *workspaces* com múltiplos projetos). |
| `--skip-tests` | — | boolean | `false` | Omitir o arquivo de teste `.spec.ts`. |
| `--type-separator` | — | string | `-` | Separador antes do tipo no nome do arquivo (e.g., `.guard.ts` se `.` for usado). |

> (angular.dev)
> 

### Globais do Angular CLI para o comando `generate`

| Opção | Alias | Tipo | Padrão | Descrição |
| --- | --- | --- | --- | --- |
| `--defaults` | — | boolean | `false` | Desativa prompts interativos para opções padrão. |
| `--dry-run` | `-d` | boolean | `false` | Simula a execução, reporta apenas as ações sem gravar arquivos. |
| `--force` | — | boolean | `false` | Força sobrescrição de arquivos existentes. |
| `--help` | — | boolean | — | Exibe ajuda sobre o comando. |
| `--interactive` | — | boolean | `true` | Habilita ou desabilita prompts interativos. |

> (angular.dev)
> 

---

## Melhores Práticas e Casos de Uso

- **Direcione a Lógica de Validação:** Mantenha a lógica de autorização em serviços reutilizáveis, usando o guard apenas para orquestração ([medium.com](https://medium.com/%40sehban.alam/everything-you-need-to-know-about-angular-guards-768c21ddbe2b?utm_source=chatgpt.com), [angular.io](https://angular.io/guide/styleguide?utm_source=chatgpt.com)).
- **Teste Automatizado:** Garanta cobertura de testes para cada cenário de navegação bloqueada e permitida.
- **Guards Múltiplos:** Combine vários guards em uma rota para divisões claras de responsabilidades (e.g., autenticação, autorização de perfil).
- **Uso de Guards Funcionais:** Em cenários simples, prefira guards funcionais pela menor verbosidade.

---

## Exemplos Completos

### 1. Guard de Autenticação (Classe)

```
// src/app/guards/auth.guard.ts
import { Injectable } from '@angular/core';
import { CanActivate, Router, UrlTree } from '@angular/router';
import { AuthService } from '../services/auth.service';

@Injectable({ providedIn: 'root' })
export class AuthGuard implements CanActivate {
  constructor(private authService: AuthService, private router: Router) {}

  canActivate(): boolean | UrlTree {
    return this.authService.isLoggedIn()
      ? true
      : this.router.parseUrl('/login');
  }
}

```

```
// src/app/app-routing.module.ts
const routes: Routes = [
  { path: 'dashboard', component: DashboardComponent, canActivate: [AuthGuard] },
  { path: 'login', component: LoginComponent },
];

```

Este exemplo segue convenções de nomenclatura recomendadas pelo guia de estilo do Angular ([angular.io](https://angular.io/guide/styleguide?utm_source=chatgpt.com)).

### 2. Guard Funcional (TypeScript)

```
// src/app/guards/auth.guard.ts
import { inject } from '@angular/core';
import { CanActivateFn, Router } from '@angular/router';
import { AuthService } from '../services/auth.service';

export const authGuard: CanActivateFn = () => {
  const auth = inject(AuthService);
  const router = inject(Router);
  return auth.isLoggedIn() || router.createUrlTree(['/login']);
};

```

```
// src/app/app-routing.module.ts
const routes: Routes = [
  { path: 'profile', component: ProfileComponent, canActivate: [authGuard] },
];

```

---

## Tópicos Adicionais

- Implementação de Guards para Rotas Filhas (`CanActivateChild`)
- Guards de Desativação para Formulários Não Salvos (`CanDeactivate`)
- Uso de `CanMatch` em Lazy-Loaded Modules
- Testes Unitários e E2E para Guards
- Desenvolvimento de *Schematics* Personalizados

---

## Tópicos Relacionados para Aprofundamento

- `ng generate service` e padrões de injeção de dependência
- Angular Resolvers e pré-carregamento de dados
- Lazy Loading de Módulos e otimização de bundle
- Autorizações baseadas em *Roles* e *Claims*
- Criação de *Schematics* úteis para automação de código

Espero que este guia lhe dê uma visão completa e prática do comando `ng generate guard` no Angular CLI. Se precisar de mais detalhes, fique à vontade para perguntar!