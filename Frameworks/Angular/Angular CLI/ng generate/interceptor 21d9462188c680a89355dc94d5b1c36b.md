# interceptor

**Título:**

Gerando e Configurando Interceptores HTTP com Angular CLI (`ng generate interceptor`)

---

## 1. Introdução

O comando `ng generate interceptor` (ou `ng g interceptor`) faz parte do Angular CLI e serve para criar, de forma padronizada, a estrutura básica de um *interceptor* HTTP em aplicações Angular. Interceptores são serviços que implementam a interface `HttpInterceptor` e permitem inspecionar e transformar requisições e respostas HTTP globalmente em sua aplicação ([v17.angular.io](https://v17.angular.io/guide/http-intercept-requests-and-responses?utm_source=chatgpt.com)).

---

## 2. Sumário

1. [Conceitos Fundamentais](https://chatgpt.com/c/685bd1e4-9d88-8013-9f64-1ff6bede9ffc#3-conceitos-fundamentais)
2. [Sintaxe e Uso](https://chatgpt.com/c/685bd1e4-9d88-8013-9f64-1ff6bede9ffc#4-sintaxe-e-uso)
3. [Restrições de Uso](https://chatgpt.com/c/685bd1e4-9d88-8013-9f64-1ff6bede9ffc#5-restri%C3%A7%C3%B5es-de-uso)
4. [Argumentos](https://chatgpt.com/c/685bd1e4-9d88-8013-9f64-1ff6bede9ffc#6-argumentos)
5. [Opções](https://chatgpt.com/c/685bd1e4-9d88-8013-9f64-1ff6bede9ffc#7-op%C3%A7%C3%B5es)
    - Específicas do *schematic*
    - Globais do Angular CLI
6. [Melhores Práticas e Casos de Uso](https://chatgpt.com/c/685bd1e4-9d88-8013-9f64-1ff6bede9ffc#8-melhores-pr%C3%A1ticas-e-casos-de-uso)
7. [Exemplos Completos](https://chatgpt.com/c/685bd1e4-9d88-8013-9f64-1ff6bede9ffc#9-exemplos-completos)
8. [Tópicos Adicionais](https://chatgpt.com/c/685bd1e4-9d88-8013-9f64-1ff6bede9ffc#10-t%C3%B3picos-adicionais)
9. [Sugestões de Aprofundamento](https://chatgpt.com/c/685bd1e4-9d88-8013-9f64-1ff6bede9ffc#11-sugest%C3%B5es-de-aprofundamento)

---

## 3. Conceitos Fundamentais

- **HttpInterceptor**: interface que define o método `intercept(req, next)`, onde você pode ler/alterar a requisição antes de enviá-la e processar a resposta antes de entregá-la ao componente ([v17.angular.io](https://v17.angular.io/guide/http-interceptor-use-cases?utm_source=chatgpt.com)).
- **Papel do *schematic***: gera arquivos `.ts` e `.spec.ts` básicos, com injeção de dependência e assinatura de `HttpInterceptor`.
- **Registro do Interceptor**: normalmente, registra-se no `AppModule` ou em módulos específicos usando o token `HTTP_INTERCEPTORS`, com `{ provide: HTTP_INTERCEPTORS, useClass: SeuInterceptor, multi: true }`.

---

## 4. Sintaxe e Uso

```bash
ng generate interceptor <nome> [options]
# abreviação
ng g interceptor <nome> [options]

```

- `<nome>`: nome do interceptor a ser criado.
- `[options]`: flags que ajustam comportamento (v. seção 7). ([medium.com](https://medium.com/%40gokulbudha/interceptors-in-angular-aee9b247d4c5?utm_source=chatgpt.com))

**Exemplo de comando**:

```bash
ng g interceptor auth --flat=false --skip-tests --project=my-app

```

---

## 5. Restrições de Uso

- **Aplicações sem Angular CLI**: não faz sentido usar este comando em projetos que não usam CLI.
- **Interceptors manuais**: se você já tem um serviço customizado e prefere um *boilerplate* mais específico, pode criar o `class` manualmente.
- **Modularização avançada**: em cenários de *lazy loading* extremo, talvez queira registrar interceptors apenas em módulos específicos, não globalmente. ([v17.angular.io](https://v17.angular.io/guide/http-interceptor-use-cases?utm_source=chatgpt.com))

---

## 6. Argumentos

| Argumento | Descrição | Tipo |
| --- | --- | --- |
| `<nome>` | Nome do interceptor a ser criado | string |

---

## 7. Opções

### 7.1. Específicas do Schematic

| Opção | Descrição | Tipo | Padrão |
| --- | --- | --- | --- |
| `--flat` | Cria o arquivo no diretório atual em vez de subpasta (quando `true`, top-level). | boolean | `false` ([book.vips.systems](https://book.vips.systems/pages/angular-cli.html?utm_source=chatgpt.com), [medium.com](https://medium.com/%40gokulbudha/interceptors-in-angular-aee9b247d4c5?utm_source=chatgpt.com)) |
| `--project` | Nome do projeto no workspace onde o interceptor será gerado. | string | —      ([book.vips.systems](https://book.vips.systems/pages/angular-cli.html?utm_source=chatgpt.com), [medium.com](https://medium.com/%40gokulbudha/interceptors-in-angular-aee9b247d4c5?utm_source=chatgpt.com)) |
| `--skip-tests` | Não gera o arquivo de testes (`.spec.ts`) quando `true`. | boolean | `false` ([book.vips.systems](https://book.vips.systems/pages/angular-cli.html?utm_source=chatgpt.com), [medium.com](https://medium.com/%40gokulbudha/interceptors-in-angular-aee9b247d4c5?utm_source=chatgpt.com)) |

### 7.2. Globais do Angular CLI (`ng generate`)

| Opção | Descrição | Tipo | Padrão |
| --- | --- | --- | --- |
| `--defaults` | Desativa prompts interativos para opções que têm valor padrão. | boolean | `false` ([angular.dev](https://angular.dev/cli/generate?utm_source=chatgpt.com)) |
| `--dry-run` (`-d`) | Simula execução sem gerar arquivos. | boolean | `false` ([angular.dev](https://angular.dev/cli/generate?utm_source=chatgpt.com)) |
| `--force` (`-f`) | Substitui arquivos existentes sem perguntar. | boolean | `false` ([angular.dev](https://angular.dev/cli/generate?utm_source=chatgpt.com)) |
| `--help` | Exibe ajuda do comando no console. | boolean | —      ([angular.dev](https://angular.dev/cli/generate?utm_source=chatgpt.com)) |
| `--interactive` | Habilita/desabilita prompts interativos. | boolean | `true` ([angular.dev](https://angular.dev/cli/generate?utm_source=chatgpt.com)) |

---

## 8. Melhores Práticas e Casos de Uso

1. **Autenticação**: adicione token JWT em cabeçalhos antes de cada requisição.
2. **Tratamento Global de Erros**: capture erros HTTP (e.g., 401, 500) e centralize lógica de *refresh* de token ou notificações.
3. **Logging e Telemetria**: meça tempos de requisição/resposta para auditoria e performance.
4. **Cache de Respostas**: implemente cache em memória para chamadas frequentes ([v17.angular.io](https://v17.angular.io/guide/http-interceptor-use-cases?utm_source=chatgpt.com)).
5. **Encadeamento de Múltiplos Interceptors**: a ordem importa — primeiro gerado, primeiro executado.

---

## 9. Exemplos Completos

> Contexto: projeto my-app com módulo raiz AppModule.
> 
1. **Criar aplicativo e interceptor**
    
    ```bash
    ng new my-app --routing --style=scss
    cd my-app
    ng g interceptor auth --flat=false --project=my-app
    
    ```
    
2. **Conteúdo gerado**: `src/app/auth.interceptor.ts`
    
    ```tsx
    import { Injectable } from '@angular/core';
    import {
      HttpInterceptor,
      HttpRequest,
      HttpHandler,
      HttpEvent
    } from '@angular/common/http';
    import { Observable } from 'rxjs';
    
    @Injectable()
    export class AuthInterceptor implements HttpInterceptor {
      intercept(req: HttpRequest<any>, next: HttpHandler): Observable<HttpEvent<any>> {
        const token = localStorage.getItem('token');
        const authReq = token
          ? req.clone({ setHeaders: { Authorization: `Bearer ${token}` } })
          : req;
        return next.handle(authReq);
      }
    }
    
    ```
    
3. **Registrar no `AppModule`** (`src/app/app.module.ts`):
    
    ```tsx
    import { HTTP_INTERCEPTORS } from '@angular/common/http';
    import { AuthInterceptor } from './auth.interceptor';
    @NgModule({
      // ...
      providers: [
        { provide: HTTP_INTERCEPTORS, useClass: AuthInterceptor, multi: true }
      ],
    })
    export class AppModule { }
    
    ```
    
4. **Teste rápido**: faça qualquer `HttpClient.get(...)` e verifique no DevTools que o header `Authorization` foi adicionado. ([v17.angular.io](https://v17.angular.io/guide/http-intercept-requests-and-responses?utm_source=chatgpt.com))

---

## 10. Tópicos Adicionais

- **Ordem de Execução** de múltiplos interceptors (`multi: true`).
- **Testando Interceptors** com `HttpClientTestingModule`.
- **Interceptors Assíncronos** (e.g., refresh token antes de continuar).
- **Interceptors por Módulo**: registrar apenas em módulos *lazy loaded*.
- **Performance**: evitar lógica pesada dentro de `intercept()`.

---

## 11. Sugestões de Aprofundamento

- **HTTP Interceptor Chaining**
- **Angular Dependency Injection Avançada**
- **HttpClient e Streams RxJS**
- **Testes Unitários e Mock de Requisições**
- **Token Refresh Automático**
- **Service Workers e Caching Avançado**

---

Com este guia completo, você tem tudo para gerar interceptors com o Angular CLI, entender o papel de cada opção, aplicar boas práticas e exemplos reais de uso. Bom desenvolvimento!