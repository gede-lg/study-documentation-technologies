# Overview

**Título:** Deep Dive no `ng cache` do Angular CLI: Gerenciando o Cache Persistente para Builds Rápidos

---

## Introdução

O comando `ng cache` do Angular CLI permite controlar o cache em disco das operações de build e teste, armazenando resultados de compilações anteriores para acelerar execuções subsequentes ([angular.dev](https://angular.dev/cli/cache)). A partir da versão 13.0.0 do Angular CLI, é criado automaticamente um diretório `.angular/cache` no root do projeto para armazenar esses artefatos ([stackoverflow.com](https://stackoverflow.com/questions/69953135/clear-angular-cache-in-angular-folder)).

---

## Sumário

1. [Conceitos Fundamentais](https://chatgpt.com/c/685bd1e4-9d88-8013-9f64-1ff6bede9ffc#conceitos-fundamentais)
2. [Sintaxe e Uso](https://chatgpt.com/c/685bd1e4-9d88-8013-9f64-1ff6bede9ffc#sintaxe-e-uso)
3. [Restrições de Uso](https://chatgpt.com/c/685bd1e4-9d88-8013-9f64-1ff6bede9ffc#restricoes-de-uso)
4. [Argumentos](https://chatgpt.com/c/685bd1e4-9d88-8013-9f64-1ff6bede9ffc#argumentos)
5. [Opções](https://chatgpt.com/c/685bd1e4-9d88-8013-9f64-1ff6bede9ffc#opcoes)
6. [Melhores Práticas e Casos de Uso](https://chatgpt.com/c/685bd1e4-9d88-8013-9f64-1ff6bede9ffc#melhores-praticas-e-casos-de-uso)
7. [Exemplos Completos](https://chatgpt.com/c/685bd1e4-9d88-8013-9f64-1ff6bede9ffc#exemplos-completos)
8. [Tópicos Adicionais para Exploração](https://chatgpt.com/c/685bd1e4-9d88-8013-9f64-1ff6bede9ffc#topicos-adicionais-para-exploracao)

---

## Conceitos Fundamentais

- **Cache em Disco:** O Angular CLI salva localmente artefatos de build (por exemplo, módulos Webpack pré-compilados e resultados do Babel) para reutilização em builds posteriores, reduzindo tempo de execução ([angular.dev](https://angular.dev/cli/cache), [balramchavan.medium.com](https://balramchavan.medium.com/angular-cache-whats-inside-and-how-it-improves-angular-build-timing-on-local-and-ci-pipeline-f6821d22d67a?utm_source=chatgpt.com)).
- **Pasta `.angular/cache`:** Dentro dela, há geralmente duas subpastas: `angular-webpack` (arquivos binários) e `babel-webpack` (JSON de pré-processamento) ([balramchavan.medium.com](https://balramchavan.medium.com/angular-cache-whats-inside-and-how-it-improves-angular-build-timing-on-local-and-ci-pipeline-f6821d22d67a)).
- **Ambientes Suportados:** Por padrão, o cache é habilitado apenas em ambientes **local**, mas pode ser configurado para **all** (todas as máquinas) ou **ci** (sistemas de Integração Contínua) via `ng config cli.cache.environment` ([angular.dev](https://angular.dev/cli/cache)).
- **Objetivo:** Diminuir o tempo de build e teste, melhorando a experiência de desenvolvimento e a eficiência de pipelines CI/CD ([angular.dev](https://angular.dev/cli/cache), [balramchavan.medium.com](https://balramchavan.medium.com/angular-cache-whats-inside-and-how-it-improves-angular-build-timing-on-local-and-ci-pipeline-f6821d22d67a?utm_source=chatgpt.com)).

---

## Sintaxe e Uso

```bash
ng cache [subcomando] [--help]

```

Além deste comando, configurações adicionais podem ser feitas com:

```bash
# Define ambiente de cache para todos os contextos
ng config cli.cache.environment all   # :contentReference[oaicite:6]{index=6}

# Altera o caminho padrão do cache
ng config cli.cache.path ".cache/ng"   # :contentReference[oaicite:7]{index=7}

```

### Subcomandos Principais

1. **clean**
    
    ```bash
    ng cache clean
    
    ```
    
    Deleta o cache persistente do disco. ([angular.dev](https://angular.dev/cli/cli/cache/clean))
    
2. **disable** (ou `off`)
    
    ```bash
    ng cache disable
    # ou
    ng cache off
    
    ```
    
    Desabilita o cache em disco para todos os projetos do workspace. ([angular.dev](https://angular.dev/cli/cache/disable))
    
3. **enable** (ou `on`)
    
    ```bash
    ng cache enable
    # ou
    ng cache on
    
    ```
    
    Habilita o cache em disco para todos os projetos do workspace. ([angular.dev](https://angular.dev/cli/cache/enable))
    
4. **info**
    
    ```bash
    ng cache info
    
    ```
    
    Exibe configuração atual e estatísticas do cache no console. ([angular.dev](https://angular.dev/cli/cache/info))
    

---

## Restrições de Uso

- **Ambientes CI Padrão:** O cache só é aplicado em `local` por padrão para evitar inconsistências em pipelines de CI; altere para `ci` ou `all` apenas se o CI suportar persistência entre runs ([angular.dev](https://angular.dev/cli/cache)).
- **Desenvolvimento de Bibliotecas:** Para projetos de biblioteca em que mudanças frequentes em código linkado (e.g., via `npm link`) podem gerar artefatos obsoletos, desative ou limpe o cache para garantir recompilações limpas ([elelad.medium.com](https://elelad.medium.com/avoid-cache-trap-when-serving-angular-app-c5981653d156?utm_source=chatgpt.com)).
- **Troca de Branch:** Ao alternar entre branches com diferenças significativas de código, recomenda-se executar `ng cache clean` para evitar erros de cache stale ([blog.ninja-squad.com](https://blog.ninja-squad.com/2022/06/02/angular-cli-14.0/?utm_source=chatgpt.com)).

---

## Argumentos

| Argumento | Descrição |
| --- | --- |
| `clean` | Deleta todo o cache persistente em disco. |
| `disable` (ou `off`) | Desabilita o cache em disco para todos os projetos. |
| `enable` (ou `on`) | Habilita o cache em disco para todos os projetos. |
| `info` | Exibe no console a configuração (`enabled`, `environment`, `path`) e estatísticas atuais. |

---

## Opções

| Opção | Tipo | Descrição |
| --- | --- | --- |
| `--help` | boolean | Exibe mensagem de ajuda para o comando. ([angular.dev](https://angular.dev/cli/cache)) |

---

## Melhores Práticas e Casos de Uso

- **Cache Local para Desenvolvimento:** Mantenha `environment: local` para builds rápidos durante dev, sem impactar ambientes de CI ([angular.dev](https://angular.dev/cli/cache)).
- **Cache em CI:** Em pipelines que persistem diretórios de build entre etapas (e.g., GitHub Actions com cache de caminhos), configure `environment: all` e execute `ng cache enable` antes do build ([angular.dev](https://angular.dev/cli/cache)).
- **Limpeza Programada:** Crie scripts (ou etapas no CI) para limpar caches antigos regularmente, evitando crescimento descontrolado de pasta ([github.com](https://github.com/angular/angular-cli/issues/22323?utm_source=chatgpt.com)).
- **Monitoramento de Tamanho:** Verifique periodicamente o tamanho de `.angular/cache`; grandes volumes indicam necessidade de limpeza automática.

---

## Exemplos Completos

### 1. Exemplo de `angular.json`

```
{
  "$schema": "./node_modules/@angular/cli/lib/config/schema.json",
  "version": 1,
  "cli": {
    "cache": {
      "enabled": true,
      "environment": "local",
      "path": ".angular/cache"
    }
  },
  "projects": {
    // ...
  }
}

```

*Configura o cache para uso local, no diretório padrão.* ([angular.dev](https://angular.dev/cli/cache))

### 2. Pipeline CI no GitHub Actions

```yaml
name: CI Build

on: [push]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'

      - name: Install Dependencies
        run: npm ci

      - name: Habilitar Cache CLI
        run: |
          ng config cli.cache.environment all
          ng cache enable
          ng cache info

      - name: Build Angular App
        run: ng build --configuration=production

      - name: Limpar Cache
        run: ng cache clean

```

*Exemplo de uso do cache em CI, seguido de limpeza ao final.* ([angular.dev](https://angular.dev/cli/cache), [angular.dev](https://angular.dev/cli/cache/info))

---

## Tópicos Adicionais para Exploração

- Internals do Webpack Filesystem Cache e integração com Angular ([webpack.js.org](https://webpack.js.org/configuration/cache/?utm_source=chatgpt.com))
- Estratégias de cache no Babel e impacto no build Angular
- Comparação entre `ng cache` e caches do Nx (Nx Cloud)
- Otimizações de build com Vite (pré-bundling) e flags `-prebundle` no `ng serve`
- Gerenciamento de cache de pacotes (Yarn, npm) e builds determinísticos

---

**Tópicos Relacionados para Aprofundamento:**

- Configuração do workspace no `angular.json`
- Otimização de performance de builds Angular
- Arquitetura de compilação Ivy e cache incremental
- Integração de cache em pipelines GitLab CI/CD e ZenHub
- Uso avançado de `ng config` para automação de projetos

---

Com essas informações, você dispõe de um guia completo e estruturado para entender, usar e otimizar o comando `ng cache` do Angular CLI em seus projetos.