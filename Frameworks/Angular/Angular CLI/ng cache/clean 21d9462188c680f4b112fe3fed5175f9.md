# clean

## Título

**Deep Dive no comando `ng cache clean` do Angular CLI: Limpeza e Gestão do Cache de Build**

---

## Introdução

O Angular CLI mantém, por padrão, um cache persistente em disco (na pasta `.angular/cache`) que armazena resultados de operações de build, testes e pré-bundling, acelerando execuções subsequentes. O comando `ng cache clean` remove totalmente esse cache, forçando o Angular a refazer todas as etapas do build do zero, o que pode ser útil para resolver inconsistências ou após atualizações de bibliotecas e configurações. ([tutorialspoint.com](https://www.tutorialspoint.com/angular_cli/angular_cli_ng_cache.htm?utm_source=chatgpt.com))

---

## Sumário

1. [Conceitos Fundamentais](https://chatgpt.com/c/685bd1e4-9d88-8013-9f64-1ff6bede9ffc#conceitos-fundamentais)
2. [Sintaxe e Uso](https://chatgpt.com/c/685bd1e4-9d88-8013-9f64-1ff6bede9ffc#sintaxe-e-uso)
3. [Restrições de Uso](https://chatgpt.com/c/685bd1e4-9d88-8013-9f64-1ff6bede9ffc#restri%C3%A7%C3%B5es-de-uso)
4. [Argumentos](https://chatgpt.com/c/685bd1e4-9d88-8013-9f64-1ff6bede9ffc#argumentos)
5. [Opções](https://chatgpt.com/c/685bd1e4-9d88-8013-9f64-1ff6bede9ffc#op%C3%A7%C3%B5es)
6. [Melhores Práticas e Casos de Uso](https://chatgpt.com/c/685bd1e4-9d88-8013-9f64-1ff6bede9ffc#melhores-pr%C3%A1ticas-e-casos-de-uso)
7. [Exemplos Completos](https://chatgpt.com/c/685bd1e4-9d88-8013-9f64-1ff6bede9ffc#exemplos-completos)
8. [Tópicos Adicionais](https://chatgpt.com/c/685bd1e4-9d88-8013-9f64-1ff6bede9ffc#t%C3%B3picos-adicionais)
9. [Tópicos Relacionados para Aprofundamento](https://chatgpt.com/c/685bd1e4-9d88-8013-9f64-1ff6bede9ffc#t%C3%B3picos-relacionados-para-aprofundamento)

---

## Conceitos Fundamentais

- **Cache Persistente em Disco**
    
    O Angular CLI armazena em disco operações “cachable” (compilações, transformações, pré-bundling) para reduzir o tempo de build e teste em execuções repetidas. ([tutorialspoint.com](https://www.tutorialspoint.com/angular_cli/angular_cli_ng_cache.htm?utm_source=chatgpt.com))
    
- **Mecanismo de Caching**
    
    Cada artefato é identificado por hashes baseados no conteúdo de entrada (arquivos, configuração); se nada mudou, o resultado anterior é reaproveitado.
    
- **Configuração via `angular.json`**
    
    Sob a seção `cli.cache` é possível definir:
    
    - `environment`: controla onde o cache é ativado (`all` / `local` / `ci`)
    - `path`: altera o diretório de cache (ex.: `".cache/ng"`) ([angular.dev](https://angular.dev/cli/cache))

---

## Sintaxe e Uso

```bash
# Sintaxe básica para remover todo o cache persistente
ng cache clean [--help]

```

- O subcomando `clean` instrui o CLI a **deletar** toda a pasta de cache em `.angular/cache` (ou no path configurado).
- Não gera saída textual significativa; para confirmação, verifique manualmente se a pasta foi removida. ([stackoverflow.com](https://stackoverflow.com/questions/69953135/clear-angular-cache-in-angular-folder?utm_source=chatgpt.com))

---

## Restrições de Uso

- **Performance**: ao limpar o cache, builds subsequentes serão **mais lentos**, pois tudo será recompilado do zero.
- **Ambientes de CI**: se o pipeline depende de cache para acelerar múltiplos jobs, evite usar `clean` em cada execução, a menos que necessário. ([angular.dev](https://angular.dev/cli/cache))
- **Alternativa**: se só quiser **desativar** o cache sem removê-lo, use `ng cache disable` / `ng cache off`.

---

## Argumentos

O comando `ng cache` aceita apenas um **subcomando** como argumento:

```bash
ng cache <subcomando>
# Subcomandos disponíveis:
#   clean   • Deleta o cache em disco
#   disable • Desabilita o cache (mantém arquivos)
#   enable  • Habilita o cache
#   info    • Exibe status e estatísticas do cache

```

Neste caso, utilizamos exclusivamente `clean`. ([angular.dev](https://angular.dev/cli/cache))

---

## Opções

- **-help**, **h**: exibe a ajuda específica para `ng cache clean` e encerra. ([tutorialspoint.com](https://www.tutorialspoint.com/angular_cli/angular_cli_ng_cache.htm?utm_source=chatgpt.com))

> ⚙️ O ng cache clean herda apenas as opções documentadas para o comando cache, não possuindo flags próprias além de --help.
> 

---

## Melhores Práticas e Casos de Uso

- **Após atualização de dependências** (ex.: mudança de versão de biblioteca), para evitar artefatos obsoletos.
- **Resolução de erros estranhos** de build (arquivos corrompidos, ocorrências “fantasma”).
- **Em monorepos**, antes de um build “limpo” de uma workspace inteira.
- **Manutenção periódica** em máquinas de desenvolvimento para liberar espaço em disco e evitar cache runaway.

---

## Exemplos Completos

### Exemplo 1: Script de CI em GitLab CI

```yaml
stages:
  - build

build_job:
  stage: build
  script:
    - npm ci
    - ng cache clean         # Garante cache limpo antes do build
    - ng build --configuration production

```

### Exemplo 2: Fluxo de atualização de biblioteca local

```bash
# Atualiza uma lib interna e força rebuild do app
npm install ../minha-lib
ng cache clean            # Remove artefatos antigos
ng serve                   # Inicia dev server com cache zerado

```

---

## Tópicos Adicionais

- Uso de `ng cache info` para diagnosticar tamanho e localização do cache.
- Como configurar `cli.cache.environment` (all/local/ci) no `angular.json`.
- Controle do caminho de cache com `cli.cache.path`.
- Comparativo entre cache de build do Angular CLI e de ferramentas como Vite.

---

## Tópicos Relacionados para Aprofundamento

- **`ng cache disable` / `ng cache enable`**
- **Configuração avançada de workspace** (`angular.json`/`cli.cache`)
- **Arquitetura interna do build cache do Angular CLI**
- **Pré-bundling com Vite no Angular**
- **Ferramentas de cache distribuído (Nx, Bazel)**

---

*Espero que esta explicação ajude você a compreender profundamente o comando `ng cache clean` e a integrá-lo de forma eficaz em seu fluxo de trabalho.*