# ng deploy

Com certeza, Gedê\! É um prazer ajudar com isso. O `ng deploy` é uma ferramenta super útil para nós, desenvolvedores, e sei que como um desenvolvedor Backend que busca se aprofundar em Go, você vai apreciar a eficiência que ele pode trazer para o seu fluxo de trabalho, mesmo sendo uma ferramenta de frontend. A.R.I.A vai te dar uma visão completa sobre esse comando.

---

## Simplificando a Publicação: O Comando `ng deploy` do Angular CLI

---

### Introdução

Publicar uma aplicação Angular para que ela esteja disponível para o mundo pode ser um processo que, à primeira vista, parece complexo. Envolve compilação, otimização e, finalmente, o envio dos arquivos gerados para um servidor web. O comando `ng deploy`, introduzido no Angular CLI, veio para simplificar essa etapa crucial, abstraindo grande parte da complexidade e integrando o processo de deploy diretamente na linha de comando. Ele permite que você implante suas aplicações Angular em diversos serviços de hospedagem com um único comando, tornando o fluxo de trabalho mais eficiente e menos propenso a erros.

### Sumário

Esta explicação detalhada abordará o comando `ng deploy` do Angular CLI, desde seus conceitos fundamentais até exemplos práticos. Exploraremos sua sintaxe, argumentos e opções, além de discutir cenários de uso, restrições e melhores práticas. O objetivo é fornecer um guia completo para que você possa utilizar o `ng deploy` com confiança e agilidade na publicação de suas aplicações Angular.

### Conceitos Fundamentais

O `ng deploy` é um comando do Angular CLI que automatiza o processo de **implantação (deploy)** de uma aplicação Angular. Ele faz isso através da integração com **construtores (builders)** específicos de deploy, que são pacotes npm projetados para interagir com diferentes serviços de hospedagem.

O propósito principal do `ng deploy` é:

- **Simplificar o processo de publicação:** Em vez de executar múltiplos comandos (build, upload, etc.), o `ng deploy` centraliza a lógica de implantação.
- **Integrar com o ecossistema Angular:** Ele se encaixa perfeitamente no fluxo de trabalho do Angular CLI, utilizando a configuração do seu projeto (`angular.json`) para determinar como e onde a aplicação deve ser implantada.
- **Abstrair a complexidade do serviço de hospedagem:** Cada serviço de hospedagem (Firebase, Netlify, Vercel, GitHub Pages, etc.) tem suas próprias ferramentas e configurações para deploy. O `ng deploy` e seus builders correspondentes lidam com essas especificidades, permitindo que você use uma interface unificada.

A magia por trás do `ng deploy` reside nos **construtores de deploy**. Quando você instala um pacote como `@angular/fire` (para deploy no Firebase) ou `netlify-ng-deploy` (para Netlify), eles geralmente incluem um construtor de deploy. Este construtor é configurado no seu arquivo `angular.json` para um projeto específico. Quando você executa `ng deploy`, o Angular CLI encontra o construtor configurado e o executa, passando as opções necessárias.

### Sintaxe e Uso

A sintaxe básica do comando `ng deploy` é a seguinte:

```bash
ng deploy [projeto] [opções]

```

- `[projeto]`: (Opcional) O nome do projeto Angular dentro do seu workspace que você deseja implantar. Se o seu workspace tiver apenas um projeto, ou se você estiver no diretório raiz de um único projeto, ele pode ser omitido.
- `[opções]`: As opções de linha de comando para o comando `deploy`. Elas geralmente são específicas do construtor de deploy que está sendo usado.

**Exemplo de Configuração e Uso:**

Vamos configurar um projeto Angular para deploy no Firebase usando o `@angular/fire`.

1. **Instale o `@angular/fire`:**
    
    ```bash
    ng add @angular/fire
    
    ```
    
    Durante a instalação, o CLI irá te guiar para configurar seu projeto Firebase e adicionará as entradas de deploy necessárias no seu `angular.json`.
    
    Um trecho relevante no `angular.json` para o seu projeto pode se parecer com isto:
    
    ```json
    {
      "projects": {
        "minha-aplicacao-angular": {
          // ... outras configurações do projeto
          "architect": {
            // ... outras configurações de arquitetura
            "deploy": {
              "builder": "@angular/fire:deploy",
              "options": {
                "prerender": false,
                "ssr": false,
                "browserTarget": "minha-aplicacao-angular:build:production",
                "firebaseProject": "nome-do-seu-projeto-firebase",
                "firebaseHostingSite": "nome-do-seu-site-firebase"
              },
              "configurations": {
                "production": {
                  // ... opções específicas de produção se necessário
                }
              }
            }
          }
        }
      }
    }
    
    ```
    
2. **Execute o comando `ng deploy`:**
Após a configuração, para implantar sua aplicação:
    
    ```bash
    ng deploy minha-aplicacao-angular
    
    ```
    
    Ou, se for o único projeto ou você estiver no diretório raiz:
    
    ```bash
    ng deploy
    
    ```
    
    **Exemplo Comentado:**
    
    ```bash
    # Implanta a aplicação "minha-aplicacao-angular" usando o builder configurado.
    # O builder (neste caso, @angular/fire:deploy) cuidará da compilação
    # da aplicação em modo de produção e do upload para o Firebase.
    ng deploy minha-aplicacao-angular
    
    # Exemplo de deploy para um ambiente específico (se configurado no angular.json)
    # Por exemplo, se você tiver uma configuração "staging" dentro do "deploy"
    ng deploy --configuration=staging
    
    # Forçando o deploy sem confirmação (depende do builder, @angular/fire tem essa opção)
    ng deploy --no-build # Pula a etapa de build, usando a última compilação gerada
    ng deploy --force    # Força a implantação, ignorando algumas verificações
    
    ```
    

---

### Restrições de Uso

O `ng deploy` é uma ferramenta poderosa, mas possui algumas restrições e cenários onde ele pode não ser a melhor opção:

- **Dependência de Builders:** O `ng deploy` não funciona "por si só". Ele exige que um construtor de deploy (como `@angular/fire:deploy`, `netlify-ng-deploy`, etc.) esteja instalado e configurado no seu projeto. Se não houver um builder para o seu serviço de hospedagem específico, o `ng deploy` não será útil.
- **Hospedagem Complexa ou Customizada:** Para infraestruturas de deploy muito complexas, ambientes on-premise, ou serviços de hospedagem que exigem scripts de deploy altamente customizados e que não possuem um builder dedicado, o `ng deploy` pode não ser adequado. Nesses casos, você provavelmente precisará de pipelines de CI/CD (Integração Contínua/Entrega Contínua) mais elaborados, como Jenkins, GitLab CI, GitHub Actions, que executam comandos de build e upload específicos.
- **Aplicações Não-Angular:** Obviamente, o `ng deploy` é específico para aplicações Angular. Ele não pode ser usado para implantar aplicações desenvolvidas em outras tecnologias.
- **Controle Granular do Processo:** Embora a automação seja uma vantagem, em cenários onde você precisa de um controle extremamente granular sobre cada etapa do processo de build e deploy (por exemplo, manipulação de arquivos pós-build muito específicas, testes de integração complexos antes do upload), um pipeline de CI/CD manual ou mais detalhado pode ser preferível. O `ng deploy` abstrai muitos desses detalhes.
- **Problemas de Autenticação/Configuração:** Se as credenciais ou a configuração do serviço de hospedagem estiverem incorretas ou desatualizadas, o `ng deploy` falhará. Ele depende de uma configuração precisa do builder e da autenticação correta com o serviço alvo.

### Argumentos

O comando `ng deploy` possui um único argumento posicional principal:

- **`project` (projeto):**
    - **Tipo:** `string`
    - **Obrigatório:** Não, se houver apenas um projeto no workspace ou se estiver no diretório raiz de um único projeto.
    - **Descrição:** Especifica o nome do projeto Angular dentro do seu workspace que deve ser implantado. Este nome deve corresponder a uma chave de projeto definida no seu arquivo `angular.json`.
    
    **Exemplo:**
    
    ```bash
    # Implanta o projeto com o nome 'meu-app-principal'
    ng deploy meu-app-principal
    
    ```
    

---

### Opções

As opções do comando `ng deploy` são em grande parte **passadas para o construtor (builder) de deploy subjacente**. Isso significa que as opções disponíveis podem variar significativamente dependendo de qual construtor de deploy você está usando (ex: `@angular/fire:deploy`, `netlify-ng-deploy`, etc.).

No entanto, existem algumas opções genéricas do CLI que podem ser aplicadas ao `ng deploy`, e os builders geralmente implementam opções comuns. Abaixo, detalho as mais comuns e como entender as opções específicas do seu builder.

### Opções Genéricas do Angular CLI (podem ser aplicadas a `ng deploy`):

- `-configuration` ou `c`:
    - **Tipo:** `string`
    - **Descrição:** Especifica uma configuração de build do seu `angular.json` para usar durante o deploy. Isso é útil para implantar diferentes versões da sua aplicação (e.g., produção, staging, desenvolvimento) que podem ter diferentes variáveis de ambiente ou otimizações.
    - **Exemplo:** `ng deploy --configuration=production` ou `ng deploy -c=staging`
- `-help`:
    - **Tipo:** `boolean`
    - **Descrição:** Exibe informações de ajuda para o comando `ng deploy`, incluindo as opções específicas do construtor configurado. Esta é a **melhor forma de descobrir quais opções são suportadas pelo seu builder**.
    - **Exemplo:** `ng deploy --help`

### Opções Comuns Fornecidas por Builders (Exemplo: `@angular/fire:deploy`):

Muitos builders de deploy fornecem opções para controlar o processo de build e deploy. As opções abaixo são exemplos comuns, mas **sempre consulte a documentação do builder específico ou use `ng deploy --help`** para ver as opções exatas.

- `-build`:
    - **Tipo:** `boolean`
    - **Padrão:** `true`
    - **Descrição:** Se `false`, o comando `deploy` não executará uma nova build da aplicação antes de tentar implantá-la. Isso é útil se você já fez a build manualmente ou em um passo anterior.
    - **Exemplo:** `ng deploy --no-build` (Note o `no-` para desativar)
- `-preview`:
    - **Tipo:** `boolean`
    - **Descrição:** Realiza uma prévia do deploy sem realmente publicar os arquivos. Útil para verificar o que seria implantado.
    - **Exemplo:** `ng deploy --preview`
- `-force`:
    - **Tipo:** `boolean`
    - **Descrição:** Força o deploy, ignorando algumas verificações ou avisos. Use com cautela.
    - **Exemplo:** `ng deploy --force`
- `-base-href`:
    - **Tipo:** `string`
    - **Descrição:** Define o base href para a aplicação. Útil para deploy em subdiretórios. Isso é mais comumente uma opção do `ng build`, mas alguns builders podem re-expor essa opção.
    - **Exemplo:** `ng deploy --base-href=/minha-pasta-app/`
- `-output-path`:
    - **Tipo:** `string`
    - **Descrição:** Especifica onde os arquivos compilados da aplicação serão gerados. Novamente, mais uma opção do `ng build`, mas pode ser relevante se o builder precisar de um caminho específico.
- `-prerender`:
    - **Tipo:** `boolean`
    - **Descrição:** Se `true`, realiza a pré-renderização (geração de HTML estático) para rotas específicas da sua aplicação. Isso é útil para SEO e tempo de carregamento inicial. (Comum em builders para SSR/Prerendering como `@angular/fire`).
- `-ssr`:
    - **Tipo:** `boolean`
    - **Descrição:** Ativa a renderização do lado do servidor (Server-Side Rendering) para sua aplicação. (Comum em builders para SSR).

### Como descobrir as opções específicas do seu builder:

A melhor maneira de descobrir as opções disponíveis para o construtor de deploy que você está usando é executando:

```bash
ng deploy --help

```

Isso listará todas as opções globais do `ng deploy` e, mais importante, as opções específicas que o construtor configurado para o seu projeto aceita.

---

### Melhores Práticas e Casos de Uso

O `ng deploy` brilha em diversos cenários, e seguir algumas melhores práticas pode otimizar seu uso:

### Casos de Uso Comuns:

1. **Projetos Pequenos e Médios:** É ideal para equipes pequenas ou desenvolvedores individuais que precisam de uma maneira rápida e eficiente de publicar suas aplicações sem a necessidade de configurar pipelines de CI/CD complexos.
2. **Projetos Hospedados em Serviços Populares:** Se sua aplicação está hospedada em serviços como Firebase Hosting, Netlify, Vercel, GitHub Pages, ou Azure Static Web Apps, onde existem builders dedicados, o `ng deploy` é a solução mais simples e integrada.
3. **Desenvolvimento e Teste Rápido:** Para ambientes de staging ou teste, onde você precisa implantar rapidamente uma nova versão para validação, o `ng deploy` agiliza o processo.
4. **Automação Simples:** Pode ser incluído em scripts shell básicos para automatizar a publicação como parte de um fluxo de trabalho maior, embora para automação robusta, CI/CD seja geralmente preferível.

### Melhores Práticas:

1. **Configure o Builder Corretamente:** Certifique-se de que o construtor de deploy esteja instalado e configurado corretamente no seu `angular.json`. Verifique os IDs dos projetos, tokens de autenticação e outras configurações específicas do serviço de hospedagem.
2. **Use `-configuration`:** Sempre utilize a opção `-configuration` para garantir que você esteja implantando a build correta (geralmente `production`). Isso garante que a aplicação esteja otimizada e minimizada para o ambiente de produção.
    
    ```bash
    ng deploy --configuration=production
    
    ```
    
3. **Autenticação Antecipada:** Para serviços como Firebase, certifique-se de estar autenticado no CLI (ex: `firebase login`) antes de executar `ng deploy`. Alguns builders podem ter seus próprios comandos de autenticação.
4. **Integração com CI/CD (Para Fluxos Mais Robustos):** Embora o `ng deploy` simplifique o deploy manual, em ambientes de equipe ou para deploys frequentes, considere integrá-lo em um pipeline de CI/CD (GitLab CI, GitHub Actions, Jenkins).
    - No CI/CD, você pode ter um estágio que primeiro instala dependências, depois executa testes, constrói a aplicação e, finalmente, executa `ng deploy`.
    - **Exemplo (GitHub Actions):**
        
        ```yaml
        # ... outros passos de CI
        - name: Build and Deploy
          run: |
            npm install # Ou yarn install
            ng deploy --configuration=production --base-href=/sua-aplicacao/ # Ajuste conforme necessário
          env:
            # Variáveis de ambiente sensíveis (ex: tokens de acesso)
            # devem ser configuradas nas secrets do seu CI/CD
            FIREBASE_TOKEN: ${{ secrets.FIREBASE_TOKEN }}
        
        ```
        
5. **Gerenciamento de Versão:** Antes de cada deploy, é uma boa prática garantir que sua base de código esteja com a versão correta (usando Git, por exemplo) e que os testes passaram.
6. **Variáveis de Ambiente:** Utilize ambientes do Angular para gerenciar variáveis específicas de cada ambiente (desenvolvimento, staging, produção). O `ng deploy` usará o `environment.ts` correspondente à sua `-configuration`.
7. **Sempre Teste em um Ambiente de Staging:** Antes de implantar diretamente em produção, se possível, implante em um ambiente de staging para testes finais.
8. **Limpeza do Cache:** Após o deploy, especialmente para aplicações que dependem fortemente de cache do navegador, instrua os usuários a limpar o cache ou implemente estratégias de cache-busting (que o `ng build --prod` já faz automaticamente com os hashes nos nomes dos arquivos).

---

### Exemplos Completos

Vamos considerar um cenário completo de implantação de uma aplicação Angular para o Netlify usando o `netlify-ng-deploy`.

**Passo 1: Crie sua aplicação Angular (se ainda não tiver uma)**

```bash
ng new minha-app-netlify --no-standalone --routing --style=scss
cd minha-app-netlify

```

**Passo 2: Instale o construtor `netlify-ng-deploy`**

```bash
npm install -D netlify-ng-deploy

```

**Passo 3: Configure o `angular.json`**

Você precisará adicionar uma entrada `deploy` no seu `angular.json` para o projeto `minha-app-netlify`.

Abra `angular.json` e localize a seção `architect` do seu projeto. Adicione o seguinte:

```json
{
  "projects": {
    "minha-app-netlify": {
      // ... outras configurações do projeto
      "architect": {
        "build": { /* ... */ },
        "serve": { /* ... */ },
        "test": { /* ... */ },
        // Adicione esta seção de deploy
        "deploy": {
          "builder": "netlify-ng-deploy:deploy",
          "options": {
            "buildTarget": "minha-app-netlify:build:production",
            "outputPath": "dist/minha-app-netlify",
            "baseHref": "/"
          }
        }
      }
    }
  },
  // ...
}

```

**Explicação da Configuração:**

- `"builder": "netlify-ng-deploy:deploy"`: Indica qual construtor será usado para o deploy.
- `"buildTarget": "minha-app-netlify:build:production"`: Informa ao construtor qual target de build deve ser executado para gerar os arquivos de produção.
- `"outputPath": "dist/minha-app-netlify"`: Especifica o diretório onde os arquivos compilados serão encontrados.
- `"baseHref": "/"`: Define a base Href para a aplicação.

**Passo 4: Autentique-se com o Netlify CLI (se ainda não o fez)**

```bash
npm install -g netlify-cli
netlify login

```

Siga as instruções para fazer login no Netlify através do seu navegador.

**Passo 5: Execute o `ng deploy`**

Agora, você pode implantar sua aplicação:

```bash
ng deploy

```

O `netlify-ng-deploy` irá:

1. Executar `ng build --configuration=production` (ou o target de build especificado).
2. Interagir com o Netlify CLI para fazer o upload dos arquivos do diretório `dist/minha-app-netlify` para o seu site Netlify.
3. Você será guiado pelo Netlify CLI para selecionar um site existente ou criar um novo, e também configurar o diretório de deploy (que já está definido no `angular.json` como `dist/minha-app-netlify`).

**Exemplo com opções:**

Se você quiser implantar uma versão de staging (assumindo que você tem uma configuração `staging` no seu `angular.json` para o build):

```json
{
  // ...
  "architect": {
    "build": {
      "builder": "@angular-devkit/build-angular:browser",
      "options": { /* ... */ },
      "configurations": {
        "production": { /* ... */ },
        "staging": {
          "optimization": true,
          "outputHashing": "all",
          "sourceMap": false,
          "namedChunks": false,
          "extractLicenses": true,
          "vendorChunk": false,
          "buildOptimizer": true,
          "fileReplacements": [
            {
              "replace": "src/environments/environment.ts",
              "with": "src/environments/environment.staging.ts"
            }
          ]
        }
      }
    },
    "deploy": {
      "builder": "netlify-ng-deploy:deploy",
      "options": {
        "outputPath": "dist/minha-app-netlify",
        "baseHref": "/"
      },
      "configurations": {
        "staging": {
          "buildTarget": "minha-app-netlify:build:staging"
        }
      }
    }
  }
}

```

Então, para implantar a versão de staging:

```bash
ng deploy --configuration=staging

```

---

### Tópicos Relacionados para Aprofundamento

Para continuar sua jornada de conhecimento, Gedê, sugiro os seguintes tópicos:

- **Pipeliness de CI/CD:** Aprofunde-se em ferramentas como GitHub Actions, GitLab CI, Jenkins, e Azure DevOps. Entender como integrar o `ng deploy` (ou mesmo o `ng build` seguido de passos de upload manuais) nesses pipelines é crucial para automação de deploy em larga escala.
- **Serviços de Hospedagem Estática:** Explore outros serviços de hospedagem como Vercel, Firebase Hosting, AWS S3 + CloudFront, GitHub Pages e suas particularidades.
- **Estratégias de Cache-Busting:** Entenda como o Angular (e outros frameworks) lida com o cache do navegador e como garantir que os usuários sempre recebam as versões mais recentes dos seus arquivos.
- **Angular Universal (SSR/SSG/Prerendering):** Se você precisa de melhor SEO ou desempenho de carregamento inicial, aprenda sobre as técnicas de renderização do lado do servidor (SSR) e geração de sites estáticos (SSG) com Angular Universal, e como isso se integra com o deploy.
- **Monorepos com Nx/Lerna:** Se você estiver trabalhando em um monorepo com múltiplos projetos Angular, entender como gerenciar e implantar projetos individuais pode ser complexo. Ferramentas como Nx ou Lerna podem ajudar.

Espero que esta explicação detalhada sobre o `ng deploy` seja muito útil para você, Gedê\! Se tiver mais alguma dúvida, é só chamar A.R.I.A\!