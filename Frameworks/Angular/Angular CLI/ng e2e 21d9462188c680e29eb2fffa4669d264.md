# ng e2e

**Título:Dominando o `ng e2e`: Testes End-to-End Robustos com o Angular CLI**

---

## Introdução

Testes end-to-end (E2E) garantem que toda a aplicação funcione do ponto de vista do usuário, validando fluxos completos em um ambiente real ou simulado. O Angular CLI fornece o comando `ng e2e` para automatizar esse processo: ele constrói e serve sua aplicação e, em seguida, executa testes E2E usando o framework configurado (por padrão Protractor ou, em versões recentes, Cypress, Nightwatch, Playwright, entre outros). ([angular.dev](https://angular.dev/tools/cli/end-to-end?utm_source=chatgpt.com))

---

## Sumário

1. Conceitos Fundamentais
2. Sintaxe e Uso
3. Restrição de Cenários
4. Argumentos
5. Opções (flags)
6. Melhores Práticas e Casos de Uso
7. Exemplo Completo
8. Tópicos Relacionados para Aprofundamento

---

## 1. Conceitos Fundamentais

- **O que são testes E2E?**
Testes de ponta a ponta simulam interações reais do usuário (cliques, navegação, formulários) para assegurar que todos os componentes trabalham em harmonia. Diferem de testes unitários, que verificam partes isoladas do código, e de testes de integração, que focam em subsistemas específicos ([angular.dev](https://angular.dev/tools/cli/end-to-end?utm_source=chatgpt.com)).
- **Papel do `ng e2e`:**
Ele aciona o *builder* `e2e` configurado em `angular.json`, realiza o build da aplicação, dispara o servidor de desenvolvimento e depois dispara o runner (Protractor, Cypress etc.) contra essa instância ([angular.dev](https://angular.dev/cli/e2e?utm_source=chatgpt.com)).
- **Fluxo interno:**
    1. Validação do target `e2e` no workspace.
    2. Caso não exista, prompt para adicionar um pacote de E2E (e.g. `ng add @cypress/schematic`) ([angular.dev](https://angular.dev/tools/cli/end-to-end?utm_source=chatgpt.com)).
    3. Build + serve da aplicação.
    4. Execução dos testes conforme configuração.

---

## 2. Sintaxe e Uso

```bash
ng e2e [<project>] [--options]

```

- `<project>` (opcional): nome do projeto (aplicação ou biblioteca) definido em `angular.json`.
- Se omisso, usa o projeto padrão.
- Exemplo básico:
    
    ```bash
    ng e2e
    
    ```
    
    — constrói, serve e executa todos os testes E2E configurados ([angular.dev](https://angular.dev/cli/e2e?utm_source=chatgpt.com)).
    

---

## 3. Restrições de Uso

- **Sem UI:** projetos de biblioteca pura ou serviços *backend* não se beneficiam de E2E.
- **Ciclos de feedback rápidos:** para testes unitários e de integração rápida, use `ng test`, pois `ng e2e` envolve build completo + serve, o que é mais pesado.
- **Ambientes inadequados:** evite rodar em máquinas com recursos limitados, pois browsers headless consomem CPU/memória.

---

## 4. Argumentos

- **project**
    - Tipo: `string`
    - Descrição: nome do projeto a ser testado (conforme chave em `projects` do `angular.json`) ([angular.dev](https://angular.dev/cli/e2e?utm_source=chatgpt.com)).

---

## 5. Opções (flags)

| Opção | Alias | Tipo | Descrição |
| --- | --- | --- | --- |
| `--baseUrl=<url>` | — | string | URL base para o Protractor. Útil para testes contra diferentes ambientes. ([tutorialspoint.com](https://www.tutorialspoint.com/angular_cli/angular_cli_ng_e2e.htm?utm_source=chatgpt.com)) |
| `--configuration=<name>` | `-c` | string | Nome de configuração em `angular.json` (e.g., `production`). ([tutorialspoint.com](https://www.tutorialspoint.com/angular_cli/angular_cli_ng_e2e.htm?utm_source=chatgpt.com)) |
| `--devServerTarget=<tgt>` | — | string | Target de serve a ser usado (ex.: `my-app:serve`). ([tutorialspoint.com](https://www.tutorialspoint.com/angular_cli/angular_cli_ng_e2e.htm?utm_source=chatgpt.com)) |
| `--grep=<pattern>` | — | string | Executa apenas specs cujo nome casar com expressão regular. ([tutorialspoint.com](https://www.tutorialspoint.com/angular_cli/angular_cli_ng_e2e.htm?utm_source=chatgpt.com)) |
| `--invertGrep` | — | boolean | Inverte a seleção do `grep`. ([tutorialspoint.com](https://www.tutorialspoint.com/angular_cli/angular_cli_ng_e2e.htm?utm_source=chatgpt.com)) |
| `--host=<addr>` | — | string | Endereço de host para o servidor de desenvolvimento. ([tutorialspoint.com](https://www.tutorialspoint.com/angular_cli/angular_cli_ng_e2e.htm?utm_source=chatgpt.com)) |
| `--port=<num>` | — | number | Porta para servir a aplicação. ([tutorialspoint.com](https://www.tutorialspoint.com/angular_cli/angular_cli_ng_e2e.htm?utm_source=chatgpt.com)) |
| `--prod` | — | boolean | Atalho para `--configuration=production`. ([tutorialspoint.com](https://www.tutorialspoint.com/angular_cli/angular_cli_ng_e2e.htm?utm_source=chatgpt.com)) |
| `--protractorConfig=<f>` | — | string | Caminho do arquivo de configuração do Protractor. ([tutorialspoint.com](https://www.tutorialspoint.com/angular_cli/angular_cli_ng_e2e.htm?utm_source=chatgpt.com)) |
| `--specs=<files>` | — | array | Sobrescreve specs no config do Protractor. ([tutorialspoint.com](https://www.tutorialspoint.com/angular_cli/angular_cli_ng_e2e.htm?utm_source=chatgpt.com)) |
| `--suite=<name>` | — | string | Sobrescreve suite no config do Protractor. ([tutorialspoint.com](https://www.tutorialspoint.com/angular_cli/angular_cli_ng_e2e.htm?utm_source=chatgpt.com)) |
| `--help` | — | boolean | Exibe ajuda. ([angular.dev](https://angular.dev/cli/e2e?utm_source=chatgpt.com)) |

---

## 6. Melhores Práticas e Casos de Uso

- **CI/CD:** integrar `ng e2e` no pipeline para validar PRs antes do merge.
- **Testes em paralelo:** usar flags do runner (e.g., `-parallel`) ou configurar múltiplas instâncias de browser.
- **Tagueamento:** organizar specs em grupos (suites) e usar `-grep` para execuções focadas (smoke, regressão).
- **Ambientes isolados:** usar `-baseUrl` apontando para staging, homologação ou docker containers.
- **Substituição de Protractor:** como Protractor foi descontinuado em versões recentes, prefira Cypress ou Playwright via `ng add` e ajuste o `builder` no `angular.json` ([angular.dev](https://angular.dev/tools/cli/end-to-end?utm_source=chatgpt.com)).

---

## 7. Exemplo Completo

**angular.json** (trecho de configuração E2E)

```
{
  "projects": {
    "my-app-e2e": {
      "root": "e2e/",
      "sourceRoot": "e2e/src",
      "projectType": "application",
      "architect": {
        "e2e": {
          "builder": "@angular-devkit/build-angular:protractor",
          "options": {
            "protractorConfig": "e2e/protractor.conf.js",
            "devServerTarget": "my-app:serve"
          },
          "configurations": {
            "production": {
              "devServerTarget": "my-app:serve:production"
            }
          }
        }
      }
    }
  }
}

```

**Comando de execução demonstrativo**

```bash
ng e2e my-app-e2e \\
  --configuration=production \\
  --baseUrl=https://staging.minhaapi.com \\
  --specs="src/**/*.e2e-spec.ts" \\
  --grep="Login" \\
  --invertGrep=false

```

> Este comando irá:
> 
> 1. Construir e servir `my-app` em modo produção.
> 2. Executar apenas os specs cujo nome contenha “Login” contra a URL informada.

---

## 8. Tópicos Relacionados para Aprofundamento

- Testes de Unidade com `ng test`
- Configuração avançada de Cypress e Playwright
- Customizar *builders* no Angular CLI (`ng run`)
- Integração de E2E em pipelines GitHub Actions / GitLab CI
- Testes de Acessibilidade (a11y) em E2E

---

Com esta visão completa, você tem todas as bases para planejar, configurar e executar testes E2E confiáveis e eficientes no seu projeto Angular!