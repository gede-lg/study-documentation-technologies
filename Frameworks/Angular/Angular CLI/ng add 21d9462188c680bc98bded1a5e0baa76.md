# ng add

Com certeza, Gedê\! A.R.I.A. está aqui para te ajudar com uma explicação detalhada sobre o comando `ng add` do Angular CLI. Prepare-se para desmistificar essa ferramenta poderosa.

---

## Adicionando Funcionalidades ao Seu Projeto Angular com `ng add`

### Introdução

No mundo do desenvolvimento front-end com Angular, gerenciar dependências e adicionar novas funcionalidades pode ser um processo repetitivo e propenso a erros. É aqui que o comando `ng add` do Angular CLI brilha. Ele simplifica a instalação de bibliotecas e pacotes, automatizando a configuração inicial para que você possa focar no que realmente importa: desenvolver.

### Sumário

Este guia explora profundamente o comando `ng add`, cobrindo desde seus conceitos fundamentais e sintaxe até os argumentos, opções, melhores práticas e exemplos práticos. Entenderemos como essa ferramenta não apenas instala pacotes, mas também integra-os de forma inteligente ao seu projeto Angular.

---

### Conceitos Fundamentais

O `ng add` é um comando do **Angular CLI (Command Line Interface)** que simplifica a adição de novas capacidades ao seu projeto. Ele vai além de um simples `npm install` ou `yarn add`, pois utiliza **schematics** para realizar ações adicionais e automatizar a configuração.

**O que são Schematics?**

Schematics são uma ferramenta poderosa para automatizar tarefas de transformação de código em projetos Angular. Pense neles como "receitas" que o `ng add` executa. Quando você usa `ng add [pacote]`, o Angular CLI procura por um schematic específico fornecido por esse pacote. Este schematic pode:

- **Instalar pacotes e dependências:** Similar ao `npm install`.
- **Modificar arquivos:** Adicionar imports, configurar módulos, injetar serviços, etc.
- **Criar novos arquivos:** Componentes, serviços, módulos, configurações.
- **Atualizar configurações:** `angular.json`, `package.json`, `tsconfig.json`.

**Propósito do `ng add`:**

O principal propósito do `ng add` é tornar a integração de bibliotecas de terceiros e funcionalidades nativas do Angular (como PWA, Angular Material, etc.) mais fluida e menos propensa a erros manuais. Ele garante que a biblioteca seja configurada corretamente, economizando tempo e evitando dores de cabeça.

---

### Sintaxe e Uso

A sintaxe básica do comando `ng add` é bastante simples:

```bash
ng add <package-specifier> [options]

```

- `<package-specifier>`: Este é o nome do pacote npm que você deseja adicionar. Pode ser um pacote npm publicado (ex: `@angular/material`, `@angular/pwa`, `@ngrx/store`) ou um caminho para um pacote local.

**Exemplos Práticos e Comentados:**

1. **Adicionando Angular Material:**
    
    ```bash
    ng add @angular/material
    
    ```
    
    - **Explicação:** Este comando instala o `@angular/material` e, em seguida, executa os schematics fornecidos pelo pacote. Normalmente, ele perguntará qual tema você deseja usar, se quer configurar a tipografia e incluir as animações do Angular Material, e fará as configurações necessárias em `angular.json` e `app.module.ts` (ou `main.ts` em Angular 17+).
2. **Adicionando suporte a Progressive Web App (PWA):**
    
    ```bash
    ng add @angular/pwa
    
    ```
    
    - **Explicação:** Este comando adiciona as configurações necessárias para transformar sua aplicação em um PWA. Ele instala o service worker (`@angular/service-worker`), adiciona o arquivo `ngsw-config.json`, configura o `manifest.webmanifest` e faz as alterações no `angular.json` e `index.html` para habilitar o PWA.
3. **Adicionando o NgRx Store:**
    
    ```bash
    ng add @ngrx/store
    
    ```
    
    - **Explicação:** Para projetos que utilizam o padrão NgRx para gerenciamento de estado, este comando instala o pacote `@ngrx/store` e pode até mesmo gerar um módulo de estado básico, dependendo da versão e schematics do NgRx.
4. **Adicionando um pacote específico com uma versão:**
    
    ```bash
    ng add @angular/material@^16.0.0
    
    ```
    
    - **Explicação:** Você pode especificar a versão do pacote que deseja adicionar. Isso é útil para garantir compatibilidade ou testar novas versões antes de atualizar todo o projeto.

---

### Restrições de Uso

Embora `ng add` seja uma ferramenta poderosa, há cenários onde seu uso pode não ser o mais apropriado:

- **Pacotes sem schematics:** Se um pacote npm não fornece schematics, `ng add` funcionará apenas como `npm install` ou `yarn add`. Nesses casos, você ainda precisará configurar manualmente o pacote após a instalação. Para verificar se um pacote tem schematics, você geralmente pode olhar a documentação do pacote ou a estrutura de pastas após a instalação (procurando por uma pasta `schematics`).
- **Atualização de dependências:** `ng add` não é a ferramenta principal para atualizar dependências existentes. Para isso, você deve usar `ng update`. Embora `ng add` possa instalar uma versão mais recente de um pacote que já existe, seu foco é a *adição inicial* e configuração.
- **Projetos não-Angular:** Obviamente, `ng add` é um comando específico do Angular CLI e só funciona em projetos Angular.
- **Conflitos manuais:** Se você já fez muitas modificações manuais em arquivos que o schematic do `ng add` tenta alterar, pode haver conflitos. Nesses casos, o CLI geralmente perguntará como proceder ou tentará mesclar as alterações. Esteja preparado para revisar e resolver esses conflitos.
- **Schematics não confiáveis ou maliciosos:** Assim como qualquer dependência que você adiciona ao seu projeto, é crucial verificar a fonte e a reputação do pacote antes de usar `ng add`. Schematics podem executar código e fazer alterações significativas no seu projeto.

---

### Argumentos

O comando `ng add` possui um único argumento principal:

- `<package-specifier>`: **(Obrigatório)** O nome do pacote npm que você deseja adicionar. Conforme mencionado, pode ser um nome de pacote publicado ou um caminho para um pacote local.
    
    **Exemplos:**
    
    - `@angular/pwa`
    - `@angular/material`
    - `@ngrx/store`
    - `./my-custom-schematic-collection` (para uma coleção de schematics local)

---

### Opções

O comando `ng add` oferece algumas opções para controlar seu comportamento:

| Opção | Tipo | Descrição |
| --- | --- | --- |
| `--registry` | `string` | A URL do registro npm a ser usado para a instalação do pacote. Útil para repositórios privados. |
| `--skip-install` | `boolean` | Se `true`, o Angular CLI não executará `npm install` (ou o gerenciador de pacotes configurado) após adicionar o pacote. Útil se você quiser adicionar múltiplos pacotes e depois rodar a instalação de uma vez, ou se você já sabe que as dependências estão presentes. **Padrão:** `false` |
| `--dry-run` ou `-d` | `boolean` | Se `true`, o CLI apenas simula as alterações que seriam feitas, sem realmente modificar os arquivos. As alterações são impressas no console. Excelente para testar antes de aplicar. **Padrão:** `false` |
| `--force` ou `-f` | `boolean` | Permite sobrescrever arquivos existentes ou aplicar alterações mesmo que haja conflitos potenciais. Use com cautela, pois pode levar à perda de trabalho. **Padrão:** `false` |
| `--version` | `boolean` | Mostra a versão do Angular CLI. (Esta opção é genérica para todos os comandos do CLI, mas é listada aqui por completude). **Padrão:** `false` |
| `--verbose` | `boolean` | Imprime mais informações detalhadas sobre o que o comando está fazendo. Útil para depuração. **Padrão:** `false` |
| `--collection` | `string` | Especifica a coleção de schematics a ser usada se o pacote tiver múltiplas coleções. Geralmente, não é necessário a menos que você esteja trabalhando com schematics personalizados ou coleções específicas. Por exemplo, `ng add @schematics/angular --collection=@schematics/angular` (embora redundante neste caso). |
| `--defaults` | `boolean` | Se `true`, usa os valores padrão para todas as opções configuráveis pelos schematics, sem fazer perguntas. Isso pode acelerar o processo, mas significa que você não terá controle sobre as escolhas. **Padrão:** `false` (schematics interativos geralmente perguntam) |
| `--interactive` | `boolean` | Permite (ou proíbe) o CLI de fazer perguntas interativas. Se `false`, o CLI usará padrões ou falhará se opções obrigatórias não forem fornecidas. **Padrão:** `true` (se um terminal interativo for detectado) |
| `--minimal` | `boolean` | Para alguns schematics (como `@angular/material`), pode instruir o schematic a instalar uma versão "mínima" da biblioteca, sem incluir todas as dependências ou configurações opcionais. Nem todos os schematics suportam esta opção. **Padrão:** `false` |
| `--skip-confirmation` | `boolean` | Se `true`, pula qualquer confirmação interativa que o schematic possa pedir antes de fazer alterações. Use com cautela. **Padrão:** `false` |
| `--preserve-symlinks` | `boolean` | Não resolve symlinks no pacote. Útil em certos ambientes de desenvolvimento com symlinks. **Padrão:** `false` |

**Opções específicas de cada schematic:**

É importante notar que, além das opções genéricas do `ng add`, muitos schematics de pacotes específicos (como `@angular/material`, `@ngrx/store`, etc.) fornecem suas próprias opções. Estas opções são passadas para o comando `ng add` e são interpretadas pelo schematic.

**Exemplo:**

```bash
ng add @angular/material --theme=custom --typography=true --animations=enabled

```

Neste exemplo, `--theme`, `--typography` e `--animations` são opções específicas do schematic do Angular Material.

---

### Melhores Práticas e Casos de Uso

**Melhores Práticas:**

1. **Sempre use `-dry-run` primeiro:** Antes de executar `ng add` em um projeto importante, especialmente com um pacote novo ou desconhecido, use `ng add <package> --dry-run`. Isso mostrará exatamente quais arquivos seriam alterados, permitindo que você verifique se as modificações são as esperadas.
2. **Commit antes de adicionar:** É uma boa prática fazer um commit de suas alterações antes de executar `ng add`. Se algo der errado ou as alterações não forem o que você esperava, você pode facilmente reverter para o estado anterior.
3. **Leia a documentação do pacote:** Antes de usar `ng add` para um pacote específico, consulte a documentação oficial dele. Muitos pacotes fornecem guias detalhados sobre como usar seus schematics e quais opções estão disponíveis.
4. **Esteja atento a conflitos:** Se você modificou manualmente partes do código que o schematic do `ng add` tenta tocar, esteja preparado para resolver conflitos. O CLI geralmente informa sobre eles.
5. **Use `-defaults` com cautela:** Se você quer um processo totalmente não interativo, `-defaults` pode ser útil. No entanto, certifique-se de entender as escolhas padrão que o schematic fará, pois elas podem não ser as ideais para o seu projeto.
6. **Mantenha o Angular CLI atualizado:** Versões mais recentes do Angular CLI geralmente trazem melhorias para o `ng add` e a compatibilidade com schematics mais novos. Use `ng update @angular/cli` para manter o CLI atualizado.

**Casos de Uso Comuns:**

- **Adicionar bibliotecas de UI/Componentes:**
    - `ng add @angular/material`
    - `ng add @ng-bootstrap/ng-bootstrap`
- **Adicionar soluções de gerenciamento de estado:**
    - `ng add @ngrx/store`
- **Adicionar funcionalidades progressivas (PWA, SSR):**
    - `ng add @angular/pwa`
    - `ng add @angular/ssr` (para Server-Side Rendering)
- **Adicionar ferramentas de teste ou linting:**
    - `ng add @angular/bazel` (para configurar Bazel)
- **Configurar internacionalização (i18n):**
    - `ng add @angular/localize`
- **Adicionar autenticação e autorização:** Muitos pacotes de autenticação de terceiros oferecem schematics para uma integração mais fácil.

---

### Exemplos Completos

Vamos ilustrar um exemplo mais abrangente de como usar `ng add` para configurar o Angular Material em um projeto novo, incluindo algumas opções.

**Cenário:** Você acabou de criar um novo projeto Angular e deseja adicionar o Angular Material, escolhendo um tema específico e configurando a tipografia e animações.

**Passo 1: Criar um novo projeto Angular (se ainda não tiver um)**

```bash
ng new my-material-app --strict --standalone --routing false
cd my-material-app

```

- `-strict`: Habilita o modo estrito do TypeScript para um código mais robusto.
- `-standalone`: Cria componentes, diretivas e pipes autônomos (sem módulos).
- `-routing false`: Não adiciona o módulo de roteamento (se não for necessário para este exemplo).

**Passo 2: Adicionar Angular Material usando `ng add`**

Agora, vamos adicionar o Angular Material. Usaremos algumas opções específicas para personalizar a instalação.

```bash
ng add @angular/material --theme=deeppurple-amber --typography=true --animations=enabled

```

- **`ng add @angular/material`**: Inicia o processo de adição do Angular Material.
- **`-theme=deeppurple-amber`**: Especifica que queremos o tema 'deeppurple-amber'. Sem esta opção, o CLI perguntaria interativamente qual tema você prefere.
- **`-typography=true`**: Habilita a tipografia global do Angular Material.
- **`-animations=enabled`**: Habilita o módulo de animações.

**O que este comando faz nos bastidores?**

1. **Instalação de Pacotes:**
    - Instala `@angular/material`, `@angular/cdk`, `@angular/animations` (e suas dependências) via npm ou yarn.
2. **Configuração de `angular.json`:**
    - Adiciona os estilos do tema `deeppurple-amber` ao array `styles` na seção `build` do `angular.json`.
    - Exemplo de trecho adicionado (simplificado):
        
        ```json
        {
          "projects": {
            "my-material-app": {
              "architect": {
                "build": {
                  "options": {
                    "styles": [
                      "src/styles.css",
                      "./node_modules/@angular/material/prebuilt-themes/deeppurple-amber.css"
                    ],
                    ...
                  }
                }
              }
            }
          }
        }
        
        ```
        
3. **Configuração do `app.config.ts` (para projetos Standalone) ou `app.module.ts` (para projetos baseados em módulos):**
    - **Para Standalone (Angular 17+):**
        - Adiciona `provideAnimations()` ao provedor de configuração da aplicação.
        - Exemplo (simplificado) de `src/app/app.config.ts`:
            
            ```tsx
            import { ApplicationConfig } from '@angular/core';
            import { provideRouter } from '@angular/router';
            import { provideAnimations } from '@angular/platform-browser/animations'; // Adicionado
            
            import { routes } from './app.routes';
            
            export const appConfig: ApplicationConfig = {
              providers: [
                provideRouter(routes),
                provideAnimations() // Aqui é adicionado
              ]
            };
            
            ```
            
    - **Para Projetos Baseados em Módulos (Angular \< 17 ou configurado para módulos):**
        - Importa `BrowserAnimationsModule` no `app.module.ts` (ou no módulo principal onde as animações são necessárias).
        - Exemplo (simplificado) de `src/app/app.module.ts`:
            
            ```tsx
            import { NgModule } from '@angular/core';
            import { BrowserModule } from '@angular/platform-browser';
            import { BrowserAnimationsModule } from '@angular/platform-browser/animations'; // Adicionado
            
            import { AppComponent } from './app.component';
            
            @NgModule({
              declarations: [
                AppComponent
              ],
              imports: [
                BrowserModule,
                BrowserAnimationsModule // Aqui é adicionado
              ],
              providers: [],
              bootstrap: [AppComponent]
            })
            export class AppModule { }
            
            ```
            
4. **Adição de Tipografia Global:**
    - Adiciona classes CSS para tipografia global no `src/styles.css` (ou um arquivo de estilo similar):
        
        ```css
        html, body { height: 100%; }
        body { margin: 0; font-family: Roboto, "Helvetica Neue", sans-serif; }
        
        ```
        
5. **Perguntas Interativas (se `-defaults` não for usado):** Se você não especificou as opções `-theme`, `-typography` e `-animations`, o CLI teria perguntado interativamente sobre essas preferências.

**Passo 3: Verificar a Instalação**

Após a execução, você pode verificar os arquivos modificados e as dependências no `package.json`.

```json
// package.json (trecho)
"dependencies": {
    "@angular/animations": "^17.X.X",
    "@angular/cdk": "^17.X.X",
    "@angular/material": "^17.X.X",
    // ... outras dependências
}

```

Agora você pode começar a usar componentes do Angular Material em seu aplicativo\!

---

### Tópicos Relacionados para Aprofundamento

Para continuar aprimorando seus conhecimentos sobre o Angular CLI e o ecossistema Angular, A.R.I.A. sugere os seguintes tópicos:

- **`ng update`**: Como manter suas dependências Angular atualizadas e migrar automaticamente para novas versões.
- **Schematics Personalizados**: Como criar seus próprios schematics para automatizar tarefas repetitivas em seus projetos ou equipe.
- **Angular Universal (SSR)**: Explorar o `ng add @angular/ssr` para renderização server-side e SEO.
- **Angular PWA**: Aprofundar-se no uso do `ng add @angular/pwa` para criar Progressive Web Apps.
- **Angular CLI Workspace Configuration (`angular.json`)**: Entender a estrutura e as configurações avançadas do seu projeto.
- **Gerenciamento de Estado com NgRx**: Se você adicionou `@ngrx/store`, explore os outros pacotes NgRx e como construir um gerenciamento de estado robusto.

Espero que esta explicação detalhada tenha sido útil para você, Gedê\! Se tiver mais alguma dúvida, A.R.I.A. está à disposição\!