# ng test

**Título:** Dominando o `ng test` no Angular CLI: Guia Completo

## Introdução

Uma visão geral do comando `ng test`, que permite executar testes unitários em aplicações e bibliotecas Angular usando o Angular CLI. ([angular.dev](https://angular.dev/cli/test))

## Sumário

1. Conceitos Fundamentais
2. Sintaxe e Uso
3. Restrições de Uso
4. Argumentos
5. Opções
6. Melhores Práticas e Casos de Uso
7. Exemplos Completos
8. Tópicos para Aprofundamento

---

## 1. Conceitos Fundamentais

O comando `ng test` orquestra o fluxo de execução de testes unitários dentro de um workspace Angular. Ele:

- Compila o projeto em memória e inicia o builder de testes (baseado em Karma). ([angular.dev](https://angular.dev/cli/test))
- Abre uma janela de navegador (ou roda em headless) para exibir resultados e reportar falhas. ([pluralsight.com](https://www.pluralsight.com/resources/blog/guides/executing-unit-tests-using-the-angular-cli?utm_source=chatgpt.com))
- Executa os testes escritos em Jasmine (framework de testes) e pode gerar relatórios de cobertura com Istanbul. ([pluralsight.com](https://www.pluralsight.com/resources/blog/guides/executing-unit-tests-using-the-angular-cli?utm_source=chatgpt.com))

---

## 2. Sintaxe e Uso

**Sintaxe geral:**

```bash
ng test [project] [options]
ng t    [project] [options]

```

- `ng t` é alias de `ng test`. ([angular.dev](https://angular.dev/cli/test))
- Se `project` não for especificado, todos os projetos do workspace serão testados. ([angular.dev](https://angular.dev/cli/test))

**Exemplos práticos:**

```bash
# 1. Testes do projeto padrão, modo watch
ng test

# 2. Testes de um projeto específico sem modo watch
ng test my-app --watch=false

# 3. Testes com relatório de cobertura e headless
ng test --code-coverage --browsers=ChromeHeadless

# 4. Testes AOT no projeto "library"
ng test library --aot

```

---

## 3. Restrições de Uso

- **Não usar para testes de Integração/E2E:** Para testes end-to-end, utilize `ng e2e` ou outras ferramentas (Protractor, Cypress).
- **Ambiente de Produção:** Não use `ng test` para gerar builds de produção; utilize `ng build --configuration production`.
- **Projetos sem arquivos `.spec.ts`:** Caso não existam testes unitários, o comando não executa nada.
- **Uso em bibliotecas:** Se não houver target de teste configurado no `angular.json`, configure manualmente antes de executar.

---

## 4. Argumentos

| Argumento | Tipo | Descrição |
| --- | --- | --- |
| `project` | string | Nome do projeto (aplicação ou biblioteca) a ser testado. Se omitido, testa todos os projetos. |
| Fonte: documentação oficial Angular CLI ([angular.dev](https://angular.dev/cli/test)) |  |  |

---

## 5. Opções

| Opção | Tipo | Padrão | Descrição | Alias |
| --- | --- | --- | --- | --- |
| `--aot` | boolean | false | Executa testes usando compilação Ahead of Time. |  |
| `--browsers` | string |  | Define navegadores para execução dos testes. Use `false` para nenhum browser. |  |
| `--code-coverage` | boolean | false | Gera relatório de cobertura de código. |  |
| `--code-coverage-exclude` | array |  | Globs de arquivos a excluir no relatório de cobertura. |  |
| `--configuration`, `-c` | string |  | Configurações nomeadas do builder, separadas por vírgula conforme `angular.json`. |  |
| `--define` | arraystring |  | Identificadores globais a substituir por valores constantes no código. |  |
| `--exclude` | array |  | Globs de arquivos a excluir do teste, relativo à raiz do projeto. |  |
| `--external-dependencies` | array |  | Dependências externas a não serem incluídas no bundle de teste. |  |
| `--help` | boolean |  | Exibe ajuda sobre o comando no console. |  |
| `--include` | array |  | Globs de arquivos a incluir nos testes. |  |
| `--inline-style-language` | string | css | Linguagem de inline styles (`css` | `less` | `sass` | `scss`). |  |
| `--karma-config` | string |  | Nome do arquivo de configuração do Karma. |  |
| `--main` | string |  | Arquivo de entrada principal para os testes. |  |
| `--poll` | number |  | Intervalo de polling (ms) para observação de arquivos. |  |
| `--polyfills` | array |  | Lista de polyfills a incluir (ex.: `zone.js`). |  |
| `--preserve-symlinks` | boolean |  | Não resolve symlinks (herda de NodeJS `--preserve-symlinks`). |  |
| `--progress` | boolean | true | Exibe progresso de build no console. |  |
| `--reporters` | array |  | Reporters do Karma a serem utilizados. |  |
| `--source-map` | boolean | true | Gera source maps para scripts e estilos. |  |
| `--ts-config` | string |  | Arquivo de configuração do TypeScript para testes. |  |
| `--watch` | boolean |  | Reexecuta testes ao detectar mudanças nos arquivos. |  |
| `--web-worker-ts-config` | string |  | Configuração TS específica para Web Workers. |  |
| Fonte: documentação oficial Angular CLI ([angular.dev](https://angular.dev/cli/test)) |  |  |  |  |

---

## 6. Melhores Práticas e Casos de Uso

- **CI/CD:** Desative o modo watch (`-watch=false`) e use navegadores headless (`-browsers=ChromeHeadless`) para integração contínua.
- **Cobertura:** Defina thresholds mínimos de cobertura e falhe o build se não forem atendidos.
- **Testes Isolados:** Utilize `-include` e `-exclude` para focar em testes específicos durante o desenvolvimento.
- **Polling em Containers:** Em ambientes sem watch nativo (WSL, contêiner), configure `-poll` para evitar falta de eventos de arquivo.
- **AOT no Teste:** Habilite `-aot` para detectar erros de template em tempo de teste.

---

## 7. Exemplos Completos

**1. Configuração em `package.json`:**

```
{
  "scripts": {
    // Testes em CI sem watch e com cobertura
    "test": "ng test --watch=false --browsers=ChromeHeadless --code-coverage",
    // Testes AOT para validação de templates
    "test:aot": "ng test --aot"
  }
}

```

**2. Trecho de `angular.json`:**

```
"projects": {
  "my-app": {
    "architect": {
      "test": {
        "builder": "@angular-devkit/build-angular:karma",
        "options": {
          "main": "src/test.ts",
          "karmaConfig": "karma.conf.js",
          "polyfills": ["zone.js", "zone.js/testing"],
          "tsConfig": "tsconfig.spec.json",
          "reporters": ["progress", "kjhtml"]
        },
        "configurations": {
          "ci": {
            "watch": false,
            "browsers": ["ChromeHeadless"],
            "codeCoverage": true
          }
        }
      }
    }
  }
}

```

**3. Exemplo de componente e teste:**

```
// src/app/calc.service.ts
export class CalcService {
  add(a: number, b: number): number {
    return a + b;
  }
}

// src/app/calc.service.spec.ts
import { CalcService } from './calc.service';

describe('CalcService', () => {
  let service: CalcService;

  beforeEach(() => {
    service = new CalcService();
  });

  it('should add two numbers', () => {
    expect(service.add(1, 2)).toBe(3);
  });
});

```

Para executar:

```bash
npm run test

```

---

## 8. Tópicos para Aprofundamento

- **Testes de End-to-End com `ng e2e`**
- **Configuração Avançada do Karma e Jasmine**
- **Cobertura de Código e Istanbul**
- **TestBed e ComponentFixture**
- **Testes com Jest no Angular CLI**

Espero que este guia ajude a dominar o uso do `ng test` no Angular CLI!