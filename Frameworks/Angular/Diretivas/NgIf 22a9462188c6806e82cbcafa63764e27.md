# NgIf

Entendido, Gedê\! Vamos mergulhar nas diretivas `ngIf` no Angular. Como um desenvolvedor Backend que está migrando para Go, entender como o frontend lida com a renderização condicional é super importante para ter uma visão completa das aplicações web.

---

# Diretivas: `ngIf` - Fundamentos do Angular

A diretiva `ngIf` é uma das ferramentas mais fundamentais e amplamente utilizadas no desenvolvimento com Angular. Ela permite que você renderize elementos do DOM (Document Object Model) de forma condicional, ou seja, exibir ou remover um bloco de HTML com base em uma expressão booleana. Em outras palavras, `ngIf` atua como um "se" para o seu HTML, controlando o que o usuário vê na tela dinamicamente.

Sua relevância no contexto de desenvolvimento frontend é imensa, pois habilita a criação de interfaces de usuário reativas e eficientes. Com `ngIf`, você pode:

- **Otimizar a performance:** Elementos não visíveis não são adicionados ao DOM, reduzindo o custo de renderização.
- **Melhorar a experiência do usuário:** Conteúdo pode ser exibido ou ocultado com base em permissões, estados de dados, ou interações do usuário, criando uma experiência mais fluida e personalizada.
- **Simplificar a lógica do template:** Evita a necessidade de manipulação manual do DOM via JavaScript puro, tornando o código mais limpo e declarativo.

---

## Sumário

- **Definição e Conceitos Fundamentais**
- **Sintaxe e Estrutura**
    - Uso Básico
    - Cláusula `else`
    - `then` e `else` com `ng-template`
    - `as` (Atribuição de Variável Local)
- **Componentes Principais e Associados**
- **Restrições de Uso**
- **Exemplos de Código Otimizados**
    - Exibindo/Ocultando Elementos Simples
    - Usando `else` para Feedback ao Usuário
    - Desestruturação de Dados Assíncronos com `async` pipe
    - Renderização de Múltiplos Elementos
- **Informações Adicionais**
    - Diferença entre `ngIf` e `[hidden]`
    - Considerações de Performance
- **Referências para Estudo Independente**

---

## Conteúdo Detalhado

### Sintaxe e Estrutura

A diretiva `ngIf` é aplicada diretamente a um elemento HTML. Ela avalia uma expressão e, se a expressão for verdadeira (truthy), o elemento e seu conteúdo são adicionados ao DOM. Se for falsa (falsy), eles são removidos do DOM.

### Uso Básico

A sintaxe mais comum é simples:

```html
<div *ngIf="condicao">
  Este conteúdo será exibido se 'condicao' for verdadeira.
</div>

```

O asterisco (`*`) antes de `ngIf` é uma abreviação para a "sintaxe micro", que indica que `ngIf` é uma **diretiva estrutural**. Diretivas estruturais alteram a estrutura do DOM, adicionando ou removendo elementos. Internamente, o Angular transforma o elemento com `*ngIf` em um `ng-template`.

### Cláusula `else`

Você pode fornecer uma cláusula `else` para exibir um conteúdo alternativo quando a condição for falsa. Para isso, você precisa definir um `ng-template` para a parte `else`.

```html
<div *ngIf="usuarioLogado; else naoLogado">
  Bem-vindo, Gedê!
</div>

<ng-template #naoLogado>
  Por favor, faça login.
</ng-template>

```

Aqui, `#naoLogado` é uma variável de template que referencia o `ng-template`.

### `then` e `else` com `ng-template`

Para cenários mais complexos onde você quer renderizar blocos diferentes de conteúdo com base em múltiplas condições ou quando a condição inicial é verdadeira, mas você quer renderizar um template específico, você pode usar a sintaxe completa com `then` e `else`.

```html
<div *ngIf="isAdmin; then adminContent else userContent"></div>

<ng-template #adminContent>
  <p>Conteúdo exclusivo para administradores.</p>
</ng-template>

<ng-template #userContent>
  <p>Conteúdo para usuários comuns.</p>
</ng-template>

```

### `as` (Atribuição de Variável Local)

A palavra-chave `as` permite que você atribua o valor da expressão `ngIf` a uma variável local dentro do escopo do template, útil para trabalhar com dados assíncronos, como observables.

```html
<div *ngIf="dados | async as meusDados">
  <p>Nome: {{ meusDados.nome }}</p>
  <p>Idade: {{ meusDados.idade }}</p>
</div>

```

No exemplo acima, `meusDados` estará disponível apenas se `dados | async` resolver para um valor truthy.

### Componentes Principais e Associados

A principal "componente" associada a `ngIf` é o **`ng-template`**.

- **`ng-template`**: Não é um elemento renderizado no DOM. Ele é um contêiner para trechos de HTML que o Angular pode renderizar condicionalmente ou repetidamente. O Angular utiliza `ng-template` internamente quando você usa diretivas estruturais como `ngIf` e `ngFor`. Quando `ngIf` é usado com o asterisco, o Angular converte o elemento em um `ng-template` e manipula sua exibição.

### Restrições de Uso

- **Apenas um  por elemento**: Você só pode ter uma diretiva estrutural (como `ngIf`, `ngFor`, `ngSwitchCase`) em um único elemento hospedeiro. Se precisar de `ngIf` e `ngFor` no mesmo elemento, use um `ng-container`.
- **Expressões Booleanas**: A expressão passada para `ngIf` deve ser avaliada como um booleano (verdadeiro ou falso) ou um valor que possa ser coercitivamente convertido para um booleano (por exemplo, `null`, `undefined`, `0`, `''` são falsy; objetos, strings não vazias são truthy).

---

## Exemplos de Código Otimizados

Vamos ver alguns exemplos práticos que você, Gedê, pode encontrar no dia a dia como desenvolvedor.

```tsx
// app.component.ts
import { Component } from '@angular/core';
import { Observable, of } from 'rxjs';
import { delay } from 'rxjs/operators';

@Component({
  selector: 'app-root',
  templateUrl: './app.component.html',
  styleUrls: ['./app.component.css']
})
export class AppComponent {
  // Exemplo 1: Simples booleano
  mostrarMensagem: boolean = true;
  isAdmin: boolean = false;
  produtoEmEstoque: number = 5;

  // Exemplo 3: Dados assíncronos
  dadosUsuario$: Observable<{ nome: string, email: string } | null>;

  constructor() {
    // Simula o carregamento de dados de um serviço assíncrono
    this.dadosUsuario$ = of({ nome: 'Luiz Gustavo', email: 'gedes@example.com' }).pipe(delay(2000));
    // Para testar o caso de dados nulos/carregando:
    // this.dadosUsuario$ = of(null).pipe(delay(2000));
  }

  // Método para alternar a exibição da mensagem
  alternarMensagem(): void {
    this.mostrarMensagem = !this.mostrarMensagem;
  }

  // Método para simular o login de um admin
  fazerLoginAdmin(): void {
    this.isAdmin = true;
  }

  // Método para simular o logout
  fazerLogout(): void {
    this.isAdmin = false;
  }
}

```

```html
<h2>Exemplos de ngIf</h2>

<h3>Exemplo 1: Exibindo/Ocultando Elementos Simples</h3>
<div *ngIf="mostrarMensagem">
  <p>Esta é uma mensagem importante que pode ser alternada!</p>
</div>
<button (click)="alternarMensagem()">Alternar Mensagem</button>

<br><br>

<h3>Exemplo 2: Usando `else` para Feedback ao Usuário</h3>
<div *ngIf="isAdmin; else usuarioComum">
  <p>Bem-vindo, Administrador! Você tem acesso total.</p>
  <button (click)="fazerLogout()">Sair</button>
</div>

<ng-template #usuarioComum>
  <p>Olá, usuário. Seu acesso é limitado.</p>
  <button (click)="fazerLoginAdmin()">Logar como Admin</button>
</ng-template>

<br><br>

<h3>Exemplo 3: Desestruturação de Dados Assíncronos com `async` pipe e `as`</h3>
<div *ngIf="dadosUsuario$ | async as usuario; else carregandoOuNulo">
  <h4>Informações do Usuário:</h4>
  <p>Nome: <strong>{{ usuario.nome }}</strong></p>
  <p>Email: <strong>{{ usuario.email }}</strong></p>
</div>

<ng-template #carregandoOuNulo>
  <p>Carregando informações do usuário ou dados não disponíveis...</p>
</ng-template>

<br><br>

<h3>Exemplo 4: Renderização Condicional de Múltiplos Elementos com `ng-container`</h3>
<ng-container *ngIf="produtoEmEstoque > 0; else produtoIndisponivel">
  <h4>Produto Disponível!</h4>
  <p>Temos <strong>{{ produtoEmEstoque }}</strong> unidades em estoque.</p>
  <button>Adicionar ao Carrinho</button>
</ng-container>

<ng-template #produtoIndisponivel>
  <p style="color: red;">Desculpe, este produto está fora de estoque.</p>
</ng-template>

<br><br>

<h3>Exemplo 5: Encapsulando Lógica Complexa com `ng-template` (Uso Avançado)</h3>
<div *ngIf="isAdmin; then templateAdmin else templatePadrao"></div>

<ng-template #templateAdmin>
  <div style="border: 1px solid blue; padding: 10px;">
    <h4>Painel de Administração</h4>
    <p>Aqui você pode gerenciar usuários, produtos, etc.</p>
  </div>
</ng-template>

<ng-template #templatePadrao>
  <div style="border: 1px solid gray; padding: 10px;">
    <h4>Página Inicial do Usuário</h4>
    <p>Explore nossos produtos e serviços.</p>
  </div>
</ng-template>

```

---

## Informações Adicionais

### Diferença entre `ngIf` e `[hidden]`

É crucial entender a diferença entre `*ngIf` e a vinculação de propriedade `[hidden]`:

- **`ngIf`**: **Remove e adiciona** o elemento do DOM. Se `ngIf="false"`, o elemento e seus filhos não existem na árvore DOM. Isso é mais eficiente em termos de performance quando o elemento contém lógica complexa ou muitos componentes internos, pois eles não são instanciados e renderizados.
- **`[hidden]`**: **Oculta e exibe** o elemento via CSS (`display: none;`). O elemento permanece no DOM, apenas não é visível. Use `[hidden]` quando a alternância de visibilidade é muito frequente ou quando o custo de criar e destruir o elemento é maior do que o custo de mantê-lo no DOM (por exemplo, um input simples que aparece e desaparece com frequência).

Como desenvolvedor, Gedê, você deve escolher a diretiva certa com base no cenário. Se o elemento é "pesado" ou se sua presença no DOM não é necessária quando invisível, `*ngIf` é a melhor escolha. Se é um elemento leve que será alternado rapidamente, `[hidden]` pode ser mais apropriado.

### Considerações de Performance

- **Evite loops `ngIf` excessivos**: Ter muitos `ngIf` aninhados ou em elementos que são renderizados em um loop `ngFor` pode levar a complexidade desnecessária e potencialmente impactar a performance se as expressões forem complexas.
- **Pipes Puros vs. Impuros**: Se a expressão do `ngIf` envolve pipes, prefira pipes puros (aqueles que dependem apenas de suas entradas para produzir uma saída) para evitar recomputações desnecessárias em cada ciclo de detecção de mudanças. O pipe `async` é um bom exemplo de pipe impuro que gerencia sua própria detecção de mudanças.

---

## Referências para Estudo Independente

Para aprofundar seus conhecimentos em `ngIf` e diretivas estruturais no Angular, sugiro os seguintes recursos:

- **Documentação Oficial do Angular - Diretivas Estruturais (`ngIf`)**:
    - [https://angular.io/guide/built-in-directives\\#structural-directives](https://angular.io/guide/built-in-directives%5C%5C#structural-directives) (Seção sobre `ngIf`)
- **Angular - `NgIf` API Documentation**:
    - [https://angular.io/api/common/NgIf](https://angular.io/api/common/NgIf)
- **Artigo da Medium sobre `ngIf` vs `[hidden]`**:
    - (Procure por "Angular ngIf vs hidden" no Medium, há vários artigos bons que comparam as duas abordagens com exemplos.)

Espero que esta explicação detalhada sobre o `ngIf` tenha sido útil, Gedê\! Se tiver mais alguma dúvida ou quiser explorar outro tópico do Angular, é só chamar a A.R.I.A.\!