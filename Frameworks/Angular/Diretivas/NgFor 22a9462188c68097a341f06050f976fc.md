# NgFor

Fala, Gedê\! Beleza? A.R.I.A. aqui para te ajudar a desvendar o `*ngFor` no Angular. Como desenvolvedor, especialmente para quem, como você, está migrando para outras tecnologias, entender a manipulação de listas na interface é fundamental.

---

## Introdução ao `ngFor`

No desenvolvimento front-end, frequentemente precisamos exibir coleções de dados, como uma lista de usuários, produtos ou posts. É aí que o `*ngFor` entra em cena no Angular. Ele é uma **diretiva estrutural** que permite renderizar um bloco de HTML para cada item em uma coleção.

A relevância do `*ngFor` é gigantesca. Ele é a principal ferramenta para a **renderização dinâmica de listas**, economizando código e mantendo a interface sincronizada com os dados. Sem ele, teríamos que manipular o DOM manualmente para cada item da lista, o que seria ineficiente e propenso a erros.

Basicamente, o `*ngFor` é um loop que percorre um array (ou qualquer iterável) e, para cada elemento, cria uma cópia do template HTML onde ele está aplicado.

---

## Sumário

- O que é `ngFor` e para que serve?
- Sintaxe e Estrutura Básica
- Variáveis Locais de Exportação (`index`, `first`, `last`, `even`, `odd`)
- `trackBy`: Otimizando a Performance
- Restrições de Uso e Melhores Práticas
- Exemplos de Código Otimizados
- Informações Adicionais: `ng-template` e `ngIf` com `ngFor`
- Referências para Estudo Independente

---

## Conteúdo Detalhado

### Sintaxe e Estrutura Básica

A sintaxe do `*ngFor` é bem simples e se assemelha a um loop `for...of` do JavaScript:

```html
<div *ngFor="let item of items">
  {{ item.nome }}
</div>

```

- `ngFor`: A diretiva estrutural que indica que este elemento e seu conteúdo serão repetidos. O asterisco () é uma açúcar sintático que simplifica o uso de diretivas estruturais. Internamente, o Angular transforma `ngFor` em uma `<ng-template>` com a diretiva `NgForOf` aplicada.
- `let item`: Declara uma **variável de template** (`item`) que, a cada iteração, receberá o valor do item atual da coleção. Você pode dar qualquer nome a essa variável.
- `of items`: Especifica a coleção (geralmente um array) sobre a qual o loop será executado. `items` deve ser uma propriedade acessível no componente TypeScript.

**Exemplo de Declaração e Utilização:**

Vamos supor que você tenha um array de produtos no seu componente:

```tsx
// app.component.ts
import { Component } from '@angular/core';

interface Produto {
  id: number;
  nome: string;
  preco: number;
}

@Component({
  selector: 'app-root',
  template: `
    <h2>Lista de Produtos</h2>
    <ul>
      <li *ngFor="let produto of produtos">
        {{ produto.nome }} - R$ {{ produto.preco.toFixed(2) }}
      </li>
    </ul>
  `,
  styleUrls: ['./app.component.css']
})
export class AppComponent {
  produtos: Produto[] = [
    { id: 1, nome: 'Notebook', preco: 4500.00 },
    { id: 2, nome: 'Mouse Gamer', preco: 150.00 },
    { id: 3, nome: 'Teclado Mecânico', preco: 300.00 },
  ];
}

```

Nesse exemplo, a `<li>` será repetida para cada `produto` no array `produtos`, exibindo o nome e o preço de cada um.

### Variáveis Locais de Exportação (`index`, `first`, `last`, `even`, `odd`)

O `*ngFor` oferece algumas variáveis locais que você pode "exportar" para usar dentro do template de cada iteração. Elas fornecem informações sobre a iteração atual:

- `index`: O índice do item atual na coleção (baseado em zero).
- `first`: Um booleano que é `true` se o item atual for o primeiro da coleção.
- `last`: Um booleano que é `true` se o item atual for o último da coleção.
- `even`: Um booleano que é `true` se o índice do item atual for par.
- `odd`: Um booleano que é `true` se o índice do item atual for ímpar.

Para exportar essas variáveis, você as declara após o `of` no `*ngFor`:

```html
<div *ngFor="let item of items; let i = index; let f = first; let l = last; let e = even; let o = odd">
  <p>Item {{ i + 1 }}: {{ item.nome }}</p>
  <p *ngIf="f">Este é o primeiro item!</p>
  <p *ngIf="l">Este é o último item!</p>
  <p *ngIf="e">Este item tem índice par.</p>
  <p *ngIf="o">Este item tem índice ímpar.</p>
</div>

```

### `trackBy`: Otimizando a Performance

O `trackBy` é uma funcionalidade crucial para a performance ao trabalhar com listas grandes ou que mudam frequentemente. Por padrão, quando os dados de um array mudam (por exemplo, um item é adicionado, removido ou reordenado), o Angular recria todos os elementos do DOM associados ao `*ngFor`. Isso pode ser custoso em termos de performance.

O `trackBy` permite que você forneça uma função que retorna um identificador único para cada item da coleção. Quando a coleção muda, o Angular usa esse identificador para saber quais itens foram adicionados, removidos ou movidos, em vez de recriar todos eles. Ele só manipula o DOM para os itens que realmente mudaram.

**Como usar `trackBy`:**

1. Crie uma função no seu componente que recebe o `index` e o `item` e retorna um identificador único.
2. Passe essa função para o `trackBy` na diretiva `ngFor`.

<!-- end list -->

```tsx
// app.component.ts
import { Component } from '@angular/core';

interface Usuario {
  id: number;
  nome: string;
  email: string;
}

@Component({
  selector: 'app-root',
  template: `
    <h2>Lista de Usuários</h2>
    <ul>
      <li *ngFor="let usuario of usuarios; trackBy: trackById">
        {{ usuario.nome }} ({{ usuario.email }})
      </li>
    </ul>
    <button (click)="adicionarUsuario()">Adicionar Usuário</button>
  `,
  styleUrls: ['./app.component.css']
})
export class AppComponent {
  usuarios: Usuario[] = [
    { id: 1, nome: 'João Silva', email: 'joao@example.com' },
    { id: 2, nome: 'Maria Souza', email: 'maria@example.com' },
  ];
  nextId = 3;

  trackById(index: number, usuario: Usuario): number {
    return usuario.id; // Retorna o ID único do usuário
  }

  adicionarUsuario() {
    this.usuarios = [
      ...this.usuarios, // Mantém os usuários existentes
      { id: this.nextId++, nome: `Novo Usuário ${this.nextId}`, email: `novo${this.nextId}@example.com` }
    ];
  }
}

```

Nesse exemplo, a função `trackById` usa o `id` de cada usuário como identificador único. Se você adicionar ou remover um usuário, o Angular será mais eficiente na atualização do DOM.

### Restrições de Uso

- **Apenas com iteráveis:** O `ngFor` funciona apenas com objetos que podem ser iterados, como Arrays, `Set`s e `Map`s.
- **Apenas um  por elemento:** Você não pode ter mais de uma diretiva estrutural (`ngIf`, `ngFor`, `ngSwitchCase`) no mesmo elemento HTML. Se precisar combinar, por exemplo, um `ngIf` e um `ngFor`, use `<ng-container>`.

---

## Exemplos de Código Otimizados

### Exemplo Básico: Lista de Tarefas

No dia a dia, Gedê, você usará muito o `*ngFor` para exibir listas simples.

```tsx
// app.component.ts
import { Component } from '@angular/core';

interface Tarefa {
  descricao: string;
  concluida: boolean;
}

@Component({
  selector: 'app-root',
  template: `
    <h2>Minhas Tarefas</h2>
    <ul>
      <li *ngFor="let tarefa of tarefas" [class.concluida]="tarefa.concluida">
        {{ tarefa.descricao }}
        <button (click)="alternarConclusao(tarefa)">
          {{ tarefa.concluida ? 'Desmarcar' : 'Concluir' }}
        </button>
      </li>
    </ul>

    <style>
      .concluida {
        text-decoration: line-through;
        color: #888;
      }
    </style>
  `,
})
export class AppComponent {
  tarefas: Tarefa[] = [
    { descricao: 'Estudar Go para backend', concluida: false },
    { descricao: 'Comprar alianças para o casamento com a Ju', concluida: false },
    { descricao: 'Planejar viagem de lua de mel', concluida: false },
    { descricao: 'Fazer compras da semana', concluida: true }
  ];

  alternarConclusao(tarefa: Tarefa) {
    tarefa.concluida = !tarefa.concluida;
  }
}

```

Neste exemplo, além de listar as tarefas, usamos o `[class.concluida]` para aplicar uma classe CSS dinamicamente, riscando a tarefa se ela estiver concluída.

### Exemplo Avançado: Lista Aninhada com `ngFor` e `trackBy`

Imagine que você precisa exibir categorias e, dentro de cada categoria, os produtos pertencentes a ela.

```tsx
// app.component.ts
import { Component } from '@angular/core';

interface Produto {
  id: number;
  nome: string;
}

interface Categoria {
  id: number;
  nome: string;
  produtos: Produto[];
}

@Component({
  selector: 'app-root',
  template: `
    <h2>Categorias de Produtos</h2>
    <div *ngFor="let categoria of categorias; trackBy: trackById">
      <h3>{{ categoria.nome }}</h3>
      <ul>
        <li *ngFor="let produto of categoria.produtos; trackBy: trackById">
          {{ produto.nome }}
        </li>
      </ul>
    </div>
  `,
})
export class AppComponent {
  categorias: Categoria[] = [
    {
      id: 1,
      nome: 'Eletrônicos',
      produtos: [
        { id: 101, nome: 'Smartphone' },
        { id: 102, nome: 'Smart TV' },
      ],
    },
    {
      id: 2,
      nome: 'Livros',
      produtos: [
        { id: 201, nome: 'A Arte da Guerra' },
        { id: 202, nome: 'Clean Code' },
      ],
    },
  ];

  trackById(index: number, item: any): number {
    return item.id;
  }
}

```

Aqui, temos um `*ngFor` aninhado. Um para as categorias e outro para os produtos dentro de cada categoria. Ambos se beneficiam do `trackBy` para garantir a performance.

---

## Informações Adicionais

### Combinando `ngFor` com `ngIf`

Como mencionado, você não pode ter duas diretivas estruturais no mesmo elemento. Se precisar renderizar um item de uma lista *condicionalmente*, você pode usar `<ng-container>`:

```html
<div *ngFor="let item of items">
  <ng-container *ngIf="item.ativo">
    <p>{{ item.nome }} está ativo!</p>
  </ng-container>
</div>

```

`ng-container` é um agrupador de elementos que o Angular não adiciona ao DOM. Ele é útil para agrupar elementos sem introduzir um novo nó na árvore DOM, perfeito para combinar diretivas estruturais.

### `ng-template`

Por trás das cenas, o `*ngFor` é desdobrado para uma estrutura com `<ng-template>`. Você pode usar `ng-template` diretamente para maior controle, embora seja mais comum para casos de uso avançados, como no `*ngIf` `else` ou `*ngSwitchCase`.

```html
<ng-template ngFor let-item [ngForOf]="items">
  <p>{{ item.nome }}</p>
</ng-template>

```

Esta é a forma "desaçucarada" do `*ngFor`. Raramente você precisará escrever dessa forma, mas é bom saber que ela existe.

---

## Referências para Estudo Independente

Para aprofundar seus conhecimentos, Gedê, sugiro os seguintes recursos confiáveis:

- **Documentação Oficial do Angular - `ngFor`**: Essencial para entender os fundamentos e detalhes.
    - [https://angular.io/api/common/NgForOf](https://angular.io/api/common/NgForOf)
- **Documentação Oficial do Angular - Diretivas Estruturais**: Para entender o contexto mais amplo das diretivas.
    - [https://angular.io/guide/structural-directives](https://angular.io/guide/structural-directives)
- **Artigo sobre `trackBy` no Angular**: Um excelente artigo para entender a fundo a otimização de performance com `trackBy`.
    - Pesquise por "Angular trackBy performance" em blogs como o de Netanel Basal ou do próprio Angular.
- **Tutoriais no YouTube**: Canais como o do Loiane Groner ou da Alura oferecem excelentes tutoriais em vídeo sobre `ngFor`.

Espero que esta explicação detalhada tenha sido clara, Gedê\! Entender o `*ngFor` é um passo crucial no desenvolvimento Angular e vai te ajudar muito na transição para o GO no backend, pois a forma como você organiza os dados para o frontend muitas vezes influencia como eles são expostos pelo backend.

Qualquer outra dúvida, é só chamar a A.R.I.A.\!