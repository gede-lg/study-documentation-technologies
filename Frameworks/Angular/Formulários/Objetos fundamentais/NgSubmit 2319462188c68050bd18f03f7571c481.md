# NgSubmit

Olá, Gedê\! Como A.R.I.A, sua Assistente Rápida para Idiotas Atarefados, preparei uma explicação extremamente detalhada sobre a diretiva `ngSubmit` no Angular, exatamente como você pediu. Vamos mergulhar fundo neste tópico essencial para o desenvolvimento de formulários.

---

### **Título: Desvendando a Diretiva `ngSubmit`: O Guia Completo para Manipulação de Formulários em Angular**

---

### **Introdução**

No ecossistema Angular, a manipulação de formulários é uma tarefa fundamental. A diretiva `ngSubmit` é a peça central que conecta a interface do usuário (o formulário HTML) à lógica de negócios do seu componente (o código TypeScript). Ela transforma o comportamento padrão de submissão de um formulário, que recarrega a página, em um evento customizado dentro do ciclo de vida de uma Single-Page Application (SPA), permitindo que você capture, valide e processe os dados do usuário de forma reativa e controlada.

---

### **Sumário**

Este guia abordará em profundidade a diretiva `ngSubmit`. Iniciaremos com seus conceitos fundamentais, explicando por que ela é necessária e como se integra ao `FormsModule`. Em seguida, detalharemos sua sintaxe, as propriedades e métodos do objeto de formulário associado, e os cenários onde seu uso é ou não recomendado. Exploraremos também os elementos que trabalham em conjunto com `ngSubmit`, como `NgForm` e `ngModel`. Por fim, apresentaremos as melhores práticas e um exemplo completo de um formulário de cadastro, consolidando todo o conhecimento.

---

### **Conceitos Fundamentais**

### O Problema do Formulário HTML Padrão em uma SPA

Um formulário HTML padrão (`<form>`) tem um comportamento nativo: quando submetido (geralmente por um clique em um `<button type="submit">`), ele envia uma requisição HTTP (GET ou POST) para a URL especificada no atributo `action`. Isso causa um **recarregamento completo da página**. Em uma SPA como as construídas com Angular, esse comportamento é indesejável, pois quebra a experiência de fluidez e reatividade da aplicação.

### A Solução Angular: `ngSubmit`

A diretiva `ngSubmit` foi criada para interceptar esse evento de submissão padrão. Seu propósito é:

1. **Prevenir o Comportamento Padrão:** Ela executa um `event.preventDefault()` internamente, impedindo que o navegador recarregue a página.
2. **Emitir um Evento Customizado:** Em vez de recarregar, ela emite um evento chamado `ngSubmit`.
3. **Conectar ao Componente:** Você pode "escutar" esse evento e vincular a ele um método do seu componente TypeScript. Isso permite que sua lógica de aplicação seja executada quando o usuário submete o formulário.

Para que `ngSubmit` funcione, o `FormsModule` (para Template-Driven Forms) ou o `ReactiveFormsModule` (para Reactive Forms) precisa ser importado no seu módulo Angular.

---

### **Sintaxe e Uso**

A diretiva `ngSubmit` é um *output property* (ou evento) do elemento `<form>`. A sintaxe para usá-la envolve a ligação de eventos, representada por parênteses `()`.

```html
<form (ngSubmit)="onFormSubmit()">
  <button type="submit">Enviar</button>
</form>

```

**Explicação do Código:**

- `<form ...>`: O elemento hospedeiro da diretiva. `ngSubmit` só pode ser usada em uma tag `<form>`.
- `(ngSubmit)="onFormSubmit()"`: Esta é a ligação de evento.
    - `(ngSubmit)`: Informa ao Angular que queremos escutar o evento `ngSubmit` neste formulário.
    - `"onFormSubmit()"`: Especifica o método no arquivo TypeScript do componente que será executado quando o evento ocorrer.

**Importante:** Para que o evento `ngSubmit` seja disparado, é necessário um botão com `type="submit"` dentro do formulário. Clicar neste botão ou pressionar "Enter" em um campo de texto do formulário acionará o evento.

---

### **Métodos e Propriedades (Através do `NgForm`)**

A diretiva `ngSubmit` em si é apenas um `EventEmitter`. O verdadeiro poder vem da diretiva `NgForm`, que o Angular anexa automaticamente a toda tag `<form>` quando o `FormsModule` está presente. Para acessar o estado do formulário, usamos uma **variável de referência de template**.

Veja como criar essa referência e acessar suas propriedades:

```html
<form #meuFormulario="ngForm" (ngSubmit)="onSubmit(meuFormulario)">
  </form>

```

Aqui, `meuFormulario` é uma variável que representa a instância da diretiva `NgForm`. Agora podemos explorar as propriedades e métodos mais importantes disponíveis através dela.

### **Propriedades do `NgForm`**

| Propriedade | Tipo | Descrição | Exemplo de Uso |
| --- | --- | --- | --- |
| `valid` | `boolean` | `true` se todos os controles do formulário forem válidos; `false` caso contrário. | `<button [disabled]="!meuFormulario.valid">` |
| `invalid` | `boolean` | O oposto de `valid`. `true` se pelo menos um controle for inválido. | `<div *ngIf="meuFormulario.invalid">Formulário inválido</div>` |
| `pending` | `boolean` | `true` se algum controle do formulário estiver passando por validação assíncrona. | `<span>Validando...</span>` |
| `pristine` | `boolean` | `true` se o usuário ainda não alterou o valor de nenhum controle no formulário. | `// Útil para saber se o form foi modificado` |
| `dirty` | `boolean` | O oposto de `pristine`. `true` se o usuário alterou o valor de algum controle. | `// Avisar o usuário antes de sair da página com dados não salvos` |
| `touched` | `boolean` | `true` se o usuário já interagiu (entrou e saiu) com pelo menos um controle. | `// Usado para exibir erros apenas depois que o usuário tocou no campo` |
| `untouched` | `boolean` | O oposto de `touched`. `true` se o usuário não interagiu com nenhum controle. | `// Estado inicial do formulário` |
| `value` | `object` | Um objeto contendo os valores de todos os controles do formulário. | `console.log(meuFormulario.value);` |
| `errors` | `object \| null` | Um objeto com erros de validação do próprio formulário (não dos controles). | `// Menos comum para o form em si, mais usado nos controles` |
| `controls` | `object` | Um objeto que contém a instância de cada `FormControl` do formulário. | `meuFormulario.controls['email'].valid` |

### **Métodos do `NgForm`**

| Método | Descrição | Sintaxe de Uso |
| --- | --- | --- |
| `reset()` ou `resetForm()` | Reseta o estado do formulário. Limpa os valores, redefine o estado para `pristine` e `untouched`, e remove os erros de validação. | `meuFormulario.resetForm();` |
| `setValue(value: object)` | Define o valor de todos os controles do formulário. Exige que o objeto passado contenha *todos* os campos do formulário. | `meuFormulario.setValue({ nome: 'Gedê', email: 'email@teste.com' });` |
| `patchValue(value: object)` | Define o valor de um subconjunto de controles do formulário. Ideal para atualizar apenas alguns campos. | `meuFormulario.patchValue({ nome: 'Luiz Gustavo' });` |
| `addControl(name: string, control: AbstractControl)` | Adiciona um controle dinamicamente ao formulário. | `// Mais comum em formulários reativos` |
| `removeControl(name: string)` | Remove um controle dinamicamente. | `// Mais comum em formulários reativos` |

---

### **Restrições de Uso**

1. **Apenas em tags `<form>`:** `ngSubmit` é uma diretiva de atributo que só funciona quando aplicada a um elemento `<form>`. Tentar usá-la em uma `<div>` ou outro elemento não terá efeito.
2. **Não usar com `(click)` para submissão:** É um erro comum colocar um `(click)="onSubmit()"` em um botão `type="submit"`. Isso pode causar a execução do método duas vezes ou levar a comportamentos inesperados, especialmente se a validação estiver envolvida. A `ngSubmit` no formulário já cuida de tudo. Use `(click)` em botões (`type="button"`) que executam ações que *não* são de submissão de formulário.
3. **Cenário de submissão nativa:** Se, por algum motivo extremamente raro em SPAs, você precisar do comportamento de submissão nativo do HTML (por exemplo, para integrar com um sistema legado que espera um POST tradicional), você não deve usar `ngSubmit`.

---

### **Elementos Associados**

`ngSubmit` não trabalha sozinha. Ela faz parte de um ecossistema.

- **`FormsModule`**: Módulo essencial que precisa ser importado no seu `AppModule` ou em um `FeatureModule`. Ele fornece as diretivas `ngSubmit`, `NgForm`, `ngModel`, etc.
    - **Uso:** `import { FormsModule } from '@angular/forms';` e adicioná-lo ao array `imports` do `@NgModule`.
- **`NgForm`**: A diretiva "cérebro" que rastreia o estado geral do formulário. Como vimos, ela é acessada via uma variável de referência de template (`#myForm="ngForm"`).
- **`ngModel`**: Usada em cada campo do formulário (`input`, `select`, `textarea`) para criar um `FormControl` e permitir o two-way data binding.
    - **Propósito:** Rastreia o valor, o estado de validação e a interação do usuário para um campo individual.
    - **Sintaxe:** `<input type="text" name="nome" [(ngModel)]="usuario.nome" required #nomeInput="ngModel">`
- **Botão com `type="submit"`**: O gatilho principal para o evento `ngSubmit`.
    - **Propósito:** Aciona a submissão do formulário.
    - **Sintaxe:** `<button type="submit">Cadastrar</button>`

---

### **Melhores Práticas e Casos de Uso**

- **Desabilitar o botão de envio:** Sempre desabilite o botão de submissão se o formulário for inválido para evitar envios de dados incompletos.
    
    ```html
    <button type="submit" [disabled]="!cadastroForm.valid">Salvar</button>
    
    ```
    
- **Exibir mensagens de erro específicas:** Use o estado do controle do formulário (acessado via `ngModel` e uma variável de referência de template) para mostrar mensagens de erro contextuais e apenas quando o usuário interagir com o campo.
    
    ```html
    <div *ngIf="emailInput.invalid && (emailInput.dirty || emailInput.touched)">
      <small *ngIf="emailInput.errors?.['required']">Email é obrigatório.</small>
      <small *ngIf="emailInput.errors?.['email']">Formato de email inválido.</small>
    </div>
    
    ```
    
- **Passar o formulário como argumento:** Passe a instância do `NgForm` para o seu método de submissão para ter acesso a todos os seus dados e métodos, como `resetForm()`.
    
    ```tsx
    // No .html
    <form #f="ngForm" (ngSubmit)="onSubmit(f)">
    
    // No .ts
    import { NgForm } from '@angular/forms';
    
    onSubmit(form: NgForm) {
      if (form.invalid) {
        return; // Segurança extra
      }
      console.log('Valor enviado:', form.value);
      // Lógica para enviar para o backend...
      form.resetForm();
    }
    
    ```
    
- **Feedback ao usuário:** Após a submissão, informe ao usuário o que aconteceu (sucesso, erro, carregando). Isso melhora a experiência do usuário.

---

### **Exemplo Completo: Formulário de Cadastro**

Vamos aplicar tudo o que aprendemos em um formulário de cadastro de usuário.

### **1. `app.module.ts` (Garantir que o `FormsModule` está importado)**

```tsx
import { NgModule } from '@angular/core';
import { BrowserModule } from '@angular/platform-browser';
import { FormsModule } from '@angular/forms'; // <-- IMPORTAR AQUI

import { AppComponent } from './app.component';

@NgModule({
  declarations: [
    AppComponent
  ],
  imports: [
    BrowserModule,
    FormsModule // <-- ADICIONAR AQUI
  ],
  providers: [],
  bootstrap: [AppComponent]
})
export class AppModule { }

```

### **2. `app.component.ts` (A lógica do componente)**

```tsx
import { Component } from '@angular/core';
import { NgForm } from '@angular/forms';

// Interface para tipar nosso modelo de dados
interface Usuario {
  nome: string;
  email: string;
  linguagemFavorita: string;
}

@Component({
  selector: 'app-root',
  templateUrl: './app.component.html',
  styleUrls: ['./app.component.css']
})
export class AppComponent {

  // Objeto para armazenar os dados do formulário via ngModel
  public usuario: Usuario = {
    nome: '',
    email: '',
    linguagemFavorita: '' // Valor inicial para o select
  };

  public onSubmit(form: NgForm): void {
    // Verificação de segurança, embora o botão já deva estar desabilitado
    if (form.invalid) {
      alert('Formulário inválido!');
      return;
    }

    // Acessando os valores enviados
    console.log('Dados submetidos:', form.value);

    // Aqui você enviaria os dados para um serviço/backend
    alert(`Usuário ${form.value.nome} cadastrado com sucesso!`);

    // Limpa o formulário e reseta seu estado para pristine e untouched
    form.resetForm();
  }
}

```

### **3. `app.component.html` (O template do formulário)**

```html
<div class="container">
  <h1>Formulário de Cadastro</h1>

  <form #cadastroForm="ngForm" (ngSubmit)="onSubmit(cadastroForm)">

    <div class="form-group">
      <label for="nome">Nome Completo</label>
      <input
        type="text"
        id="nome"
        name="nome"
        class="form-control"
        [(ngModel)]="usuario.nome"
        required
        minlength="3"
        #nomeInput="ngModel">

      <div *ngIf="nomeInput.invalid && (nomeInput.dirty || nomeInput.touched)" class="alert alert-danger">
        <div *ngIf="nomeInput.errors?.['required']">O nome é obrigatório.</div>
        <div *ngIf="nomeInput.errors?.['minlength']">O nome precisa ter no mínimo 3 caracteres.</div>
      </div>
    </div>

    <div class="form-group">
      <label for="email">Email</label>
      <input
        type="email"
        id="email"
        name="email"
        class="form-control"
        [(ngModel)]="usuario.email"
        required
        email
        #emailInput="ngModel">

      <div *ngIf="emailInput.invalid && (emailInput.dirty || emailInput.touched)" class="alert alert-danger">
        <div *ngIf="emailInput.errors?.['required']">O email é obrigatório.</div>
        <div *ngIf="emailInput.errors?.['email']">O formato do email é inválido.</div>
      </div>
    </div>

    <div class="form-group">
        <label for="linguagem">Linguagem Favorita</label>
        <select
          id="linguagem"
          name="linguagemFavorita"
          class="form-control"
          [(ngModel)]="usuario.linguagemFavorita"
          required
          #linguagemInput="ngModel">
          <option value="" disabled>Selecione uma opção</option>
          <option value="Java">Java</option>
          <option value="Go">Go</option>
          <option value="TypeScript">TypeScript</option>
        </select>
        <div *ngIf="linguagemInput.invalid && (linguagemInput.dirty || linguagemInput.touched)" class="alert alert-danger">
            <div *ngIf="linguagemInput.errors?.['required']">Você precisa escolher uma linguagem.</div>
        </div>
    </div>

    <button type="submit" class="btn btn-primary" [disabled]="!cadastroForm.valid">
      Cadastrar
    </button>
  </form>

  <hr>
  <h3>Estado do Formulário (Debug)</h3>
  <pre>Válido: {{ cadastroForm.valid }}</pre>
  <pre>Pristine (intocado): {{ cadastroForm.pristine }}</pre>
  <pre>Touched (tocado): {{ cadastroForm.touched }}</pre>
  <pre>Valores: {{ cadastroForm.value | json }}</pre>
</div>

```

---

### **Tópicos Relacionados para Aprofundamento**

1. **Validação Customizada:** Aprender a criar suas próprias regras de validação (ex: validar um CPF, checar se um username já existe de forma assíncrona).
2. **Formulários Reativos (Reactive Forms):** A outra abordagem para formulários em Angular, usando `FormGroup` e `FormControl`. É mais verbosa, porém mais poderosa e escalável para formulários complexos e dinâmicos. É o próximo passo natural após dominar os Template-Driven Forms.
3. **Two-Way Data Binding (`[(ngModel)]`):** Entender a fundo como essa sintaxe de "banana in a box" funciona (ela é uma combinação de `[ngModel]` e `(ngModelChange)`).
4. **Injeção de Dependência e Serviços:** Como criar um serviço para encapsular a lógica de envio de dados para um backend e injetá-lo no seu componente, mantendo o código limpo e organizado.

Espero que esta explicação super detalhada seja extremamente útil para você, Gedê. Se tiver qualquer outra dúvida, pode perguntar\!