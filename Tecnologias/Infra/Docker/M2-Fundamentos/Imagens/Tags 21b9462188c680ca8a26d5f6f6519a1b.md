# Tags

**Título da Explicação**

A Importância das Tags no Docker: Conceitos, Arquitetura e Boas Práticas

---

## 1. Introdução

As tags em Docker constituem um elemento essencial para versionamento, reprodutibilidade e organização de imagens. Ao associar um identificador legível a uma imagem, as tags permitem controlar quais versões de software são implantadas em diferentes ambientes, facilitar fluxos de entrega contínua e garantir rastreabilidade.

---

## 2. Sumário

1. Introdução
2. Sumário
3. Conceitos Fundamentais
4. Detalhamento do Versionamento Semântico (SemVer)
5. Versionamento SemVer com Hash de Commit
6. Componentes e Arquitetura Teórica
7. Cenários de Aplicação e Limitações
8. Melhores Práticas e Padrões de Uso
    - Quando utilizar
    - Restrições de uso
9. Sugestões para Aprofundamento

---

## 3. Conceitos Fundamentais

- **Identificador Humano-legível**: substituem hashes complexos por nomes que comunicam versão, estabilidade ou finalidade (por exemplo, “1.2.0-stable”, “dev-latest”).
- **Apontador para Manifesto**: cada tag referencia um manifesto de imagem, que lista camadas binárias e metadados. A tag é um ponteiro mutável.
- **Imutabilidade vs. Mutabilidade**: tags apontam recursos versionados, mas podem ser sobrescritas. Convenções semânticas minimizam riscos de alterações não intencionais.
- **Reprodutibilidade de Ambiente**: tags fixas (ex.: “3.9.5”) garantem consistência, evitando que “latest” atualize para versões inesperadas.
- **Integração com Registros Remotos**: tags organizam imagens em repositórios (Docker Hub ou privados), habilitando políticas de retenção e segurança.

---

## 4. Detalhamento do Versionamento Semântico (SemVer)

- **Estrutura MAJOR.MINOR.PATCH**
    - **MAJOR**: alterações incompatíveis na API;
    - **MINOR**: novas funcionalidades compatíveis;
    - **PATCH**: correções de bugs compatíveis.
- **Regras de Incremento**
    - Incrementar MAJOR ao introduzir breaking changes;
    - Incrementar MINOR ao adicionar recursos sem quebrar compatibilidade;
    - Incrementar PATCH para ajustes e correções de segurança.
- **Pre-releases e Metadados de Build**
    - Sintaxe: rótulos após hífen (ex.: `1.2.0-beta.1`) e metadados após `+` (ex.: `1.2.0+exp.sha.5114f85`).

---

## 5. Versionamento SemVer com Hash de Commit

- **Combinação de SemVer e Commit Hash**
    - Aplica o versionamento semântico base seguido de um sufixo com hash curto do commit (ex.: `v1.0.1-A241E3`).
- **Propósito e Benefícios**
    - **Rastreabilidade Precisa**: link direto ao estado exato do código-fonte usado na build;
    - **Unicidade**: cada imagem torna-se única, mesmo entre builds da mesma versão SemVer;
    - **Facilita Diagnóstico**: permite identificar rapidamente qual commit originou um incidente ou bug.
- **Formato Convencional**
    - **Prefixo da Tag**: `vMAJOR.MINOR.PATCH-HASH`, onde `HASH` corresponde aos primeiros 6–8 caracteres do SHA do commit;
    - **Separador**: hífen () antes do hash para manter clareza semântica;
    - **Case Sensitivity**: use padrão consistente (maiúsculas ou minúsculas) conforme convenções do repositório.
- **Fluxo de Geração em CI/CD**
    - Extrair hash curto do commit ativo (`git rev-parse --short HEAD`);
    - Concatenar ao SemVer definido no pipeline de release;
    - Taggear a imagem com o rótulo combinado e realizar push para o registry.
- **Cuidados e Limitações**
    - **Comprimento do Hash**: escolher comprimento suficiente para evitar colisões sem criar tags excessivamente longas;
    - **Imutabilidade de Tags**: não sobrescrever imagens versionadas com hash específico;
    - **Compatibilidade de Ferramentas**: validar que orquestradores e scanners suportem o formato estendido de tag.

---

## 6. Componentes e Arquitetura Teórica

- **Repositório vs. Imagem vs. Tag**
    - **Repositório**: coleção lógica de imagens relacionadas;
    - **Imagem**: conjunto de camadas e metadados, identificada por digest imutável;
    - **Tag**: ponteiro simbólico para o digest dentro do repositório.
- **Manifesto de Imagem**: documento JSON com camadas, plataformas suportadas e configurações de execução.
- **Camadas de Arquivo (Layering)**: cada etapa de construção adiciona uma camada; tags agrupam conjuntos de camadas em versões distintas.
- **Controle de Metadados**: uso de rótulos para canal de release, data ou finalidade.
- **Fluxo de Atualização**: pipelines CI/CD validam e atualizam tags somente após testes e verificações.

---

## 7. Cenários de Aplicação e Limitações

**Cenários de Aplicação**

- **Ambientes Isolados**: separar builds de dev (`app:dev`) de prod (`app:prod`).
- **Rollbacks Ágeis**: alternar facilmente entre `v2.1.0` e `v2.0.0` sem rebuild.
- **Testes Automatizados**: usar `ci-latest` para validar antes de promover `release-candidate`.
- **Gestão de Políticas**: manter apenas tags LTS ou stable conforme SLA.

**Limitações**

- **Inconsistência de Tags Mutáveis**: risco ao usar etiquetas flutuantes em produção.
- **Sobrecarga Semântica**: excesso de convenções pode confundir equipes.
- **Ferramentas de Terceiros**: alguns scanners ignoram contexto de tags, focando apenas no digest.

---

## 8. Melhores Práticas e Padrões de Uso

### Quando Utilizar

- **Versionamento Semântico**: aplique SemVer de forma consistente em tags numéricas.
- **Tags Flutuantes**: restrinja `latest` a ambientes de teste; evite em produção.
- **Canais de Release**: distinga `beta`, `rc` e `lts` de versões estáveis.
- **Imagens Multi-arquitetura**: crie manifestos unificados para várias plataformas.

### Restrições de Uso

- **Proteção de Tags Estáveis**: não sobrescrever tags de produção.
- **Limpeza de Tags**: implemente expiração de tags obsoletas.
- **Documentação de Convenções**: padronize formato e significados internamente.

---

## 9. Sugestões para Aprofundamento

- **Artigos e Blogs**:
    - Docker Oficial: *Docker Tagging Best Practices*
    - Blogs DevOps: *Semantic Versioning for Containers*
- **Termos de Pesquisa**: *OCI Image Manifest*, *Docker Descriptor*, *Mutability in Container Registries*
- **Leituras Avançadas**:
    - Design de microserviços com versionamento por tags;
    - Integração de tagging em pipelines Jenkins e GitHub Actions.