# FROM

# Instrução `FROM` em Dockerfile

## Introdução

A instrução `FROM` define a imagem base a partir da qual todas as demais instruções de um Dockerfile serão executadas. É obrigatória e deve ser a primeira instrução em qualquer Dockerfile (exceto em heranças de estágios de build, onde cada novo estágio reinicia com um `FROM`).

## Sumário

- [Conceitos Fundamentais](https://chatgpt.com/g/g-p-68596a64c76c819185e08bdb9bacec85-infra/c/6859817f-01e8-8013-9e5a-cbb14e4c689f#conceitos-fundamentais)
- [Sintaxe Detalhada e Uso Prático](https://chatgpt.com/g/g-p-68596a64c76c819185e08bdb9bacec85-infra/c/6859817f-01e8-8013-9e5a-cbb14e4c689f#sintaxe-detalhada-e-uso-pr%C3%A1tico)
- [Cenários de Restrição ou Não Aplicação](https://chatgpt.com/g/g-p-68596a64c76c819185e08bdb9bacec85-infra/c/6859817f-01e8-8013-9e5a-cbb14e4c689f#cen%C3%A1rios-de-restri%C3%A7%C3%A3o-ou-n%C3%A3o-aplica%C3%A7%C3%A3o)
- [Componentes Chave Associados](https://chatgpt.com/g/g-p-68596a64c76c819185e08bdb9bacec85-infra/c/6859817f-01e8-8013-9e5a-cbb14e4c689f#componentes-chave-associados)
- [Melhores Práticas e Padrões de Uso](https://chatgpt.com/g/g-p-68596a64c76c819185e08bdb9bacec85-infra/c/6859817f-01e8-8013-9e5a-cbb14e4c689f#melhores-pr%C3%A1ticas-e-padr%C3%B5es-de-uso)
- [Exemplo Prático Completo](https://chatgpt.com/g/g-p-68596a64c76c819185e08bdb9bacec85-infra/c/6859817f-01e8-8013-9e5a-cbb14e4c689f#exemplo-pr%C3%A1tico-completo)
- [Sugestões para Aprofundamento](https://chatgpt.com/g/g-p-68596a64c76c819185e08bdb9bacec85-infra/c/6859817f-01e8-8013-9e5a-cbb14e4c689f#sugest%C3%B5es-para-aprofundamento)

---

## Conceitos Fundamentais

A instrução `FROM` estabelece o ponto de partida para a construção de uma imagem Docker. Sua principal função é:

1. **Definir a base do sistema de arquivos:** Indica qual sistema operacional (ou ambiente pré-configurado) será utilizado.
2. **Garantir consistência de builds:** Ao fixar uma tag ou digest, assegura que todos que construírem a mesma imagem partirão de uma base idêntica.
3. **Permitir multi-stage builds:** Suporta múltiplos estágios de build no mesmo Dockerfile, ajudando a reduzir o tamanho final e separar compilação de runtime.

A ausência de `FROM` resulta em erro de parsing do Dockerfile, pois o Docker não sabe em qual contexto executar comandos como `RUN`, `COPY` ou `CMD`.

---

## Sintaxe Detalhada e Uso Prático

```
FROM <imagem>[:<tag>|@<digest>] [AS <alias>]

```

- `<imagem>`: Nome do repositório no Docker Hub ou caminho completo de um registro privado (ex.: `node`, `ubuntu`, `meuregistro/minhaapp`).
- `:<tag>` (opcional): Versão específica da imagem (ex.: `:14-alpine`, `:20.04`). Caso omitida, assume-se `:latest`.
- `@<digest>` (opcional): Identificador imutável da imagem no registro, garantindo versão exata.
- `AS <alias>` (opcional): Nomeia o estágio de build atual para referência em estágios posteriores.

### Exemplos

1. **Imagem Ubuntu padrão**
    
    ```
    FROM ubuntu:20.04
    
    ```
    
2. **Imagem Alpine minimalista**
    
    ```
    FROM alpine:3.18
    
    ```
    
3. **Build multi-stage com alias**
    
    ```
    FROM golang:1.21 AS builder
    WORKDIR /app
    COPY . .
    RUN go build -o meuapp
    
    FROM scratch AS runtime
    COPY --from=builder /app/meuapp /meuapp
    ENTRYPOINT ["/meuapp"]
    
    ```
    
4. **Uso de digest para controle rígido**
    
    ```
    FROM node@sha256:0123456789abcdef...
    
    ```
    

---

## Cenários de Restrição ou Não Aplicação

- **Execução direta de aplicações sem build:** Em aplicações que não precisam de compilação ou empacotamento, pode-se preferir imagens gerenciadas (`FROM ubuntu`) em vez de multi-stage.
- **Quando o build envolve ferramentas não disponíveis em imagem base:** Se o estágio de compilação exigir ferramentas específicas ausentes até mesmo em imagens oficiais, é necessário criar uma imagem customizada ou usar contêineres auxiliares.
- **Ambientes com política de segurança rígida:** Alguns registros privados podem não permitir o uso de tags `latest` ou digests sem autenticação adequada.

---

## Componentes Chave Associados

- **Imagem**: Pacote versionado contendo sistema de arquivos e metadados.
- **Tag**: Rótulo legível que aponta para uma imagem específica (ex.: `:alpine`, `:3.18`).
- **Digest**: Hash imutável que garante a integridade e versão exata da imagem.
- **Alias (AS)**: Identificador simbólico do estágio de build, utilizado por comandos como `COPY --from=alias`.

---

## Melhores Práticas e Padrões de Uso

1. **Pinagem de Versões**: Sempre especifique uma `tag` ou `digest`, evitando `latest` em produção.
2. **Multi-Stage Builds**: Separe estágios de compilação (builder) e runtime para diminuir o tamanho final da imagem.
3. **Uso de Imagens Slim/Mínimas**: Prefira variantes “slim” ou `alpine` para reduzir superfície de ataque e tamanho.
4. **Alias Descritivos**: Utilize nomes claros para estágios (`builder`, `test`, `prod`).
5. **Ordem de Instruções**: Coloque `FROM` e instruções estáticas (ex.: `RUN apt-get update`) antes de copiar código para evitar recriar camadas desnecessariamente.
6. **Registro Privado**: Prefira `FROM meu-registro.local:5000/minha-imagem:tag` para evitar latências e garantir políticas de segurança.

---

## Exemplo Prático Completo

```
# 1. Estágio de build (compile)
FROM node:18-alpine AS builder
WORKDIR /usr/src/app
COPY package*.json ./
RUN npm ci --only=production
COPY . .
RUN npm run build

# 2. Estágio de teste (opcional)
FROM builder AS tester
RUN npm test

# 3. Estágio de runtime (final)
FROM nginx:stable-alpine
COPY --from=builder /usr/src/app/dist /usr/share/nginx/html
EXPOSE 80
CMD ["nginx", "-g", "daemon off;"]

```

1. **Builder**: Baixa dependências e gera artefatos em `/usr/src/app/dist`.
2. **Tester**: Reutiliza o build para rodar testes.
3. **Runtime**: Usa Nginx para servir arquivos estáticos gerados.

---

## Sugestões para Aprofundamento

- [Documentação Oficial do Dockerfile – `FROM`](https://docs.docker.com/engine/reference/builder/#from)
- Artigos sobre **multi-stage builds** e **otimização de imagens**
- Vídeos tutoriais sobre **estratégias de caching em Docker**

---

*Documento gerado para explicar detalhadamente o uso da instrução `FROM` em Dockerfile.*