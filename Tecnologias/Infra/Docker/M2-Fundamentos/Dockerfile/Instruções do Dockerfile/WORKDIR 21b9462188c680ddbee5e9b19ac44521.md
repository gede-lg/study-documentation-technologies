# WORKDIR

# Instrução `WORKDIR` em Dockerfile

## Introdução

A instrução `WORKDIR` define o diretório de trabalho para as instruções seguintes no Dockerfile, como `RUN`, `CMD`, `ENTRYPOINT`, `COPY` e `ADD`. Ao estabelecer um diretório padrão, evita a necessidade de utilizar caminhos absolutos repetidamente, tornando o Dockerfile mais legível e portátil.

## Sumário

- [Conceitos Fundamentais](https://chatgpt.com/g/g-p-68596a64c76c819185e08bdb9bacec85-infra/c/6859817f-01e8-8013-9e5a-cbb14e4c689f#conceitos-fundamentais)
- [Sintaxe Detalhada e Uso Prático](https://chatgpt.com/g/g-p-68596a64c76c819185e08bdb9bacec85-infra/c/6859817f-01e8-8013-9e5a-cbb14e4c689f#sintaxe-detalhada-e-uso-pr%C3%A1tico)
- [Cenários de Restrição ou Não Aplicação](https://chatgpt.com/g/g-p-68596a64c76c819185e08bdb9bacec85-infra/c/6859817f-01e8-8013-9e5a-cbb14e4c689f#cen%C3%A1rios-de-restri%C3%A7%C3%A3o-ou-n%C3%A3o-aplica%C3%A7%C3%A3o)
- [Componentes Chave Associados](https://chatgpt.com/g/g-p-68596a64c76c819185e08bdb9bacec85-infra/c/6859817f-01e8-8013-9e5a-cbb14e4c689f#componentes-chave-associados)
- [Melhores Práticas e Padrões de Uso](https://chatgpt.com/g/g-p-68596a64c76c819185e08bdb9bacec85-infra/c/6859817f-01e8-8013-9e5a-cbb14e4c689f#melhores-pr%C3%A1ticas-e-padr%C3%B5es-de-uso)
- [Exemplo Prático Completo](https://chatgpt.com/g/g-p-68596a64c76c819185e08bdb9bacec85-infra/c/6859817f-01e8-8013-9e5a-cbb14e4c689f#exemplo-pr%C3%A1tico-completo)
- [Sugestões para Aprofundamento](https://chatgpt.com/g/g-p-68596a64c76c819185e08bdb9bacec85-infra/c/6859817f-01e8-8013-9e5a-cbb14e4c689f#sugest%C3%B5es-para-aprofundamento)

---

## Conceitos Fundamentais

- **Diretório de trabalho**: Local dentro do contêiner onde comandos serão executados e onde arquivos serão copiados.
- **Persistência por instrução**: Cada `WORKDIR` subsequente altera o diretório de contexto para todas as instruções a seguir.
- **Criação automática**: Se o diretório não existir, o Docker o criará automaticamente com permissão padrão.

---

## Sintaxe Detalhada e Uso Prático

```
WORKDIR <caminho>

```

- `<caminho>`: Diretório absoluto ou relativo. Caminhos relativos são interpretados a partir do `WORKDIR` anterior ou do diretório raiz se for o primeiro.

### Exemplos

1. **Definir diretório único**
    
    ```
    FROM ubuntu:20.04
    WORKDIR /app
    COPY . .
    RUN make build
    
    ```
    
    - `/app` será criado e usado para `COPY` e `RUN`.
2. **Múltiplos níveis**
    
    ```
    FROM node:18
    WORKDIR /usr/src/app
    WORKDIR logs
    RUN touch error.log access.log
    
    ```
    
    - Primeiro define `/usr/src/app`, depois relativo cria `/usr/src/app/logs`.
3. **Uso com variáveis de ambiente**
    
    ```
    ARG APP_DIR=/opt/service
    WORKDIR ${APP_DIR}
    COPY . ${APP_DIR}
    
    ```
    

---

## Cenários de Restrição ou Não Aplicação

- **Operações de cópia específicas**: Quando se copia diretamente para caminhos absolutos diferentes dos definidos no `WORKDIR`.
- **Imagens muito simples**: Se o container só executa um comando único sem necessidade de contexto de diretório.
- **Scripts de inicialização**: Em alguns casos, o script define seu próprio diretório de trabalho interna, tornando a instrução redundante.

---

## Componentes Chave Associados

- **ARG e ENV**: Variáveis podem parametrizar caminhos usados em `WORKDIR`.
- **COPY / ADD**: Instruções que utilizam o diretório atual como destino quando caminho relativo.
- **RUN, CMD, ENTRYPOINT**: Todas executam seus comandos no contexto do diretório definido.

---

## Melhores Práticas e Padrões de Uso

1. **Definir cedo no Dockerfile**: Coloque o `WORKDIR` logo após o `FROM` (e variáveis) para padronizar o contexto.
2. **Evitar caminhos complexos**: Utilize variáveis ou caminhos simples e legíveis.
3. **Minimizar instruções**: Um único `WORKDIR` na maioria dos casos, evitando fragmentação de contexto.
4. **Consistência com volumes**: Se usar `VOLUME`, alinhe o ponto de montagem com o `WORKDIR` quando apropriado.
5. **Documentação**: Explique no README o propósito do diretório de trabalho.

---

## Exemplo Prático Completo

```
FROM python:3.11-slim

# Definir diretório base da aplicação
WORKDIR /usr/src/app

# Instalar dependências
COPY requirements.txt ./
RUN pip install --no-cache-dir -r requirements.txt

# Copiar código-fonte
COPY . .

# Criar diretórios de logs dentro do contexto
WORKDIR logs
RUN mkdir -p errors access

# Voltar ao diretório principal
WORKDIR /usr/src/app

# Expor porta e definir entrypoint
EXPOSE 5000
CMD ["python", "app.py"]

```

---

## Sugestões para Aprofundamento

- Documentação oficial Docker: [`WORKDIR`](https://docs.docker.com/engine/reference/builder/#workdir)
- Artigos sobre **estruturas de diretórios em containers** e **organização de código**
- Comparativo entre uso de `WORKDIR` e caminhos absolutos em comandos de cópia

---

*Documento gerado para explicar detalhadamente a instrução `WORKDIR` em Dockerfile.*