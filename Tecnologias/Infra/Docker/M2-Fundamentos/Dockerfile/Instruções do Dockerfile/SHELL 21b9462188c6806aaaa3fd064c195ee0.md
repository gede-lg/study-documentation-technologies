# SHELL

# Instrução `SHELL` em Dockerfile

## Introdução

A instrução `SHELL` permite alterar o shell padrão usado para interpretar comandos nas instruções `RUN`, `CMD` e `ENTRYPOINT`. Por padrão, o Docker utiliza `/bin/sh -c`. Com `SHELL`, é possível especificar outros interpretadores, como `bash`, PowerShell, ou até scripts customizados.

## Sumário

- [Conceitos Fundamentais](https://chatgpt.com/g/g-p-68596a64c76c819185e08bdb9bacec85-infra/c/6859817f-01e8-8013-9e5a-cbb14e4c689f#conceitos-fundamentais)
- [Sintaxe Detalhada e Uso Prático](https://chatgpt.com/g/g-p-68596a64c76c819185e08bdb9bacec85-infra/c/6859817f-01e8-8013-9e5a-cbb14e4c689f#sintaxe-detalhada-e-uso-pr%C3%A1tico)
- [Cenários de Restrição ou Não Aplicação](https://chatgpt.com/g/g-p-68596a64c76c819185e08bdb9bacec85-infra/c/6859817f-01e8-8013-9e5a-cbb14e4c689f#cen%C3%A1rios-de-restri%C3%A7%C3%A3o-ou-n%C3%A3o-aplica%C3%A7%C3%A3o)
- [Componentes Chave Associados](https://chatgpt.com/g/g-p-68596a64c76c819185e08bdb9bacec85-infra/c/6859817f-01e8-8013-9e5a-cbb14e4c689f#componentes-chave-associados)
- [Melhores Práticas e Padrões de Uso](https://chatgpt.com/g/g-p-68596a64c76c819185e08bdb9bacec85-infra/c/6859817f-01e8-8013-9e5a-cbb14e4c689f#melhores-pr%C3%A1ticas-e-padr%C3%B5es-de-uso)
- [Exemplo Prático Completo](https://chatgpt.com/g/g-p-68596a64c76c819185e08bdb9bacec85-infra/c/6859817f-01e8-8013-9e5a-cbb14e4c689f#exemplo-pr%C3%A1tico-completo)
- [Sugestões para Aprofundamento](https://chatgpt.com/g/g-p-68596a64c76c819185e08bdb9bacec85-infra/c/6859817f-01e8-8013-9e5a-cbb14e4c689f#sugest%C3%B5es-para-aprofundamento)

---

## Conceitos Fundamentais

- **Shell padrão:** Sem `SHELL`, comandos em Dockerfile são executados com `/bin/sh -c` no Linux ou `cmd /S /C` no Windows.
- **Personalização:** Permite usar shells alternativos (bash, PowerShell) ou configurar opções de shell (ex.: pipefail, exec).
- **Escopo de afetação:** A instrução afeta todas as linhas seguintes no Dockerfile, até outro `SHELL` ser declarado.

---

## Sintaxe Detalhada e Uso Prático

```
SHELL ["executable", "param1", "param2", ...]

```

- Executable: caminho para o interpretador (ex.: `/bin/bash`, `powershell`).
- Params: opções passadas ao shell (ex.: `o pipefail`, `Command`).

### Exemplos

1. **Usar Bash com pipefail**
    
    ```
    FROM ubuntu:20.04
    SHELL ["/bin/bash", "-o", "pipefail", "-c"]
    
    RUN apt-get update && apt-get install -y \
        curl \
      && echo "Concluído"  # pipefail garante falha se qualquer comando falhar
    
    ```
    
2. **PowerShell no Windows**
    
    ```
    FROM mcr.microsoft.com/windows/nanoserver:1809
    SHELL ["powershell", "-Command"]
    
    RUN Write-Host "Instalando pacote..."; \
        Install-Package -Name git -Force
    
    ```
    
3. **Shell customizado (Script Wrapper)**
    
    ```
    COPY my_shell.sh /usr/local/bin/
    SHELL ["/usr/local/bin/my_shell.sh"]
    
    RUN echo "Executando com shell customizado"
    
    ```
    

---

## Cenários de Restrição ou Não Aplicação

- **Imagens minimalistas sem outro shell:** Se a imagem base não inclui o shell desejado, o build falhará.
- **Scripts portáteis:** Usar shells que não existam em todos os ambientes pode reduzir portabilidade.
- **Complexidade desnecessária:** Para comandos simples, manter o shell padrão evita configuração extra.

---

## Componentes Chave Associados

- **Executable:** Binário do shell, presente na imagem base.
- **Parâmetros de shell:** Opções para controlar comportamento (ex.: `l`, `e`, `x`).
- **Instruções afetadas:** `RUN`, `CMD`, `ENTRYPOINT` até próxima declaração de `SHELL`.

---

## Melhores Práticas e Padrões de Uso

1. **Definir no início:** Declare `SHELL` logo após o `FROM` para clareza.
2. **Combinar com `RUN` complexo:** Use shells avançados quando scripts envolvem pipelines ou características de shell específicas.
3. **Documentar mudanças:** Explique no README a razão para alterar o shell.
4. **Verificar presença do shell:** Confirme que o interpretador esteja instalado na imagem base.
5. **Evitar múltiplos `SHELL`:** Use apenas quando realmente necessário para não confundir a ordem das instruções.

---

## Exemplo Prático Completo

```
FROM ubuntu:22.04

# Utilizar bash com pipefail e verbose
SHELL ["/bin/bash", "-o", "pipefail", "-x", "-c"]

WORKDIR /app
COPY . .

# Instala módulos Python com controles adicionais do shell
RUN apt-get update && apt-get install -y python3-pip \
    && pip3 install --no-cache-dir -r requirements.txt

# Comandos posteriores também usam bash
RUN echo "Build finalizado!"

CMD ["/bin/bash", "-c", "python3 main.py"]

```

---

## Sugestões para Aprofundamento

- Documentação oficial Docker: [`SHELL`](https://docs.docker.com/engine/reference/builder/#shell)
- Artigos sobre **pipefail** e **bash options** em scripts de build
- Comparativo entre shells (`sh` vs `bash` vs `powershell`)

---

*Documento gerado para explicar detalhadamente a instrução `SHELL` em Dockerfile.*