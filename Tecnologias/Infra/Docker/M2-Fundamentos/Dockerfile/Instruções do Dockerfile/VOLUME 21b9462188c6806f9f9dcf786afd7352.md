# VOLUME

# Instrução `VOLUME` em Dockerfile

## Introdução

A instrução `VOLUME` permite criar pontos de montagem para volumes externos, garantindo que dados gerados ou utilizados pelo contêiner sejam armazenados fora de sua camada de leitura/escrita, preservando persistência e facilitando compartilhamento entre contêineres.

## Sumário

- [Conceitos Fundamentais](https://chatgpt.com/g/g-p-68596a64c76c819185e08bdb9bacec85-infra/c/6859817f-01e8-8013-9e5a-cbb14e4c689f#conceitos-fundamentais)
- [Sintaxe Detalhada e Uso Prático](https://chatgpt.com/g/g-p-68596a64c76c819185e08bdb9bacec85-infra/c/6859817f-01e8-8013-9e5a-cbb14e4c689f#sintaxe-detalhada-e-uso-pr%C3%A1tico)
- [Cenários de Restrição ou Não Aplicação](https://chatgpt.com/g/g-p-68596a64c76c819185e08bdb9bacec85-infra/c/6859817f-01e8-8013-9e5a-cbb14e4c689f#cen%C3%A1rios-de-restri%C3%A7%C3%A3o-ou-n%C3%A3o-aplica%C3%A7%C3%A3o)
- [Componentes Chave Associados](https://chatgpt.com/g/g-p-68596a64c76c819185e08bdb9bacec85-infra/c/6859817f-01e8-8013-9e5a-cbb14e4c689f#componentes-chave-associados)
- [Melhores Práticas e Padrões de Uso](https://chatgpt.com/g/g-p-68596a64c76c819185e08bdb9bacec85-infra/c/6859817f-01e8-8013-9e5a-cbb14e4c689f#melhores-pr%C3%A1ticas-e-padr%C3%B5es-de-uso)
- [Exemplo Prático Completo](https://chatgpt.com/g/g-p-68596a64c76c819185e08bdb9bacec85-infra/c/6859817f-01e8-8013-9e5a-cbb14e4c689f#exemplo-pr%C3%A1tico-completo)
- [Sugestões para Aprofundamento](https://chatgpt.com/g/g-p-68596a64c76c819185e08bdb9bacec85-infra/c/6859817f-01e8-8013-9e5a-cbb14e4c689f#sugest%C3%B5es-para-aprofundamento)

---

## Conceitos Fundamentais

- **Volumes Docker:** Áreas de armazenamento gerenciadas pelo Docker fora do sistema de arquivos da imagem.
- **Persistência de dados:** Garante que alterações em diretórios montados não sejam perdidas ao remover ou recriar o contêiner.
- **Compartilhamento de dados:** Volumes podem ser compartilhados entre múltiplos contêineres simultaneamente.

---

## Sintaxe Detalhada e Uso Prático

```
VOLUME ["/caminho/no/container" [, "/outro/caminho"]...]
# ou
VOLUME <caminho> <caminho>...

```

- Canônico: recomenda-se a forma JSON com colchetes e aspas.
- Cada caminho especificado será criado no contêiner como ponto de montagem de volume.

### Exemplos

1. **Volume de logs**
    
    ```
    VOLUME ["/var/log/app"]
    
    ```
    
2. **Múltiplos volumes**
    
    ```
    VOLUME ["/data/db", "/data/cache"]
    
    ```
    
3. **Forma simples (sem JSON)**
    
    ```
    VOLUME /opt/app/uploads /opt/app/tmp
    
    ```
    

---

## Cenários de Restrição ou Não Aplicação

- **Contêineres efêmeros (stateless):** Quando não há necessidade de persistir dados.
- **Uso de bind mounts:** Em ambientes locais, bind mounts podem oferecer maior controle sobre caminhos do host.
- **Orquestração avançada:** Kubernetes e Docker Compose têm suas próprias abstrações de volumes; `VOLUME` no Dockerfile pode ser substituído por definições do orquestrador.

---

## Componentes Chave Associados

- **Driver de volume:** Define onde e como os dados serão armazenados (`local`, `nfs`, `gcs`, etc.).
- **docker run -v/--mount:** Alternativas em tempo de execução para mapear volumes com opções específicas.
- **Docker Compose:** Declara volumes no `docker-compose.yml`, permitindo nomeação e configurações adicionais.

---

## Melhores Práticas e Padrões de Uso

1. **Isolar dados persistentes:** Utilize diretórios explícitos para separar dados do aplicativo e dados temporários.
2. **Nomear volumes:** Prefira nomear volumes no orquestrador em vez de usar volumes anonimamente criados por `VOLUME`.
3. **Gerenciar limites de tamanho:** Para drivers que suportam quotas, defina limites conforme necessidade.
4. **Backup e restauração:** Planeje estratégias de backup para volumes críticos.
5. **Evitar VOLUME em imagens base:** Prefira definir volumes nos pipelines finais ou no orquestrador para maior flexibilidade.

---

## Exemplo Prático Completo

Dockerfile:

```
FROM postgres:15

# Define diretório de dados como volume
VOLUME ["/var/lib/postgresql/data"]

ENV POSTGRES_DB=meudb \
    POSTGRES_USER=usuario \
    POSTGRES_PASSWORD=senha

EXPOSE 5432

CMD ["postgres"]

```

Uso com Docker Compose:

```yaml
version: '3.8'
services:
  db:
    build: .
    volumes:
      - db_data:/var/lib/postgresql/data
volumes:
  db_data:
    driver: local

```

1. O contêiner persistirá dados de banco no volume `db_data`.
2. Ao recriar o serviço, os dados permanecem intactos.

---

## Sugestões para Aprofundamento

- Documentação oficial Docker: [`VOLUME`](https://docs.docker.com/engine/reference/builder/#volume)
- Artigos sobre **drivers de volumes** e **estratégias de backup**
- Práticas de gerenciamento de volumes em **Docker Compose** e **Kubernetes**

---

*Documento gerado para explicar detalhadamente a instrução `VOLUME` em Dockerfile.*