# ENTRYPOINT

## Instrução `ENTRYPOINT` no Dockerfile: definição, sintaxe e uso prático

---

## Introdução

A instrução `ENTRYPOINT` em um **Dockerfile** define o processo “principal” que será executado **sempre** que um contêiner for iniciado a partir da imagem – transformando o container em uma espécie de executável. Ela garante que o comando configurado seja disparado como **PID 1**, permitindo o tratamento adequado de sinais do sistema (SIGTERM, SIGINT), essencial para desligamentos limpos e gerenciamento de processos em produção ([cloudbees.com](https://www.cloudbees.com/blog/understanding-dockers-cmd-and-entrypoint-instructions?utm_source=chatgpt.com), [bmc.com](https://www.bmc.com/blogs/docker-cmd-vs-entrypoint/?utm_source=chatgpt.com)).

---

## Sumário

1. [Conceitos Fundamentais](https://chatgpt.com/g/g-p-68596a64c76c819185e08bdb9bacec85-infra/c/6859817f-01e8-8013-9e5a-cbb14e4c689f#conceitos-fundamentais)
2. [Sintaxe Detalhada e Uso Prático](https://chatgpt.com/g/g-p-68596a64c76c819185e08bdb9bacec85-infra/c/6859817f-01e8-8013-9e5a-cbb14e4c689f#sintaxe-detalhada-e-uso-pr%C3%A1tico)
    - Formas **exec** e **shell**
    - Interação com `CMD` e sobrescrita em `docker run`
3. [Cenários de Restrição ou Não Aplicação](https://chatgpt.com/g/g-p-68596a64c76c819185e08bdb9bacec85-infra/c/6859817f-01e8-8013-9e5a-cbb14e4c689f#cen%C3%A1rios-de-restri%C3%A7%C3%A3o-ou-n%C3%A3o-aplica%C3%A7%C3%A3o)
4. [Componentes Chave Associados](https://chatgpt.com/g/g-p-68596a64c76c819185e08bdb9bacec85-infra/c/6859817f-01e8-8013-9e5a-cbb14e4c689f#componentes-chave-associados)
5. [Melhores Práticas e Padrões de Uso](https://chatgpt.com/g/g-p-68596a64c76c819185e08bdb9bacec85-infra/c/6859817f-01e8-8013-9e5a-cbb14e4c689f#melhores-pr%C3%A1ticas-e-padr%C3%B5es-de-uso)
6. [Exemplo Prático Completo](https://chatgpt.com/g/g-p-68596a64c76c819185e08bdb9bacec85-infra/c/6859817f-01e8-8013-9e5a-cbb14e4c689f#exemplo-pr%C3%A1tico-completo)
7. [Sugestões para Aprofundamento](https://chatgpt.com/g/g-p-68596a64c76c819185e08bdb9bacec85-infra/c/6859817f-01e8-8013-9e5a-cbb14e4c689f#sugest%C3%B5es-para-aprofundamento)

---

## Conceitos Fundamentais

- **Processo principal (PID 1):**
    
    Ao usar `ENTRYPOINT`, o comando definido executa como processo raiz do container, recebendo sinais do kernel e possibilitando desligamentos e reinícios ordenados ([cloudbees.com](https://www.cloudbees.com/blog/understanding-dockers-cmd-and-entrypoint-instructions?utm_source=chatgpt.com), [bmc.com](https://www.bmc.com/blogs/docker-cmd-vs-entrypoint/?utm_source=chatgpt.com)).
    
- **Container como executável:**
    
    Argumentos passados em `docker run <imagem> [args]` são automaticamente anexados ao `ENTRYPOINT`, enquanto para alterar o entrypoint é preciso usar `--entrypoint` explicitamente ([cloudbees.com](https://www.cloudbees.com/blog/understanding-dockers-cmd-and-entrypoint-instructions?utm_source=chatgpt.com), [kinsta.com](https://kinsta.com/blog/dockerfile-entrypoint/?utm_source=chatgpt.com)).
    
- **Relação com `CMD`:**
    
    Quando combinados, `ENTRYPOINT` define o executável fixo e `CMD` fornece parâmetros padrão; em `docker run`, passar novos parâmetros substitui o `CMD`, mas não o `ENTRYPOINT` ([stackoverflow.com](https://stackoverflow.com/questions/21553353/what-is-the-difference-between-cmd-and-entrypoint-in-a-dockerfile?utm_source=chatgpt.com), [bmc.com](https://www.bmc.com/blogs/docker-cmd-vs-entrypoint/?utm_source=chatgpt.com)).
    

---

## Sintaxe Detalhada e Uso Prático

### Formas **exec** e **shell**

```
# Exec form (recomendada)
ENTRYPOINT ["executable", "param1", "param2"]

```

- Não envolve shell intermediário; trata sinais corretamente; cada elemento do array é um argumento separado ([docs.docker.com](https://docs.docker.com/reference/dockerfile/?utm_source=chatgpt.com), [bmc.com](https://www.bmc.com/blogs/docker-cmd-vs-entrypoint/?utm_source=chatgpt.com)).

```
# Shell form
ENTRYPOINT comando param1 param2

```

- Invoca `/bin/sh -c`; permite expansões de variáveis e operadores do shell, mas **não** repassa sinais diretamente ao processo filho ([docs.docker.com](https://docs.docker.com/reference/dockerfile/?utm_source=chatgpt.com), [kinsta.com](https://kinsta.com/blog/dockerfile-entrypoint/?utm_source=chatgpt.com)).

### Interação com `CMD` e sobrescrita

```
ENTRYPOINT ["python", "app.py"]
CMD ["--port", "8080"]

```

- Aqui, executar `docker run imagem` dispara `python app.py --port 8080`.
- Já `docker run imagem --debug` executa `python app.py --debug`, pois `CMD` foi substituído.
- Para trocar o entrypoint:
    
    ```
    docker run --entrypoint /bin/bash imagem
    ``` :contentReference[oaicite:6]{index=6}.
    
    ```
    

---

## Cenários de Restrição ou Não Aplicação

- **Flexibilidade extrema:** se o container deve aceitar comandos variados sem um ponto fixo, prefira usar somente `CMD` ([stackoverflow.com](https://stackoverflow.com/questions/21553353/what-is-the-difference-between-cmd-and-entrypoint-in-a-dockerfile?utm_source=chatgpt.com), [kinsta.com](https://kinsta.com/blog/dockerfile-entrypoint/?utm_source=chatgpt.com)).
- **Scripts complexos de inicialização:** para lógica de startup (múltiplos passos, checagens), crie um script externo e aponte o `ENTRYPOINT` para ele (e.g., `ENTRYPOINT ["./start.sh"]`) ([bmc.com](https://www.bmc.com/blogs/docker-cmd-vs-entrypoint/?utm_source=chatgpt.com), [kinsta.com](https://kinsta.com/blog/dockerfile-entrypoint/?utm_source=chatgpt.com)).
- **Containers multi-serviços:** não use `ENTRYPOINT` único se o contêiner precisar orquestrar mais de uma aplicação simultaneamente; prefira orquestração externa (Docker Compose, Kubernetes).

---

## Componentes Chave Associados

- **`CMD`:** parâmetros padrão para o entrypoint; evita repetição de argumentos no `docker run`.
- **`SHELL`:** altera o shell padrão usado pelas instruções em shell form (incluindo `ENTRYPOINT`).
- **`ARG`/`ENV`:** podem ser referenciados dentro de scripts invocados pelo `ENTRYPOINT`, mas não diretamente no exec form.
- **`docker run --entrypoint`:** mecanismo para sobrescrever o comando fixo definido pelo `ENTRYPOINT` em tempo de execução.

---

## Melhores Práticas e Padrões de Uso

1. **Use a exec form sempre que possível**, garantindo sinalização adequada (SIGTERM, SIGINT) ([docs.docker.com](https://docs.docker.com/reference/dockerfile/?utm_source=chatgpt.com), [bmc.com](https://www.bmc.com/blogs/docker-cmd-vs-entrypoint/?utm_source=chatgpt.com)).
2. **Combine `ENTRYPOINT` + `CMD`** para definir executável fixo e parâmetros padrão, tornando o uso mais intuitivo (`docker run imagem` sem args extras).
3. **Mantenha scripts de inicialização externos** quando a lógica for complexa, deixando o Dockerfile limpo e modular ([kinsta.com](https://kinsta.com/blog/dockerfile-entrypoint/?utm_source=chatgpt.com), [bmc.com](https://www.bmc.com/blogs/docker-cmd-vs-entrypoint/?utm_source=chatgpt.com)).
4. **Documente no `README`** como passar flags e alterar comportamentos via `docker run --entrypoint` ou argumentos.

---

## Exemplo Prático Completo

```
# Imagem base com Node.js
FROM node:20-alpine AS build

WORKDIR /app
COPY package.json yarn.lock .
RUN yarn install --production

COPY . .

# Stage final: imagem mais leve
FROM alpine:3.18

WORKDIR /app
# Copia somente o necessário
COPY --from=build /app/dist ./dist
COPY --from=build /app/node_modules ./node_modules

# Permite variáveis de ambiente dinâmicas
ENV PORT=3000

# Define o processo principal e parâmetros padrão
ENTRYPOINT ["node", "dist/index.js"]
CMD ["--port", "3000"]

```

- **Uso:**
    - `docker run minha-imagem` → `node dist/index.js --port 3000`
    - `docker run minha-imagem --host 0.0.0.0` → `node dist/index.js --host 0.0.0.0`

---

## Sugestões para Aprofundamento

- **Referência oficial Dockerfile:** seção **ENTRYPOINT** ([docs.docker.com](https://docs.docker.com/reference/dockerfile/?utm_source=chatgpt.com))
- **Comparativo CMD vs ENTRYPOINT:** guia prático em CloudBees ([cloudbees.com](https://www.cloudbees.com/blog/understanding-dockers-cmd-and-entrypoint-instructions?utm_source=chatgpt.com))
- **Padrões de inicialização em contêineres:** artigo Kinsta sobre ENTRYPOINT avançado ([kinsta.com](https://kinsta.com/blog/dockerfile-entrypoint/?utm_source=chatgpt.com))
- **Boas práticas de construção de imagens:** documentação de best practices no site Docker ([docs.docker.com](https://docs.docker.com/reference/dockerfile/?utm_source=chatgpt.com))

---

Com esta explicação, você estará apto a configurar `ENTRYPOINT` de forma eficaz, garantindo imagens mais previsíveis, manejáveis e alinhadas às necessidades de produção.