# Name

**Entendendo o elemento top-level `name` no Docker Compose**

## Introdução

O Compose Specification permite definir um elemento superior `name` em um arquivo `docker-compose.yml`, utilizado para configurar o nome do projeto de forma declarativa. Sem esse elemento, o Docker Compose deriva um nome de projeto padrão a partir do diretório onde o arquivo está localizado ou por outros mecanismos de precedência ([docs.docker.com](https://docs.docker.com/reference/compose-file/version-and-name/), [docs.docker.com](https://docs.docker.com/compose/how-tos/project-name/)).

## Sumário

1. Conceitos Fundamentais
2. Sintaxe Detalhada e Uso Prático
3. Cenários de Restrição ou Não Aplicação
4. Componentes Chave Associados
5. Melhores Práticas e Padrões de Uso
6. Exemplo Prático Completo
7. Sugestões para Aprofundamento

---

## 1. Conceitos Fundamentais

O elemento top-level `name` declara o **nome do projeto Compose**, exposto internamente para interpolação através da variável de ambiente `COMPOSE_PROJECT_NAME`. Quando definido, o Compose utiliza este valor para isolar recursos (contêineres, redes, volumes) dentro do escopo do projeto, evitando colisões entre ambientes distintos ([docs.docker.com](https://docs.docker.com/reference/compose-file/version-and-name/)).

A ordem de precedência para determinação do nome do projeto é, do mais alto para o mais baixo:

1. Flag de linha de comando `p` / `-project-name`.
2. Variável de ambiente `COMPOSE_PROJECT_NAME`.
3. Atributo top-level `name:` no arquivo Compose.
4. Nome do diretório base que contém o arquivo Compose.
5. Nome do diretório atual, caso nenhum arquivo seja especificado ([docs.docker.com](https://docs.docker.com/compose/how-tos/project-name/)).

---

## 2. Sintaxe Detalhada e Uso Prático

Para declarar o `name`, basta adicioná-lo como o primeiro atributo do seu `docker-compose.yml`:

```yaml
name: myapp
services:
  web:
    image: nginx
    command: echo "Projeto: ${COMPOSE_PROJECT_NAME}"

```

- **Localização:** deve estar antes de `services`, `networks`, `volumes` etc.
- **Valor:** somente letras minúsculas, dígitos decimais, hífens () e underscores (`_`), começando por letra ou dígito ([docs.docker.com](https://docs.docker.com/compose/how-tos/project-name/)).
- **Interpolação:** qualquer lugar no arquivo que use `${COMPOSE_PROJECT_NAME}` será substituído por este valor.

---

## 3. Cenários de Restrição ou Não Aplicação

- **Versões legadas:** em versões muito antigas do Docker Compose (< v2.5.1) houve bugs de suporte a `name` (corrigidos em 2022) ([stackoverflow.com](https://stackoverflow.com/questions/72482123/should-the-top-level-name-property-in-compose-yaml-set-compose-project-name?utm_source=chatgpt.com)).
- **Swarm stacks:** ao usar `docker stack deploy`, o top-level `name` não substitui o parâmetro `-name` do comando.
- **Múltiplos arquivos:** se passar vários arquivos com `f`, o Compose usa o último `name:` declarado ([docs.docker.com](https://docs.docker.com/compose/how-tos/project-name/)).

---

## 4. Componentes Chave Associados

- **`COMPOSE_PROJECT_NAME`:** exposta para interpolação e scripts.
- **Flag `p` / `-project-name`:** define o nome sem alterar o arquivo.
- **`-project-directory`:** altera o diretório base para derivação do nome padrão.
- **Arquivo `.env`:** pode conter `COMPOSE_PROJECT_NAME`, respeitando a precedência.

---

## 5. Melhores Práticas e Padrões de Uso

- **Consistência:** padronize nomes para facilitar automações e CI/CD.
- **Isolamento de ambientes:** use nomes distintos para dev, staging e produção.
- **Evitar colisões:** ao rodar múltiplas instâncias, prefira `p` dinamicamente (ex.: feature branches).
- **Documentação:** inclua comentário no `docker-compose.yml` explicando a escolha do nome.

---

## 6. Exemplo Prático Completo

```yaml
# docker-compose.yml
name: api_service

version: '3.9'  # informativo
services:
  api:
    image: myorg/api:latest
    ports:
      - "8080:80"
    environment:
      - MODE=production
    deploy:
      replicas: 2

  db:
    image: postgres:15
    volumes:
      - db-data:/var/lib/postgresql/data

volumes:
  db-data:

networks:
  default:
    driver: bridge

```

Neste cenário, todos os recursos serão prefixados com `api_service`, isolando o projeto de outras execuções ([docs.docker.com](https://docs.docker.com/reference/compose-file/version-and-name/)).

---

## 7. Sugestões para Aprofundamento

- **Referência Compose Spec:** leia [Version and name top-level elements](https://docs.docker.com/reference/compose-file/version-and-name/) ([docs.docker.com](https://docs.docker.com/reference/compose-file/version-and-name/)).
- **Como definir nome de projeto:** veja [Specify a project name](https://docs.docker.com/compose/how-tos/project-name/) ([docs.docker.com](https://docs.docker.com/compose/how-tos/project-name/)).
- **Interpolação de variáveis:** confira a seção de [interpolation](https://docs.docker.com/compose/compose-file/#interpolation).

Se precisar de mais detalhes ou exemplos, é só falar!