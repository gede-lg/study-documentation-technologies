# tmpfs

**Guia Completo do Atributo `tmpfs` nos Serviços do Docker Compose**

---

## Sumário

1. [Introdução](https://chatgpt.com/c/6859817f-01e8-8013-9e5a-cbb14e4c689f#introdu%C3%A7%C3%A3o)
2. [Conceitos Fundamentais](https://chatgpt.com/c/6859817f-01e8-8013-9e5a-cbb14e4c689f#conceitos-fundamentais)
3. [Sintaxe Detalhada e Uso Prático](https://chatgpt.com/c/6859817f-01e8-8013-9e5a-cbb14e4c689f#sintaxe-detalhada-e-uso-pr%C3%A1tico)
    - [Sintaxe Curta](https://chatgpt.com/c/6859817f-01e8-8013-9e5a-cbb14e4c689f#sintaxe-curta)
    - [Sintaxe Longa (via `volumes`)](https://chatgpt.com/c/6859817f-01e8-8013-9e5a-cbb14e4c689f#sintaxe-longa-via-volumes)
4. [Cenários de Restrição ou Não Aplicação](https://chatgpt.com/c/6859817f-01e8-8013-9e5a-cbb14e4c689f#cen%C3%A1rios-de-restri%C3%A7%C3%A3o-ou-n%C3%A3o-aplica%C3%A7%C3%A3o)
5. [Componentes-Chave Associados](https://chatgpt.com/c/6859817f-01e8-8013-9e5a-cbb14e4c689f#componentes-chave-associados)
6. [Melhores Práticas e Padrões de Uso](https://chatgpt.com/c/6859817f-01e8-8013-9e5a-cbb14e4c689f#melhores-pr%C3%A1ticas-e-padr%C3%B5es-de-uso)
7. [Exemplo Prático Completo](https://chatgpt.com/c/6859817f-01e8-8013-9e5a-cbb14e4c689f#exemplo-pr%C3%A1tico-completo)
8. [Sugestões para Aprofundamento](https://chatgpt.com/c/6859817f-01e8-8013-9e5a-cbb14e4c689f#sugest%C3%B5es-para-aprofundamento)

---

## Introdução

No Docker Compose, a montagem de sistemas de arquivos temporários em memória (tmpfs) permite que containers gerenciem dados efêmeros com baixo overhead de I/O e maior segurança, pois nada é gravado no disco. A seguir, exploramos em detalhes o atributo `tmpfs` disponível na definição de serviços, conforme a [referência oficial do Compose](https://docs.docker.com/reference/compose-file/services/#tmpfs).

---

## Conceitos Fundamentais

- **O que é `tmpfs`:**
    
    Um *tmpfs* é um sistema de arquivos criado diretamente na memória RAM do host, removido automaticamente quando o container é parado ou reiniciado. Diferente de volumes e bind mounts, não persiste dados em disco e não pode ser compartilhado entre containers ([docs.docker.com](https://docs.docker.com/engine/storage/tmpfs/)).
    
- **Caso de uso:**
    
    Ideal para armazenar dados sensíveis (tokens, credenciais), caches temporários ou arquivos de swap de pequena duração, melhorando desempenho e reduzindo riscos de persistência indesejada ([docs.docker.com](https://docs.docker.com/engine/storage/tmpfs/)).
    
- **Mapa para o kernel Linux:**
    
    O Docker faz `mount` direto em `tmpfs` do kernel. Atenção ao uso de swap — o tmpfs pode, por configuração do sistema, usar swap e, assim, involuntariamente persistir parte dos dados em disco ([docs.docker.com](https://docs.docker.com/engine/storage/tmpfs/)).
    

---

## Sintaxe Detalhada e Uso Prático

### Sintaxe Curta

Permite declarar diretamente, em cada serviço, uma lista de montagens *tmpfs*:

```yaml
services:
  app:
    tmpfs:
      - /data:mode=755,uid=1009,gid=1009
      - /run

```

- **Formato:**
    - Cada item é `"<caminho>[:<opções>]"`.
    - `path`: ponto de montagem dentro do container.
    - `options`: lista separada por vírgulas de chaves:
        - `mode`: permissão Unix em octal.
        - `uid`: usuário proprietário (ID).
        - `gid`: grupo proprietário (ID). ([docs.docker.com](https://docs.docker.com/reference/compose-file/services/))

### Sintaxe Longa (via `volumes`)

Permite configurar parâmetros adicionais (como tamanho máximo):

```yaml
services:
  app:
    volumes:
      - type: tmpfs
        target: /cache
        tmpfs:
          size: 100m
          mode: 1770

```

- **Campos principais:**
    - `type: tmpfs`: define o tipo de montagem.
    - `target`: destino no container.
    - `tmpfs`: objeto com opções:
        - `size`: tamanho máximo (bytes ou com sufixo, ex. `100m`).
        - `mode`: permissão em octal (ex. `1770`). ([docs.docker.com](https://docs.docker.com/reference/compose-file/services/))

---

## Cenários de Restrição ou Não Aplicação

- **Plataforma:**
    
    Disponível **somente em hosts Linux**. Não há suporte a `tmpfs` em containers Windows ou em implantações Swarm via `docker stack deploy` ([docs.docker.com](https://docs.docker.com/engine/storage/tmpfs/)).
    
- **Compartilhamento:**
    
    Não é possível montar o mesmo *tmpfs* em múltiplos containers; cada montagem é isolada ([docs.docker.com](https://docs.docker.com/engine/storage/tmpfs/)).
    
- **Persistência Acidental:**
    
    Em sistemas com swap habilitado, parte dos dados pode ser gravada em disco pelo kernel — cuidado com informações sensíveis ([docs.docker.com](https://docs.docker.com/engine/storage/tmpfs/)).
    
- **Permissões:**
    
    Montagens *tmpfs* podem redefinir permissões após reinicialização do container; use `uid`/`gid` para contornar esse comportamento ([docs.docker.com](https://docs.docker.com/engine/storage/tmpfs/)).
    
- **Uso de Memória:**
    
    Dados em *tmpfs* ocupam RAM do host (até 50% do total por padrão). Evite alocar grandes quantidades sem necessidade, pois pode levar a falta de memória.
    

---

## Componentes-Chave Associados

| Componente | Descrição |
| --- | --- |
| `path` / `target` | Caminho dentro do container onde o *tmpfs* é montado. |
| `mode` | Permissões Unix (ex. `755`, `1777`). |
| `uid`, `gid` | IDs de usuário e grupo proprietários da montagem. |
| `size` | (Long syntax) Tamanho máximo do *tmpfs* (bytes ou com sufixo). |
| `type` | (Long syntax via `volumes`) Deve ser `tmpfs`. |
| `tmpfs` | Objeto filho em `volumes` contendo `size` e `mode`. |

---

## Melhores Práticas e Padrões de Uso

- **Defina sempre tamanho (`size`)** quando o volume de dados temporários for significativo, evitando consumo excessivo de RAM.
- **Use permissões restritivas** (`mode`) para diretórios que contenham dados sensíveis.
- **Combine com variáveis de ambiente** para controlar dinamicamente parâmetros de montagem.
- **Prefira a sintaxe longa** quando precisar de `size`; caso contrário, a sintaxe curta é mais enxuta.
- **Não utilize para persistência**: dados em *tmpfs* são efêmeros e não devem ser críticos para o negócio.
- **Monitore uso de memória** em produção para evitar fugas de recursos.

---

## Exemplo Prático Completo

```yaml
version: "3.8"

services:
  webapp:
    image: nginx:latest
    ports:
      - "80:80"

    # Montagens tmpfs curtas
    tmpfs:
      - /run:mode=755,uid=1000,gid=1000
      - /tmp

    # Montagem tmpfs longa com tamanho e modo
    volumes:
      - type: tmpfs
        target: /cache
        tmpfs:
          size: 200m
          mode: 1777

    # Outros exemplos de uso...
    environment:
      - APP_ENV=production
    restart: unless-stopped

```

- **O que acontece:**
    - `/run` e `/tmp` existirão somente em RAM, com permissões e donos configurados.
    - `/cache` terá limite de 200 MiB e permissão `rwxrwxrwt` (modo 1777), ideal para cache de aplicação.

---

## Sugestões para Aprofundamento

- Leia a seção completa de [tmpfs mounts no Docker Engine](https://docs.docker.com/engine/storage/tmpfs/) para entender opções avançadas de CLI e limitações ([docs.docker.com](https://docs.docker.com/engine/storage/tmpfs/)).
- Explore a [Especificação do Docker Compose](https://github.com/compose-spec/compose-spec) para conhecer evoluções e suporte em versões mais recentes.
- Analise práticas de segurança em sistemas de arquivos em memória no [kernel Linux](https://en.wikipedia.org/wiki/Tmpfs) para otimizar swap e evitar vazamento de dados.

---

Com este guia, você tem todos os detalhes para usar o atributo `tmpfs` de forma eficiente e segura nos seus projetos com Docker Compose. Se tiver dúvidas ou cenários específicos, fique à vontade para perguntar!