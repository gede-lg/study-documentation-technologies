# expose

**Título da Explicação:** Entendendo o atributo `expose` na chave Services do Docker Compose

---

## Introdução

O Docker Compose permite definir e orquestrar múltiplos contêineres de forma simples, usando um arquivo YAML. Cada serviço declarado no Compose é conectado a uma rede interna padrão, facilitando a comunicação entre contêineres sem expor portas diretamente ao host ([docs.docker.com](https://docs.docker.com/compose/how-tos/networking/?utm_source=chatgpt.com)). O atributo `expose`, presente na seção de **services**, serve justamente para indicar quais portas serão disponibilizadas **internamente** para outros serviços, sem publicá-las para o host ([docs.docker.com](https://docs.docker.com/reference/compose-file/services/), [baeldung.com](https://www.baeldung.com/ops/docker-compose-expose-vs-ports?utm_source=chatgpt.com)).

---

## Sumário

1. [Conceitos Fundamentais](https://chatgpt.com/g/g-p-68596a64c76c819185e08bdb9bacec85-infra/c/6859817f-01e8-8013-9e5a-cbb14e4c689f#conceitos-fundamentais)
2. [Sintaxe Detalhada e Uso Prático](https://chatgpt.com/g/g-p-68596a64c76c819185e08bdb9bacec85-infra/c/6859817f-01e8-8013-9e5a-cbb14e4c689f#sintaxe-detalhada-e-uso-pr%C3%A1tico)
3. [Cenários de Restrição ou Não Aplicação](https://chatgpt.com/g/g-p-68596a64c76c819185e08bdb9bacec85-infra/c/6859817f-01e8-8013-9e5a-cbb14e4c689f#cen%C3%A1rios-de-restri%C3%A7%C3%A3o-ou-n%C3%A3o-aplica%C3%A7%C3%A3o)
4. [Componentes Chave Associados](https://chatgpt.com/g/g-p-68596a64c76c819185e08bdb9bacec85-infra/c/6859817f-01e8-8013-9e5a-cbb14e4c689f#componentes-chave-associados)
5. [Melhores Práticas e Padrões de Uso](https://chatgpt.com/g/g-p-68596a64c76c819185e08bdb9bacec85-infra/c/6859817f-01e8-8013-9e5a-cbb14e4c689f#melhores-pr%C3%A1ticas-e-padr%C3%B5es-de-uso)
6. [Exemplo Prático Completo](https://chatgpt.com/g/g-p-68596a64c76c819185e08bdb9bacec85-infra/c/6859817f-01e8-8013-9e5a-cbb14e4c689f#exemplo-pr%C3%A1tico-completo)
7. [Sugestões para Aprofundamento](https://chatgpt.com/g/g-p-68596a64c76c819185e08bdb9bacec85-infra/c/6859817f-01e8-8013-9e5a-cbb14e4c689f#sugest%C3%B5es-para-aprofundamento)

---

## Conceitos Fundamentais

- **O que é `expose`:** instrui o Compose a “anunciar” portas que outros contêineres na mesma rede poderão acessar, porém **não** publica essas portas para o host ([baeldung.com](https://www.baeldung.com/ops/docker-compose-expose-vs-ports?utm_source=chatgpt.com)).
- **Diferença entre `EXPOSE` (Dockerfile) e `expose` (Compose):**
    - A instrução `EXPOSE` no Dockerfile documenta quais portas o contêiner escuta ([docs.docker.com](https://docs.docker.com/reference/dockerfile/?utm_source=chatgpt.com)).
    - Já `expose` no Compose aplica esse conceito **somente** na rede Docker interna, sem criar mapeamento para o host.
- **Rede Interna do Compose:** por padrão, todos os serviços compartilham uma rede isolada, permitindo descoberta por nome de serviço e comunicação direta ([docs.docker.com](https://docs.docker.com/compose/how-tos/networking/?utm_source=chatgpt.com)).

---

## Sintaxe Detalhada e Uso Prático

```yaml
version: '3.8'
services:
  api:
    image: minha-api:latest
    expose:
      - "3000"
      - "8000-8002"   # intervalo de portas
    networks:
      - backend

  web:
    image: minha-web:latest
    ports:
      - "8080:80"     # expõe para o host
    depends_on:
      - api
    networks:
      - frontend
      - backend

networks:
  frontend: {}
  backend: {}

```

- **Lista de portas:** aceita números individuais ou faixas (`"8000-8002"`) ([warp.dev](https://www.warp.dev/terminus/docker-compose-port-mapping)).
- **Sem publicação no host:** diferente de `ports`, **não** gera mapeamento `host:container`.
- **Protocolos suportados:** TCP por padrão; não há sintaxe para UDP em `expose`.

---

## Cenários de Restrição ou Não Aplicação

- **Acesso Externo Necessário:** se for preciso acesso direto do host ou da internet, use `ports` (p. ex. `"8080:80"`) em vez de `expose`.
- **Ambientes sem redes Docker:** se o serviço estiver em *network_mode: host* ou sem rede definida, `expose` não se aplica.
- **Segurança:** não use `expose` para serviços que devam permanecer inacessíveis a outros contêineres.

---

## Componentes Chave Associados

- **`ports`**: publica portas no host; complementa `expose`.
- **`network_mode`**: pode anular redes implícitas; `expose` só funciona se houver rede definida.
- **`depends_on`**: garante ordem de startup, mas não verifica disponibilidade em portas `expose`.
- **`networks`**: define isolamento e segmentação de tráfego interno.

---

## Melhores Práticas e Padrões de Uso

- **Isolar serviços internos:** utilize `expose` em serviços de backend (banco de dados, caches) que não precisem de acesso externo ([baeldung.com](https://www.baeldung.com/ops/docker-compose-expose-vs-ports?utm_source=chatgpt.com)).
- **Documentação clara:** mesmo sem publicar no host, liste portas-chave em `expose` para facilitar manutenção.
- **Combinação com `healthcheck`:** junte `expose` a verificações de saúde para garantir que serviços internos estejam prontos antes de depender deles.
- **Uso de faixas de portas:** simplifica configuração quando múltiplas instâncias consomem portas sequenciais.

---

## Exemplo Prático Completo

Imagine um cenário com três serviços:

- **db** expõe internamente a porta 5432.
- **api** expõe a porta 3000 internamente e depende de `db`.
- **frontend** publica a porta 8080 para o host e se comunica com `api`.

```yaml
version: '3.8'
services:
  db:
    image: postgres:14
    environment:
      POSTGRES_PASSWORD: exemplo
    expose:
      - "5432"
    networks:
      - backend

  api:
    build: ./api
    expose:
      - "3000"
    depends_on:
      - db
    networks:
      - backend

  frontend:
    build: ./frontend
    ports:
      - "8080:80"
    depends_on:
      - api
    networks:
      - frontend
      - backend

networks:
  frontend: {}
  backend: {}

```

1. **`db`** fica disponível apenas na rede `backend` na porta 5432.
2. **`api`** comunica-se com `db:5432` internamente e expõe sua porta 3000 para `frontend`.
3. **`frontend`** recebe tráfego externo em 8080 e encaminha para `api:3000`.

---

## Sugestões para Aprofundamento

- **Documentação oficial Compose v3/v2**: consulte a seção de services no Compose Spec ([docs.docker.com](https://docs.docker.com/reference/compose-file/services/)).
- **Dockerfile EXPOSE**: entenda o escopo do `EXPOSE` no builder ([docs.docker.com](https://docs.docker.com/build/building/best-practices/?utm_source=chatgpt.com)).
- **Artigo Baeldung**: comparação detalhada entre `expose` e `ports` ([baeldung.com](https://www.baeldung.com/ops/docker-compose-expose-vs-ports?utm_source=chatgpt.com)).
- **Compose Networking**: explore a fundo como o Docker Create redes e a descoberta de serviços ([docs.docker.com](https://docs.docker.com/compose/how-tos/networking/?utm_source=chatgpt.com)).