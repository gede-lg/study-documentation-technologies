# uts

**Título da Explicação:** Entendendo o Atributo `uts` na Chave `services` do Docker Compose

---

## Introdução

O Docker Compose permite definir e executar múltiplos containers de forma orquestrada através de um arquivo YAML, agrupando cada container em um serviço (`services`) com configurações específicas de isolamento, rede, volumes e namespaces ([docs.docker.com](https://docs.docker.com/reference/compose-file/services/)). Entre as opções de namespace, o atributo `uts` controla o isolamento do nome de host (hostname) e do nome de domínio (NIS domain name), garantindo que esses identificadores possam ser compartilhados ou isolados conforme a necessidade.

---

## Sumário

1. [Conceitos Fundamentais](https://chatgpt.com/c/6859817f-01e8-8013-9e5a-cbb14e4c689f#conceitos-fundamentais)
2. [Sintaxe Detalhada e Uso Prático](https://chatgpt.com/c/6859817f-01e8-8013-9e5a-cbb14e4c689f#sintaxe-detalhada-e-uso-pr%C3%A1tico)
3. [Cenários de Restrição ou Não Aplicação](https://chatgpt.com/c/6859817f-01e8-8013-9e5a-cbb14e4c689f#cen%C3%A1rios-de-restri%C3%A7%C3%A3o-ou-n%C3%A3o-aplica%C3%A7%C3%A3o)
4. [Componentes Chave Associados](https://chatgpt.com/c/6859817f-01e8-8013-9e5a-cbb14e4c689f#componentes-chave-associados)
5. [Melhores Práticas e Padrões de Uso](https://chatgpt.com/c/6859817f-01e8-8013-9e5a-cbb14e4c689f#melhores-pr%C3%A1ticas-e-padr%C3%B5es-de-uso)
6. [Exemplo Prático Completo](https://chatgpt.com/c/6859817f-01e8-8013-9e5a-cbb14e4c689f#exemplo-pr%C3%A1tico-completo)
7. [Sugestões para Aprofundamento](https://chatgpt.com/c/6859817f-01e8-8013-9e5a-cbb14e4c689f#sugest%C3%B5es-para-aprofundamento)

---

## Conceitos Fundamentais

- **Namespaces no Linux:** são abstrações do kernel que isolam recursos do sistema, apresentando instâncias “privadas” para processos dentro de cada namespace ([man7.org](https://man7.org/linux/man-pages/man7/namespaces.7.html?utm_source=chatgpt.com), [manpages.ubuntu.com](https://manpages.ubuntu.com/manpages/jammy/man7/namespaces.7.html?utm_source=chatgpt.com)).
- **UTS Namespace:** isola dois identificadores de sistema – o **hostname** e o **NIS domain name**. Processos em um mesmo UTS namespace veem as mesmas informações de hostname/domain; processos em namespaces diferentes não interferem uns nos outros ([manpages.ubuntu.com](https://manpages.ubuntu.com/manpages/focal/man7/uts_namespaces.7.html?utm_source=chatgpt.com)).
- **Importância:** ao isolar o hostname, evitam-se conflitos em ambientes multi-container, testes de DNS/SSL e cenários de replicação de cluster, onde cada instância pode apresentar um hostname distinto.

---

## Sintaxe Detalhada e Uso Prático

No Compose, o atributo `uts` é definido ao nível de cada serviço:

```yaml
version: '3.8'
services:
  web:
    image: nginx:latest
    # Compartilha o namespace UTS com o host
    uts: "host"

```

- **Requerimento de Versão:** disponível a partir do Docker Compose **2.15.1** ([docs.docker.com](https://docs.docker.com/reference/compose-file/services/)).
- **Valores Suportados:**
    - `"host"`: usa o mesmo UTS namespace do host (mesmo hostname e domínio).
    - **Omissão** do campo: o Compose delega ao runtime a escolha de um namespace privado (padrão). ([docs.docker.com](https://docs.docker.com/reference/compose-file/services/))
- **Interpretação:**
    - `"host"` faz com que `uname`, `gethostname` e `getdomainname` dentro do container retornem exatamente as informações do host.
    - Sem `uts`, cada serviço recebe um UTS namespace isolado, permitindo configurações independentes de hostname.

---

## Cenários de Restrição ou Não Aplicação

- **Compatibilidade de Plataforma:** UTS namespaces são exclusivos de kernels Linux com `CONFIG_UTS_NS` ativado; **não** aplicável em ambientes Windows ou runtimes que não suportem namespaces ([manpages.ubuntu.com](https://manpages.ubuntu.com/manpages/focal/man7/uts_namespaces.7.html?utm_source=chatgpt.com)).
- **Versões Anteriores:** Compose `< 2.15.1` ignora ou rejeita o campo `uts`.
- **Casos de Uso Desnecessários:** a menos que o container precise observar ou modificar o hostname do host (por exemplo, debug de DNS/SSL), manter UTS isolado evita efeitos colaterais e aumenta segurança.

---

## Componentes Chave Associados

Além de `uts`, outros atributos de namespaces configuráveis em `services` incluem:

- `ipc` – IPC namespace
- `pid` – PID namespace
- `userns_mode` – User namespace
- `network_mode` – Network namespace
- **Cada um isola recursos específicos** do kernel, permitindo granularidade no isolamento de processos e comunicação ([docs.docker.com](https://docs.docker.com/reference/compose-file/services/)).

---

## Melhores Práticas e Padrões de Uso

- **Evite compartilhamento desnecessário:** compartilhe o namespace UTS **apenas** quando for essencial para o funcionamento (por exemplo, containers que dependem de hostname igual ao do host) ([docs.datadoghq.com](https://docs.datadoghq.com/security/default_rules/gdz-mkr-i6f/?utm_source=chatgpt.com)).
- **Mantenha isolamento por padrão:** preserve UTS, PID e IPC privados a menos que exista um motivo claro para integrá-los ao host.
- **Documente escolhas:** registre no controle de versão por que cada namespace foi configurado, facilitando auditoria e manutenção.

---

## Exemplo Prático Completo

Imagine um cenário de monitoramento onde um agente containerizado precisa reportar o hostname do host:

```yaml
version: '3.8'
services:
  monitor:
    image: my-monitor-agent:latest
    uts: "host"         # Necessário para captar hostname real
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
  db:
    image: postgres:13  # mantém hostname isolado (padrão)

```

1. **`monitor`**: com `uts: "host"`, ao executar dentro do container:
    
    ```bash
    $ hostname
    meu-servidor-prod
    
    ```
    
2. **`db`**: sem `uts`, veja seu próprio hostname gerado pelo Compose:
    
    ```bash
    $ hostname
    db_1
    
    ```
    

---

## Sugestões para Aprofundamento

- **Documentação Oficial Docker Compose – services:**
    
    [https://docs.docker.com/reference/compose-file/services/#uts](https://docs.docker.com/reference/compose-file/services/#uts) ([docs.docker.com](https://docs.docker.com/reference/compose-file/services/))
    
- **Man Page Linux Namespaces:**
    
    [https://man7.org/linux/man-pages/man7/namespaces.7.html](https://man7.org/linux/man-pages/man7/namespaces.7.html) ([man7.org](https://man7.org/linux/man-pages/man7/namespaces.7.html?utm_source=chatgpt.com))
    
- **Detalhes sobre UTS Namespaces:**
    
    [https://manpages.ubuntu.com/manpages/focal/man7/uts_namespaces.7.html](https://manpages.ubuntu.com/manpages/focal/man7/uts_namespaces.7.html) ([manpages.ubuntu.com](https://manpages.ubuntu.com/manpages/focal/man7/uts_namespaces.7.html?utm_source=chatgpt.com))
    
- **Artigo “Building a container by hand using namespaces: The UTS” (Red Hat):**
    
    [https://www.redhat.com/en/blog/uts-namespace](https://www.redhat.com/en/blog/uts-namespace) ([redhat.com](https://www.redhat.com/en/blog/uts-namespace?utm_source=chatgpt.com))
    

---

Com este guia, você tem uma visão completa do atributo `uts` no contexto de serviços do Docker Compose, desde os fundamentos de namespaces do Linux até exemplos práticos e recomendações para uso seguro e eficaz.