# links

**Título da Explicação:** Atributo `links` em serviços do Docker Compose

---

## Introdução

O atributo `links` do Docker Compose permite definir ligações de rede entre serviços, criando aliases de hostname e compartilhando variáveis de ambiente para facilitar a comunicação entre containers de serviços distintos. ([docs.docker.com](https://docs.docker.com/reference/compose-file/services/))

Além de resolver hostnames, `links` também expressa uma dependência implícita de inicialização, garantindo que serviços vinculados sejam iniciados antes daquele que os referencia, similar ao comportamento do `depends_on`. ([docs.docker.com](https://docs.docker.com/reference/compose-file/services/))

---

## Sumário

- Conceitos Fundamentais
- Sintaxe Detalhada e Uso Prático
- Variações de Sintaxe
- Cenários de Restrição ou Não Aplicação
- Componentes-Chave Associados
- Melhores Práticas e Padrões de Uso
- Exemplo Prático Completo
- Sugestões para Aprofundamento

---

## Conceitos Fundamentais

1. **Rede Implícita vs. links:** Por padrão, o Docker Compose conecta todos os containers de uma aplicação a uma rede “default”, permitindo comunicação pelo nome do serviço sem necessidade de `links`. ([docs.docker.com](https://docs.docker.com/reference/compose-file/services/), [docs.docker.com](https://docs.docker.com/compose/how-tos/networking/))
2. **Hostname e Alias:** Quando `links` é usado, o serviço “linkado” fica acessível pelo hostname igual ao nome do serviço ou ao alias especificado (`SERVICE:ALIAS`). ([docs.docker.com](https://docs.docker.com/reference/compose-file/services/))
3. **Variáveis de Ambiente Legadas:** Ao criar um link, o Docker também injeta variáveis de ambiente (`SERVICE_PORT`, `SERVICE_PORT_5432_TCP`, etc.), recurso legado não suportado por redes definidas manualmente. ([docs.docker.com](https://docs.docker.com/engine/network/links/?utm_source=chatgpt.com))

---

## Sintaxe Detalhada e Uso Prático

```yaml
services:
  web:
    image: nginx:latest
    links:
      - db            # conecta 'db' como 'db'
      - redis:cache   # conecta 'redis' como 'cache'
  db:
    image: postgres:13
  redis:
    image: redis:6

```

- `db` → cria um link sem alias; o hostname dentro de `web` é `db`.
- `redis:cache` → cria um link com alias; o hostname dentro de `web` é `cache`. ([docs.docker.com](https://docs.docker.com/reference/compose-file/services/))

---

## Variações de Sintaxe

- **Somente nome do serviço:**
    
    ```yaml
    links:
      - api
    
    ```
    
- **Serviço com alias:**
    
    ```yaml
    links:
      - api:backend
    
    ```
    
- **Múltiplos links:**
    
    ```yaml
    links:
      - db
      - redis:cache
      - logger
    
    ```
    

Todas as formas acima são equivalentes em permitir que o serviço referenciado seja alcançado pelo hostname especificado. ([docs.docker.com](https://docs.docker.com/reference/compose-file/services/))

---

## Cenários de Restrição ou Não Aplicação

1. **Comunicação em redes personalizadas:** Se você especificar redes customizadas no Compose, `links` **não** altera a configuração de rede e não é necessário para que serviços em uma mesma rede se comuniquem. ([docs.docker.com](https://docs.docker.com/reference/compose-file/services/))
2. **Compose V2 e Redes por Projeto:** Desde o Compose V2 (Docker CLI ≥ 1.27.0), a rede padrão já oferece descoberta de serviços por nome, tornando `links` redundante na maioria dos casos. ([docs.docker.com](https://docs.docker.com/compose/how-tos/networking/))
3. **Ambientes Swarm/Overlay:** Em modo Swarm, redes overlay cuidam da descoberta entre nós, e `links` não se aplica para comunicação multi-host. ([docs.docker.com](https://docs.docker.com/compose/how-tos/networking/))

---

## Componentes-Chave Associados

- **`depends_on`:** Expressa apenas ordem de inicialização, sem configurar hostnames ou variáveis de ambiente. Use `depends_on` para controle de ordenação, e `links` apenas se precisar de alias legados. ([docs.docker.com](https://docs.docker.com/reference/compose-file/services/))
- **`networks`:** Define explicitamente as redes de cada serviço. É o método recomendado para isolar e segmentar comunicação entre containers. ([docs.docker.com](https://docs.docker.com/reference/compose-file/services/))

---

## Melhores Práticas e Padrões de Uso

- **Prefira redes definidas:** Utilize o atributo `networks` e aliases de rede (`aliases`) para descoberta de serviços, em vez de `links`. ([docs.docker.com](https://docs.docker.com/reference/compose-file/services/), [docs.docker.com](https://docs.docker.com/compose/how-tos/networking/))
- **Evite variáveis de ambiente legadas:** A injeção de variáveis via `links` é considerada legado. Prefira montar configurações de conexão em arquivos de configuração ou variáveis de ambiente customizadas. ([docs.docker.com](https://docs.docker.com/engine/network/links/?utm_source=chatgpt.com))
- **Use `depends_on` separadamente:** Para controlar a ordem de inicialização de containers, sem misturar definições de rede. ([docs.docker.com](https://docs.docker.com/reference/compose-file/services/))

---

## Exemplo Prático Completo

```yaml
version: '3.8'

services:
  web:
    image: nginx:latest
    ports:
      - "8080:80"
    links:
      - db:database       # Alias 'database' para o serviço 'db'
      - cache             # Acesso a 'cache' pelo hostname 'cache'
    depends_on:
      - db
      - cache

  db:
    image: postgres:13
    environment:
      POSTGRES_USER: user
      POSTGRES_PASSWORD: pass

  cache:
    image: redis:6

```

1. **Rede Implícita:** Todos os serviços conectam-se à rede `default`, criada automaticamente.
2. **Acesso em `web`:**
    - `database:5432` conecta ao Postgres.
    - `cache:6379` conecta ao Redis.
3. **Ordem de Inicialização:** `db` e `cache` iniciam antes de `web`, por conta do `depends_on`. ([docs.docker.com](https://docs.docker.com/reference/compose-file/services/))

---

## Sugestões para Aprofundamento

- **Compose Specification (rede):** leia as seções de [`networks`](https://docs.docker.com/compose/compose-file/compose-file-v3/#networks) para entender opções avançadas de IPAM e drivers.
- **Como o Docker gerencia redes:** explore o guia [Networking in Compose](https://docs.docker.com/compose/how-tos/networking/) para cenários Swarm e customização de redes. ([docs.docker.com](https://docs.docker.com/compose/how-tos/networking/))
- **Depreciação de links no Docker Engine:** confira a seção de [Legacy container links](https://docs.docker.com/engine/network/links/) para entender alternativas modernas. ([docs.docker.com](https://docs.docker.com/engine/network/links/?utm_source=chatgpt.com))

---

Com esta visão detalhada, você tem todos os elementos para entender, usar e migrar do atributo `links` para soluções de rede mais modernas e robustas no Docker Compose.