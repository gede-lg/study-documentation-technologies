# working_dir

**Entendendo o atributo `working_dir` no Docker Compose**

---

## Introdução

O atributo `working_dir` em uma definição de serviço no Docker Compose permite sobrescrever o diretório de trabalho padrão do container (definido pelo `WORKDIR` no Dockerfile) para todas as instruções de comando e entrypoint executadas pelo Compose. Isso garante que comandos como `command`, `entrypoint` e demais operações de arquivos sejam executados no contexto de diretório adequado, simplificando scripts e volumes montados ([learn.microsoft.com](https://learn.microsoft.com/en-us/dotnet/api/aspire.hosting.docker.resources.composenodes.service.workingdir?view=dotnet-aspire-9.2&utm_source=chatgpt.com), [docs.hercules-ci.com](https://docs.hercules-ci.com/arion/options.html)).

---

## Sumário

1. [Conceitos Fundamentais](https://chatgpt.com/c/6859817f-01e8-8013-9e5a-cbb14e4c689f#conceitos-fundamentais)
2. [Sintaxe Detalhada e Uso Prático](https://chatgpt.com/c/6859817f-01e8-8013-9e5a-cbb14e4c689f#sintaxe-detalhada-e-uso-pr%C3%A1tico)
3. [Cenários de Restrição ou Não Aplicação](https://chatgpt.com/c/6859817f-01e8-8013-9e5a-cbb14e4c689f#cen%C3%A1rios-de-restri%C3%A7%C3%A3o-ou-n%C3%A3o-aplica%C3%A7%C3%A3o)
4. [Componentes Chave Associados](https://chatgpt.com/c/6859817f-01e8-8013-9e5a-cbb14e4c689f#componentes-chave-associados)
5. [Melhores Práticas e Padrões de Uso](https://chatgpt.com/c/6859817f-01e8-8013-9e5a-cbb14e4c689f#melhores-pr%C3%A1ticas-e-padr%C3%B5es-de-uso)
6. [Exemplo Prático Completo](https://chatgpt.com/c/6859817f-01e8-8013-9e5a-cbb14e4c689f#exemplo-pr%C3%A1tico-completo)
7. [Sugestões para Aprofundamento](https://chatgpt.com/c/6859817f-01e8-8013-9e5a-cbb14e4c689f#sugest%C3%B5es-para-aprofundamento)

---

## Conceitos Fundamentais

- **O que é**:
    - `working_dir` é uma string opcional que indica o caminho do diretório de trabalho dentro do container, no qual os comandos serão executados ([docs.hercules-ci.com](https://docs.hercules-ci.com/arion/options.html)).
- **Tipo e valor padrão**:
    - Tipo: `null` ou `string`
    - Valor padrão: `null` (usa o `WORKDIR` do Dockerfile ou, se não definido, a raiz `/`) ([docs.hercules-ci.com](https://docs.hercules-ci.com/arion/options.html)).
- **Relação com Dockerfile**:
    - Corresponde ao Dockerfile `WORKDIR`, mas aplicado em tempo de execução pelo Compose, similar ao `w/--workdir` no comando `docker run` ([learn.microsoft.com](https://learn.microsoft.com/en-us/dotnet/api/aspire.hosting.docker.resources.composenodes.service.workingdir?view=dotnet-aspire-9.2&utm_source=chatgpt.com), [docs.docker.com](https://docs.docker.com/reference/dockerfile/?utm_source=chatgpt.com)).

---

## Sintaxe Detalhada e Uso Prático

```yaml
services:
  app:
    image: minha-imagem:latest
    # Sobrescreve o WORKDIR definido no Dockerfile
    working_dir: /app/src
    volumes:
      - ./src:/app/src
    command: sh -c "npm install && npm run dev"

```

- **Formato**:
    - Dentro de `services.<nome>.working_dir: "<caminho>"` ([docs.hercules-ci.com](https://docs.hercules-ci.com/arion/options.html)).
- **Caminho absoluto vs. relativo**:
    - Recomenda-se usar caminho absoluto (ex.: `/app/src`).
    - Caminhos relativos não são recomendados, pois seu comportamento pode variar conforme o diretório de invocação ([docs.docker.com](https://docs.docker.com/reference/build-checks/workdir-relative-path/?utm_source=chatgpt.com)).
- **Impacto**:
    - Todos os comandos subsequentes (`command`, `entrypoint`, exec via `docker exec`) iniciarão no diretório especificado.

---

## Cenários de Restrição ou Não Aplicação

- **Quando não usar**:
    - Se o Dockerfile já define corretamente `WORKDIR` e não há necessidade de sobrescrever para diferentes ambientes.
    - Em serviços que não executam comandos ou usam apenas volumes de dados estáticos.
- **Plataformas Windows**:
    - Em containers Windows, o diretório pode usar sintaxe de unidades (ex.: `C:\app`) e o Compose ignora se não suportado.
- **Construções multi-estágio**:
    - `working_dir` aplica-se somente em tempo de execução; não afeta imagens construídas em múltiplos estágios.

---

## Componentes Chave Associados

- **`command` / `entrypoint`**: executados dentro do `working_dir`.
- **Volumes**: caminho de montagem relativo ao `working_dir` facilita organização de código.
- **CLI `w/--workdir`**: equivale a `working_dir` no Compose quando se usa `docker run`.
- **Dockerfile `WORKDIR`**: define diretório padrão em tempo de build; `working_dir` sobrescreve em tempo de execução ([docs.docker.com](https://docs.docker.com/reference/dockerfile/?utm_source=chatgpt.com)).

---

## Melhores Práticas e Padrões de Uso

- **Defina explicitamente**: evite surpresas e garanta consistência entre ambientes de desenvolvimento e produção.
- **Alinhe com volumes**: monte código e dados diretamente dentro do `working_dir` para manter paths previsíveis.
- **Caminhos absolutos**: previnem erros de resolução relativos.
- **Valide existência**: assegure que o diretório existe na imagem ou crie-o no Dockerfile (ex.: `RUN mkdir -p /app/src`).

---

## Exemplo Prático Completo

```yaml
version: '3.8'

services:
  web:
    build:
      context: .
      dockerfile: Dockerfile
    working_dir: /usr/src/app
    volumes:
      - ./:/usr/src/app
    command: sh -c "yarn install && yarn start"
    ports:
      - "3000:3000"
    environment:
      NODE_ENV: development

  db:
    image: postgres:15
    environment:
      POSTGRES_DB: example
      POSTGRES_USER: user
      POSTGRES_PASSWORD: secret
    volumes:
      - db-data:/var/lib/postgresql/data

volumes:
  db-data:

```

Este `docker-compose.yml` demonstra um fluxo de desenvolvimento local, sincronizando código no `/usr/src/app` e executando comandos nesse diretório.

---

## Sugestões para Aprofundamento

- [Compose Specification (services.working_dir)](https://github.com/compose-spec/compose-spec/blob/main/05-services.md#working_dir)
- [Dockerfile WORKDIR Reference](https://docs.docker.com/engine/reference/builder/#workdir) ([docs.docker.com](https://docs.docker.com/reference/dockerfile/?utm_source=chatgpt.com))
- [CLI `docker run -w`](https://docs.docker.com/engine/reference/commandline/run/)

Com isso, você terá um entendimento completo de como o `working_dir` funciona no contexto do Docker Compose, podendo aplicá-lo de forma eficaz em seus projetos.