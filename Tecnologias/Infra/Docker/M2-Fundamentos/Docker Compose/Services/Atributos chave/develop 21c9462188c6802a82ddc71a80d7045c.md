# develop

**Título da Explicação:** Atributo `develop` em Serviços no Docker Compose

## Introdução

O atributo `develop` no contexto de serviços em um arquivo Docker Compose permite definir configurações específicas para manter o ambiente em sincronia com o código-fonte durante o desenvolvimento, otimizando fluxos de trabalho como sincronização de arquivos e reconstrução automática de imagens conforme alterações locais são detectadas ([docs.docker.com](https://docs.docker.com/reference/compose-file/services/), [docs.docker.com](https://docs.docker.com/reference/compose-file/develop/)).

## Sumário

- Conceitos Fundamentais
- Sintaxe Detalhada e Uso Prático
- Componentes-chave Associados
- Cenários de Restrição ou Não Aplicação
- Melhores Práticas e Padrões de Uso
- Exemplo Prático Completo
- Sugestões para Aprofundamento

## Conceitos Fundamentais

O `develop` é um atributo opcional introduzido a partir da versão 2.22.0 do Docker Compose que se integra à especificação de desenvolvimento de Compose, permitindo definir regras de como o Compose deve reagir a alterações no código-fonte durante o ciclo de desenvolvimento ([docs.docker.com](https://docs.docker.com/reference/compose-file/services/)). Seu principal propósito é agilizar a produtividade do desenvolvedor, reduzindo a necessidade de reiniciar manualmente containers ou rebuildar imagens sempre que houver uma modificação nos arquivos do projeto ([docs.docker.com](https://docs.docker.com/reference/compose-file/develop/)).

## Sintaxe Detalhada e Uso Prático

Abaixo está a sintaxe básica para incluir o atributo `develop` em um serviço. Note que é necessário ter a seção `build` configurada para que ações como `rebuild` funcionem corretamente:

```yaml
services:
  frontend:
    image: example/webapp
    build: ./webapp
    develop:
      watch:
        - path: ./webapp/html
          action: sync
          target: /var/www
          ignore:
            - node_modules/

```

*Comentário:* o bloco `watch` define regras de monitoramento de arquivos locais para manter o container alinhado com o código de desenvolvimento ([docs.docker.com](https://docs.docker.com/reference/compose-file/services/), [docs.docker.com](https://docs.docker.com/reference/compose-file/develop/)).

### Variações de Sintaxe

- O atributo `develop` pode ser omitido em ambientes de produção, pois sua aplicação é voltada exclusivamente para desenvolvimento.
- Cada item do array `watch` é uma regra independente que pode conter combinações de `action`, `exec`, `include`, `ignore`, `path` e `target` conforme especificado na seção de atributos de desenvolvimento ([docs.docker.com](https://docs.docker.com/reference/compose-file/develop/)).

## Componentes-chave Associados

### watch

Define a lista de regras para atualização automática com base em mudanças locais no sistema de arquivos, permitindo que o Compose acompanhe eventos de modificação de código ([docs.docker.com](https://docs.docker.com/reference/compose-file/develop/)).

### action

Especifica a ação a ser tomada quando uma mudança é detectada. Possíveis valores:

- `rebuild`: reconstrói a imagem e recria o serviço a partir de `build`.
- `restart`: reinicia o container sem rebuildar (a partir da versão 2.32.0).
- `sync`: sincroniza arquivos sem reiniciar o container.
- `sync+restart`: sincroniza e reinicia (a partir da versão 2.23.0).
- `sync+exec`: sincroniza e executa um comando dentro do container (a partir da versão 2.32.0) ([docs.docker.com](https://docs.docker.com/reference/compose-file/develop/)).

### exec

Usado quando `action` é `sync+exec`. Define o comando a ser executado, o usuário, o diretório de trabalho e variáveis de ambiente para pós-sincronização, similar aos hooks de ciclo de vida ([docs.docker.com](https://docs.docker.com/reference/compose-file/develop/)).

### ignore

Lista de padrões de arquivos ou pastas que devem ser ignorados pelo mecanismo de watch. Utiliza a mesma sintaxe de `.dockerignore`, suportando `*`, `?`, `**` etc., evitando triggers desnecessários em arquivos não relevantes ([docs.docker.com](https://docs.docker.com/reference/compose-file/develop/)).

### include

Contraponto ao `ignore`, define padrões de inclusão para limitar o escopo de monitoramento a arquivos ou diretórios específicos, reduzindo overhead de observação ([docs.docker.com](https://docs.docker.com/reference/compose-file/develop/)).

### path

Caminho relativo ao diretório do projeto que será observado para modificações. Qualquer alteração em arquivos dentro desse caminho (não ignorados) dispara a regra definida ([docs.docker.com](https://docs.docker.com/reference/compose-file/develop/)).

### target

Aplica-se apenas quando `action` contém `sync`, indicando o diretório dentro do container para onde os arquivos modificados devem ser sincronizados ([docs.docker.com](https://docs.docker.com/reference/compose-file/develop/)).

## Cenários de Restrição ou Não Aplicação

- **Ambientes de Produção:** O atributo `develop` não deve ser utilizado, pois não faz parte da especificação de deploy e pode aumentar o consumo de recursos com observers de arquivo ([docs.docker.com](https://docs.docker.com/reference/compose-file/services/), [docs.docker.com](https://docs.docker.com/reference/compose-file/develop/)).
- **Containers sem Contexto de Build:** Se o serviço não possuir `build`, ações como `rebuild` não serão aplicáveis e resultarão em erro; utilize apenas `sync` ou `restart` nesses casos ([docs.docker.com](https://docs.docker.com/reference/compose-file/develop/)).
- **Sistemas de Arquivos Não Suportados:** Em ambientes que não suportam notificações de sistema de arquivos (ex.: certos ambientes Docker Desktop antigos), o `watch` pode se comportar de forma inconsistente ou não disparar eventos ([docs.docker.com](https://docs.docker.com/reference/compose-file/develop/)).

## Melhores Práticas e Padrões de Uso

- **Limite o Escopo do Watch:** Use `include` para definir explicitamente quais tipos de arquivos ou diretórios devem ser monitorados, evitando sobrecarga de CPU e falsos positivos.
- **Combine `ignore` e `include`:** Defina `ignore` para padrões genéricos (ex.: `node_modules/`) e `include` para focar em arquivos de código-fonte, assegurando eficiência.
- **Documente as Regras:** Comente cada regra `watch` para facilitar o entendimento da equipe.
- **Sincronização Parcial (`sync`):** Prefira `sync` para arquivos estáticos (HTML/CSS) evitando reinícios frequentes que podem interromper o servidor ([docs.docker.com](https://docs.docker.com/reference/compose-file/develop/)).
- **Rebuild Inteligente:** Utilize `rebuild` apenas para mudanças em código que alteram o ambiente de build (ex.: `Dockerfile`, dependências), minimizando tempo de resposta ([docs.docker.com](https://docs.docker.com/reference/compose-file/develop/)).

## Exemplo Prático Completo

```yaml
version: "3.9"
services:
  webapp:
    image: company/webapp:dev
    build:
      context: ./webapp
      dockerfile: Dockerfile.dev
    ports:
      - "3000:3000"
    develop:
      watch:
        # Sincroniza templates sem reiniciar
        - path: ./webapp/templates
          include: "*.html"
          action: sync
          target: /usr/src/app/templates
          ignore:
            - "*.tmp"
        # Reconstrói imagem e reinicia ao alterar código Python
        - path: ./webapp/src
          action: rebuild
        # Sincroniza assets e recarrega via comando interno
        - path: ./webapp/assets
          action: sync+exec
          target: /usr/src/app/assets
          exec:
            command: npm run reload-assets
            user: node
            working_dir: /usr/src/app

  api:
    image: company/api:dev
    build:
      context: ./api
      dockerfile: Dockerfile.dev
    ports:
      - "8000:8000"
    develop:
      watch:
        # Rebuild e recreate no código backend
        - path: ./api
          action: rebuild

```

*Comentário:* Este projeto define regras para sincronização de templates, rebuild de backend e sincronização de assets com recarga automática do serviço ([docs.docker.com](https://docs.docker.com/reference/compose-file/develop/)).

## Sugestões para Aprofundamento

- Consulte o guia **Use Compose Watch** para entender opções avançadas de configuração de `watch` ([docs.docker.com](https://docs.docker.com/reference/compose-file/develop/)).
- Explore a **Compose Deploy Specification** para diferenciar `develop` de `deploy` em fluxos de CI/CD ([docs.docker.com](https://docs.docker.com/reference/compose-file/services/)).
- Analise o comportamento de notificação de arquivos em diferentes plataformas Docker (Linux, macOS, Windows) para otimizar a performance do `watch`.

---

Com isso, você possui uma visão completa e detalhada do atributo `develop`, suas possibilidades, restrições e boas práticas para enriquecer seu fluxo de trabalho no Docker Compose.