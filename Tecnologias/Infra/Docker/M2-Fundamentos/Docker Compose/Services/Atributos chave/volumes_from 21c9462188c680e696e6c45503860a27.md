# volumes_from

# Entendimento Completo do `volumes_from` no Docker Compose

## Introdução

No contexto de orquestração de containers com Docker Compose, o atributo `volumes_from` permite que um serviço monte **todos** os volumes declarados em outro serviço ou container, facilitando o compartilhamento de dados sem a necessidade de expor caminhos de host explicitamente no arquivo Compose ([stackoverflow.com](https://stackoverflow.com/questions/45494746/docker-compose-volumes-from-usage-example?utm_source=chatgpt.com)). Apesar de útil em versões legadas, seu uso foi descontinuado em especificações posteriores, exigindo compreensão de onde e quando aplicá-lo.

## Sumário

1. [Conceitos Fundamentais](https://chatgpt.com/c/6859817f-01e8-8013-9e5a-cbb14e4c689f#conceitos-fundamentais)
2. [Sintaxe Detalhada e Uso Prático](https://chatgpt.com/c/6859817f-01e8-8013-9e5a-cbb14e4c689f#sintaxe-detalhada-e-uso-pr%C3%A1tico)
3. [Cenários de Restrição ou Não Aplicação](https://chatgpt.com/c/6859817f-01e8-8013-9e5a-cbb14e4c689f#cen%C3%A1rios-de-restri%C3%A7%C3%A3o-ou-n%C3%A3o-aplica%C3%A7%C3%A3o)
4. [Componentes Chave Associados](https://chatgpt.com/c/6859817f-01e8-8013-9e5a-cbb14e4c689f#componentes-chave-associados)
5. [Melhores Práticas e Padrões de Uso](https://chatgpt.com/c/6859817f-01e8-8013-9e5a-cbb14e4c689f#melhores-pr%C3%A1ticas-e-padr%C3%B5es-de-uso)
6. [Exemplo Prático Completo](https://chatgpt.com/c/6859817f-01e8-8013-9e5a-cbb14e4c689f#exemplo-pr%C3%A1tico-completo)
7. [Sugestões para Aprofundamento](https://chatgpt.com/c/6859817f-01e8-8013-9e5a-cbb14e4c689f#sugest%C3%B5es-para-aprofundamento)

---

## Conceitos Fundamentais

- **Definição:** o `volumes_from` é um atributo de serviço no Docker Compose (versão 2.x) que instrui o Compose a montar todos os volumes declarados por outro serviço ou container, incluindo volumes anônimos e nomeados ([stackoverflow.com](https://stackoverflow.com/questions/45494746/docker-compose-volumes-from-usage-example?utm_source=chatgpt.com)).
- **Propósito:** simplificar o compartilhamento de dados entre containers, evitando a repetição de declarações de volume e mantendo o isolamento da máquina host.
- **Importância:** em cenários de *data containers* (contêineres cujo único propósito é prover volumes de dados), o `volumes_from` permite que serviços consumidores acessem esses dados sem mapear caminhos de host manualmente.

---

## Sintaxe Detalhada e Uso Prático

```yaml
version: "2"
services:
  data:
    image: busybox
    volumes:
      - /var/lib/data

  app:
    image: myapp:latest
    volumes_from:
      - data:ro   # montar todos os volumes de "data" em modo somente leitura
      - data_rw:rw  # se houvesse outro container "data_rw", montaria em leitura/escrita

```

- **Estrutura:**
    - `volumes_from` aceita uma lista de strings no formato `<serviço|container>[:<modo>]`.
    - `<modo>` pode ser `ro` (read-only) ou `rw` (read-write). A omissão assume `rw`.
- **Variante via ID de container:**
    
    ```yaml
    app:
      volumes_from:
        - container_id_abcdef123456
    
    ```
    
    Permite referenciar containers externos ao Compose ([stackoverflow.com](https://stackoverflow.com/questions/45494746/docker-compose-volumes-from-usage-example?utm_source=chatgpt.com)).
    
- **Mount points herdados:** todos os pontos de montagem definidos no serviço de origem são replicados no serviço destino, preservando drivers de volume e opções originais.

---

## Cenários de Restrição ou Não Aplicação

1. **Compose versão 3.x e posterior:**
    - O atributo `volumes_from` foi removido a partir da especificação 3, gerando erro de configuração se usado ([medium.com](https://medium.com/%40alexanderyegorov_67403/docker-volumes-changes-in-compose-version-3-95a7c48f6d17?utm_source=chatgpt.com)).
    - Recomenda-se usar volumes nomeados declarados no nível superior (`volumes:`) e referenciá-los explicitamente em cada serviço.
2. **Arquivos compostos com `extends`:**
    - `volumes_from` **não** é propagado entre serviços que utilizam `extends`, evitanto dependências implícitas ([docs.docker.com](https://docs.docker.com/compose/how-tos/multiple-compose-files/extends/?utm_source=chatgpt.com)).
3. **Compartilhamento parcial de dados:**
    - Se apenas um subdiretório ou volume específico precisa ser compartilhado, `volumes_from` pode ser excessivo, pois monta **todos** os volumes de origem.

---

## Componentes Chave Associados

| Componente | Descrição |
| --- | --- |
| `services:` | Top-level do Compose onde se definem containers e atributos como `volumes` e `volumes_from`. ([docs.docker.com](https://docs.docker.com/reference/compose-file/services/?utm_source=chatgpt.com)) |
| `volumes:` | Seção top-level para declarar **named volumes**, que podem então ser referenciados por múltiplos serviços. ([docs.docker.com](https://docs.docker.com/reference/compose-file/volumes/?utm_source=chatgpt.com)) |
| `depends_on:` | Configura ordem de inicialização; `volumes_from` também implica dependência, garantindo que o container de origem inicie antes do consumidor. ([docs.docker.com](https://docs.docker.com/compose/how-tos/startup-order/?utm_source=chatgpt.com)) |
| Modo de acesso | `ro` ou `rw`, controla permissões de montagem herdadas no serviço destino. |

---

## Melhores Práticas e Padrões de Uso

1. **Prefira volumes nomeados no Compose 3.x**
    - Defina volumes no bloco superior e monte explicitamente em cada serviço:
        
        ```yaml
        volumes:
          db-data:
        services:
          db:
            volumes:
              - db-data:/var/lib/db
          backup:
            volumes:
              - db-data:/backup
        
        ```
        
        ([forums.docker.com](https://forums.docker.com/t/what-is-the-right-nomenclature-for-volume-from-in-compose-v2/9759?utm_source=chatgpt.com))
        
2. **Use `volumes_from` apenas em data containers legados**
    - Em projetos que utilizam Compose v2 e *data-only containers*, centralize volumes para evitar duplicação de mapeamentos.
3. **Controle de erros e legibilidade**
    - Como monta todos os volumes, inspecione regularmente a configuração de origem para não inflar o container destino com montagens desnecessárias.
4. **Evite dependências implícitas**
    - Sempre documente no README do projeto quando `volumes_from` for usado, destacando a relação entre serviços.

---

## Exemplo Prático Completo

Suponha um ambiente onde um container “data” popula um diretório com backups diários e um serviço “restore” precisa acessar esses dados:

```yaml
version: "2"
services:
  data:
    image: alpine
    command: sh -c "while true; do date > /backup/now.txt; sleep 86400; done"
    volumes:
      - backup-vol:/backup

  restore:
    image: ubuntu
    entrypoint: /bin/bash
    command: -c "cp /backup/now.txt /restore/; cat /restore/now.txt"
    volumes_from:
      - data:ro   # Acesso somente leitura aos backups
    volumes:
      - restore-vol:/restore

volumes:
  backup-vol:
  restore-vol:

```

**Fluxo**:

1. O serviço `data` escreve diariamente a data atual em `/backup` (via volume `backup-vol`).
2. O serviço `restore` monta todos os volumes de `data` em modo `ro` (graças a `volumes_from`) e copia o arquivo para seu próprio volume `restore-vol`.

---

## Sugestões para Aprofundamento

- Consultar o [Compose Specification](https://docs.docker.com/compose/compose-file/) para entender a evolução das versões do arquivo Compose.
- Explorar o uso de [bind mounts vs. named volumes](https://docs.docker.com/storage/volumes/) e suas diferenças de performance.
- Avaliar ferramentas como o **Docker Data Volume Container Pattern**, que exemplifica bem o uso de containers de dados legados.

---

Com esta visão, você tem um panorama completo do `volumes_from`: desde sua finalidade original em Compose v2 até o motivo de sua depreciação e as alternativas recomendadas nas versões mais recentes.