# init

**Entendendo o atributo `init` em serviços do Docker Compose**

---

### Introdução

O Docker Compose permite orquestrar múltiplos contêineres definindo serviços, redes e volumes em um único arquivo YAML. Dentro da definição de cada serviço, o atributo `init` insere um processo init (PID 1) dentro do contêiner, responsável por encaminhar sinais e "recolher" processos zumbis (zombies), melhorando o comportamento de terminação e evitando acúmulo de processos órfãos ([docs.docker.com](https://docs.docker.com/reference/compose-file/services/)).

---

### Sumário

1. Conceitos Fundamentais
2. Sintaxe Detalhada e Uso Prático
3. Versões e Compatibilidade
4. Cenários de Restrição ou Não Aplicação
5. Componentes Chave Associados
6. Melhores Práticas e Padrões de Uso
7. Exemplo Prático Completo
8. Sugestões para Aprofundamento

---

### 1. Conceitos Fundamentais

O atributo `init` adiciona um processo init dentro do contêiner, que passa a exercer o papel de PID 1, garantindo o repasse correto de sinais (como SIGTERM, SIGINT) ao processo principal e a limpeza de processos-filho que terminam sem serem aguardados, evitando a criação de processos zumbis e possíveis vazamentos de PIDs ([docs.docker.com](https://docs.docker.com/reference/compose-file/services/)).

Em implementações comuns, esse init interno é baseado em um binário leve como o Tini, que se encarrega justamente de repassar sinais e reaper processos zumbis de forma eficiente ([github.com](https://github.com/krallin/tini?utm_source=chatgpt.com)).

---

### 2. Sintaxe Detalhada e Uso Prático

O `init` é um atributo booleano definido no nível de serviço. Quando não declarado, seu valor implícito é `false`; para habilitá-lo, basta defini-lo como `true`:

```yaml
services:
  meu-servico:
    image: alpine:latest
    init: true

```

- **Valor:** `true` ou `false`
- **Padrão:** `false` (nenhum init)
- **Efeito:** insere o init do Docker (geralmente Tini) como PID 1 ([docs.docker.com](https://docs.docker.com/reference/compose-file/services/)).

---

### 3. Versões e Compatibilidade

O atributo `init` foi introduzido no formato de arquivo **version 2.2**, suportado a partir do Docker Engine 1.13.0+ e Compose 1.13.0+ ([docker-docs.uclv.cu](https://docker-docs.uclv.cu/compose/compose-file/compose-versioning/)).

No formato **version 3**, ele está disponível a partir de **3.7**, compatível com Docker Engine 18.06.0+ ([docker-docs.uclv.cu](https://docker-docs.uclv.cu/compose/compose-file/compose-versioning/)).

---

### 4. Cenários de Restrição ou Não Aplicação

Não existem desvantagens significativas em usar `init: true`, pois o init incorporado cobre apenas encaminhamento de sinais e reaping de processos-filho, sem tentar replicar todas as funcionalidades de um init completo ([stackoverflow.com](https://stackoverflow.com/questions/56496495/when-not-to-use-docker-run-init?utm_source=chatgpt.com)). Em contêineres que *não* geram subprocessos (por exemplo, aplicações uniprocesso sem forks), seu impacto será mínimo, mas ainda assim não causa efeitos colaterais adversos.

---

### 5. Componentes Chave Associados

- **Processo Init Interno:** Geralmente o [Tini](https://github.com/krallin/tini), um init minimalista de contêiner que aguarda sinais, os repassa ao processo principal e reaps processos zumbis ([github.com](https://github.com/krallin/tini?utm_source=chatgpt.com)).
- **PID 1 no Namespace:** Ao habilitar `init`, o Docker posiciona o init como PID 1 dentro do namespace do contêiner, relegando o processo de aplicação a PID 2, garantindo comportamento consistente de sinalização.

---

### 6. Melhores Práticas e Padrões de Uso

- **Sempre use `init: true`** em serviços que possam criar subprocessos ou dependam de recebimento correto de sinais para terminação graciosa.
- **Em ambientes de produção**, habilitar o init evita acúmulo de processos zumbis e garante que contêineres respondam adequadamente a comandos como `docker stop` ([dev-aditya.medium.com](https://dev-aditya.medium.com/pid-1-and-tini-in-docker-why-your-container-ignores-ctrl-c-800b565cb76e?utm_source=chatgpt.com)).
- **Combine com `healthcheck`** para assegurar que o contêiner seja monitorado de forma robusta e possa se recuperar de falhas.

---

### 7. Exemplo Prático Completo

```yaml
version: "3.7"
services:
  web:
    image: nginx:alpine
    init: true
    ports:
      - "8080:80"
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost/"]
      interval: 30s
      timeout: 10s
      retries: 3

```

Nesse cenário, o `init` garante o repasse de sinais e limpeza de zombies, enquanto o `healthcheck` monitora a disponibilidade do serviço ([docs.docker.com](https://docs.docker.com/reference/compose-file/services/)).

---

### 8. Sugestões para Aprofundamento

- **Compose File Reference – Services:** Explora todos os atributos de um serviço, incluindo `init` ([docs.docker.com](https://docs.docker.com/reference/compose-file/services/)).
- **Compose File Versioning:** Detalha os *file formats* e em quais versões cada atributo foi introduzido ([docker-docs.uclv.cu](https://docker-docs.uclv.cu/compose/compose-file/compose-versioning/)).
- **Repositório Tini no GitHub:** Entenda internamente como o Tini implementa o repasse de sinais e reaping ([github.com](https://github.com/krallin/tini?utm_source=chatgpt.com)).