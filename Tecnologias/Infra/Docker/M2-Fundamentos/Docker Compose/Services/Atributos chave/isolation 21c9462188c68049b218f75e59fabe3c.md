# isolation

**Entendendo o atributo `isolation` no Docker Compose**

**Introdução**

No Docker Compose, cada serviço pode mapear diretamente atributos de sua definição para a criação de containers no Docker Engine. O atributo `isolation` controla a tecnologia de isolamento a ser usada pelo container no host, permitindo definir se ele compartilha o kernel do host ou roda em um ambiente virtualizado separado ([docs.docker.com](https://docs.docker.com/reference/compose-file/services/)).

---

## Sumário

1. Conceitos Fundamentais
2. Sintaxe Detalhada e Uso Prático
3. Cenários de Restrição ou Não Aplicação
4. Componentes Chave Associados
5. Melhores Práticas e Padrões de Uso
6. Exemplo Prático Completo
7. Sugestões para Aprofundamento

---

## 1. Conceitos Fundamentais

- **O que é “isolação”**
    
    É o método pelo qual o container é separado do sistema operacional do host, garantindo segurança, compatibilidade de versões e controle de recursos ([docs.docker.com](https://docs.docker.com/reference/compose-file/services/)).
    
- **Modos de isolamento em Windows**
    - **Process**: o container compartilha o kernel do Windows com o host, com isolamento no nível de namespace de processos.
    - **Hyper-V**: cada container roda dentro de uma máquina virtual otimizada, tendo seu próprio kernel, o que aumenta a segurança e permite mismatches de versão entre host e imagem ([learn.microsoft.com](https://learn.microsoft.com/en-us/virtualization/windowscontainers/manage-containers/hyperv-container?utm_source=chatgpt.com)).
- **Por que usar**
    - *Process*: menor overhead, adequado quando host e imagem são da mesma versão.
    - *Hyper-V*: recomendável em testes de containers com versões diferentes do host ou ambientes que exigem isolamento de kernel por hardware.

---

## 2. Sintaxe Detalhada e Uso Prático

A sintaxe se dá diretamente no nível de serviço do `docker-compose.yml`:

```yaml
version: "3.8"
services:
  meu_servico:
    image: mcr.microsoft.com/windows/servercore:ltsc2019
    isolation: process   # ou "hyperv" ou "default"
    ports:
      - "8080:80"

```

- **Valores aceitos**
    - `process` – usa isolamento de processo.
    - `hyperv` – usa isolamento baseado em Hyper-V.
    - `default` – adota o modo padrão do host (no Windows Server: `process`; no Windows 10: `hyperv`) ([learn.microsoft.com](https://learn.microsoft.com/en-us/virtualization/windowscontainers/manage-containers/hyperv-container?utm_source=chatgpt.com)).
- **Equivalência com Docker CLI**
    
    O Compose traduz `isolation: <valor>` para `--isolation=<valor>` no comando `docker run`, definindo a propriedade `HostConfig.Isolation` interna ([learn.microsoft.com](https://learn.microsoft.com/en-us/virtualization/windowscontainers/manage-containers/hyperv-container?utm_source=chatgpt.com)).
    

---

## 3. Cenários de Restrição ou Não Aplicação

- **Plataforma Linux**
    
    O parâmetro `isolation` é **specific to Windows containers**. Em hosts Linux não há suporte a essa opção; caso seja declarado, o engine pode ignorá-lo ou falhar ao criar o container ([docs.docker.com](https://docs.docker.com/reference/compose-file/services/)).
    
- **Mismatch de versão Windows**
    
    Se tentar rodar um container com versão de base diferente da do host sem usar `hyperv`, ocorre erro:
    
    ```
    failure in a Windows system call: The operating system of the container does not match the operating system of the host
    
    ```
    
    para então forçar `isolation: hyperv` e contornar o bloqueio ([learn.microsoft.com](https://learn.microsoft.com/en-us/virtualization/windowscontainers/deploy-containers/version-compatibility)).
    

---

## 4. Componentes Chave Associados

- **`HostConfig.Isolation`** (API Docker Engine) – recebe o valor de `isolation` definido no Compose.
- **`docker run --isolation`** – flag direta para rodar sem Compose.
- **Outros atributos de isolamento** (para namespaces):
    - `ipc` (IPC namespaces)
    - `userns_mode` (user namespaces)
    - `security_opt` (seccomp, AppArmor, SELinux)
        
        Esses podem complementar o isolamento de kernel definido por `isolation`.
        

---

## 5. Melhores Práticas e Padrões de Uso

- **Não especifique** `isolation` se o modo padrão do host já atender ao seu caso.
- **Use `process`** em ambientes Windows Server homogêneos para reduzir overhead.
- **Use `hyperv`** quando for necessário:
    - Executar containers com versões de base diferentes do host.
    - Garantir boundary de kernel por hardware, em cenários de maior risco de segurança.
- **Teste localmente** cada cenário antes de migrar para produção, validando desempenho e compatibilidade.

---

## 6. Exemplo Prático Completo

```yaml
version: "3.8"
services:
  web:
    image: mcr.microsoft.com/windows/servercore:ltsc2019
    isolation: hyperv      # maior segurança, permite mismatch de versão
    build:
      context: ./WebApp
    ports:
      - "8080:80"

  api:
    image: mcr.microsoft.com/windows/servercore:ltsc2019
    isolation: process     # baixa latência, kernel compartilhado
    build:
      context: ./ApiService
    environment:
      - ASPNETCORE_ENVIRONMENT=Production
    ports:
      - "5000:5000"

```

Neste cenário, dois serviços Windows usam modos de isolamento distintos, adequados a requisitos de segurança e performance diferentes.

---

## 7. Sugestões para Aprofundamento

- **Docker Compose Reference** – detalhes do atributo `isolation` ([docs.docker.com](https://docs.docker.com/reference/compose-file/services/))
- **Windows Containers Isolation** – explicação completa de `process` vs `hyperv` ([learn.microsoft.com](https://learn.microsoft.com/en-us/virtualization/windowscontainers/manage-containers/hyperv-container?utm_source=chatgpt.com))
- **Windows Version Compatibility** – erros e compatibilidade de versões Windows para containers ([learn.microsoft.com](https://learn.microsoft.com/en-us/virtualization/windowscontainers/deploy-containers/version-compatibility))
- **Docker Engine API** – `HostConfig.Isolation` e demais configurações programáticas

Espero que este guia detalhado ajude a compreender, configurar e aplicar corretamente o atributo `isolation` em seus projetos com Docker Compose!