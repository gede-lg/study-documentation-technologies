# domainname

# Entendendo o atributo `domainname` em Docker Compose

## Introdução

No Docker Compose, cada serviço definido na chave `services` gera um ou mais containers que devem ser configurados para comunicação em rede e identificação interna. O atributo `domainname` permite especificar o nome de domínio que será aplicado ao container dentro do seu namespace de UTS, afetando seu Fully Qualified Domain Name (FQDN) e a identificação pelos processos internos, sem necessariamente alterar o comportamento de resolução de DNS externamente ([docs.docker.com](https://docs.docker.com/reference/compose-file/services/)). Por padrão, o Compose cria uma rede interna e registra cada container sob seu nome de serviço; o `domainname` complementa essa configuração ao definir o sufixo de domínio do hostname ([docs.docker.com](https://docs.docker.com/compose/how-tos/networking/?utm_source=chatgpt.com)).

## Sumário

1. [Conceitos Fundamentais](https://chatgpt.com/g/g-p-68596a64c76c819185e08bdb9bacec85-infra/c/6859817f-01e8-8013-9e5a-cbb14e4c689f#conceitos-fundamentais)
2. [Sintaxe Detalhada e Uso Prático](https://chatgpt.com/g/g-p-68596a64c76c819185e08bdb9bacec85-infra/c/6859817f-01e8-8013-9e5a-cbb14e4c689f#sintaxe-detalhada-e-uso-pr%C3%A1tico)
3. [Cenários de Restrição ou Não Aplicação](https://chatgpt.com/g/g-p-68596a64c76c819185e08bdb9bacec85-infra/c/6859817f-01e8-8013-9e5a-cbb14e4c689f#cen%C3%A1rios-de-restri%C3%A7%C3%A3o-ou-n%C3%A3o-aplica%C3%A7%C3%A3o)
4. [Componentes Chave Associados](https://chatgpt.com/g/g-p-68596a64c76c819185e08bdb9bacec85-infra/c/6859817f-01e8-8013-9e5a-cbb14e4c689f#componentes-chave-associados)
5. [Melhores Práticas e Padrões de Uso](https://chatgpt.com/g/g-p-68596a64c76c819185e08bdb9bacec85-infra/c/6859817f-01e8-8013-9e5a-cbb14e4c689f#melhores-pr%C3%A1ticas-e-padr%C3%B5es-de-uso)
6. [Exemplo Prático Completo](https://chatgpt.com/g/g-p-68596a64c76c819185e08bdb9bacec85-infra/c/6859817f-01e8-8013-9e5a-cbb14e4c689f#exemplo-pr%C3%A1tico-completo)
7. [Sugestões para Aprofundamento](https://chatgpt.com/g/g-p-68596a64c76c819185e08bdb9bacec85-infra/c/6859817f-01e8-8013-9e5a-cbb14e4c689f#sugest%C3%B5es-para-aprofundamento)

---

## Conceitos Fundamentais

O atributo `domainname` declara um nome de domínio RFC 1123 válido que será atribuído ao container no namespace de UTS, influenceando o valor retornado por chamadas internas como `hostname -d` e `hostname -f` ([docs.docker.com](https://docs.docker.com/reference/compose-file/services/)).

Internamente, isso corresponde ao flag `--domainname` do comando `docker run`, que define o NIS domain name visível aos processos dentro do container, sem alterar as configurações de DNS externa ou a entrada em `/etc/resolv.conf` ([stackoverflow.com](https://stackoverflow.com/questions/70741780/what-is-the-domainname-option-used-for-in-docker?utm_source=chatgpt.com)).

---

## Sintaxe Detalhada e Uso Prático

A sintaxe do `domainname` em um arquivo `docker-compose.yml` é direta:

```yaml
services:
  web:
    image: nginx:latest
    # Define o hostname para 'web'
    hostname: web
    # Define o sufixo de domínio para 'example.com'
    domainname: example.com

```

- **Formato:** uma única string, sem listas.
- **Validação:** deve seguir o padrão de hostnames RFC 1123 (letras, dígitos e hífen).

**Combinação com `hostname`:**

Se `hostname` não for especificado, o Docker utiliza o ID do container como hostname, mas o `domainname` ainda se aplica, resultando em `<container_id>.example.com` ([docs.docker.com](https://docs.docker.com/reference/compose-file/services/)).

---

## Cenários de Restrição ou Não Aplicação

- **Ambientes sem NIS:** aplicações que não usam Domain Information Services (NIS) não se beneficiam do `domainname`, pois ele só é relevante para chamadas internas a `setdomainname(2)` ([stackoverflow.com](https://stackoverflow.com/questions/70741780/what-is-the-domainname-option-used-for-in-docker?utm_source=chatgpt.com)).
- **Resolução de DNS:** para configurar domínios de busca (search domains) que afetam `/etc/resolv.conf`, use `dns_search` em vez de `domainname` ([docs.docker.com](https://docs.docker.com/reference/compose-file/services/)).
- **Containers Windows:** o atributo pode não ser suportado ou ter comportamento diferente em containers Windows, pois depende do namespace de UTS, recurso específico de Linux.

---

## Componentes Chave Associados

- **`hostname`:** define o nome “curto” do host dentro do container.
- **`domainname`:** define o sufixo de domínio aplicado ao hostname ([docs.docker.com](https://docs.docker.com/reference/compose-file/services/)).
- **`dns_search`:** lista de domínios de busca para resolução de DNS (não atrelado ao hostname interno) ([docs.docker.com](https://docs.docker.com/reference/compose-file/services/)).
- **Namespace de UTS:** mecanismo que isola hostname e domainname de cada container, permitindo configurações independentes.

---

## Melhores Práticas e Padrões de Uso

- **Sempre combine `hostname` + `domainname`:** para obter um FQDN previsível (ex.: `web.example.com`), defina ambos.
- **Validação de RFC 1123:** garanta que o valor de `domainname` siga o padrão de até 63 caracteres por label e caracteres permitidos (letras, dígitos, hífen) ([docs.docker.com](https://docs.docker.com/reference/compose-file/services/)).
- **Uso pontual:** aplique o `domainname` somente quando aplicações internas dependam do FQDN, evitando configurações desnecessárias.
- **Não substitui DNS externo:** para redirecionamento ou resolução de nomes em rede, configure `dns` e `dns_search` ou use um reverse proxy/serviço de descoberta.

---

## Exemplo Prático Completo

```yaml
version: '3.9'
services:
  api:
    image: mycompany/api:1.2
    hostname: api
    domainname: internal.mycompany.com
    ports:
      - "8080:80"
    networks:
      - backend

  db:
    image: postgres:13
    hostname: db
    domainname: internal.mycompany.com
    environment:
      POSTGRES_DB: appdb
      POSTGRES_USER: user
      POSTGRES_PASSWORD: secret
    networks:
      - backend

networks:
  backend:
    driver: bridge

```

1. **Rede `backend`:** cria isolamento e descoberta por nome de serviço.
2. **Containers:** terão FQDNs `api.internal.mycompany.com` e `db.internal.mycompany.com`.
3. **Processos internos:** `hostname -f` retorna o FQDN completo, útil para logs e configurações de aplicação.

---

## Sugestões para Aprofundamento

- **Compose Specification:** leia a seção de services no manual oficial para entender todos os atributos disponíveis (e.g., `dns`, `dns_search`, `hostname`, `domainname`) ([docs.docker.com](https://docs.docker.com/reference/compose-file/services/)).
- **Networking em Compose:** compreenda como o Docker DNS interno funciona e como as redes são criadas e nomeadas ([docs.docker.com](https://docs.docker.com/compose/how-tos/networking/?utm_source=chatgpt.com)).
- **NIS e UTS Namespace:** explore o manual do kernel Linux sobre namespaces para entender como hostname e domainname são isolados.

> Bônus: experimente em um container Linux executar docker exec -it <container> bash e usar hostname -d e hostname -f para ver na prática o efeito do domainname.
>