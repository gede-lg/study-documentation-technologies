# profiles

# Guia Completo sobre o Atributo `profiles` no Docker Compose

## Introdução

O atributo `profiles` permite ajustar sua aplicação Docker Compose para diferentes ambientes ou casos de uso, ativando seletivamente determinados serviços. Com ele, você mantém todas as definições em um único `docker-compose.yml`, mas só inicia os serviços necessários quando o profile correspondente está ativo. ([docs.docker.com](https://docs.docker.com/compose/how-tos/profiles/?utm_source=chatgpt.com), [docs.docker.com](https://docs.docker.com/reference/compose-file/profiles/?utm_source=chatgpt.com))

## Sumário

1. [Conceitos Fundamentais](https://chatgpt.com/c/6859817f-01e8-8013-9e5a-cbb14e4c689f#conceitos-fundamentais)
2. [Sintaxe Detalhada e Uso Prático](https://chatgpt.com/c/6859817f-01e8-8013-9e5a-cbb14e4c689f#sintaxe-detalhada-e-uso-pr%C3%A1tico)
3. [Cenários de Restrição ou Não Aplicação](https://chatgpt.com/c/6859817f-01e8-8013-9e5a-cbb14e4c689f#cen%C3%A1rios-de-restri%C3%A7%C3%A3o-ou-n%C3%A3o-aplica%C3%A7%C3%A3o)
4. [Componentes Chave Associados](https://chatgpt.com/c/6859817f-01e8-8013-9e5a-cbb14e4c689f#componentes-chave-associados)
5. [Melhores Práticas e Padrões de Uso](https://chatgpt.com/c/6859817f-01e8-8013-9e5a-cbb14e4c689f#melhores-pr%C3%A1ticas-e-padr%C3%B5es-de-uso)
6. [Exemplo Prático Completo](https://chatgpt.com/c/6859817f-01e8-8013-9e5a-cbb14e4c689f#exemplo-pr%C3%A1tico-completo)
7. [Sugestões para Aprofundamento](https://chatgpt.com/c/6859817f-01e8-8013-9e5a-cbb14e4c689f#sugest%C3%B5es-para-aprofundamento)

---

## Conceitos Fundamentais

- **Definição:** O Compose Specification define `profiles` como um array de nomes de perfil vinculados a um serviço. Serviços sem esse atributo são sempre ativados; serviços com `profiles` só iniciam quando seu profile está ativo. ([docs.docker.com](https://docs.docker.com/reference/compose-file/profiles/?utm_source=chatgpt.com))
- **Propósito:** Facilitar cenários de desenvolvimento, testes, debugging ou deploy parcial, sem fragmentar múltiplos arquivos de Compose. Permite, por exemplo, ter serviços de monitoramento, debug ou dependências opcionais que só sobem quando solicitados. ([docs.docker.com](https://docs.docker.com/compose/how-tos/profiles/?utm_source=chatgpt.com))

---

## Sintaxe Detalhada e Uso Prático

1. **Declaração no YAML**
    
    ```yaml
    version: "3.9"
    services:
      web:
        image: nginx
        profiles: ["frontend"]    # Serviço parte do profile "frontend"
      debug:
        image: busybox
        command: ["sh", "-c", "while true; do echo debuggin; sleep 5; done"]
        profiles:
          - debug               # Serviço parte do profile "debug"
      db:
        image: postgres        # Sem profiles: sempre ativado
    
    ```
    
    - O atributo `profiles` deve ser uma sequência (array) de strings. ([docs.docker.com](https://docs.docker.com/compose/how-tos/profiles/?utm_source=chatgpt.com))
2. **Ativação via CLI**
    - Ativar um profile:
        
        ```bash
        docker compose --profile frontend up
        
        ```
        
    - Ativar múltiplos:
        
        ```bash
        docker compose --profile frontend --profile debug up
        
        ```
        
    - Variável de ambiente alternativa:
        
        ```bash
        export COMPOSE_PROFILES=frontend,debug
        docker compose up
        ``` :contentReference[oaicite:4]{index=4}
        
        ```
        
3. **Comportamento de Serviços**
    - **Sempre ativos:** Serviços sem `profiles` ou explicitamente alvo de comando (`docker compose up db`).
    - **Opcionais:** Serviços com `profiles` só sobem se o profile estiver na lista ativa.

---

## Cenários de Restrição ou Não Aplicação

- **Docker Swarm / Stack Deploy:** O comando `docker stack deploy` não reconhece o atributo `profiles` e retorna erro `Additional property profiles is not allowed`. É necessário manter arquivos separados ou mecanismos alternativos para deploy parcial em Swarm mode. ([serverfault.com](https://serverfault.com/questions/1147494/how-use-profiles-with-swarm?utm_source=chatgpt.com))
- **Orquestradores de Terceiros:** Plataformas que usam Compose spec parcial podem não implementar `profiles` (ex.: algumas versões de Portainer, Kubernetes via Kompose).

---

## Componentes Chave Associados

- **Compose Specification:** Define o schema de `profiles` em [services](https://docs.docker.com/compose/compose-file/compose-file-v3/#profiles) ([docs.docker.com](https://docs.docker.com/reference/compose-file/profiles/?utm_source=chatgpt.com))
- **Flag `-profile`:** Opção da CLI Docker Compose para ativar profiles específicos.
- **Variável `COMPOSE_PROFILES`:** Permite setar profiles por meio de ambiente, útil em pipelines ou IDEs.
- **Serviços sem profiles:** Sempre iniciam, garantindo dependências básicas.
- **Serviços com profiles múltiplos:** Um serviço pode pertencer a vários contexts (e.g., `profiles: ["dev","test"]`).

---

## Melhores Práticas e Padrões de Uso

- **Nomenclatura Clara:** Use nomes de profiles autoexplicativos (`dev`, `test`, `debug`, `metrics`).
- **Documentação no Repositório:** Liste os profiles disponíveis no README com exemplos de uso.
- **Evitar Dependências Implícitas:** Serviços em profiles não devem ser dependência obrigatória de outros sem tratamento condicional.
- **Uso em CI/CD:** Combine profiles com variáveis de ambiente para pipelines que executam apenas partes do stack.
- **Manter Arquivo Único:** Aproveite o `profiles` para evitar ter múltiplos `docker-compose.*.yml`; centralize configurações.

---

## Exemplo Prático Completo

**Descrição do cenário:** aplicação web com monitoramento e debug opcionais.

```yaml
# docker-compose.yml
version: "3.9"

services:
  web:
    image: myapp:latest
    ports:
      - "80:80"
    profiles: ["prod","dev"]

  db:
    image: postgres:15
    environment:
      POSTGRES_PASSWORD: example
    profiles: ["prod","dev"]

  metrics:
    image: prom/prometheus
    profiles: ["monitor"]

  debug-shell:
    image: busybox
    command: ["sh"]
    profiles: ["debug"]

```

- **Dev/Prod padrão:**
    
    ```bash
    docker compose --profile dev up        # Levanta web + db
    
    ```
    
- **Monitoramento apenas:**
    
    ```bash
    docker compose --profile monitor up   # Inicia apenas o serviço de metrics
    
    ```
    
- **Debug + Dev:**
    
    ```bash
    COMPOSE_PROFILES=dev,debug docker compose up
    ``` :contentReference[oaicite:7]{index=7}
    
    ```
    

---

## Sugestões para Aprofundamento

- Explore a [Compose Specification completa](https://github.com/compose-spec/compose-spec).
- Consulte tutoriais sobre integração de profiles em pipelines CI/CD (e.g., GitHub Actions, GitLab CI).
- Avalie ferramentas de orquestração superiores (Kubernetes, Nomad) para cenários de produção mais robustos.
- Leia artigos de especialistas em Docker sobre padrões de configuração avançados com profiles.

---