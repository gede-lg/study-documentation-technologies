# type

# Entendendo o atributo `type` em definições de serviços do Docker Compose

## Introdução

O Docker Compose permite descrever e orquestrar múltiplos contêineres através de um arquivo YAML. A partir da versão 2.36.0, passou a oferecer o recurso de **Provider Services**, que delega o ciclo de vida de um serviço a componentes externos (por exemplo, plugins ou binários personalizados). Nesse contexto, o atributo `type` assume papel fundamental ao informar qual componente será invocado para o *setup* e *teardown* do serviço ([docs.docker.com](https://docs.docker.com/reference/compose-file/services/)).

## Sumário

1. [Conceitos Fundamentais](https://chatgpt.com/c/6859817f-01e8-8013-9e5a-cbb14e4c689f#conceitos-fundamentais)
2. [Sintaxe Detalhada e Uso Prático](https://chatgpt.com/c/6859817f-01e8-8013-9e5a-cbb14e4c689f#sintaxe-detalhada-e-uso-pr%C3%A1tico)
3. [Cenários de Restrição ou Não Aplicação](https://chatgpt.com/c/6859817f-01e8-8013-9e5a-cbb14e4c689f#cen%C3%A1rios-de-restri%C3%A7%C3%A3o-ou-n%C3%A3o-aplica%C3%A7%C3%A3o)
4. [Componentes Chave Associados](https://chatgpt.com/c/6859817f-01e8-8013-9e5a-cbb14e4c689f#componentes-chave-associados)
5. [Melhores Práticas e Padrões de Uso](https://chatgpt.com/c/6859817f-01e8-8013-9e5a-cbb14e4c689f#melhores-pr%C3%A1ticas-e-padr%C3%B5es-de-uso)
6. [Exemplo Prático Completo](https://chatgpt.com/c/6859817f-01e8-8013-9e5a-cbb14e4c689f#exemplo-pr%C3%A1tico-completo)
7. [Sugestões para Aprofundamento](https://chatgpt.com/c/6859817f-01e8-8013-9e5a-cbb14e4c689f#sugest%C3%B5es-para-aprofundamento)

---

## Conceitos Fundamentais

- A opção `provider` agrupa configurações que dizem ao Compose para não gerenciar diretamente o contêiner, delegando esse papel a um componente externo instalado no host ([docs.docker.com](https://docs.docker.com/reference/compose-file/services/)).
- Dentro de `provider`, o atributo **`type`** é **obrigatório** e especifica o nome do executável ou plugin que o Compose deve chamar para provisionar e desmontar o serviço ([docs.docker.com](https://docs.docker.com/reference/compose-file/services/)).
- Esse mecanismo só existe a partir da versão **2.36.0** do Docker Compose; versões anteriores não reconhecem nem `provider` nem `type` ([docs.docker.com](https://docs.docker.com/reference/compose-file/services/)).

## Sintaxe Detalhada e Uso Prático

```yaml
version: "3.9"
services:
  database:
    provider:
      type: awesomecloud      # Identifica o componente externo
      options:
        type: mysql           # Parâmetros passados ao provedor
        foo: bar
  app:
    image: myapp:latest
    depends_on:
      - database

```

- **`provider.type`** recebe sempre uma string apontando para o executável (no PATH) ou plugin registrado ([docs.docker.com](https://docs.docker.com/reference/compose-file/services/)).
- Durante a execução de `docker compose up`, o Compose invoca `awesomecloud setup` (ou equivalente) antes de iniciar contêineres, e `awesomecloud teardown` ao final do ciclo ([docs.docker.com](https://docs.docker.com/reference/compose-file/services/)).

## Cenários de Restrição ou Não Aplicação

- Em serviços tradicionais (definidos apenas por `image` ou `build`), **não** se declara `provider` nem `type`, pois o Compose controla integralmente o contêiner.
- Declarações de `provider` ou `type` em versões **anteriores** a 2.36.0 resultarão em erro de sintaxe, já que o recurso não existe ([docs.docker.com](https://docs.docker.com/reference/compose-file/services/)).

## Componentes Chave Associados

- **`provider`**: habilita o uso de serviços geridos externamente, substituindo `image`/`build` como fonte de provisão ([docs.docker.com](https://docs.docker.com/reference/compose-file/services/)).
- **`type`**: identifica o componente de terceiros (binário ou plugin) responsável pelo ciclo de vida ([docs.docker.com](https://docs.docker.com/reference/compose-file/services/)).
- **`options`**: mapeamento de parâmetros específicos do provedor, sem validação pelo Compose (são repassados “as is”) ([docs.docker.com](https://docs.docker.com/reference/compose-file/services/)).

## Melhores Práticas e Padrões de Uso

- Use nomes de `type` claros e consistentes (ex.: `awesomecloud`, `cloudsql`) para facilitar o entendimento da equipe ([docs.docker.com](https://docs.docker.com/reference/compose-file/services/)).
- Documente em README as versões necessárias do provedor e as opções aceitas, garantindo fácil onboarding.
- Teste localmente a invocação do provedor (ex.: `awesomecloud --help`) antes de incluí-lo no Compose.

## Exemplo Prático Completo

```yaml
version: "3.9"
services:
  vault:
    provider:
      type: vault-plugin
      options:
        url: https://vault.example.com
        token: "${VAULT_TOKEN}"
  web:
    image: nginx:latest
    depends_on:
      - vault
    environment:
      VAULT_ADDR: "${VAULT_URL}"
      VAULT_TOKEN: "${VAULT_TOKEN}"
networks:
  default:
    driver: bridge

```

1. O serviço **`vault`** não cria contêiner Docker: o Compose executa `vault-plugin setup` para provisionar segredos.
2. O serviço **`web`** só inicia após o provisionamento, recebendo variáveis de ambiente geradas pelo provedor.
3. Ao rodar `docker compose down`, o Compose chama `vault-plugin teardown` para limpar o recurso ([docs.docker.com](https://docs.docker.com/reference/compose-file/services/)).

## Sugestões para Aprofundamento

- Guia prático “Use provider services” na documentação oficial do Docker (How-To) ([docs.docker.com](https://docs.docker.com/compose/how-tos/provider-services/)).
- Seções de **Compose Deploy Specification** para entender integração com Swarm e outras plataformas.