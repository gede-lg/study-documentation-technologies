# external_links

**Entendendo o atributo `external_links` em serviços no Docker Compose**

---

## Introdução

O atributo `external_links` permite que um serviço definido em um arquivo `docker-compose.yml` estabeleça ligações (links) com containers gerenciados fora daquela aplicação Compose. Isso facilita o reuso de serviços compartilhados (como bancos de dados ou caches) que não estão definidos no mesmo projeto Compose. ([docker-docs.uclv.cu](https://docker-docs.uclv.cu/compose/compose-file/compose-file-v2/?utm_source=chatgpt.com))

---

## Sumário

1. Conceitos Fundamentais
2. Sintaxe Detalhada e Uso Prático
3. Cenários de Restrição ou Não Aplicação
4. Componentes Chave Associados
5. Melhores Práticas e Padrões de Uso
6. Exemplo Prático Completo
7. Sugestões para Aprofundamento

---

## 1. Conceitos Fundamentais

- **Propósito:** Estabelecer conectividade de rede e resolver nomes de containers externos à aplicação Compose, similar ao legado `links`, mas apontando para containers iniciados em outro projeto ou manualmente ([docker-docs.uclv.cu](https://docker-docs.uclv.cu/compose/compose-file/compose-file-v2/?utm_source=chatgpt.com)).
- **Funcionamento:** Sob o capô, o Compose injeta entradas no `/etc/hosts` do container consumista, mapeando nome ou *alias* para o IP do container externo ([docker-docs.uclv.cu](https://docker-docs.uclv.cu/compose/compose-file/compose-file-v2/?utm_source=chatgpt.com)).
- **Histórico:** Introduzido no Compose v1.1.0, permitindo “linkar” containers fora do app pela primeira vez ([docs.docker.com](https://docs.docker.com/compose/releases/release-notes/)).
- **Diferença entre `links` e `external_links`:**
    - `links`: une serviços internos de um mesmo `docker-compose.yml`.
    - `external_links`: ligações para containers externos ao arquivo, não definidos nem iniciados pelo mesmo Compose.

---

## 2. Sintaxe Detalhada e Uso Prático

```yaml
version: '2'  # ou '3'
services:
  web:
    image: nginx:latest
    external_links:
      - redis_service         # usa o nome do container externo
      - db_container:db_alias # usa ALIAS personalizado

```

- **Formato:**
    - Lista YAML de strings;
    - Cada item pode ser `CONTAINER` ou `CONTAINER:ALIAS`.
- **Semântica:**
    - `redis_service` → insere `/etc/hosts` → `redis_service <IP>`;
    - `db_container:db_alias` → insere `/etc/hosts` → `db_alias <IP>`.
- **Validação (JSON Schema):**
    
    ```
    "external_links": {
      "type": "array",
      "items": { "type": "string" },
      "uniqueItems": true
    }
    
    ```
    
    ([cuetorials.com](https://cuetorials.com/first-steps/convert-jsonschema/?utm_source=chatgpt.com))
    

---

## 3. Cenários de Restrição ou Não Aplicação

- **Rede Compartilhada Obrigatória:** Se estiver usando a versão 2 ou superior do formato, os containers externos **devem** estar conectados a pelo menos uma das mesmas redes que o serviço que faz a ligação ([docker-docs.uclv.cu](https://docker-docs.uclv.cu/compose/compose-file/compose-file-v2/?utm_source=chatgpt.com)).
- **Legado/Depreciação:** `external_links` e `links` são considerados **legados**. A recomendação é usar **redes definidas pelo usuário** em vez de links ([docker-docs.uclv.cu](https://docker-docs.uclv.cu/compose/compose-file/compose-file-v2/?utm_source=chatgpt.com)).
- **Modo Swarm (Deploy):** Em cenários Swarm/`docker stack deploy`, `external_links` **não** é suportado no `deploy` spec; redes externas são o caminho correto.
- **DNS vs Hosts:** Em redes modernas (modo `bridge` customizado ou `overlay`), a descoberta de serviço via DNS da própria rede torna `external_links` desnecessário.

---

## 4. Componentes Chave Associados

| Componente | Descrição |
| --- | --- |
| `external_links` | Atributo de serviço que lista containers externos para fazer *link*. |
| `links` | Versão legada para containers internos; semelhante em funcionamento. |
| `networks` | Definição de redes; deve incluir redes externas compartilhadas. |
| `aliases` | Em redes definidas, permite criar *alias* sem usar `external_links`. |
| `/etc/hosts` | Arquivo modificado para resolver nomes/aliases de containers externos. |

---

## 5. Melhores Práticas e Padrões de Uso

- **Prefira redes**: configure uma rede externa com `docker network create` e marque-a em ambos os `docker-compose.yml` como `external: true`, usando nomes de serviço e aliases nativos de DNS de rede.
- **Use `external_links` apenas** para migrações ou compatibilidade com setups legados que não podem ser convertidos imediatamente para redes de DNS.
- **Aplique aliases coerentes**: use `CONTAINER:ALIAS` para manter consistência nomimal dentro do container, separando nome do host real do alias de aplicação.
- **Evite múltiplos links**: se vários serviços externos dependem entre si, agrupe-os em uma rede em comum ao invés de encadear `external_links`.

---

## 6. Exemplo Prático Completo

**Cenário:** Serviço `webapp` quer usar banco `db_external` definido em outro Compose.

1. **Criar rede externa**
    
    ```bash
    docker network create -d bridge shared_net
    
    ```
    
2. **Compose do banco (outro projeto)**
    
    ```yaml
    version: '3'
    services:
      db:
        image: postgres:13
        networks:
          - shared_net
    networks:
      shared_net:
        external: true
    
    ```
    
3. **Compose do app**
    
    ```yaml
    version: '3'
    services:
      webapp:
        image: myapp:latest
        depends_on:
          - db_external
        networks:
          - shared_net
        external_links:
          - db_external:database
    networks:
      shared_net:
        external: true
    
    ```
    
- **Fluxo:**
    1. Banco é iniciado e conectado a `shared_net`.
    2. `webapp` conecta-se à mesma rede e recebe `/etc/hosts` com `database` apontando para o IP de `db_external`.

---

## 7. Sugestões para Aprofundamento

- [Compose Specification (schema JSON)](https://github.com/compose-spec/compose-spec/blob/master/schema/compose-spec.json)
- Guia oficial de [Networking in Compose](https://docs.docker.com/compose/networking/)
- Artigos sobre migração de links para redes definidas pelo usuário

---

> Conclusão: Embora external_links ainda funcione, é uma solução de transição. Para sistemas modernos, invista em configurações de redes externas e alias DNS para garantir escalabilidade e compatibilidade com Swarm/Kubernetes.
>