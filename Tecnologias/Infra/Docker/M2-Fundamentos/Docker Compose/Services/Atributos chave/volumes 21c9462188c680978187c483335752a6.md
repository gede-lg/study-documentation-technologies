# volumes

**Título da Explicação:** Volumes na chave `services` do Docker Compose

---

## 1. Introdução

No Docker Compose, o atributo `volumes` dentro da seção `services` permite que você monte volumes, sejam eles *named volumes* do Docker ou diretórios do host, nos contêineres de um serviço. Essa funcionalidade é crucial para persistência de dados e compartilhamento entre contêineres, separando o ciclo de vida dos dados do ciclo de vida dos contêineres ([docs.docker.com](https://docs.docker.com/reference/compose-file/volumes/?utm_source=chatgpt.com)).

---

## 2. Sumário

1. Conceitos Fundamentais
2. Sintaxe Detalhada e Uso Prático
    - Sintaxe Curta
    - Sintaxe Longa
3. Cenários de Restrição ou Não Aplicação
4. Componentes-Chave Associados
5. Melhores Práticas e Padrões de Uso
6. Exemplo Prático Completo
7. Sugestões para Aprofundamento

---

## 3. Conceitos Fundamentais

- **Objetivo:** Permitir que serviços compartilhem ou persistam dados em volumes gerenciados pelo Docker ou em diretórios do host.
- **Importância:**
    - **Persistência de dados:** Volumes não são destruídos quando o contêiner é removido, preservando bancos de dados, logs, uploads e caches.
    - **Compartilhamento:** Vários contêineres podem montar o mesmo volume para colaborar em uma base de dados, sistemas de arquivos ou estatísticas ([docs.docker.com](https://docs.docker.com/reference/compose-file/volumes/?utm_source=chatgpt.com)).

---

## 4. Sintaxe Detalhada e Uso Prático

### 4.1 Sintaxe Curta

```yaml
services:
  web:
    image: nginx:alpine
    volumes:
      - ./app:/usr/share/nginx/html:ro
      - data_volume:/var/lib/data

volumes:
  data_volume:

```

- `host_path:container_path:mode`
    - `host_path`: caminho do host (relativo ou absoluto).
    - `container_path`: caminho dentro do contêiner.
    - `mode`: opcional, `ro` (read-only) ou `rw` (read-write). ([kinsta.com](https://kinsta.com/blog/docker-compose-volumes/?utm_source=chatgpt.com))

### 4.2 Sintaxe Longa

Permite detalhes avançados (como `nocopy`, `tmpfs`, `bind` ou `volume`):

```yaml
services:
  db:
    image: mysql:5.6
    volumes:
      - type: volume
        source: db-data
        target: /var/lib/mysql
        volume:
          nocopy: true
      - type: bind
        source: ./init-scripts
        target: /docker-entrypoint-initdb.d

volumes:
  db-data:

```

- **type:** `volume` | `bind` | `tmpfs`
- **source:** nome do volume (ou caminho do host)
- **target:** ponto de montagem no contêiner
- **volume.bind / volume.nocopy:** opções específicas de volume ([stackoverflow.com](https://stackoverflow.com/questions/40905761/how-do-i-mount-a-host-directory-as-a-volume-in-docker-compose?utm_source=chatgpt.com)).

---

## 5. Cenários de Restrição ou Não Aplicação

- **Ambientes efêmeros:** Em testes rápidos, pode-se não se preocupar com persistência.
- **Dados sensíveis:** Para segredos, prefira o atributo `secrets`, que monta arquivos somente leitura e com controle de acesso dedicado.
- **Performance crítica:** Bind mounts podem ser mais lentos em alguns sistemas de arquivos (como VirtualBox/Mac); prefira *named volumes* quando possível ([docs.docker.com](https://docs.docker.com/engine/storage/volumes/?utm_source=chatgpt.com)).

---

## 6. Componentes-Chave Associados

| Atributo | Descrição |
| --- | --- |
| `type` | Tipo de montagem: |

```
            - `volume`: *named volume* gerenciado pelo Docker
            - `bind`: bind mount de diretório/arquivo do host
            - `tmpfs`: sistema de arquivos temporário em memória |

```

| `source`     | Nome do volume ou caminho do host (para `bind`).                                          |

| `target`     | Caminho dentro do contêiner onde o volume será montado.                                   |

| `read_only`  | (long syntax) `true` para somente leitura.                                                |

| `volume.nocopy` | Evita a cópia inicial de dados do contêiner para o volume vazio.                        |

| `driver_opts`| (top-level volumes) configurações específicas do driver (ex.: NFS, CIFS).                 |

Cada um desses componentes pode ser combinado para adaptar volumes a diferentes cenários e requisitos avançados ([stackoverflow.com](https://stackoverflow.com/questions/40905761/how-do-i-mount-a-host-directory-as-a-volume-in-docker-compose?utm_source=chatgpt.com)).

---

## 7. Melhores Práticas e Padrões de Uso

- **Use *named volumes*** para dados que precisam sobreviver a atualizações e reinícios de contêiner.
- **Limite bind mounts** a casos em que você necessita de acesso direto ao sistema de arquivos do host (por exemplo, desenvolvimento local).
- **Defina modos de acesso explícitos** (`ro` / `rw`) para evitar gravações acidentais em ambientes de produção.
- **Evite caminhos absolutos** no host em projetos colaborativos; prefira referências relativas (`./src`).
- **Documente os volumes** no `README` ou comentários do `docker-compose.yml` para clareza e manutenção.

---

## 8. Exemplo Prático Completo

```yaml
version: '3.8'

services:
  web:
    image: nginx:alpine
    ports:
      - "8080:80"
    volumes:
      # Bind mount de arquivos do projeto (somente leitura)
      - ./site:/usr/share/nginx/html:ro
      # Named volume para logs persistentes
      - logs_volume:/var/log/nginx

  db:
    image: postgres:15
    environment:
      POSTGRES_DB: example
      POSTGRES_USER: user
      POSTGRES_PASSWORD: pass
    volumes:
      # Named volume para dados do banco
      - db_data:/var/lib/postgresql/data

volumes:
  logs_volume:
    driver: local
  db_data:
    driver: local

```

> Como funciona:
> 
> 1. `web`: usa `./site` do host para servir conteúdo e armazena logs em `logs_volume`.
> 2. `db`: armazena dados do Postgres em `db_data`, garantindo persistência mesmo se o contêiner for recriado.

---

## 9. Sugestões para Aprofundamento

- Leia a **Compose Specification** completa no repositório oficial:
    
    [https://github.com/compose-spec/compose-spec](https://github.com/compose-spec/compose-spec) ([raw.githubusercontent.com](https://raw.githubusercontent.com/compose-spec/compose-spec/master/spec.md))
    
- Explore tópicos avançados de **drivers de volume** (NFS, CIFS, plugins de cloud) na documentação de volumes do Docker Engine.
- Experimente **`tmpfs` mounts** para cenários de cache em memória de alta performance.

Com esses elementos, você terá um entendimento profundo e prático de como o atributo `volumes` funciona dentro de `services` no Docker Compose.