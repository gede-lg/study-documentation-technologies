# ipam

**Atributo `ipam` em `networks` no Docker Compose**

---

## Introdu√ß√£o

Nos arquivos do Docker Compose, a se√ß√£o `networks` permite definir redes customizadas para os cont√™ineres, controlando tanto a comunica√ß√£o quanto o isolamento entre servi√ßos ([docs.docker.com](https://docs.docker.com/reference/compose-file/networks/?utm_source=chatgpt.com)). Dentro dessa defini√ß√£o, o bloco `ipam` (IP Address Management) gerencia como os endere√ßos IP s√£o alocados, sendo crucial para evitar conflitos e estruturar topologias de rede complexas ([stackoverflow.com](https://stackoverflow.com/questions/50432734/what-is-the-purpose-of-the-ipam-key-in-a-docker-compose-config?utm_source=chatgpt.com)).

---

## Sum√°rio

1. [Conceitos Fundamentais](https://chatgpt.com/c/6859817f-01e8-8013-9e5a-cbb14e4c689f#conceitos-fundamentais)
2. [Sintaxe Detalhada e Uso Pr√°tico](https://chatgpt.com/c/6859817f-01e8-8013-9e5a-cbb14e4c689f#sintaxe-detalhada-e-uso-pr%C3%A1tico)
3. [Cen√°rios de Restri√ß√£o ou N√£o Aplica√ß√£o](https://chatgpt.com/c/6859817f-01e8-8013-9e5a-cbb14e4c689f#cen%C3%A1rios-de-restri%C3%A7%C3%A3o-ou-n%C3%A3o-aplica%C3%A7%C3%A3o)
4. [Componentes Chave Associados](https://chatgpt.com/c/6859817f-01e8-8013-9e5a-cbb14e4c689f#componentes-chave-associados)
5. [Melhores Pr√°ticas e Padr√µes de Uso](https://chatgpt.com/c/6859817f-01e8-8013-9e5a-cbb14e4c689f#melhores-pr%C3%A1ticas-e-padr%C3%B5es-de-uso)
6. [Exemplo Pr√°tico Completo](https://chatgpt.com/c/6859817f-01e8-8013-9e5a-cbb14e4c689f#exemplo-pr%C3%A1tico-completo)
7. [Sugest√µes para Aprofundamento](https://chatgpt.com/c/6859817f-01e8-8013-9e5a-cbb14e4c689f#sugest%C3%B5es-para-aprofundamento)

---

## Conceitos Fundamentais

O IPAM (IP Address Management) √© a parte do Docker Compose que cuida da gest√£o de endere√ßos IP em redes definidas no Compose. Ele permite:

- **Definir sub-redes** em formato CIDR, evitando sobreposi√ß√£o de intervalos.
- **Estabelecer faixas espec√≠ficas** (`ip_range`) para containers, mantendo o restante da sub-rede livre para outros usos.
- **Configurar gateways** customizados, controlando a sa√≠da/padr√£o de roteamento.
- **Reservar endere√ßos auxiliares** para hosts ou servi√ßos especiais.
    
    Estas funcionalidades s√£o essenciais para ambientes com m√∫ltiplos projetos ou microservi√ßos, garantindo previsibilidade e isolamento de rede ([stackoverflow.com](https://stackoverflow.com/questions/50432734/what-is-the-purpose-of-the-ipam-key-in-a-docker-compose-config?utm_source=chatgpt.com), [docs.docker.com](https://docs.docker.com/reference/compose-file/networks/?utm_source=chatgpt.com)).
    

---

## Sintaxe Detalhada e Uso Pr√°tico

A seguir, a estrutura completa do bloco `ipam` em `networks`:

```yaml
networks:
  <nome_da_rede>:
    driver: <driver>       # opcional, padr√£o √© 'bridge' ou 'default' no Compose v2/v3
    ipam:
      driver: <ipam-driver>    # opcional, padr√£o √© 'default'
      config:                  # lista de configura√ß√µes de sub-rede
        - subnet: <CIDR>       # ex: 172.28.0.0/16
          ip_range: <CIDR>     # ex: 172.28.5.0/24
          gateway: <IP>        # ex: 172.28.5.254
          aux_addresses:       # endere√ßos IP reservados mapeados por nome
            host1: 172.28.1.5
            host2: 172.28.1.6
      options:                 # op√ß√µes espec√≠ficas do driver de IPAM
        <chave>: <valor>

```

### Campos de destaque

- **`driver`** em `ipam`: escolhe o mecanismo de aloca√ß√£o de IPs (padr√£o √© `default`).
- **`config`**: lista de blocos, cada um definindo uma sub-rede e seus par√¢metros.
- **`subnet`**: sub-rede principal em formato CIDR.
- **`ip_range`**: intervalo dentro da sub-rede reservado para containers.
- **`gateway`**: IP do roteador padr√£o para essa sub-rede.
- **`aux_addresses`**: mapeamento de nomes para IPs auxiliares.
- **`options`**: configura√ß√µes avan√ßadas passadas ao driver (por exemplo, chaves espec√≠ficas de plugins) ([docs.docker.com](https://docs.docker.com/reference/compose-file/networks/?utm_source=chatgpt.com), [warp.dev](https://www.warp.dev/terminus/docker-compose-networks?utm_source=chatgpt.com)).

---

## Cen√°rios de Restri√ß√£o ou N√£o Aplica√ß√£o

- **Vers√µes do Compose**: no Compose V3.x, algumas op√ß√µes de IPAM (como `gateway` customizado) podem n√£o ser totalmente honradas; para suporte completo, use V2.x ([github.com](https://github.com/docker/compose/issues/6569?utm_source=chatgpt.com), [stackoverflow.com](https://stackoverflow.com/questions/57447078/default-network-gateway-value-for-docker-compose-version-3?utm_source=chatgpt.com)).
- **Redes Externas** (`external: true`): ao referenciar uma rede j√° existente, o Docker Compose ignora defini√ß√µes internas de IPAM.
- **Modos de Rede Especiais**: `network_mode: host` ou `none` n√£o utilizam IPAM, pois n√£o gerenciam redes isoladas pelo Compose.

---

## Componentes Chave Associados

- **`ipam.driver`**: determina o plugin ou driver de IPAM (por exemplo, `default`, `overlay`).
- **`ipam.config[].subnet`**: define a sub-rede principal.
- **`ipam.config[].ip_range`**: especifica o intervalo de IPs para containers.
- **`ipam.config[].gateway`**: gateway padr√£o da sub-rede.
- **`ipam.config[].aux_addresses`**: endere√ßos reservados mapeados a nomes de host.
- **`ipam.options`**: par√¢metros avan√ßados para o driver de IPAM.
- **Atributos de servi√ßo**: dentro de `services.<nome>.networks`, use `ipv4_address`/`ipv6_address` para atribuir IP est√°tico em redes com IPAM configurado ([docs.docker.com](https://docs.docker.com/reference/compose-file/networks/?utm_source=chatgpt.com), [warp.dev](https://www.warp.dev/terminus/docker-compose-networks?utm_source=chatgpt.com)).

---

## Melhores Pr√°ticas e Padr√µes de Uso

- **Defina redes customizadas** em vez da default, para melhor controle de isolamento e nomea√ß√£o de recursos ([nandovillalba.medium.com](https://nandovillalba.medium.com/docker-compose-tricks-and-best-practices-5e7e43eba8eb?utm_source=chatgpt.com)).
- **Use nomes sem√¢nticos** (e.g., `frontend-net`, `backend-db`) para facilitar entendimento e manuten√ß√£o ([nandovillalba.medium.com](https://nandovillalba.medium.com/docker-compose-tricks-and-best-practices-5e7e43eba8eb?utm_source=chatgpt.com)).
- **Evite IPs est√°ticos sem necessidade**; confie no servi√ßo de descoberta por nome e deixe o Docker alocar IPs dinamicamente, reduzindo riscos de conflito ([forums.docker.com](https://forums.docker.com/t/using-docker-compose-network-to-give-a-service-a-fixed-ip-address/116813?utm_source=chatgpt.com)).
- **Organize sub-redes por ambiente** (dev, staging, prod) e documente as faixas alocadas.

---

## Exemplo Pr√°tico Completo

```yaml
version: '3.8'

services:
  web:
    image: nginx:alpine
    networks:
      app_net:
        ipv4_address: 172.28.5.10

  db:
    image: postgres:13
    environment:
      POSTGRES_PASSWORD: changeme
    networks:
      app_net:
        ipv4_address: 172.28.5.11

networks:
  app_net:
    driver: bridge
    ipam:
      driver: default
      config:
        - subnet: 172.28.0.0/16
          ip_range: 172.28.5.0/24
          gateway: 172.28.5.254
      options:
        com.example.foo: bar

```

Neste exemplo, definimos uma rede `app_net` com IPAM completo, atribuindo IPs est√°ticos aos servi√ßos `web` e `db`, garantindo isolamento e controle de endere√ßamento ([docs.docker.com](https://docs.docker.com/reference/compose-file/networks/?utm_source=chatgpt.com), [warp.dev](https://www.warp.dev/terminus/docker-compose-networks?utm_source=chatgpt.com)).

---

## Sugest√µes para Aprofundamento

- üìñ [Documenta√ß√£o oficial de redes no Compose](https://docs.docker.com/reference/compose-file/networks/)
- üê≥ [Docker Networking Design Philosophy (blog)](https://www.docker.com/blog/docker-networking-design-philosophy)
- üîç Pesquise ‚ÄúDocker Compose IPAM tutorial‚Äù em blogs e f√≥runs para casos pr√°ticos de troubleshooting.

---