# enable_ipv6

# Atributo `enable_ipv6` em `networks` do Docker Compose: Guia Detalhado

## Introdução

O Docker Compose permite orquestrar múltiplos contêineres Docker em ambientes de desenvolvimento e produção. Entre os diversos recursos de rede oferecidos, o atributo `enable_ipv6` na definição de redes habilita a atribuição de endereços IPv6, ampliando a conectividade além do IPv4 tradicional ([docs.docker.com](https://docs.docker.com/reference/compose-file/networks/?utm_source=chatgpt.com)).

## Sumário

1. [Conceitos Fundamentais](https://chatgpt.com/c/6859817f-01e8-8013-9e5a-cbb14e4c689f#conceitos-fundamentais)
2. [Sintaxe Detalhada e Uso Prático](https://chatgpt.com/c/6859817f-01e8-8013-9e5a-cbb14e4c689f#sintaxe-detalhada-e-uso-pr%C3%A1tico)
3. [Cenários de Restrição ou Não Aplicação](https://chatgpt.com/c/6859817f-01e8-8013-9e5a-cbb14e4c689f#cen%C3%A1rios-de-restri%C3%A7%C3%A3o-ou-n%C3%A3o-aplica%C3%A7%C3%A3o)
4. [Componentes-Chave Associados](https://chatgpt.com/c/6859817f-01e8-8013-9e5a-cbb14e4c689f#componentes-chave-associados)
5. [Melhores Práticas e Padrões de Uso](https://chatgpt.com/c/6859817f-01e8-8013-9e5a-cbb14e4c689f#melhores-pr%C3%A1ticas-e-padr%C3%B5es-de-uso)
6. [Exemplo Prático Completo](https://chatgpt.com/c/6859817f-01e8-8013-9e5a-cbb14e4c689f#exemplo-pr%C3%A1tico-completo)
7. [Sugestões para Aprofundamento](https://chatgpt.com/c/6859817f-01e8-8013-9e5a-cbb14e4c689f#sugest%C3%B5es-para-aprofundamento)

---

## Conceitos Fundamentais

- **Redes no Compose:** O bloco `networks` em um arquivo Compose define redes nomeadas que serviços podem compartilhar ([docs.docker.com](https://docs.docker.com/reference/compose-file/networks/?utm_source=chatgpt.com)).
- **IPv6 no Docker:** Por padrão, redes user-defined suportam apenas IPv4; ao ativar o atributo `enable_ipv6`, o Docker Engine aloca endereços IPv6 para contêineres nessa rede ([docs.docker.com](https://docs.docker.com/reference/compose-file/networks/?utm_source=chatgpt.com)).
- **Motivação:** Com o esgotamento de IPv4 e a adoção crescente de IPv6, habilitar IPv6 em ambientes de contêineres garante compatibilidade com redes modernas e a possibilidade de comunicação nativa em IPv6.

---

## Sintaxe Detalhada e Uso Prático

A seguir, a estrutura básica e variações de uso do atributo `enable_ipv6`:

```yaml
version: "3.8"  # Versão do Compose File, compatível com o atributo

services:
  web:
    image: nginx:latest
    ports:
      - "80:80"
    networks:
      - ipv6net  # Conecta o serviço à rede ipv6net

networks:
  ipv6net:
    driver: bridge         # Driver de rede (bridge é o padrão para redes locais)
    enable_ipv6: true      # Habilita atribuição de endereços IPv6 pelo Docker :contentReference[oaicite:3]{index=3}

```

Para especificar uma sub-rede IPv6 fixa, combinamos `enable_ipv6` com a seção `ipam`:

```yaml
networks:
  ip6net:
    enable_ipv6: true      # Ativa IPv6 dinâmico ou estático
    ipam:
      driver: default
      config:
        - subnet: "2001:db8:abcd:1::/64"   # Define um prefixo IPv6 específico :contentReference[oaicite:4]{index=4}
          gateway: "2001:db8:abcd:1::1"   # (Opcional) Define gateway IPv6

```

Comentários:

- `driver`: define o tipo de rede (ex.: `bridge`, `overlay`, `macvlan`).
- `ipam.config`: permite configurar sub-redes IPv4 e IPv6 de forma granular.

---

## Cenários de Restrição ou Não Aplicação

1. **Docker Daemon Sem IPv6:** É necessário habilitar IPv6 no Docker Engine adicionando em `/etc/docker/daemon.json`:
    
    ```json
    {
      "ipv6": true,
      "fixed-cidr-v6": "2001:db8::/64"
    }
    
    ```
    
    Sem isso, `enable_ipv6` não terá efeito ([docs.docker.com](https://docs.docker.com/engine/daemon/ipv6/?utm_source=chatgpt.com)).
    
2. **Suporte a IPv6 no Host:** IPv6 só é suportado em hosts Linux; em ambientes Windows ou macOS sem suporte nativo, a rede IPv6 pode não funcionar ([docs.docker.com](https://docs.docker.com/engine/daemon/ipv6/?utm_source=chatgpt.com)).
3. **Compose File Version Antiga:** Versões iniciais do Compose v3 (por volta de 3.0) não reconheciam `enable_ipv6`; recomenda-se usar Compose CLI atualizado (≥ 1.29) ou especificar versão ≥ `2.1` ([github.com](https://github.com/docker/compose/issues/4958?utm_source=chatgpt.com)).
4. **Redes Externas:** Ao referenciar redes externas (`external: true`), atributos como `enable_ipv6` são ignorados, pois o Compose não cria a rede ([docs.docker.com](https://docs.docker.com/reference/compose-file/networks/?utm_source=chatgpt.com)).

---

## Componentes-Chave Associados

- **`driver_opts`:** Permite passar opções específicas ao driver, como ajustes de ponte (`bridge`), embora não exista uma opção genérica para IPv6 via `driver_opts`.
- **`ipam`:**
    - `driver`: define o provedor de IPAM (geralmente `default`).
    - `config`: lista de objetos com `subnet`, `gateway` e `aux_addresses`.
- **`internal`:** Quando `true`, restringe a rede a tráfego interno, tanto IPv4 quanto IPv6.
- **`labels`:** Rótulos Docker que podem ser usados em tooling externo para classificar redes IPv6.

---

## Melhores Práticas e Padrões de Uso

- **Planejar Prefixos IPv6:** Use ULAs (Unique Local Addresses) para ambientes internos e evite prefixos públicos sem necessidade.
- **Configurar Pools Dinâmicos:** Sem sub-rede explícita, o Docker usa pools ULAs padrão para IPv6; para controle, configure `default-address-pools` no daemon ([docs.docker.com](https://docs.docker.com/engine/daemon/ipv6/?utm_source=chatgpt.com)).
- **Testes de Conectividade:** Após criar a rede, valide com:
    
    ```bash
    docker run --rm --network ip6net traefik/whoami curl -g http://[2001:db8::2]
    
    ```
    
- **Documentar Versões:** Registre versão do Compose CLI e esquema (`version:` no YAML) para manter reproducibilidade.
- **Isolar Ambientes:** Use redes separadas (e.g., `dev`, `prod`) com prefixos IPv6 distintos para evitar conflitos.

---

## Exemplo Prático Completo

Suponha um cenário em que você deseje executar um serviço web acessível via IPv4 e IPv6, usando prefixo ULA interno e gateway customizado:

```yaml
# docker-compose.yml
version: "3.8"

services:
  web:
    image: nginx:stable
    ports:
      - "80:80"       # Publica porta 80 para IPv4 e IPv6
    networks:
      - public_net

networks:
  public_net:
    driver: bridge
    enable_ipv6: true     # Habilita IPv6 para esta rede :contentReference[oaicite:10]{index=10}
    ipam:
      driver: default
      config:
        - subnet: "fd00:1234:5678:1::/64"  # Prefixo ULA
          gateway: "fd00:1234:5678:1::1"

```

**Passos para rodar e testar:**

1. Configure `/etc/docker/daemon.json` para suportar IPv6 e reinicie o daemon.
2. Execute `docker-compose up -d`.
3. Verifique atribuição de IPs:
    
    ```bash
    docker network inspect public_net
    
    ```
    
4. Teste acesso IPv6:
    
    ```bash
    curl -g http://[fd00:1234:5678:1::1]
    
    ```
    

---

## Sugestões para Aprofundamento

- [Networking in Compose File Reference](https://docs.docker.com/compose/compose-file/#networks) ([docs.docker.com](https://docs.docker.com/reference/compose-file/networks/?utm_source=chatgpt.com))
- [Docker Engine IPv6 Guide](https://docs.docker.com/engine/daemon/ipv6/) ([docs.docker.com](https://docs.docker.com/engine/daemon/ipv6/?utm_source=chatgpt.com))
- [Compose Spec – Networks](https://github.com/compose-spec/compose-spec/blob/main/06-networks.md)
- Artigos e tutoriais sobre IPv6 com Docker no Medium e fóruns oficiais.

> Próximos passos: garanta que seu ambiente de produção e CI/CD estejam preparados para rede IPv6, atualize sistemas de monitoramento e logging para lidar com múltiplos protocolos de rede.
>