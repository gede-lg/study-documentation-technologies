# external

**Entendendo o Atributo `external` na Chave `networks` do Docker Compose**

---

## 1. Introdução

Docker Compose é uma ferramenta que permite definir e rodar aplicações multi-container via um arquivo YAML. Nesse contexto, o tópico **networks** representa a forma como serviços se conectam em nível de rede dentro de um *scope* de projeto. O atributo `external`, dentro desse bloco, instrui o Compose a não tentar criar certas redes, conectando os containers apenas a redes já existentes fora do ciclo de vida do Compose ([docs.docker.com](https://docs.docker.com/reference/compose-file/networks/?utm_source=chatgpt.com), [docs.docker.com](https://docs.docker.com/reference/compose-file/networks/?utm_source=chatgpt.com)).

---

## 2. Sumário

1. [Conceitos Fundamentais](https://chatgpt.com/c/6859817f-01e8-8013-9e5a-cbb14e4c689f#3-conceitos-fundamentais)
2. [Sintaxe Detalhada e Uso Prático](https://chatgpt.com/c/6859817f-01e8-8013-9e5a-cbb14e4c689f#4-sintaxe-detalhada-e-uso-pr%C3%A1tico)
3. [Cenários de Restrição ou Não Aplicação](https://chatgpt.com/c/6859817f-01e8-8013-9e5a-cbb14e4c689f#5-cen%C3%A1rios-de-restri%C3%A7%C3%A3o-ou-n%C3%A3o-aplica%C3%A7%C3%A3o)
4. [Componentes Chave Associados](https://chatgpt.com/c/6859817f-01e8-8013-9e5a-cbb14e4c689f#6-componentes-chave-associados)
5. [Melhores Práticas e Padrões de Uso](https://chatgpt.com/c/6859817f-01e8-8013-9e5a-cbb14e4c689f#7-melhores-pr%C3%A1ticas-e-padr%C3%B5es-de-uso)
6. [Exemplo Prático Completo](https://chatgpt.com/c/6859817f-01e8-8013-9e5a-cbb14e4c689f#8-exemplo-pr%C3%A1tico-completo)
7. [Sugestões para Aprofundamento](https://chatgpt.com/c/6859817f-01e8-8013-9e5a-cbb14e4c689f#9-sugest%C3%B5es-para-aprofundamento)

---

## 3. Conceitos Fundamentais

- **Rede Default:** Por padrão, ao executar `docker compose up`, o Compose cria uma rede com nome `<projeto>_default`, onde `<projeto>` é baseado no nome do diretório ou na variável `COMPOSE_PROJECT_NAME` ([docs.docker.com](https://docs.docker.com/compose/how-tos/networking/?utm_source=chatgpt.com)).
- **Rede Externa (`external: true`):** Indica que a rede foi provisionada fora do Compose. O Compose **não** a cria e **falha** se ela não existir ([docs.docker.com](https://docs.docker.com/reference/compose-file/networks/?utm_source=chatgpt.com), [stackoverflow.com](https://stackoverflow.com/questions/59673164/docker-compose-what-does-external-property-signify-under-networks?utm_source=chatgpt.com)).
- **Importância:** Usar `external` é essencial quando múltiplos projetos Docker precisam compartilhar a mesma rede ou quando se quer conectar um serviço a redes como `host` ou `none`.

---

## 4. Sintaxe Detalhada e Uso Prático

```yaml
version: "3.8"

services:
  proxy:
    image: example/proxy
    networks:
      - outside
      - default

  app:
    image: example/app
    networks:
      - default

networks:
  # Conecta ao network 'outside' já existente (fora do Compose)
  outside:
    external: true

  # Mantém a criação da rede default (sem marcação external)
  default:
    driver: bridge

```

- **Atributo `external: true`:** flag booleana ([docs.docker.com](https://docs.docker.com/reference/compose-file/networks/?utm_source=chatgpt.com)).
- **Atributo `name`:** quando o nome interno (`outside`) difere do nome real da rede Docker, especifique:
    
    ```yaml
    networks:
      shared-net:
        external: true
        name: redis_network
    
    ```
    
    Isso conecta o serviço `shared-net` à rede Docker `redis_network` ([warp.dev](https://www.warp.dev/terminus/docker-compose-networks?utm_source=chatgpt.com)).
    

> Nota de variação: Em algumas versões mais antigas ou exemplos da comunidade, você verá:
> 
> 
> ```yaml
> networks:
>   custom:
>     external:
>       name: custom_network
> 
> ```
> 
> Essa sintaxe é equivalente, mas o padrão oficial atual aceita `external: true` + `name` no mesmo nível ([forums.docker.com](https://forums.docker.com/t/how-to-configure-docker-networking-with-docker-compose-to-enable-remote-access-to-docker-container-via-ip/96990?utm_source=chatgpt.com)).
> 

---

## 5. Cenários de Restrição ou Não Aplicação

- Se `external: true` **não** encontrar a rede pré-existente, o Compose aborta com erro.
- **Somente** o atributo `name` (para mapear o nome real) é válido em conjunto com `external`; qualquer outro atributo (ex.: `driver`, `ipam`) gera erro de validação ([docs.docker.com](https://docs.docker.com/reference/compose-file/networks/?utm_source=chatgpt.com)).
- `external` **só** se aplica no bloco top-level `networks:`; não há `external` dentro do bloco de serviço.

---

## 6. Componentes Chave Associados

Além de `external` e `name`, a chave `networks` suporta:

- **`driver`**: tipo de driver (e.g., `bridge`, `overlay`).
- **`ipam`**: configurações de IPAM (subnets, gateways, aux_addresses).
- **`internal`**: se `true`, isola a rede de conexões externas.
- **`attachable`**: permite que containers CLI se conectem manualmente.
- **`enable_ipv4` / `enable_ipv6`**: habilitam/desabilitam atribuição de IP v4/v6.
- **`labels`**: metadados arbitrários.

Esses atributos **não** são válidos quando `external: true`, exceto `name` ([docs.docker.com](https://docs.docker.com/reference/compose-file/networks/?utm_source=chatgpt.com)).

---

## 7. Melhores Práticas e Padrões de Uso

1. **Pré-criação de Redes:** Crie redes externas com `docker network create <nome>` antes de usar em Compose ([stackoverflow.com](https://stackoverflow.com/questions/59673164/docker-compose-what-does-external-property-signify-under-networks?utm_source=chatgpt.com)).
2. **Consistência de Nomes:** Use convenções claras (e.g., `shared_db_net`, `backend_net`) para facilitar identificação entre projetos.
3. **Compartilhamento entre Projetos:** Utilize `external: true` para conectar múltiplos projetos à mesma rede, sem recriação acidental.
4. **Evitar Sobrecarga de Atributos:** Limite-se a `external` e `name` em redes externas para evitar conflitos de versão ou validação.

---

## 8. Exemplo Prático Completo

Imagine dois projetos concordantes: **cache** e **webapp**, que devem compartilhar uma rede `redis_net`.

1. **Pré-criar a rede**
    
    ```bash
    docker network create redis_net
    
    ```
    
2. **Projeto `cache/docker-compose.yml`**
    
    ```yaml
    version: "3.8"
    
    services:
      redis:
        image: redis:latest
        networks:
          - redis_net
    
    networks:
      redis_net:
        name: redis_net
        external: true
    
    ```
    
3. **Projeto `webapp/docker-compose.yml`**
    
    ```yaml
    version: "3.8"
    
    services:
      app:
        build: .
        networks:
          - redis_net
    
    networks:
      redis_net:
        external: true
        name: redis_net
    
    ```
    

Ao rodar `docker compose up` em cada projeto, ambos conectarão seus containers à rede `redis_net` pré-existente, sem que nenhum deles a (re)crie ([warp.dev](https://www.warp.dev/terminus/docker-compose-networks?utm_source=chatgpt.com), [stackoverflow.com](https://stackoverflow.com/questions/59673164/docker-compose-what-does-external-property-signify-under-networks?utm_source=chatgpt.com)).

---

## 9. Sugestões para Aprofundamento

- **Documentação Oficial Compose**
    
    [https://docs.docker.com/compose/compose-file/compose-file-v3/#networks](https://docs.docker.com/compose/compose-file/compose-file-v3/#networks) ([docs.docker.com](https://docs.docker.com/reference/compose-file/networks/?utm_source=chatgpt.com))
    
- **Compose Specification**
    
    [https://github.com/compose-spec/compose-spec/blob/main/06-networks.md](https://github.com/compose-spec/compose-spec/blob/main/06-networks.md)
    
- **Artigos de Blog e How-Tos**
    
    *How to Create and Use Networks in Docker Compose* (Warp)
    
- **Perguntas Frequentes (StackOverflow)**
    
    *“What does external property signify under networks?”*
    

---

*Espero que este guia detalhado ajude você a entender e aplicar corretamente o atributo `external` em suas definições de rede no Docker Compose!*