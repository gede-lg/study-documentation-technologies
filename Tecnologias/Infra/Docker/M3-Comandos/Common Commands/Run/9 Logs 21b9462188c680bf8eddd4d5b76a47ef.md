# 9. Logs

---

Os parâmetros de log permitem configurar como o Docker coleta, armazena e roteia as saídas dos contêineres, integrando-os a sistemas de monitoramento e análise.

---

### 9.1 `-log-driver string`

- **Sintaxe**
    
    ```bash
    --log-driver=json-file
    --log-driver=syslog
    --log-driver=journald
    --log-driver=gelf
    --log-driver=fluentd
    --log-driver=awslogs
    
    ```
    
- **Descrição**
    
    Seleciona o driver de log para o contêiner, definindo o backend que receberá stdout e stderr.
    
- **Conceito de Uso**
    - **json-file** (padrão): armazena logs localmente em formato JSON, sob `/var/lib/docker/containers/<id>/<id>-json.log`.
    - **syslog**: envia mensagens para o daemon syslog do host.
    - **journald**: integra com o systemd-journald.
    - **gelf**: envia via UDP/TCP a um servidor Graylog ou compatível.
    - **fluentd**: envia para um agente Fluentd.
    - **awslogs**, **splunk**, **etwlogs**, **gcplogs**, **logentries**: drivers cloud/terceiros.
- **Propriedades Internas**
    - Define `HostConfig.LogConfig.Type` no JSON de criação do contêiner.
    - Ao iniciar, o Docker libera um pipe para stdout/stderr e o conecta ao driver especificado, que trata a formatação e o transporte.
- **Exemplo**
    
    ```bash
    # Usar syslog para centralizar no /var/log/syslog do host
    docker run -d \
      --log-driver=syslog \
      nginx
    
    # Enviar para Fluentd ouvindo em localhost:24224
    docker run -d \
      --log-driver=fluentd \
      nginx
    
    ```
    

---

### 9.2 `-log-opt list`

- **Sintaxe**
    
    ```bash
    --log-opt max-size=10m
    --log-opt max-file=3
    --log-opt tag="{{.ImageName}}/{{.Name}}/{{.ID}}"
    --log-opt syslog-address=udp://192.168.0.42:514
    --log-opt fluentd-address=localhost:24224
    --log-opt gelf-address=udp://graylog.example.com:12201
    
    ```
    
- **Descrição**
    
    Especifica opções de configuração adicionais para o driver de log escolhido.
    
- **Formato & Sub-opções Comuns**
    - **json-file**
        - `max-size=<bytes|k|m|g>`: tamanho máximo de cada arquivo de log antes de rodar rotação (ex.: `10m`).
        - `max-file=<N>`: número máximo de arquivos de log rotacionados a manter.
        - `compress=<true|false>` (em versões mais novas): comprimir logs antigos.
    - **syslog**
        - `syslog-address=<protocol>://<host>:<port>`: endereço do servidor.
        - `syslog-facility=<facility>`: facility (daemon, local0–local7).
        - `syslog-tag=<tag>`: marca a origem da mensagem.
    - **gelf** / **fluentd**
        - `tag=<string>`: template Go para tag (ex.: `{{.Name}}`).
        - `labels=<label1>,<label2>`: anexar labels como metadados.
        - `env=<VAR1>,<VAR2>`: anexar variáveis de ambiente.
    - **awslogs**
        - `awslogs-region=<region>`
        - `awslogs-group=<log-group>`
        - `awslogs-stream=<log-stream>`
- **Propriedades Internas**
    - Preenche `HostConfig.LogConfig.Config` com pares chave/valor; o driver recebe esse mapa para configurar sua conexão e rotação.
- **Exemplo**
    
    ```bash
    # Rotacionar logs JSON quando chegarem a 5 MB, mantendo até 3 arquivos
    docker run -d \
      --log-driver=json-file \
      --log-opt max-size=5m \
      --log-opt max-file=3 \
      myapp
    
    # Enviar a um servidor GELF com tag personalizada
    docker run -d \
      --log-driver=gelf \
      --log-opt gelf-address=udp://graylog.mydomain:12201 \
      --log-opt tag="{{.Name}}.{{.ID}}" \
      myapp
    
    ```
    

---

## Observações e Boas Práticas

1. **Centralização de Logs**
    - Para ambientes de produção, use drivers remotos (fluentd, gelf, awslogs) em vez de json-file, evitando encher o disco local e facilitando análise centralizada.
2. **Rotação e Retenção**
    - Sempre defina `max-size` e `max-file` no `json-file` para não ultrapassar limites de armazenamento.
3. **Metadados e Tags**
    - Utilize `-log-opt labels` e `-log-opt env` para anexar informações de contexto (versão, ambiente) aos eventos de log.
4. **Segurança**
    - Verifique se canais remotos (syslog, fluentd, gelf) estão criptografados ou em redes seguras para evitar vazamento de dados sensíveis.
5. **Compatibilidade**
    - Nem todos os drivers suportam as mesmas opções; sempre consulte a documentação do driver específico ao configurar `-log-opt`.

Com estas configurações, você controla completamente como seus contêineres registram e roteiam logs, garantindo eficiência, escalabilidade e segurança na coleta de dados operacionais.