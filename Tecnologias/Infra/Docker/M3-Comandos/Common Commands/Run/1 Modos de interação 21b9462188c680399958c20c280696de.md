# 1. Modos de interação

Aqui está uma versão muito mais detalhada da explicação de cada parâmetro de **`docker container run`**, abordando sintaxe, conceito de uso, comportamento interno e possíveis sub-opções:

---

## Visão Geral da Sintaxe

```bash
docker container run [OPÇÕES] IMAGEM [COMANDO] [ARG...]

```

- **`IMAGEM`**: nome (e tag) da imagem Docker a ser executada.
- **`COMANDO [ARG...]`**: comando (e seus argumentos) que será executado dentro do contêiner. Se omitido, será usado o *Entrypoint/CMD* definido na imagem.

---

## 1. Modos de Interação

### 1.1 `d`, `-detach`

- **Sintaxe**
    
    ```bash
    -d
    --detach
    
    ```
    
- **Descrição**
    
    Executa o contêiner em segundo plano (modo *background*) e imprime imediatamente o ID (hash) do contêiner.
    
- **Conceito de Uso**
    
    Use quando não precisar interagir com o processo em tempo real, por exemplo, para serviços de longa duração (bancos, web servers).
    
- **Propriedades Internas**
    - Aciona o campo `HostConfig.AutoRemove=false` (a não ser que se combine com `-rm`).
    - Define `containerConfig.DetachKeys` como padrão (`ctrl-p,ctrl-q`) ou conforme `-detach-keys`.
    - Retorna apenas o SHA256 do contêiner e encerra o CLI, deixando o daemon do Docker cuidando do processo.
- **Considerações & Exemplos**
    
    ```bash
    docker container run -d nginx
    # -> Inicio do nginx em background, imprime ID do contêiner.
    
    ```
    

---

### 1.2 `i`, `-interactive`

- **Sintaxe**
    
    ```bash
    -i
    --interactive
    
    ```
    
- **Descrição**
    
    Mantém aberto o canal STDIN do contêiner, mesmo que você não esteja anexado a um terminal.
    
- **Conceito de Uso**
    
    Esencial para iniciar shells ou aplicações que aguardam entrada do usuário (por exemplo, `bash`, `python` REPL).
    
- **Propriedades Internas**
    - Define `containerConfig.OpenStdin=true`.
    - Se combinado com `t`, habilita interatividade completa (linha a linha) via pseudo-TTY.
- **Exemplo**
    
    ```bash
    docker container run -i ubuntu cat
    # Você pode digitar texto e verá echo dele de volta.
    
    ```
    

---

### 1.3 `t`, `-tty`

- **Sintaxe**
    
    ```bash
    -t
    --tty
    
    ```
    
- **Descrição**
    
    Aloca um pseudo-TTY no contêiner, permitindo formatação de terminal (cores, teclas de controle, modo de edição de linha).
    
- **Conceito de Uso**
    
    Ideal em conjunto com `-i` para shells interativos, editores baseados em terminal ou qualquer app que detecta presença de TTY.
    
- **Propriedades Internas**
    - Configura `containerConfig.Tty=true`.
    - Faz com que o Docker crie um par de PTY (`/dev/ptmx` no host → `/dev/tty` no contêiner).
- **Combinações Comuns**
    
    ```bash
    docker container run -it ubuntu /bin/bash
    # -i mantém o stdin aberto; -t aloca terminal.
    
    ```
    

---

## 2. Limpeza Automática

### 2.1 `-rm`

- **Sintaxe**
    
    ```bash
    --rm
    
    ```
    
- **Descrição**
    
    Remove automaticamente o contêiner assim que o processo principal terminar, junto com volumes anônimos criados por `-v /data`.
    
- **Conceito de Uso**
    
    Evita acúmulo de contêineres/parados em cenários de testes, execuções pontuais ou CI/CD.
    
- **Propriedades Internas**
    - Define `HostConfig.AutoRemove=true`.
    - **Atenção**: não remove volumes nomeados explicitamente; apenas os gerados sem nome.
- **Exemplo**
    
    ```bash
    docker container run --rm busybox echo "hello"
    # Contêiner é criado, impressora “hello” no stdout e o contêiner some.
    
    ```
    

---

## 3. Identificação e Registro

### 3.1 `-name string`

- **Sintaxe**
    
    ```bash
    --name <nome_do_conteiner>
    
    ```
    
- **Descrição**
    
    Atribui um nome amigável e estático ao contêiner (em vez do nome aleatório gerado).
    
- **Conceito de Uso**
    
    Facilita referência em comandos subsequentes (`docker stop nome_do_conteiner`).
    
- **Restrições de Nome**
    - Deve começar com letra ou número, podendo conter  ou `_`.
    - Case-sensitive.
    - Único por host; tentar usar nome existente resulta em erro.
- **Propriedades Internas**
    - Preenche `ContainerCreateRequest.Name`.
- **Exemplo**
    
    ```bash
    docker container run --name meu-mysql -e MYSQL_ROOT_PASSWORD=123 mysql
    
    ```
    

### 3.2 `-cidfile string`

- **Sintaxe**
    
    ```bash
    --cidfile /caminho/para/arquivo.cid
    
    ```
    
- **Descrição**
    
    Escreve o ID do contêiner recém-criado no arquivo especificado.
    
- **Conceito de Uso**
    
    Útil em scripts de automação: lê-se o arquivo para manipular o contêiner depois (stop, logs, inspect).
    
- **Propriedades Internas**
    - Ao criar o contêiner, o Docker faz um `os.WriteFile(path, containerID)` após o `CreateContainer`.
- **Exemplo em Script**
    
    ```bash
    docker container run --cidfile /tmp/meucid.cid alpine sleep 60
    CID=$(cat /tmp/meucid.cid)
    docker container logs $CID
    
    ```
    

---

## 4. Sequência de Desanexar Interativo

### 4.1 `-detach-keys string`

- **Sintaxe**
    
    ```bash
    --detach-keys="ctrl-p,ctrl-q"
    # ou
    --detach-keys="ctrl-x,ctrl-y"
    
    ```
    
- **Descrição**
    
    Define a combinação de teclas para “desanexar” de um contêiner rodando em modo interativo (`-it`) sem pará-lo.
    
- **Conceito de Uso**
    
    Quando o padrão (`ctrl-p,ctrl-q`) conflita com a aplicação em execução (editores, jogos, etc).
    
- **Formato & Sub-parâmetros**
    - Lista de duas seqüências, separadas por vírgula, cada uma no formato `ctrl-<letra>` ou `ctrl-<ascii>`.
- **Propriedades Internas**
    - Ajusta `HostConfig.DetachKeys` antes de `docker attach`.
- **Exemplo**
    
    ```bash
    docker container run -it --detach-keys="ctrl-x,ctrl-y" ubuntu bash
    
    ```
    

---

## 5. Exemplos Completos

```bash
# 1. Servidor Nginx em background, nome “web”, com remoção ao parar:
docker container run -d --name web --rm nginx

# 2. Shell Ubuntu interativo, custom detach keys, CID em arquivo:
docker container run -it --detach-keys="ctrl-x,ctrl-y" --cidfile ./cid.txt ubuntu /bin/bash

# 3. Pipeline em script usando CIDFILE:
docker container run --cidfile=/tmp/cid alpine sleep 30
CID=$(cat /tmp/cid)
docker container logs $CID
docker container rm $CID

```

---

### Observações Finais

- **Combinações Inválidas**
    - `d` e `it` juntos: você estará em background sem *TTY* ou *stdin*; geralmente inútil.
- **Persistência de Dados**
    - `-rm` não afeta volumes nomeados (`v nome_volume:/data`); só remove volumes anônimos.
- **Boa Prática**
    - Sempre escolha `-name` ou `-cidfile` em scripts, facilita debug e automação.
    - Use `-detach-keys` para não “trav­­ar” sua sessão interativa em aplicações sensíveis a `ctrl-p/q`.

Com isso, você tem uma visão profunda de cada parâmetro, desde a sintaxe CLI até o impacto na configuração interna do daemon Docker. Qualquer dúvida, só falar!