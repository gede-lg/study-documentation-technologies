# 11. Content Trust

---

Os parâmetros de Content Trust controlam a verificação de assinaturas nas imagens Docker, garantindo que você só execute imagens autenticadas pelo autor pretendido.

---

### 11.1 `-disable-content-trust`

- **Sintaxe**
    
    ```bash
    --disable-content-trust
    
    ```
    
    (não aceita valor; basta incluí-lo para desabilitar a verificação)
    
- **Descrição**
    
    Ao realizar um `docker pull`, **ignora** a verificação de assinatura Notary/TUF que o Docker Content Trust realiza por padrão quando está habilitado.
    
- **Conceito de Uso**
    - **Habilitado por padrão** (desde Docker 1.10) quando a variável de ambiente `DOCKER_CONTENT_TRUST=1` está ativa.
    - Use `-disable-content-trust` para fazer pull de imagens mesmo que não possuam assinatura ou se a verificação de assinatura falhar.
    - Útil em cenários de **desenvolvimento**, pipelines CI legados, ou quando você confia explicitamente na fonte, mas precisa ignorar temporariamente falhas de assinatura.
- **Propriedades Internas**
    - Sob o capô, o cliente Docker gerencia o Content Trust via Notary:
        1. Ao puxar (`pull`), o Docker consulta o servidor Notary para obter metadados de assinatura.
        2. Se `DOCKER_CONTENT_TRUST=1` **e** `-disable-content-trust` **não** for passado, ele valida a assinatura da imagem contra as chaves do repositório.
        3. Com `-disable-content-trust`, o Docker pula **todos** os passos de consulta e validação Notary/TUF, tratando a imagem como se não houvesse Content Trust configurado.
    - Não modifica o daemon (server-side); é um parâmetro apenas do cliente CLI.
- **Exemplo**
    
    ```bash
    # Sem Content Trust (ignora assinatura, mesmo que DOCKER_CONTENT_TRUST=1)
    docker pull --disable-content-trust myregistry.com/minha-imagem:latest
    
    # Mesmo que a variável esteja setada no escopo do terminal:
    export DOCKER_CONTENT_TRUST=1
    docker pull --disable-content-trust ubuntu:20.04
    
    ```
    

---

## Observações e Boas Práticas

1. **Segurança vs. Conveniência**
    - **Não** deixe `-disable-content-trust` em uso contínuo em produção — você estará executando imagens sem garantia de autoria e integridade.
    - Prefira assinar suas próprias imagens ou exigir que a equipe de DevOps publique imagens assinadas corretamente no repositório.
2. **Configuração Permanente**
    - Para desabilitar trust globalmente em um host, você pode exportar:
        
        ```bash
        export DOCKER_CONTENT_TRUST=0
        
        ```
        
        Mas isso afeta **todos** os pulls e pushes, não apenas a operação pontual.
        
3. **Integração CI/CD**
    - Em pipelines de CI, condicione `-disable-content-trust` apenas em etapas de build/test; nas etapas de deploy, garanta imagens assinadas e evite desativar a verificação.
4. **Verificando Assinaturas**
    - Para forçar a verificação manualmente, defina:
        
        ```bash
        export DOCKER_CONTENT_TRUST=1
        
        ```
        
        e **não** passe o flag, garantindo que imagens não assinadas **falhem** no pull.
        

Com isso, você entende como gerenciar Docker Content Trust e quando (ou não) desabilitá-lo em suas operações de pull.