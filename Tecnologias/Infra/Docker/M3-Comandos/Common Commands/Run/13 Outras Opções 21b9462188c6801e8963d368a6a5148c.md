# 13. Outras Opções

---

Estas opções fornecem controle sobre o comportamento geral do contêiner, desde como o comando é invocado até políticas de pull, sinais de parada e ajustes de kernel.

---

### 13.1 `-entrypoint string`

- **Sintaxe**
    
    ```bash
    --entrypoint="/bin/sh"
    --entrypoint='["/usr/local/bin/my-init","--flag"]'
    
    ```
    
- **Descrição**
    
    Substitui o `ENTRYPOINT` definido na imagem Docker, especificando diretamente o executável ou array de argumentos.
    
- **Conceito de Uso**
    
    – Permite executar um shell interativo ou outro programa em vez do entrypoint padrão;
    
    – Útil para debugging ou wrappers de inicialização personalizados.
    
- **Propriedades Internas**
    
    – Ajusta `Config.Entrypoint` no JSON de criação do contêiner;
    
    – Se você usar JSON array, pula o shell, executando diretamente o binário.
    
- **Exemplo**
    
    ```bash
    # Forçar shell em vez do entrypoint da imagem
    docker run --entrypoint="/bin/sh" alpine
    
    # Usar um script de inicialização customizado
    docker run \
      --entrypoint='["/usr/local/bin/init-wrapper","--debug"]' \
      myapp:latest
    
    ```
    

---

### 13.2 `[COMMAND] [ARG...]`

- **Sintaxe**
    
    ```bash
    docker run myimage ls -la /data
    docker run --entrypoint=/bin/bash ubuntu -c "echo hello"
    
    ```
    
- **Descrição**
    
    Qualquer comando e argumentos posicionais após a imagem substituem o `CMD` da imagem.
    
- **Conceito de Uso**
    
    – Permite executar tarefas pontuais (scripts, debugging, inspeções) sem modificar a imagem;
    
    – Combinado com `--entrypoint`, oferece máxima flexibilidade de execução.
    
- **Propriedades Internas**
    
    – Preenche `Config.Cmd` no JSON de criação;
    
    – Se `ENTRYPOINT` existir, `Cmd` é passado como argumentos para ele; caso contrário, é executado diretamente.
    
- **Exemplo**
    
    ```bash
    # Substituindo apenas o CMD
    docker run ubuntu date
    
    # Combinando ENTRYPOINT e CMD
    docker run --entrypoint=/usr/bin/env ubuntu PATH=/usr/local/bin env
    
    ```
    

---

### 13.3 `-platform string`

- **Sintaxe**
    
    ```bash
    --platform=linux/amd64
    --platform=linux/arm64/v8
    
    ```
    
- **Descrição**
    
    Seleciona qual variante da imagem multi-plataforma baixar e executar, especificando `os/arch[/variant]`.
    
- **Conceito de Uso**
    
    – Força o uso de uma arquitetura específica em hosts que suportam múltiplos modos (ex.: Apple Silicon);
    
    – Garantir teste em diferentes arquiteturas sem modificar o host.
    
- **Propriedades Internas**
    
    – Usa o campo `platform` na API de pull (`ImagePullOptions.Platform`);
    
    – O daemon busca a imagem que corresponda ao `os`, `architecture` e `variant` indicados.
    
- **Exemplo**
    
    ```bash
    # Forçar amd64 mesmo em host arm64
    docker run --platform=linux/amd64 myimage
    
    # Rodar variante arm64v8 explicitamente
    docker run --platform=linux/arm64/v8 myimage
    
    ```
    

---

### 13.4 `-pull string`

- **Sintaxe**
    
    ```bash
    --pull=missing
    --pull=always
    --pull=never
    
    ```
    
- **Descrição**
    
    Política de pull de imagem:
    
    - **`missing`** (padrão): só faz pull se a imagem não existir localmente.
    - **`always`**: força pull sempre, independentemente de existir local.
    - **`never`**: nunca faz pull; falha se a imagem não existir local.
- **Conceito de Uso**
    
    – Controlar explicitamente o fluxo de rede e versão de imagem em pipelines ou scripts automatizados.
    
- **Propriedades Internas**
    
    – Define `ImagePullPolicy` em `ContainerCreateOptions`;
    
    – O daemon avalia antes de criar o contêiner.
    
- **Exemplo**
    
    ```bash
    # Garantir sempre a última versão da imagem
    docker run --pull=always myapp:latest
    
    # Usar apenas imagens já baixadas
    docker run --pull=never myapp:stable
    
    ```
    

---

### 13.5 `q`, `-quiet`

- **Sintaxe**
    
    ```bash
    -q
    --quiet
    
    ```
    
- **Descrição**
    
    Suprime a saída verbosa de operações de pull, mostrando apenas o ID do contêiner no final.
    
- **Conceito de Uso**
    
    – Em scripts que capturam o ID do contêiner;
    
    – Reduzir logs em pipelines CI.
    
- **Propriedades Internas**
    
    – Ajusta o nível de log do comando cliente, emitindo apenas saídas essenciais.
    
- **Exemplo**
    
    ```bash
    # Puxa e executa em background, retornando só o ID
    CID=$(docker run -d -q nginx)
    echo "Container iniciado: $CID"
    
    ```
    

---

### 13.6 `-sig-proxy[=true|false]`

- **Sintaxe**
    
    ```bash
    --sig-proxy       # padrão true
    --sig-proxy=false
    
    ```
    
- **Descrição**
    
    Controla se o Docker proxy de sinais do host (SIGINT, SIGTERM) é redirecionado para o PID 1 dentro do contêiner.
    
- **Conceito de Uso**
    
    – Em aplicações que gerenciam seus próprios handlers de sinal;
    
    – Prevenir dupla recepção de sinais (host + contêiner).
    
- **Propriedades Internas**
    
    – Configura `HostConfig.ProxySettings.ProxiedSignals`;
    
    – Quando `true`, o cliente Docker estabelece listener e repassa sinais para o container.
    
- **Exemplo**
    
    ```bash
    # Desabilitar proxy de sinais
    docker run --sig-proxy=false my-custom-init
    
    ```
    

---

### 13.7 `-stop-signal string`

- **Sintaxe**
    
    ```bash
    --stop-signal=SIGINT
    --stop-signal=SIGUSR1
    
    ```
    
- **Descrição**
    
    Define o sinal UNIX enviado ao PID 1 do contêiner quando se executa `docker stop` (padrão: `SIGTERM`).
    
- **Conceito de Uso**
    
    – Ajustar para aplicações que escutam sinais diferentes para shutdown gracioso;
    
    – Evitar forçar encerramentos bruscos.
    
- **Propriedades Internas**
    
    – Popula `HostConfig.StopSignal`;
    
    – `docker stop` envia esse sinal, depois aguarda `--stop-timeout` antes de `SIGKILL`.
    
- **Exemplo**
    
    ```bash
    docker run --stop-signal=SIGINT my-go-app
    
    ```
    

---

### 13.8 `-stop-timeout int`

- **Sintaxe**
    
    ```bash
    --stop-timeout=10
    
    ```
    
- **Descrição**
    
    Tempo máximo em segundos que o Docker aguarda após o `stop-signal` antes de enviar `SIGKILL`.
    
- **Conceito de Uso**
    
    – Dar mais tempo para shutdown gracioso em operações de flush ou limpeza;
    
    – Evitar encerramento forçado antes que recursos sejam liberados.
    
- **Propriedades Internas**
    
    – Ajusta `HostConfig.StopTimeout`;
    
    – `docker stop` faz:
    
    1. Sinaliza PID 1;
    2. Espera `StopTimeout` segundos;
    3. Envia `SIGKILL` se ainda ativo.
- **Exemplo**
    
    ```bash
    docker run --stop-signal=SIGQUIT --stop-timeout=20 my-service
    
    ```
    

---

### 13.9 `-shm-size bytes`

- **Sintaxe**
    
    ```bash
    --shm-size=64m
    --shm-size=1g
    
    ```
    
- **Descrição**
    
    Define o tamanho de `/dev/shm` (shared memory) no contêiner, padrão é 64 MiB no driver `bridge`.
    
- **Conceito de Uso**
    
    – Aplicações que usam POSIX shared memory (ex.: bancos de dados, IPC intensivo);
    
    – Evitar `ENOMEM` em cargas que alocam buffers grandes.
    
- **Propriedades Internas**
    
    – Equivalente a `--mount type=tmpfs,target=/dev/shm,tmpfs-size=<bytes>`;
    
    – Ajusta `HostConfig.ShmSize`.
    
- **Exemplo**
    
    ```bash
    docker run --shm-size=512m my-db
    
    ```
    

---

### 13.10 `-sysctl map`

- **Sintaxe**
    
    ```bash
    --sysctl net.ipv4.ip_forward=1
    --sysctl fs.inotify.max_user_watches=524288
    
    ```
    
- **Descrição**
    
    Aplica parâmetros `sysctl` (kernel) no namespace de kernel do contêiner.
    
- **Conceito de Uso**
    
    – Ajustar tuning de rede, file watchers ou outros parâmetros sem alterar o host;
    
    – Permitir ou restringir funcionalidades (por exemplo, IPv4 forwarding).
    
- **Propriedades Internas**
    
    – Para cada `key=value`, escreve em `/proc/sys/<key>` no namespace do contêiner antes de iniciar o processo.
    
- **Exemplo**
    
    ```bash
    docker run --sysctl net.core.somaxconn=1024 nginx
    
    ```
    

---

### 13.11 `-use-api-socket`

- **Sintaxe**
    
    ```bash
    --use-api-socket
    
    ```
    
- **Descrição**
    
    Monta o socket do Docker daemon (`/var/run/docker.sock`) dentro do contêiner, permitindo chamadas internas à API Docker.
    
- **Conceito de Uso**
    
    – Ferramentas de CI/CD ou agentes que precisam gerenciar outros contêineres;
    
    – Routers dinâmicos que criam e removem contêineres sob demanda.
    
- **Propriedades Internas**
    
    – Equivalente a `-v /var/run/docker.sock:/var/run/docker.sock`;
    
    – Adiciona entrada em `HostConfig.Binds`.
    
- **Exemplo**
    
    ```bash
    docker run -v /var/run/docker.sock:/var/run/docker.sock \
               docker/cli:latest ps
    
    ```
    

---

### 13.12 `-help`

- **Sintaxe**
    
    ```bash
    --help
    
    ```
    
- **Descrição**
    
    Exibe a mensagem de ajuda do comando `docker container run` e sai sem executar nada.
    
- **Conceito de Uso**
    
    – Consultar rapidamente sintaxe e opções disponíveis.
    
- **Propriedades Internas**
    
    – O cliente detecta `--help` e imprime automaticamente o texto de help gerado a partir do schema de comando.
    
- **Exemplo**
    
    ```bash
    docker run --help
    
    ```
    

---

## Observações e Boas Práticas

1. **Override vs. Inheritance**
    
    – `--entrypoint` e `[COMMAND] [ARG...]` dão poder total a cada execução, mas podem dificultar homogeneidade em scripts;
    
    – Prefira parametrizar via `CMD`/`ENTRYPOINT` na imagem se for uso recorrente.
    
2. **Políticas de Pull**
    
    – Use `--pull=always` em CI para garantir versões limpas;
    
    – Em produção, `missing` é suficiente se seu deploy pré-puxa imagens.
    
3. **Shutdown Gracioso**
    
    – Combine `--stop-signal` e `--stop-timeout` de acordo com o tempo de flush/cleanup da aplicação;
    
    – Exemplos: banco de dados pode precisar de mais tempo para fechar conexões.
    
4. **Namespace e Kernel**
    
    – `--sysctl` fornece ajustes finos sem tocar o host;
    
    – `--shm-size` é crítico para workloads HPC ou processos que trocam grande volume em `/dev/shm`.
    
5. **Segurança e Isolamento**
    
    – Montar o Docker socket (`--use-api-socket`) oferece grandes poderes, mas cuidado com elevação de privilégios;
    
    – Revise se realmente precisa desse acesso antes de fazê-lo.
    

Com essas opções, você tem o conjunto completo de knobs para controlar cada aspecto da inicialização, execução e encerramento de seus contêineres Docker.