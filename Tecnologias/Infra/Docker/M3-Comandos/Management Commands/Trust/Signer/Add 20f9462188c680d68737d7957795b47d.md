# Add

A seguir, uma explicação completa e estruturada do comando **`docker trust signer add`**, incluindo sintaxe, parâmetros, opções, fluxo de funcionamento e exemplos de uso.

---

## 1. O que faz este comando

O **`docker trust signer add`** permite **associar um assinante** (“signer”) a um ou mais repositórios Docker sob gerenciamento de confiança (Notary).

Ao adicionar um signer, você autoriza uma chave pública (pré-carregada ou gerada) a assinar imagens daquele repositório, reforçando o **Docker Content Trust**.

---

## 2. Sintaxe geral

```bash
docker trust signer add [OPTIONS] NAME REPOSITORY [REPOSITORY...]

```

- **`[OPTIONS]`**: flags que modificam o comportamento.
- **`NAME`**: nome do assinante a ser adicionado (ex.: usuário ou identificador da chave).
- **`REPOSITORY`**: nome(s) do(s) repositório(s) Docker ao qual(is) esse assinante terá permissão de assinatura.

---

## 3. Parâmetros

| Parâmetro | Obrigatório | Descrição |
| --- | --- | --- |
| `NAME` | Sim | Identificador do signer (por ex., `alice`, `build-bot`). Deve corresponder ao nome registrado na store de chaves. |
| `REPOSITORY` | Sim | Um ou mais repositórios Docker (ex.: `minharepo`, `meuregistro/meuapp`) nos quais esse signer atuará. |

---

## 4. Opções disponíveis

| Opção | Tipo | Padrão | Finalidade |
| --- | --- | --- | --- |
| `--key list` | string | — | Caminho para o arquivo de chave **pública** do signer. Pode usar múltiplas vezes para carregar várias chaves. Ex.: `--key alice.pub`. |

> Importante: a chave pública apontada em --key deve estar previamente gerada ou carregada (via docker trust key generate / docker trust key load).
> 

---

## 5. Fluxo de funcionamento

1. **Validação de parâmetros**
    - Verifica se `NAME`, pelo menos um `REPOSITORY` e pelo menos um `-key` foram fornecidos.
2. **Verificação da chave pública**
    - Confere se o arquivo indicado em `-key` existe e é legível.
3. **Atualização do metadata de Trust**
    - Ajusta o metadata local em `~/.docker/trust/tuf/` para incluir o novo signer na role “targets” deste(s) repositório(s).
4. **Envio para Notary Server**
    - No próximo `docker trust sign` ou `docker push`, o cliente sincroniza automaticamente as alterações com o servidor de confiança.
5. **Uso pelo signer**
    - O signer (com sua chave privada correspondente) poderá então executar:
        
        ```bash
        docker trust sign --key NAME.key meuregistro/meuapp:latest
        
        ```
        
    - Outras máquinas poderão verificar as assinaturas ao fazer:
        
        ```bash
        docker pull meuregistro/meuapp:latest
        
        ```
        

---

## 6. Exemplos de uso

1. **Adicionar “alice” ao repositório `minharepo`**
    
    ```bash
    docker trust signer add \
      --key alice.pub \
      alice minharepo
    # Agora, 'alice' pode assinar imagens em 'minharepo'
    
    ```
    
2. **Adicionar “build-bot” a múltiplos repositórios**
    
    ```bash
    docker trust signer add \
      --key build-bot.pub \
      build-bot app/frontend app/backend
    # 'build-bot' assinará tanto 'app/frontend' quanto 'app/backend'
    
    ```
    
3. **Fluxo completo de confiança**
    
    ```bash
    # 1. Gera/chaveia par de chaves para Bob
    docker trust key generate bob
    
    # 2. Carrega a chave pública de Bob
    docker trust key load --name bob bob.key
    
    # 3. Adiciona Bob como signer em 'meuapp'
    docker trust signer add --key bob.pub bob meuregistro/meuapp
    
    # 4. Bob assina a imagem
    docker trust sign --key bob.key meuregistro/meuapp:1.0
    
    # 5. Usuário final puxa a imagem verificando a assinatura
    docker pull meuregistro/meuapp:1.0
    
    ```
    

---

## 7. Tabela de referência rápida

| Componente | Sintaxe | Descrição |
| --- | --- | --- |
| Comando base | `docker trust signer add` | Associa um signer a um repositório Docker sob Content Trust. |
| Parâmetro | `NAME` | Identificador do signer (ex.: usuário, build-bot). |
| Parâmetro | `REPOSITORY` | Repositório(s) alvo(s) para assinatura. |
| Opção | `--key <arquivo.pub>` | Arquivo de chave pública do signer. Pode ser repetida. |

---

Com isso, você tem todas as informações para **adicionar signers** aos seus repositórios Docker de forma segura e controlada. Se precisar de cenários adicionais ou tiver dúvidas, só avisar!