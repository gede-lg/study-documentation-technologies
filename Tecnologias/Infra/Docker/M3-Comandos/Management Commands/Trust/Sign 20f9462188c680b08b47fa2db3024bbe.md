# Sign

A seguir, uma explicação completa e estruturada do comando **`docker trust sign`**, cobrindo sua finalidade, sintaxe, parâmetros, opções, fluxo de funcionamento e exemplos de uso.

---

## 1. O que faz este comando

O **`docker trust sign`** permite **assinar** uma imagem Docker usando sua chave privada registrada no Docker Content Trust.

Isso adiciona uma assinatura digital à tag especificada, de modo que qualquer cliente que habilite Content Trust possa verificar a integridade e a autoria da imagem ao fazer o pull.

---

## 2. Sintaxe geral

```bash
docker trust sign [OPTIONS] IMAGE:TAG

```

- **`IMAGE:TAG`**: especifica o repositório e a tag da imagem a ser assinada.
- Você **deve** ter a chave privada correspondente a um signer autorizado desse repositório carregada (via `docker trust key generate` ou `docker trust key load`) e configurada como signer (via `docker trust signer add`).

---

## 3. Parâmetros

| Parâmetro | Obrigatório | Descrição |
| --- | --- | --- |
| `IMAGE:TAG` | Sim | Nome da imagem e sua tag exata (e.g. `meuregistro/meuapp:1.0`). É essa versão que será assinada. |

---

## 4. Opções disponíveis

| Opção | Tipo | Padrão | Finalidade |
| --- | --- | --- | --- |
| `--local` | boolean | `false` | Assina **somente** a imagem que está **taggeada localmente**, sem tentar fazer pull/push no registry. Útil em pipelines offline ou para testes locais. |

---

## 5. Fluxo de funcionamento

1. **Validação de parâmetros**
    - Confirma se `IMAGE:TAG` foi informado; caso contrário, exibe ajuda.
2. **Obtenção da imagem**
    - Por padrão, o Docker tentará **pull** da imagem remota para garantir que você assine a versão mais recente.
    - Com `-local`, usa apenas a imagem que já existe no daemon local.
3. **Solicitação de frase-secreta**
    - Se sua chave privada estiver protegida por passphrase, o CLI pedirá a digitação antes de prosseguir.
4. **Geração da assinatura**
    - O cliente gera uma assinatura digital da digest da imagem com sua chave privada.
5. **Atualização do metadata de Trust**
    - O metadata local (TUF) é atualizado para incluir a nova assinatura sob sua role de signer.
6. **Envio para Notary Server**
    - Após a assinatura, o cliente faz **push** automático do metadata atualizado para o servidor Notary, de modo que outros usuários vejam a nova assinatura.

---

## 6. Exemplos de uso

1. **Assinar a imagem remota `meuapp:2.0`**
    
    ```bash
    docker trust sign meuapp:2.0
    # O Docker faz pull de meuapp:2.0, pede sua passphrase e assina remotamente.
    
    ```
    
2. **Assinar somente localmente (sem pull/push) `minharepo:latest`**
    
    ```bash
    docker trust sign --local minharepo:latest
    # Usa apenas a cópia local de minharepo:latest para gerar a assinatura.
    
    ```
    
3. **Fluxo completo de assinatura após configurar signer**
    
    ```bash
    # 1. Gera e carrega sua chave:
    docker trust key generate carlos
    docker trust signer add --key carlos.pub carlos meuapp
    
    # 2. Assina a tag 1.0 de meuapp:
    docker trust sign meuapp:1.0
    
    # 3. Outros usuários que fizerem:
    docker pull meuapp:1.0
    # terão certeza de que aquela imagem vem realmente de “carlos”
    
    ```
    

---

## 7. Tabela de referência rápida

| Componente | Sintaxe | Descrição |
| --- | --- | --- |
| Comando base | `docker trust sign [OPTIONS] IMAGE:TAG` | Assina digitalmente a tag de uma imagem Docker. |
| Parâmetro | `IMAGE:TAG` | Imagem e tag exatas a serem assinadas. |
| Opção | `--local` | Força uso da imagem local, sem pull/push no registry. |

---

Com isso, você pode adicionar assinaturas confiáveis às suas imagens Docker, garantindo rastreabilidade e segurança no seu fluxo de distribuição. Qualquer dúvida, estou à disposição!