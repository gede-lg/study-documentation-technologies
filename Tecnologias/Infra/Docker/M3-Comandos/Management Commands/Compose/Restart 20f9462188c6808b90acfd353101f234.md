# Restart

**Introdução**

O comando `docker compose restart` é usado para reiniciar um ou mais serviços definidos em seu arquivo `docker-compose.yml`. Ele para os containers em execução e, em seguida, inicia-os novamente, aplicando quaisquer alterações de configuração (por exemplo, novas variáveis de ambiente, volumes, etc.) sem recriar imagens.

---

## 1. Sintaxe Geral

```bash
docker compose restart [OPÇÕES] [SERVIÇOS...]

```

- **SERVIÇOS...**
    
    Lista opcional de nomes de serviço (conforme definidos em `docker-compose.yml`).
    
    - Se omitido, **todos** os serviços serão reiniciados.

---

## 2. Parâmetros e Opções

| Opção | Sintaxe | Finalidade | Comportamento Padrão |
| --- | --- | --- | --- |
| **dry-run** | `--dry-run` | Executa o comando em modo “simulação”: mostra quais containers seriam reiniciados, **sem** reiniciá-los de fato. | não ativado |
| **no-deps** | `--no-deps` | Reinicia apenas o(s) container(s) indicado(s), **ignorando** serviços dos quais eles dependem. | reinicia também dependências |
| **timeout** | `-t, --timeout int` | Define, em segundos, o tempo máximo de espera para desligar graciosamente um container antes de forçar sua parada. | 10 segundos |

> Observação sobre timeout
> 
> 
> O Docker envia um sinal de término (`SIGTERM`) ao container. Se, dentro de `timeout` segundos, o container não encerrar, ele recebe um `SIGKILL`.
> 

---

## 3. Descrição Detalhada de Cada Opção

### 3.1 `-dry-run`

- **Como usar:**
    
    ```bash
    docker compose restart --dry-run
    
    ```
    
- **O que faz:**
    - Lista quais serviços/container seriam reiniciados.
    - Útil para verificar o impacto antes de executar de fato.

### 3.2 `-no-deps`

- **Como usar:**
    
    ```bash
    docker compose restart --no-deps web
    
    ```
    
- **O que faz:**
    - Reinicia apenas o serviço **web**, sem reiniciar seus `depends_on` (por exemplo, banco de dados, cache).
    - Economiza tempo quando você sabe que as dependências estão estáveis.

### 3.3 `t, --timeout int`

- **Como usar:**
    
    ```bash
    docker compose restart -t 30 api
    
    ```
    
    ou
    
    ```bash
    docker compose restart --timeout 30 api
    
    ```
    
- **O que faz:**
    - Aguarda até `int` segundos para o container encerrar normalmente após receber `SIGTERM`.
    - Se o container não encerrar, é forçado com `SIGKILL`.
- **Valor padrão:** `10` segundos.

---

## 4. Exemplos Práticos

1. **Reiniciar todos os serviços com timeout de 20 segundos**
    
    ```bash
    docker compose restart --timeout 20
    
    ```
    
2. **Reiniciar apenas o serviço `db`, sem reiniciar dependências**
    
    ```bash
    docker compose restart --no-deps db
    
    ```
    
3. **Simular reinício de `web` e `api`, sem executar de fato**
    
    ```bash
    docker compose restart --dry-run web api
    
    ```
    
4. **Reiniciar `worker` com timeout customizado**
    
    ```bash
    docker compose restart -t 5 worker
    
    ```
    

---

**Resumo rápido das opções:**

| Opção | Efeito principal |
| --- | --- |
| `--dry-run` | Mostra o que seria feito, **sem** reiniciar containers |
| `--no-deps` | Ignora serviços dependentes e reinicia **apenas** os indicados |
| `-t, --timeout` | Tempo (em segundos) para aguardar o encerramento gracioso do container |

Dessa forma, você tem controle preciso sobre **quando** e **como** cada serviço é reiniciado em seu ambiente Docker Compose.