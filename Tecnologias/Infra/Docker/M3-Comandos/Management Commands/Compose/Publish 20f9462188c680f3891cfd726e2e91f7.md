# Publish

Olá, Gedê! A.R.I.A. na área para te ajudar a dominar o `docker compose publish`.

O comando `docker compose publish` é uma ferramenta poderosa para publicar sua aplicação definida em um arquivo `compose.yml` em um registro de contêineres, como o Docker Hub. Isso empacota sua aplicação multi-contêiner como um único artefato OCI (Open Container Initiative), facilitando o compartilhamento e a implantação.

Vamos detalhar cada parte do comando e suas opções.

### **Sintaxe de Uso**

A estrutura básica do comando é a seguinte:

```bash
docker compose publish [OPÇÕES] REPOSITORIO[:TAG]

```

- **`REPOSITORIO[:TAG]`**: Este é o único argumento obrigatório. Ele especifica o local no registro para onde sua aplicação será enviada.
    - **`REPOSITORIO`**: O nome do seu repositório no registro (ex: `gedelg/minha-app`).
    - **`[:TAG]`**: Uma etiqueta opcional para versionar sua publicação (ex: `:v1.0`, `:latest`). Se omitida, a tag `latest` geralmente é usada como padrão.

---

### **Opções (OPTIONS)**

As opções, também conhecidas como *flags*, modificam o comportamento do comando `publish`.

| Opção | Sintaxe Alternativa | Finalidade |
| --- | --- | --- |
| `--dry-run` |  | Simula a execução do comando sem enviar nada para o registro. Útil para verificar se o processo de *build* e empacotamento está correto. |
| `--oci-version` |  | Permite especificar a versão da especificação do artefato OCI. Por padrão, o Docker determina a melhor versão automaticamente. |
| `--resolve-image-digests` |  | Fixa (ou "pina") as tags das imagens a seus *digests* (hashes SHA256). Isso garante que a implantação use exatamente a mesma versão da imagem, independentemente de a tag ser atualizada no futuro. |
| `--with-env` |  | Inclui as variáveis de ambiente definidas no seu arquivo `.env` ou no ambiente do shell dentro do artefato OCI publicado. **Cuidado**: não use para informações sensíveis. |
| `--yes` | `-y` | Responde "sim" automaticamente para qualquer solicitação de confirmação que o comando possa fazer durante a execução. |

---

### **Exemplos Práticos**

**1. Publicação Simples**

Digamos que seu repositório no Docker Hub seja `gedelg/meu-projeto-incrivel`. Para publicar a versão `1.0`, você usaria:

```bash
docker compose publish gedelg/meu-projeto-incrivel:1.0

```

**2. Verificando o que será publicado (`--dry-run`)**

Antes de publicar, você quer ter certeza de que tudo está em ordem, sem enviar nada de verdade:

```bash
docker compose publish --dry-run gedelg/meu-projeto-incrivel:1.0

```

O terminal mostrará os passos que seriam executados, mas não realizará o *push* final.

**3. Garantindo a Imutabilidade (`--resolve-image-digests`)**

Para garantir que sua aplicação sempre use a versão exata da imagem do banco de dados `postgres:14.1`, por exemplo, você pode usar esta opção. Isso troca a tag `14.1` pelo seu hash de conteúdo específico.

```bash
docker compose publish --resolve-image-digests gedelg/meu-projeto-incrivel:1.0-stable

```

**4. Incluindo Variáveis de Ambiente (`--with-env`)**

Se sua aplicação precisa de uma variável de ambiente como `APP_MODE=production` para ser configurada, você pode incluí-la diretamente no artefato.

```bash
# Supondo que seu shell ou arquivo .env tenha APP_MODE=production
docker compose publish --with-env gedelg/meu-projeto-incrivel:1.0

```

Isso é útil para configurações não sensíveis que definem o comportamento da aplicação.

Espero que esta explicação detalhada ajude você, Gedê, a utilizar o `docker compose publish` com mais confiança nos seus projetos. Se tiver mais alguma dúvida, é só chamar!