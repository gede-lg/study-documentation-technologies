# Exec

Olá, Gedê!

Com certeza! O comando `docker compose exec` é uma ferramenta extremamente útil para interagir com os serviços que estão rodando em seus contêineres. Com ele, você pode executar comandos diretamente dentro de um contêiner em execução, o que é ótimo para depuração, verificação de logs ou execução de tarefas administrativas.

Vamos detalhar cada parte do comando.

---

## Comando `docker compose exec`

Este comando permite que você execute um comando específico dentro de um serviço que já está em execução, definido no seu arquivo `docker-compose.yml`.

### Sintaxe Geral

A estrutura básica do comando é a seguinte:

```bash
docker compose exec [OPÇÕES] NOME_DO_SERVIÇO COMANDO [ARGUMENTOS...]

```

- **[OPÇÕES]:** São os parâmetros que modificam o comportamento do comando `exec`. Veremos cada um deles em detalhes.
- **NOME\_DO\_SERVIÇO:** É o nome do serviço (o contêiner) que você quer acessar, conforme definido no seu arquivo `docker-compose.yml`.
- **COMANDO:** É o comando que você deseja executar dentro do contêiner.
- **[ARGUMENTOS...]:** São os argumentos adicionais para o comando que você está executando.

---

### Parâmetros (Options)

A seguir, está uma tabela que detalha cada um dos parâmetros disponíveis para o `docker compose exec`.

| Parâmetro (Opção) | Sintaxe Longa | Finalidade | Exemplo de Uso |
| --- | --- | --- | --- |
| `-d` | `--detach` | **Execução em Segundo Plano (Detached):** Roda o comando em segundo plano, sem manter o terminal "preso" à execução. | `docker compose exec -d meu_servico_db backup.sh` |
|  | `--dry-run` | **Simulação (Dry Run):** Mostra o comando que *seria* executado, mas não o executa de fato. Útil para verificar se a sintaxe está correta. | `docker compose exec --dry-run meu_servico_app ls -l /app` |
| `-e` | `--env` | **Variáveis de Ambiente:** Define uma ou mais variáveis de ambiente (`CHAVE=VALOR`) para o comando a ser executado. Pode ser usado múltiplas vezes. | `docker compose exec -e MINHA_VAR=valor meu_servico_app node script.js` |
|  | `--index` | **Índice do Contêiner:** Especifica qual contêiner usar quando um serviço tem múltiplas réplicas (escalonamento). O índice começa em 1. | `docker compose exec --index=2 meu_servico_web bash` |
| `-T` | `--no-TTY` | **Desabilitar Pseudo-TTY:** Desabilita a alocação de um pseudo-terminal (TTY). Útil para scripts automatizados ou quando a saída não é interativa. | `docker compose exec -T meu_servico_db psql -U user -d db < backup.sql` |
|  | `--privileged` | **Modo Privilegiado:** Concede privilégios estendidos ao processo dentro do contêiner, permitindo acesso a recursos do host que normalmente são restritos. | `docker compose exec --privileged meu_servico_app dmesg` |
| `-u` | `--user` | **Especificar Usuário:** Executa o comando como um usuário específico (nome ou UID) dentro do contêiner. | `docker compose exec -u www-data meu_servico_web ls -l /var/www/html` |
| `-w` | `--workdir` | **Diretório de Trabalho (WORKDIR):** Define o diretório de trabalho (`WORKDIR`) para a execução do comando, sobrescrevendo o padrão do contêiner. | `docker compose exec -w /tmp meu_servico_app touch novo_arquivo.txt` |

---

### Exemplos Práticos

Vamos ver alguns cenários comuns:

1. **Acessar o shell de um contêiner:**
Este é o uso mais comum, ideal para depurar ou inspecionar o ambiente.
    
    ```bash
    docker compose exec meu_servico_api bash
    
    ```
    
    Neste caso, `meu_servico_api` é o nome do serviço, e `bash` é o comando para iniciar um terminal interativo.
    
2. **Verificar a conexão com o banco de dados de dentro do contêiner da aplicação:**
Imagine que seu serviço `app` precisa se conectar a um serviço `db`. Você pode testar a conexão:
    
    ```bash
    # Supondo que 'meu_servico_app' tenha o cliente psql instalado
    docker compose exec meu_servico_app psql -h db -U usuario -d meu_banco -c "SELECT 1;"
    
    ```
    
3. **Executar um script de backup em segundo plano:**
Se você tem um script de backup dentro do seu contêiner de banco de dados e não quer que seu terminal fique ocupado, use a flag `d`.
    
    ```bash
    docker compose exec -d meu_servico_db /scripts/fazer_backup.sh
    
    ```
    
4. **Listar arquivos em um diretório específico como outro usuário:**
Se sua aplicação web roda como `www-data`, você pode querer listar os arquivos com as permissões daquele usuário.
    
    ```bash
    docker compose exec -u www-data -w /var/www/html meu_servico_web ls -la
    
    ```
    

Espero que esta explicação detalhada ajude você a dominar o `docker compose exec`, Gedê! É uma ferramenta poderosa no seu arsenal de desenvolvimento. Se tiver mais alguma dúvida, pode mandar!