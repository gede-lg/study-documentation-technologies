# Prune

Perfeito, Gustavo! Segue uma explicação completa e detalhada sobre o comando `docker image prune` e todos os seus parâmetros, com direito a tabela de resumo, exemplos comentados e as melhores práticas.

---

# Entendendo o Comando `docker image prune` e Seus Parâmetros

---

## Introdução

Gerenciar imagens é essencial para evitar acúmulo desnecessário de arquivos no host Docker. O comando `docker image prune` é utilizado para remover imagens não utilizadas, ajudando a liberar espaço em disco e a manter o ambiente limpo.

---

## Sumário

1. [Sintaxe Inicial e Finalidade](https://chatgpt.com/c/68465468-f320-8013-b0ec-40c431f3c58f#sintaxe-inicial-e-finalidade)
2. [Parâmetros do Comando `docker image prune`](https://chatgpt.com/c/68465468-f320-8013-b0ec-40c431f3c58f#par%C3%A2metros-do-comando-docker-image-prune)
    - Tabela Resumo dos Parâmetros
    - Descrição Detalhada de Cada Parâmetro
    - Exemplos Práticos de Uso
3. [Funcionamento Interno e Considerações](https://chatgpt.com/c/68465468-f320-8013-b0ec-40c431f3c58f#funcionamento-interno-e-considera%C3%A7%C3%B5es)
4. [Cenários de Restrição e Cuidados](https://chatgpt.com/c/68465468-f320-8013-b0ec-40c431f3c58f#cen%C3%A1rios-de-restri%C3%A7%C3%A3o-e-cuidados)
5. [Boas Práticas](https://chatgpt.com/c/68465468-f320-8013-b0ec-40c431f3c58f#boas-pr%C3%A1ticas)
6. [Resumo Visual dos Parâmetros](https://chatgpt.com/c/68465468-f320-8013-b0ec-40c431f3c58f#resumo-visual-dos-par%C3%A2metros)
7. [Sugestões para Aprofundamento](https://chatgpt.com/c/68465468-f320-8013-b0ec-40c431f3c58f#sugest%C3%B5es-para-aprofundamento)

---

## Sintaxe Inicial e Finalidade

### Sintaxe Geral

```
docker image prune [OPTIONS]

```

### Finalidade

Remove imagens não utilizadas do sistema Docker.

Por padrão, remove apenas as **dangling images** — imagens "órfãs", sem tag, que não estão associadas a nenhum container.

Com opções adicionais, pode remover **todas** as imagens não usadas por nenhum container.

---

## Parâmetros do Comando `docker image prune`

### Tabela Resumo dos Parâmetros

| Parâmetro | Forma Longa | Descrição | Valor Esperado / Padrão |
| --- | --- | --- | --- |
| `-a` | `--all` | Remove **todas** as imagens não usadas por containers (não só as dangling) | Booleano (flag) |
| — | `--filter` | Filtra as imagens a serem removidas conforme critérios (ex: tempo, label) | String |
| `-f` | `--force` | Não pede confirmação para remover as imagens; executa direto | Booleano (flag) |

---

### Descrição Detalhada de Cada Parâmetro

### 1. `a` ou `-all`

- **Função:**
    
    Remove **todas** as imagens não utilizadas por nenhum container, não só as que estão "dangling" (órfãs).
    
- **Uso típico:**
    
    ```
    docker image prune -a
    
    ```
    
- **Sem esse parâmetro:**
    
    Apenas imagens "dangling" (sem tag e não referenciadas) serão removidas.
    
- **Com esse parâmetro:**
    
    Todas as imagens não utilizadas por nenhum container são removidas, **inclusive** as que possuem tag, mas não estão sendo usadas.
    

### 2. `-filter filter`

- **Função:**
    
    Permite remover apenas imagens que correspondam a certos critérios.
    
    O filtro mais comum é pelo tempo (`until`), mas também pode usar labels.
    
- **Exemplo de uso:**
    
    ```
    docker image prune --filter "until=24h"
    
    ```
    
    Remove imagens não usadas **e** criadas há mais de 24 horas.
    
- **Sintaxe:**
    - Para tempo: `until=<timestamp|duration>`
    - Para label: `label=<key>=<value>`
- **Exemplo prático:**
    
    ```
    docker image prune --filter "label=env=dev"
    
    ```
    
    Remove imagens com a label `env=dev` não usadas.
    

### 3. `f` ou `-force`

- **Função:**
    
    Executa o comando **sem solicitar confirmação** do usuário.
    
- **Uso típico:**
    
    ```
    docker image prune -f
    
    ```
    
- **Por padrão:**
    
    O comando pede confirmação (“Are you sure you want to continue?”).
    
- **Em scripts:**
    
    Essencial para automação (não há prompt interativo).
    

---

### Exemplos Práticos de Uso

| Comando | O que faz |
| --- | --- |
| `docker image prune` | Remove apenas dangling images (pede confirmação) |
| `docker image prune -a` | Remove todas imagens não usadas (pede confirmação) |
| `docker image prune -f` | Remove dangling images, sem pedir confirmação |
| `docker image prune -a -f` | Remove todas imagens não usadas, sem pedir confirmação |
| `docker image prune --filter "until=168h"` | Remove dangling images criadas há mais de 7 dias |
| `docker image prune -a --filter "until=24h" -f` | Remove todas imagens não usadas há mais de 24h, sem pedir confirmação |
| `docker image prune --filter "label=type=temp"` | Remove dangling images com a label `type=temp` |

---

## Funcionamento Interno e Considerações

- **Dangling images** são imagens intermediárias, normalmente sem tag (`<none>`), geradas durante o build e não mais associadas a nenhum container.
- Ao rodar `docker image prune -a`, imagens utilizadas por containers ativos **não** são removidas.
- O comando não afeta containers, volumes ou networks. Para limpeza mais profunda, veja `docker system prune`.

---

## Cenários de Restrição e Cuidados

- **Atenção!**
    
    Imagens removidas não podem ser recuperadas a menos que sejam reconstruídas ou baixadas novamente.
    
- **Evite usar `a` em ambientes de produção** sem ter certeza do impacto, pois pode remover imagens de versões anteriores úteis para rollback.
- **Scripts automatizados:** Sempre utilize `f` para evitar que o processo fique aguardando confirmação.

---

## Boas Práticas

- **Utilize o filtro `until`** para evitar remover imagens recentes que podem ser reutilizadas em breve.
- **Agende limpezas periódicas** em ambientes de desenvolvimento ou CI, mas nunca automatize em produção sem regras e revisões.
- **Documente o uso do comando nos scripts** para manter o time ciente dos impactos.

---

## Resumo Visual dos Parâmetros

| Flag | Uso Básico | Descrição Breve |
| --- | --- | --- |
| `-a`/`--all` | `docker image prune -a` | Remove todas imagens não usadas |
| `--filter` | `docker image prune --filter "until=..."` | Remove imagens não usadas conforme filtro |
| `-f`/`--force` | `docker image prune -f` | Não pede confirmação; ideal para automação |

---

## Sugestões para Aprofundamento

- [Documentação Oficial do `docker image prune`](https://docs.docker.com/engine/reference/commandline/image_prune/)
- [Filtros disponíveis em comandos prune](https://docs.docker.com/engine/reference/commandline/image_prune/#filtering)
- [Limpeza avançada com `docker system prune`](https://docs.docker.com/engine/reference/commandline/system_prune/)
- [Gerenciamento de espaço em disco no Docker](https://docs.docker.com/config/pruning/)

---

### Se precisar de exemplos práticos de scripts para automatizar a limpeza, filtros avançados, ou quiser ver um fluxo de uso integrado em CI/CD, só avisar!