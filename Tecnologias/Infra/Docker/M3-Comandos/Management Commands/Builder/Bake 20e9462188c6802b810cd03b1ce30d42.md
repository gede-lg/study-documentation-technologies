# Bake

Segue uma visão detalhada do comando `docker buildx bake`, com todos os seus parâmetros, sintaxes e finalidades.

---

## 1. Visão Geral

- **Objetivo**: Orquestrar builds declarativos a partir de um arquivo de definição (geralmente `docker-bake.hcl`, `docker-compose.yml` ou similar).
- **Comando**:
    
    ```bash
    docker buildx bake [OPTIONS] [TARGET...]
    
    ```
    
- **Aliases**:
    - `docker buildx bake`
    - `docker buildx f`
- **Uso de Targets**:
    
    Após as opções, pode-se indicar um ou mais *targets* (nomes de configurações de build) definidos no arquivo.
    

---

## 2. Sintaxe dos Parâmetros

| Opção | Sintaxe | Tipo | Finalidade | Observações |
| --- | --- | --- | --- | --- |
| `--allow` | `--allow <recurso>...` | `stringArray` | Permite que o build acesse recursos específicos (por ex. `network`, `ssh`, `secret`) | Pode repetir para vários recursos |
| `--builder` | `--builder <nome>` | `string` | Seleciona qual instância de builder será usada | Default: `"default"` |
| `--call` | `--call <modo>` | `string` | Controla o método de avaliação do bake: |  |
- `check` (valida configurações)
- `outline` (mostra resumo de passos)
- `targets` (lista *targets* disponíveis)
- `build` (executa o build) | Default: `build` |
    
    | `--check`              | `--check`                        | `bool`          | **Atalho** para `--call=check`                                                                                  | —                                                                                                    |
    
    | `-D`, `--debug`        | `-D` ou `--debug`                | `bool`          | Habilita logs de depuração (mais verbosos)                                                                     | —                                                                                                    |
    
    | `-f`, `--file`         | `-f <arquivo>...`                | `stringArray`   | Especifica um ou mais arquivos de definição de build                                                           | Ex.: `-f docker-bake.hcl -f extra.hcl`                                                                |
    
    | `--list`               | `--list targets|vars`            | `string`        | Lista, conforme o argumento:
    
- `targets` (mostra *targets*)
- `vars` (mostra variáveis definidas) | — |
    
    | `--load`               | `--load`                         | `bool`          | **Atalho** para `--set=*.output=type=docker`
    
    (carrega a imagem resultante no Docker local)                                                                        | —                                                                                                    |
    
    | `--metadata-file`      | `--metadata-file <caminho>`      | `string`        | Salva metadados do resultado do build em um arquivo (ex.: JSON)                                               | —                                                                                                    |
    
    | `--no-cache`           | `--no-cache`                     | `bool`          | Impede o uso de cache durante o build                                                                          | —                                                                                                    |
    
    | `--print`              | `--print`                        | `bool`          | Apenas imprime as opções e os passos a executar, sem realmente construir                                       | —                                                                                                    |
    
    | `--progress`           | `--progress auto|quiet|plain|tty|rawjson` | `string`        | Define o estilo de exibição do progresso:
    
- `auto` (padrão detecta terminal)
- `quiet` (silencioso)
- `plain` (mostra saída dos containers)
- `tty` (barra interativa)
- `rawjson` (JSON bruto) | Default: `auto` |
    
    | `--pull`               | `--pull`                         | `bool`          | Sempre faz pull das imagens de base antes de iniciar o build                                                   | —                                                                                                    |
    
    | `--push`               | `--push`                         | `bool`          | **Atalho** para `--set=*.output=type=registry`
    
    (faz push da imagem ao final)                                                                                        | —                                                                                                    |
    
    | `--set`                | `--set <target>.<chave>=<valor>...` | `stringArray`   | Sobrepõe valores de parâmetros dos *targets*.
    
    Ex.: `--set frontend.tags=latest --set backend.cache=true`                                                    | Pode repetir para várias chaves                                                                       |
    
    | `--provenance`         | `--provenance <valor>`           | `string`        | **Atalho** para `--set=*.attest=type=provenance`
    
    (gera metadados de proveniência)                                                                        | —                                                                                                    |
    
    | `--sbom`               | `--sbom <valor>`                 | `string`        | **Atalho** para `--set=*.attest=type=sbom`
    
    (gera Software Bill of Materials)                                                                       | —                                                                                                    |
    

> Nota: comandos e flags experimentais ficam ocultos.
> 
> 
> Para vê-los, exporte a variável `BUILDX_EXPERIMENTAL=1` antes de executar.
> 

---

## 3. Exemplos de Uso

1. **Build padrão**, usando o arquivo `docker-bake.hcl` e alvo `default`:
    
    ```bash
    docker buildx bake
    
    ```
    
2. **Especificar múltiplos arquivos** de definição e listar *targets*:
    
    ```bash
    docker buildx bake --file docker-bake.hcl --file extras.hcl --list targets
    
    ```
    
3. **Forçar pull** das imagens base e carregar o resultado localmente:
    
    ```bash
    docker buildx bake --pull --load
    
    ```
    
4. **Definir saída no registry** e gerar SBOM:
    
    ```bash
    docker buildx bake --push --sbom type=cyclonedx
    
    ```
    
5. **Depuração ativa** e sem cache:
    
    ```bash
    docker buildx bake -D --no-cache
    
    ```
    

---

Com essa estrutura, você tem à mão a sintaxe de cada parâmetro, seus tipos e finalidades, além de exemplos práticos de aplicação. Qualquer dúvida ou refinamento, é só falar!