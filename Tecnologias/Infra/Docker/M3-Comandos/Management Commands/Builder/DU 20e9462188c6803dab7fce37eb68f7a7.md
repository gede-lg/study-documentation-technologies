# DU

Olá, Gedê! Aqui é a A.R.I.A. pronta para te ajudar.

Com certeza! O comando `docker builder du` (ou `docker buildx du`) é uma ferramenta muito útil para gerenciar o espaço em disco consumido pelo cache do Buildx, o construtor de imagens do Docker. Vamos detalhar cada um dos seus parâmetros.

---

### Finalidade do Comando

O objetivo principal do `docker builder du` é **analisar o uso do disco pelo cache de compilação**. Ele mostra quanto espaço está sendo ocupado, quais componentes do cache são os maiores e permite que você identifique caches antigos ou desnecessários que podem ser removidos para liberar espaço.

A sintaxe básica é:

```bash
docker builder du [OPTIONS]

```

---

### Parâmetros (Options)

A seguir, apresento uma tabela detalhada com cada opção, sua finalidade e como usá-la.

| Opção | Sintaxe de Uso | Finalidade |
| --- | --- | --- |
| `--builder` | `--builder <nome_do_builder>` | Especifica qual instância do construtor (builder) você quer analisar. Útil se você tiver múltiplos builders. |
| `-D`, `--debug` | `-D` ou `--debug` | Ativa o modo de depuração, exibindo logs detalhados sobre a execução do próprio comando `du`. |
| `--filter` | `--filter "chave=valor"` | Filtra os resultados do cache com base em critérios específicos. É a opção mais poderosa para análise. |
| `--verbose` | `--verbose` | Fornece uma saída mais detalhada, mostrando uma quebra completa dos registros de cache, incluindo seus tipos e IDs. |

---

### Detalhando os Parâmetros

### 1. `-builder`

Por padrão, o Docker Buildx usa um builder chamado `default`. Se você criou outros builders (por exemplo, para compilar para diferentes arquiteturas como ARM), pode usar esta flag para especificar qual deles deseja inspecionar.

**Exemplo:**
Se você tem um builder chamado `meu_builder_multiplataforma`:

```bash
docker builder du --builder meu_builder_multiplataforma

```

### 2. `D, --debug`

Esta opção não é para analisar o cache em si, mas para **depurar o próprio comando `docker builder du`**. Se o comando estiver falhando ou se comportando de maneira inesperada, usar `--debug` mostrará informações internas que podem ajudar a diagnosticar o problema.

**Exemplo:**

```bash
docker builder du --debug

```

### 3. `-filter`

Esta é a flag mais importante para uma análise refinada. Ela permite filtrar os dados do cache que são exibidos. O filtro mais comum é o `until`, que permite ver o cache criado antes de um determinado período de tempo.

**Filtros comuns:**

- `until=<duração>`: Mostra caches mais antigos que a duração especificada (ex: `24h`, `720h`).

**Exemplo:**
Para ver todo o cache que não é utilizado há mais de 30 dias (720 horas):

```bash
docker builder du --filter "until=720h"

```

Isso é extremamente útil para combinar com o comando `docker builder prune` e limpar apenas o cache antigo.

### 4. `-verbose`

Sem esta flag, `docker builder du` mostra um resumo geral do espaço ocupado. Ao usar `--verbose`, ele exibe uma **lista detalhada** de todos os objetos no cache, incluindo:

- **ID do Objeto**: O identificador único do item no cache.
- **Type**: O tipo do objeto (ex: `source.local`, `exec.cachemount`, `regular`).
- **Size**: O tamanho do objeto.
- **Created At**: A data de criação.
- **Last Used**: A data do último uso.
- **Usage Count**: Quantas vezes foi utilizado.
- **Shared**: Se o cache é compartilhado.

**Exemplo:**

```bash
# Saída resumida (padrão)
docker builder du

# Saída detalhada
docker builder du --verbose

```

A saída do modo `--verbose` te dá um controle visual completo para decidir o que pode ser removido.

---

### Resumo Prático

Imagine que você, como um desenvolvedor Go, está compilando várias versões do seu projeto e o cache está crescendo. Para liberar espaço de forma segura, você pode:

1. **Analisar o que pode ser limpo:** Veja o cache não utilizado há mais de uma semana (168h).
    
    ```bash
    gedelg@DESKTOP-H3T36NM:~$ docker builder du --filter "until=168h"
    
    ```
    
2. **Ver em detalhes o que será removido:** Se a análise acima mostrar que muito espaço será liberado, você pode inspecionar em detalhes com `-verbose`.
    
    ```bash
    gedelg@DESKTOP-H3T36NM:~$ docker builder du --filter "until=168h" --verbose
    
    ```
    
3. **Limpar o cache antigo:** Após confirmar, use `prune` com o mesmo filtro para remover o cache identificado.
    
    ```bash
    gedelg@DESKTOP-H3T36NM:~$ docker builder prune --filter "until=168h"
    
    ```
    

Espero que esta explicação detalhada te ajude a gerenciar o cache do Docker de forma mais eficiente, Gedê. Se tiver mais alguma dúvida, é só chamar!