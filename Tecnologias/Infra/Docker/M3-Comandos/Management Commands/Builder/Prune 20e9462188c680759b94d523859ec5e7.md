# Prune

Aqui está uma visão estruturada de todos os parâmetros do comando `docker buildx prune` (o “builder prune” do plugin Buildx), com sintaxe, finalidade e exemplos de uso.

---

## 1. Descrição

O comando **`docker buildx prune`** remove o cache de builds gerenciado pelo Buildx, liberando espaço em disco. Ele faz parte do plugin **Buildx** do Docker (subcomando `buildx`) e, por padrão, solicita confirmação antes de excluir o cache.

---

## 2. Sintaxe

```bash
docker buildx prune [OPTIONS]

```

- **`docker buildx`**: invoca o plugin Buildx.
- **`prune`**: subcomando para limpar o cache de build.
- **`[OPTIONS]`**: parâmetros que controlam exatamente o quê e como o cache será removido.

---

## 3. Parâmetros e Flags

| Flag | Valor esperado | Finalidade | Padrão | Exemplo de uso |
| --- | --- | --- | --- | --- |
| `-a`, `--all` | – | Inclui também imagens internas / front-end no cache | `false` | `docker buildx prune --all` |
| `--builder <string>` | nome do builder | Força o uso de um builder específico (ao invés do `default`) | `"default"` | `docker buildx prune --builder mybuilder` |
| `-D`, `--debug` | – | Habilita saída em modo debug, útil para diagnosticar o que está sendo removido | `false` | `docker buildx prune --debug` |
| `--filter <filter>` | expressão string | Filtra quais caches remover; ex.: `until=24h` (mais antigos que 24 horas), `label=foo` | – | `docker buildx prune --filter "until=48h"` |
| `-f`, `--force` | – | Não pede confirmação interativa — simplesmente executa a remoção | `false` | `docker buildx prune -f` |
| `--max-used-space <bytes>` | inteiro em bytes | Define o espaço máximo de cache a ser mantido; tudo que exceder será removido | – | `docker buildx prune --max-used-space 20GB` |
| `--min-free-space <bytes>` | inteiro em bytes | Objetivo de espaço livre no disco após o prune; limpa até atingir esse mínimo | – | `docker buildx prune --min-free-space 5GB` |
| `--reserved-space <bytes>` | inteiro em bytes | Espaço que deve ser sempre reservado para cache, mesmo após o prune | – | `docker buildx prune --reserved-space 1GB` |
| `--verbose` | – | Produz saída mais detalhada sobre as ações realizadas | `false` | `docker buildx prune --verbose` |

> Obs.: Comandos e flags experimentais (não listados acima) ficam ocultos por padrão. Ative-os definindo a variável de ambiente:
> 
> 
> ```bash
> export BUILDX_EXPERIMENTAL=1
> 
> ```
> 

---

## 4. Explicação Detalhada de Cada Parâmetro

1. **`a, --all`**
    - **O que faz:** Inclui no scrub também imagens criadas internamente pelo frontend do Buildx (por exemplo, camadas intermediárias que não seriam removidas apenas com o cache padrão).
    - **Quando usar:** Quando quiser garantir que **todo** o cache seja limpo, não apenas o cache “externo”.
2. **`-builder <string>`**
    - **O que faz:** Especifica explicitamente qual instância de builder usar (útil quando você tem múltiplos builders registrados, ex.: `docker buildx create --name mybuilder`).
    - **Default:** `default`
    - **Exemplo:**
        
        ```bash
        docker buildx prune --builder experiment
        
        ```
        
3. **`D, --debug`**
    - **O que faz:** Ativa logs de debug, mostrando detalhes de cada etapa do prune.
    - **Quando usar:** Em casos de falha ou comportamento inesperado, para entender o que está sendo detectado e removido.
4. **`-filter <filter>`**
    - **O que faz:** Permite passar **filtros** no estilo `chave=valor`, por exemplo:
        - `until=24h` – remove caches com mais de 24 horas
        - `label!=frontend` – remove caches que **não** têm o label `frontend`
    - **Suporta múltiplos filtros:** basta repetir a flag `-filter`.
5. **`f, --force`**
    - **O que faz:** Elimina o prompt de confirmação interativa (o “Are you sure?”), executando imediatamente.
6. **`-max-used-space <bytes>`**
    - **O que faz:** Especifica um **teto** para o tamanho total do cache. Se o cache exceder esse valor, o prune eliminará entradas antigas até ficar dentro do limite.
7. **`-min-free-space <bytes>`**
    - **O que faz:** Define quanto **espaço livre** você quer garantir no disco após o prune. O comando limpará o cache até que reste pelo menos esse valor livre.
8. **`-reserved-space <bytes>`**
    - **O que faz:** Define um **fundo de reserva** de espaço para o cache, que nunca será tocado, mesmo após limpar até `-min-free-space`.
9. **`-verbose`**
    - **O que faz:** Semelhante ao `-debug`, mas foca em expandir a saída de status (por exemplo, listando cada camada removida).

---

## 5. Exemplos de Uso

```bash
# 1) Limpar todo o cache sem confirmação
docker buildx prune -a -f

# 2) Manter no máximo 10 GB de cache
docker buildx prune --max-used-space 10GB

# 3) Liberar espaço até ter 5 GB livres
docker buildx prune --min-free-space 5GB

# 4) Remover caches com mais de 72 horas e em modo debug
docker buildx prune --filter "until=72h" --debug

# 5) Usar outro builder e saída mais detalhada
docker buildx prune --builder mybuilder --verbose

```

Com estes parâmetros você tem **controle fino** sobre o que e quando é removido do cache de build, garantindo tanto limpeza eficaz quanto segurança de espaço em disco.