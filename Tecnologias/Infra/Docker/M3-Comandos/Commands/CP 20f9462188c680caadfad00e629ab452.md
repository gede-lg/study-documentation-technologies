# CP

---

## 1. Finalidade do `docker cp`

O **`docker cp`** copia arquivos e diretórios **entre** o **host** e um **contêiner** em execução ou parado, de forma bidirecional. É útil para:

- Extrair logs, artefatos ou dados gerados dentro de um contêiner.
- Injetar arquivos de configuração, scripts ou assets no sistema de arquivos de um contêiner.

---

## 2. Sintaxe básica

Há duas formas principais:

```bash
# Do contêiner para o host
docker cp [OPTIONS] CONTAINER:SRC_PATH DEST_PATH

# Do host para o contêiner
docker cp [OPTIONS] SRC_PATH CONTAINER:DEST_PATH

```

- **`CONTAINER`**: nome ou ID do contêiner.
- **`SRC_PATH`/`DEST_PATH`**: caminho no contêiner ou no host.

Você também pode usar `-` para transmitir via `stdin`/`stdout` em formato TAR:

```bash
# Ler um tar do stdin e extrair no contêiner
tar cf - ./meus_arquivos | docker cp - mycontainer:/destino

# Empacotar arquivos do contêiner e enviar ao stdout
docker cp mycontainer:/var/log - | tar xf - -C ./logs_locais

```

---

## 3. Parâmetros

| Parâmetro | Obrigatório | Descrição |
| --- | --- | --- |
| `CONTAINER:SRC_PATH` | Sim/Contrato* | Caminho de origem dentro do contêiner (quando copiando para o host). |
| `SRC_PATH` | Sim/Contrato* | Caminho de origem no host (quando copiando para o contêiner). |
| `DEST_PATH` | Sim | Caminho de destino no host ou no contêiner, dependendo do sentido da cópia. |

> É exigido colocar o prefixo com container apenas no lado correspondente à origem ou destino, conforme o exemplo.
> 

---

## 4. Opções disponíveis

| Opção | Tipo | Padrão | Finalidade |
| --- | --- | --- | --- |
| `-a, --archive` | boolean | `false` | Copia arquivos preservando **todas** as informações de **UID**, **GID**, **permissões** e **timestamps**. |
| `-L, --follow-link` | boolean | `false` | Sempre segue **symlinks** no caminho de origem, copiando o conteúdo apontado em vez do link. |
| `-q, --quiet` | boolean | `false` | Suprime a saída de progresso durante a cópia (útil em scripts ou quando não há TTY). |

---

## 5. Fluxo de funcionamento

1. **Resolução de caminhos**
    - Interpreta se cada caminho tem prefixo `CONTAINER:` ou não, definindo origem e destino.
2. **Leitura e empacotamento**
    - No modo padrão, o Docker empacota a fonte em um stream TAR internamente.
    - Se `-archive`, mantém metadados extras.
    - Se `-follow-link`, resolve symlinks antes de empacotar.
3. **Transporte**
    - Transfere o stream TAR pelo socket Docker para o daemon, depois ao contêiner ou host.
4. **Extração ou gravação**
    - Descompacta o tar no destino, recriando arquivos e diretórios conforme a origem.

---

## 6. Exemplos de uso

1. **Copiar do contêiner para o host**
    
    ```bash
    docker cp meu_container:/var/log/app.log ./app.log
    
    ```
    
2. **Copiar do host para o contêiner**
    
    ```bash
    docker cp ./config.yaml meu_container:/etc/app/config.yaml
    
    ```
    
3. **Preservar UID/GID e permissões**
    
    ```bash
    docker cp --archive ./scripts meu_container:/usr/local/bin
    
    ```
    
4. **Seguir symlinks**
    
    ```bash
    docker cp --follow-link meu_container:/usr/bin/python /tmp/python_real
    
    ```
    
5. **Stream via tar (stdin → contêiner)**
    
    ```bash
    tar czf - ./data | docker cp - meu_container:/data.tar.gz
    
    ```
    
6. **Stream via tar (contêiner → stdout)**
    
    ```bash
    docker cp meu_container:/data - | tar xzf - -C ./backup
    
    ```
    

---

## 7. Tabela de referência rápida

| Componente | Sintaxe / Valor | Descrição |
| --- | --- | --- |
| Básico | `docker cp CONTAINER:SRC DEST` | Copia de contêiner → host. |
| Básico | `docker cp SRC CONTAINER:DEST` | Copia de host → contêiner. |
| Archive | `-a, --archive` | Preserva UID/GID, permissões e timestamps. |
| Follow link | `-L, --follow-link` | Resolve symlinks no SRC antes de copiar. |
| Quiet | `-q, --quiet` | Sem saída de progresso. |
| Stream TAR (stdin) | `docker cp - CONTAINER:DEST` | Lê tar do stdin e extrai no contêiner. |
| Stream TAR (stdout) | `docker cp CONTAINER:SRC -` | Empacota src em tar e envia para stdout. |

---

Com isso, você tem tudo o que precisa para usar o **`docker cp`** de forma segura e flexível, copiando dados para dentro e fora dos seus contêineres conforme suas necessidades. Se surgir qualquer dúvida ou situação especial, só avisar!