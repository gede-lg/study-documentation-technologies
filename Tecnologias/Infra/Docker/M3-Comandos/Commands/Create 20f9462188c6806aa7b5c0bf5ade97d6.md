# Create

---

## 1. Finalidade do `docker create`

O **`docker create`** prepara um novo contêiner no seu host Docker **sem iniciá-lo**. Ele realiza todas as etapas de configuração (networking, volumes, variáveis de ambiente, recursos de CPU e memória etc.) e devolve o ID do contêiner, permitindo que você:

- **Projete** contêineres com configurações complexas antes de rodá-los.
- **Automatize** fluxos onde você quer criar, inspecionar ou conectar volumes antes do start.
- **Separe** a fase de criação da fase de execução (`docker start`).

---

## 2. Sintaxe básica

```bash
docker create [OPTIONS] IMAGE [COMMAND] [ARG...]

```

- **`IMAGE`**: imagem Docker de base (ex.: `ubuntu:20.04`, `nginx:latest`).
- **`[COMMAND] [ARG...]`**: (opcionais) comando + argumentos que substituirão o `ENTRYPOINT`/`CMD` da imagem.

Ao final, o comando imprime algo como:

```
$ docker create ubuntu sleep 3600
d9b100f2f636e507607a3c2b5289b130b9ea9f3b4f50b8e7d3c0a835b54f5c5a

```

---

## 3. Principais categorias de opções

Para simplificar, agrupamos as centenas de flags em blocos funcionais:

1. **Redes e DNS**
2. **Volumes e armazenamento**
3. **Ambiente e metadados**
4. **Recursos de CPU e memória**
5. **Segurança e isolamentos**
6. **Logs e dispositivos**
7. **Outras opções úteis**

---

### 3.1 Redes e DNS

| Opção | Descrição |
| --- | --- |
| `--network <network>` | Conecta o contêiner à rede Docker especificada (`bridge`, `host`, `none` ou custom). |
| `-p, --publish <ports>` | Mapeia portas host:container (ex.: `-p 8080:80`). |
| `-P, --publish-all` | Mapeia todas as portas expostas para portas aleatórias no host. |
| `--dns <servers>` | Servidores DNS customizados (ex.: `--dns 8.8.8.8`). |
| `--dns-search <domains>` | Domínios de busca DNS (ex.: `--dns-search example.com`). |
| `--add-host <host:ip>` | Insere entrada em `/etc/hosts` do contêiner. |

---

### 3.2 Volumes e armazenamento

| Opção | Descrição |
| --- | --- |
| `-v, --volume <src:dst[:ro]>` | Bind-mount local ou volume nomeado (`host_path:container_path[:ro]`). |
| `--mount type=<type>,...` | Definição avançada de bind, volume ou tmpfs. |
| `--tmpfs <paths>` | Monta um tmpfs dentro do contêiner (ex.: `--tmpfs /run`). |
| `--volumes-from <container>` | Monta volumes de outro contêiner existente. |

---

### 3.3 Ambiente e metadados

| Opção | Descrição |
| --- | --- |
| `-e, --env <VAR=val>` | Define variável de ambiente dentro do contêiner. |
| `--env-file <file>` | Carrega variáveis de ambiente de um arquivo (`VAR=valor`). |
| `-l, --label <key=val>` | Adiciona metadata (labels) ao contêiner. |
| `--annotation <key=val>` | Anotações passadas ao runtime OCI (para integração avançada). |

---

### 3.4 Recursos de CPU e memória

| Opção | Descrição |
| --- | --- |
| `-m, --memory <bytes>` | Limite de memória RAM (`512m`, `2g`). |
| `--memory-swap <bytes>` | Limite de swap + RAM (`-1` para ilimitado). |
| `--cpus <decimal>` | Número de CPUs atribuídas (ex.: `--cpus 1.5`). |
| `-c, --cpu-shares <int>` | Peso relativo de CPU (default 1024). |
| `--cpuset-cpus <list>` | CPUs específicas permitidas (ex.: `0-3`). |

---

### 3.5 Segurança e isolamentos

| Opção | Descrição |
| --- | --- |
| `--user <user | uid[:grp |
| `--read-only` | Monta o filesystem raiz como somente-leitura. |
| `--cap-add <cap>` | Adiciona Linux capabilities (ex.: `NET_ADMIN`). |
| `--cap-drop <cap>` | Remove capabilities. |
| `--security-opt <opt>` | Opções de segurança (AppArmor, SELinux, seccomp). |
| `--privileged` | Concede privilégios ampliados (uso cuidadoso). |

---

### 3.6 Logs e dispositivos

| Opção | Descrição |
| --- | --- |
| `--log-driver <driver>` | Define driver de logs (`json-file`, `syslog`, etc.). |
| `--log-opt <opt>` | Opções do driver de logs (ex.: `max-size=10m`). |
| `--device <host_dev:ctr_dev>` | Exponha dispositivo do host no contêiner (ex.: `/dev/snd`). |

---

### 3.7 Outras opções úteis

| Opção | Descrição |
| --- | --- |
| `--name <string>` | Define um nome legível ao contêiner. |
| `--hostname, -h <string>` | Configura o hostname do contêiner. |
| `-i, --interactive` | Mantém o STDIN aberto (útil para `docker attach`). |
| `-t, --tty` | Aloca um pseudo-TTY (para shells interativos). |
| `--entrypoint <string>` | Sobrescreve o ENTRYPOINT da imagem. |
| `--workdir, -w <dir>` | Define diretório de trabalho dentro do contêiner. |
| `--restart <policy>` | Política de reinício (`no`, `on-failure`, `always`, `unless-stopped`). |
| `--rm` | Remove automaticamente o contêiner após parado (não preserva volumes anônimos). |
| `--detach-keys <seq>` | Sequência de teclas para desanexar depois de `docker attach`. |

---

## 4. Exemplos de uso

1. **Criar um contêiner com nome e sem iniciá-lo**
    
    ```bash
    docker create --name web_tmp nginx:latest
    
    ```
    
2. **Criar e mapear portas e volumes**
    
    ```bash
    docker create \
      -p 8080:80 \
      -v /data/web:/usr/share/nginx/html:ro \
      --name static_site \
      nginx:alpine
    
    ```
    
3. **Criar com limites de memória e CPU**
    
    ```bash
    docker create \
      -m 512m \
      --cpus 1.0 \
      --name worker \
      ubuntu:20.04 \
      sleep 3600
    
    ```
    
4. **Definir usuário e diretório de trabalho**
    
    ```bash
    docker create \
      -u appuser \
      -w /app \
      --name myapp \
      myimage:latest \
      ./start.sh
    
    ```
    
5. **Criar e configurar política de reinício**
    
    ```bash
    docker create \
      --restart unless-stopped \
      --name db \
      postgres:14
    
    ```
    

---

## 5. Tabela de referência rápida

| Categoria | Exemplos de flags |
| --- | --- |
| Rede | `-p`, `-P`, `--network`, `--add-host` |
| Armazenamento | `-v`, `--mount`, `--tmpfs`, `--volumes-from` |
| Ambiente | `-e`, `--env-file`, `-l`, `--annotation` |
| Recursos | `-m`, `--memory-swap`, `--cpus`, `--cpu-shares` |
| Segurança | `--user`, `--read-only`, `--cap-add`, `--privileged` |
| Execução | `--name`, `-i`, `-t`, `--entrypoint`, `-w` |
| Outros | `--restart`, `--rm`, `--detach-keys`, `--cidfile` |

---

Com essa visão completa, você pode **criar** contêineres com todas as configurações necessárias antes de iniciá-los, garantindo maior controle sobre o ciclo de vida e os recursos alocados. Se precisar de mais detalhes ou cenários específicos, é só avisar!