## O que é e para que serve?

A chave `configs` no arquivo `docker-compose.yml` é utilizada no contexto de aplicações Docker, especificamente com o Docker Swarm, para gerenciar configurações sensíveis ou não, que não devem estar hard-coded nos arquivos de serviço. Essa abordagem é útil para separar a configuração do código, permitindo uma maior flexibilidade e segurança, especialmente em ambientes de produção.

## Restrições de uso

As principais restrições relacionadas ao uso da chave `configs` incluem:

- **Compatibilidade**: Disponível apenas quando se utiliza o modo swarm do Docker.
- **Imutabilidade**: Uma vez criado, um objeto de configuração não pode ser alterado. Se necessário modificar o conteúdo de uma configuração, deve-se criar uma nova configuração com o conteúdo atualizado e atualizar os serviços que a utilizam.
- **Limitação de serviço**: As configurações são acessíveis apenas para os serviços que explicitamente as referenciam em seu serviço no `docker-compose.yml`.

## Subchaves de `configs`

Dentro de `configs`, você pode definir várias subchaves para configurar os aspectos detalhados da configuração. As principais subchaves incluem:

- **`name`**: Nome da configuração, como é referenciado no Docker.
- **`file`** ou **`external`**: Determina se a configuração será criada a partir de um arquivo local (`file`) ou se é uma configuração externa já existente no Docker Swarm (`external`).
- **`labels`**: Rótulos opcionais para aplicar às configurações, úteis para organizar e filtrar as configurações dentro do Docker.

##### 1. `name`

A subchave `name` é usada para definir um nome identificador para a configuração. Este nome é utilizado para referenciar a configuração nos serviços que a utilizam.

**Formato de Uso:**
```yaml
configs:
  my_config:
    name: my_custom_config_name
```

##### 2. `file`

A subchave `file` especifica o caminho do arquivo no host que será carregado como configuração.

**Formato de Uso:**
```yaml
configs:
  my_config:
    file: ./path/to/my/config/file.txt
```

##### 3. `external`

A subchave `external` indica se a configuração é gerenciada fora do Docker Compose. Se for `true`, significa que o Docker Compose espera que a configuração já exista no ambiente Docker e não tentará criar uma nova.

**Formato de Uso:**
```yaml
configs:
  my_config:
    external: true
```

##### 4. `labels`

`labels` permite adicionar metadados à configuração na forma de pares chave-valor. Essas etiquetas podem ser usadas para organizar, categorizar ou filtrar configurações durante consultas administrativas ou por ferramentas de gerenciamento.

**Formato de Uso:**
```yaml
configs:
  my_config:
    labels:
      com.example.description: "Configuração de exemplo"
```

#### Considerações Adicionais

Utilizar a chave `configs` no Docker Compose permite uma gestão centralizada e segura de arquivos de configuração, essencial para manter a segurança e a integridade das aplicações em ambientes de produção. É especialmente útil em cenários onde configurações precisam ser compartilhadas entre vários serviços ou quando se deseja facilitar a atualização de configurações sem reconstruir imagens Docker.
## Exemplo completo utilizando a chave e todas suas subchaves

Aqui está um exemplo detalhado de como usar a chave `configs` e suas subchaves em um arquivo `docker-compose.yml`. Este exemplo ilustra como definir configurações, referenciá-las em serviços e aplicar rótulos para organização:

```yaml
version: '3.8'
services:
  app:
    image: my-app-image:latest
    ports:
      - "8080:80"
    configs:
      - source: my_app_config
        target: /etc/configs/my_app_config
        uid: '1000'
        gid: '1000'
        mode: 0440

configs:
  my_app_config:
    name: my_custom_config_name
    file: ./config/app_config.txt
    external: false
    labels:
      com.example.description: "Arquivo de configuração principal do aplicativo"
      
  another_config:
    external: true
    name: existing_config_name
    labels:
      - "com.example.description=Configuração externa existente"
```

### Detalhes do exemplo:

- **Serviço `app`**: Um serviço que utiliza a imagem `my-app-image:latest`, mapeando a porta 8080 do host para a porta 80 do contêiner e utilizando uma configuração chamada `my_app_config`.
- **Configuração `my_app_config`**:
  - **`file`**: Define que a configuração é carregada a partir de um arquivo local chamado `./config_data/app_config`.
  - **`labels`**: Aplica um rótulo à configuração para descrever sua utilização.
- **Configuração `another_config`**:
  - **`external`**: Indica que esta é uma configuração já existente e gerenciada externamente pelo Docker Swarm.
  - **`name`**: Especifica o nome da configuração externa que está sendo referenciada.
  - **`labels`**: Aplica um rótulo similar à primeira configuração para fins de organização e descrição.

Este exemplo mostra como você pode gerenciar configurações de forma eficaz dentro de um ambiente Docker, especialmente quando operando em modo swarm, promovendo práticas seguras e escaláveis de gerenciamento de configurações.