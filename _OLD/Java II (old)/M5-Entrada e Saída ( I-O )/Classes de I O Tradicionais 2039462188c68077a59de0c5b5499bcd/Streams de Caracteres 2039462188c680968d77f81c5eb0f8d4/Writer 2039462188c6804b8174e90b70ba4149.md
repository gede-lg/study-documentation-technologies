# Writer

## 1. Introdução

Streams de caracteres em Java são abstrações de fluxo de dados especiais para manipular texto (sequências de caracteres) de forma eficiente e segura. Dentro do pacote `java.io`, os objetos do tipo **Writer** são responsáveis por escrever caracteres em destinos diversos (arquivos, buffers de memória, sockets etc.).

- **Visão Geral**
Os Writers fazem parte da hierarquia de I/O orientada a caracteres, que codifica diretamente em `char` e `String` em vez de bytes brutos. Isso evita problemas de conversão de charset e facilita o trabalho com texto.
- **Relevância**
    - Permitem escrever arquivos de configuração, logs e gerar relatórios de texto.
    - Internamente cuidam da codificação (UTF-8, ISO-8859-1 etc.).
    - Oferecem filtros (buffers, compactadores, cifradores) encadeáveis para otimização e transformação de dados.
- **Definição e Conceitos Fundamentais**
    - **Tema principal**: Streams de caracteres — focado na classe abstrata `java.io.Writer`.
    - **Subtemas**:
        - Escrita simples (`FileWriter`, `OutputStreamWriter`)
        - Bufferização (`BufferedWriter`)
        - Escrita em memória (`StringWriter`)
        - Encadeamento de filtros (composição de Writers)
    - **Para que servem**: organizar e otimizar a saída de texto, garantindo correto tratamento de charset e performance.

---

## 2. Sumário

1. [Sintaxe e Estrutura](Writer%202039462188c6804b8174e90b70ba4149.md)
2. [Componentes Principais](Writer%202039462188c6804b8174e90b70ba4149.md)
3. [Restrições de Uso](Writer%202039462188c6804b8174e90b70ba4149.md)
4. [Exemplos de Código Otimizados](Writer%202039462188c6804b8174e90b70ba4149.md)
5. [Informações Adicionais](Writer%202039462188c6804b8174e90b70ba4149.md)
6. [Referências para Estudo Independente](Writer%202039462188c6804b8174e90b70ba4149.md)

---

## 3. Conteúdo Detalhado

### Sintaxe e Estrutura

- **`java.io.Writer`** é a classe abstrata base:
    
    ```java
    public abstract class Writer implements Closeable, Flushable {
        public abstract void write(char[] cbuf, int off, int len) throws IOException;
        public void write(int c) throws IOException { … }          // escreve um char
        public void write(String str) throws IOException { … }      // escreve uma String
        public void write(String str, int off, int len) throws IOException { … }
        public void flush() throws IOException { … }                // força envio de buffers
        public void close() throws IOException { … }                // fecha o stream
    }
    
    ```
    
- **Fluxo básico**:
    1. Instanciar um Writer concreto.
    2. Chamar `write(...)` para adicionar caracteres ao buffer interno.
    3. Chamar `flush()` para garantir gravação física (opcional antes de `close()`).
    4. Chamar `close()` para liberar recursos.

---

### Componentes Principais

1. **`FileWriter`**
    - Subclasse de `OutputStreamWriter` especializada em arquivos.
    - Usa charset padrão da plataforma ou pode receber um `Charset` (Java 11+).
    
    ```java
    Writer fw = new FileWriter("saida.txt", StandardCharsets.UTF_8);
    
    ```
    
2. **`OutputStreamWriter`**
    - Adapta um `OutputStream` (bytes) para `Writer` (chars).
    - Permite especificar `Charset` explicitamente.
    
    ```java
    OutputStream os = new FileOutputStream("dados.txt");
    Writer osw = new OutputStreamWriter(os, StandardCharsets.UTF_8);
    
    ```
    
3. **`BufferedWriter`**
    - Envolve outro Writer, adiciona buffer de saída.
    - Reduz chamadas de I/O físicas, melhorando performance.
    
    ```java
    Writer bw = new BufferedWriter(new FileWriter("log.txt"));
    
    ```
    
    - Métodos adicionais:
        - `newLine()` para pular linha com convenção de plataforma.
4. **`StringWriter`**
    - Escrita em memória (StringBuilder interno).
    - Útil para testes, geração de templates e logs em string.
    
    ```java
    StringWriter sw = new StringWriter();
    sw.write("Olá, mundo!");
    String resultado = sw.toString();
    
    ```
    
5. **Encadeamento de Filters**
    - Pode-se combinar vários Writers para adicionar camadas de funcionalidade:
        
        ```java
        Writer writer =
          new BufferedWriter(
            new OutputStreamWriter(socket.getOutputStream(), StandardCharsets.UTF_8)
          );
        
        ```
        

---

### Restrições de Uso

- **Charset**: usar sempre charset explícito em `OutputStreamWriter`/`FileWriter` (Java 11+) para evitar inconsistências entre ambientes.
- **Buffer vs. Flush**: chamar `flush()` somente quando necessário (por ex., antes de troca de contexto); caso contrário, deixar que o `close()` cuide disso.
- **Concorrência**: Writers **não** são thread-safe; para acesso multithread, sincronize externamente ou use wrappers (`java.io.Writer synchronizedWriter = new BufferedWriter(...);`).

---

## 4. Exemplos de Código Otimizados

### 4.1 Gravação em Arquivo com Buffer

```java
import java.io.*;
import java.nio.charset.StandardCharsets;

public class GravaArquivo {
    public static void main(String[] args) {
        // Usa try-with-resources para auto-close
        try (Writer writer = new BufferedWriter(
                new OutputStreamWriter(
                    new FileOutputStream("relatorio.txt"), StandardCharsets.UTF_8
                )
             )) {
            writer.write("Relatório de Vendas\\n");
            writer.write("================================\\n");
            for (int i = 1; i <= 5; i++) {
                writer.write(String.format("Item %d: %d unidades%n", i, i * 10));
            }
            // flush é implícito no close()
        } catch (IOException e) {
            e.printStackTrace();
        }
    }
}

```

- **Melhores práticas**:
    - `try-with-resources` garante `close()`.
    - Charset explícito evita problemas de encoding.
    - Buffer reduz operações de disco.

---

### 4.2 Geração de Texto em Memória

```java
import java.io.*;

public class TemplateProcessor {
    public String gerarCarta(String nome, String mensagem) throws IOException {
        try (StringWriter sw = new StringWriter();
             BufferedWriter bw = new BufferedWriter(sw)) {

            bw.write("Prezado(a) " + nome + ",");
            bw.newLine();
            bw.newLine();
            bw.write(mensagem);
            bw.newLine();
            bw.write("Atenciosamente,");
            bw.newLine();
            bw.write("Equipe de Suporte");
            // Flush antes de toString()
            bw.flush();
            return sw.toString();
        }
    }
}

```

- Imagina uso em APIs de geração de e-mails ou relatórios sem criar arquivos temporários.

---

### 4.3 Escrita em Socket com Encadeamento

```java
import java.io.*;
import java.net.Socket;
import java.nio.charset.StandardCharsets;

public class ClientSender {
    public void sendMessage(Socket socket, String message) throws IOException {
        try (Writer writer = new BufferedWriter(
                new OutputStreamWriter(socket.getOutputStream(), StandardCharsets.UTF_8)
             )) {
            writer.write(message);
            writer.write("\\r\\n");  // protocolo de linha
            writer.flush();         // garante envio imediato
        }
    }
}

```

- Exemplo de como combinar I/O de rede com abstração de caracteres.

---

## 5. Informações Adicionais

- **Performance**: em casos de escrita em disco de alto volume, use `BufferedWriter` com tamanho de buffer customizado (ex.: `new BufferedWriter(wrappedWriter, 16 * 1024)`).
- **Alternativas em NIO**: para cenários de alta performance, explore `java.nio.channels.FileChannel` e classes do pacote `java.nio.charset`.
- **Internacionalização**: cuidado ao escrever arquivos de propriedades (`.properties`) — use `Writer` e `Reader` com `ISO-8859-1` ou a classe `java.util.Properties.store(Writer, coment)`.

---

## 6. Referências para Estudo Independente

- [API `java.io.Writer` (Oracle Docs)](https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/io/Writer.html)
- [Guia de I/O em Java (Baeldung)](https://www.baeldung.com/java-io)
- Livro **“Java I/O”** de Elliotte Rusty Harold
- Tutorial oficial Oracle: [Essential Java™ Classes – I/O](https://docs.oracle.com/javase/tutorial/essential/io/)