# Redux Toolkit (RTK)

## üéØ Introdu√ß√£o e Defini√ß√£o

### Defini√ß√£o Conceitual

**Redux Toolkit (RTK)** √© **official toolset** do Redux que elimina 70% do boilerplate - API moderna com **configureStore**, **createSlice**, **createAsyncThunk**. Substitui `createStore` + manual reducers + action creators por abstra√ß√µes: `createSlice` gera actions + reducer automaticamente, `configureStore` setup DevTools + thunks sem config, **Immer** embutido permite "mutation" syntax (realmente imut√°vel por baixo).

RTK representa **Redux moderno** (2019+): desenvolvedor escreve menos c√≥digo, mant√©m previsibilidade. `createSlice` = declarar state + reducers, RTK gera actions/types. `createAsyncThunk` = fetch async sem boilerplate manual. Trade-off: **abstra√ß√£o** vs **controle** - RTK esconde complexidade, Redux cl√°ssico exp√µe tudo.

**Filosofia:** "Simple things simple, complex things possible." RTK = defaults inteligentes (DevTools on, Immer on, thunks on). Developer escreve business logic, RTK cuida de plumbing. Redux + RTK = combina√ß√£o poderosa para scale.

### Import√¢ncia no Ecossistema

RTK √© **essencial** para:

- **Reduzir boilerplate**: 70% menos c√≥digo que Redux cl√°ssico
- **Melhor DX**: API intuitiva, menos configura√ß√£o
- **Modern defaults**: DevTools, Immer, thunks built-in
- **Official recommendation**: Redux docs recomendam RTK (n√£o Redux cl√°ssico)

**Contexto:** Lan√ßado em 2019 pelo Redux team. Hoje √© **padr√£o** - Redux docs ensinam RTK first. Apps novas devem usar RTK, n√£o Redux cl√°ssico. 10M+ downloads/semana.

---

## üìã Sum√°rio Conceitual

### T√≥picos Cobertos

1. **configureStore**: Setup store com defaults
2. **createSlice**: Gerar actions + reducer
3. **createAsyncThunk**: Async actions simplificadas
4. **RTK Query**: Data fetching (bonus)
5. **Migration**: Redux cl√°ssico ‚Üí RTK

---

## üîç An√°lise Conceitual Profunda

### 13.4.1 Instala√ß√£o

```bash
npm install @reduxjs/toolkit react-redux
```

**RTK inclui:**
- Redux core
- Redux Thunk
- Immer (mutations)
- Reselect (memoized selectors)

### 13.4.2 configureStore

**Redux cl√°ssico (verbose):**
```javascript
import { createStore, applyMiddleware, combineReducers } from 'redux';
import thunk from 'redux-thunk';
import { composeWithDevTools } from 'redux-devtools-extension';

const rootReducer = combineReducers({
  todos: todosReducer,
  user: userReducer
});

const store = createStore(
  rootReducer,
  composeWithDevTools(applyMiddleware(thunk))
);
```

**RTK (conciso):**
```javascript
import { configureStore } from '@reduxjs/toolkit';
import todosReducer from './slices/todosSlice';
import userReducer from './slices/userSlice';

const store = configureStore({
  reducer: {
    todos: todosReducer,
    user: userReducer
  }
  // DevTools, thunks, Immer = ON automaticamente
});

export default store;
```

**Defaults autom√°ticos:**
- Redux DevTools Extension habilitado
- Redux Thunk middleware habilitado
- Immer para immutability habilitado
- Serialization checks (dev mode)

### 13.4.3 createSlice

**Redux cl√°ssico (3 arquivos):**
```javascript
// types.js
export const ADD_TODO = 'ADD_TODO';
export const TOGGLE_TODO = 'TOGGLE_TODO';

// actions.js
export function addTodo(text) {
  return { type: ADD_TODO, payload: { id: Date.now(), text, completed: false } };
}

export function toggleTodo(id) {
  return { type: TOGGLE_TODO, payload: id };
}

// reducer.js
import { ADD_TODO, TOGGLE_TODO } from './types';

const initialState = [];

export default function todosReducer(state = initialState, action) {
  switch (action.type) {
    case ADD_TODO:
      return [...state, action.payload];
    case TOGGLE_TODO:
      return state.map(todo =>
        todo.id === action.payload ? { ...todo, completed: !todo.completed } : todo
      );
    default:
      return state;
  }
}
```

**RTK (1 arquivo):**
```javascript
// slices/todosSlice.js
import { createSlice } from '@reduxjs/toolkit';

const todosSlice = createSlice({
  name: 'todos',
  initialState: [],
  reducers: {
    addTodo: (state, action) => {
      // Immer permite "mutation" syntax
      state.push({
        id: Date.now(),
        text: action.payload,
        completed: false
      });
    },

    toggleTodo: (state, action) => {
      const todo = state.find(todo => todo.id === action.payload);
      if (todo) {
        todo.completed = !todo.completed;
      }
    },

    deleteTodo: (state, action) => {
      return state.filter(todo => todo.id !== action.payload);
    }
  }
});

// Actions geradas automaticamente
export const { addTodo, toggleTodo, deleteTodo } = todosSlice.actions;

// Reducer
export default todosSlice.reducer;
```

**Uso no component:**
```javascript
import { useDispatch, useSelector } from 'react-redux';
import { addTodo, toggleTodo } from './slices/todosSlice';

function TodoList() {
  const dispatch = useDispatch();
  const todos = useSelector((state) => state.todos);

  return (
    <div>
      <button onClick={() => dispatch(addTodo('Learn RTK'))}>
        Add Todo
      </button>

      <ul>
        {todos.map(todo => (
          <li key={todo.id}>
            <input
              type="checkbox"
              checked={todo.completed}
              onChange={() => dispatch(toggleTodo(todo.id))}
            />
            {todo.text}
          </li>
        ))}
      </ul>
    </div>
  );
}
```

### 13.4.4 createSlice com Prepare

**Payload customizado:**
```javascript
const todosSlice = createSlice({
  name: 'todos',
  initialState: [],
  reducers: {
    // ‚ùå Sem prepare: payload = text apenas
    // addTodo: (state, action) => {
    //   state.push({ id: Date.now(), text: action.payload, completed: false });
    // }

    // ‚úÖ Com prepare: controle total sobre action
    addTodo: {
      reducer: (state, action) => {
        state.push(action.payload);
      },
      prepare: (text) => {
        return {
          payload: {
            id: Date.now(),
            text,
            completed: false,
            createdAt: new Date().toISOString()
          }
        };
      }
    }
  }
});

// Uso: dispatch(addTodo('Learn RTK'))
// Action: { type: 'todos/addTodo', payload: { id, text, completed, createdAt } }
```

### 13.4.5 createAsyncThunk

**Redux cl√°ssico (verbose):**
```javascript
// Action types
const FETCH_TODOS_START = 'FETCH_TODOS_START';
const FETCH_TODOS_SUCCESS = 'FETCH_TODOS_SUCCESS';
const FETCH_TODOS_ERROR = 'FETCH_TODOS_ERROR';

// Action creators
export function fetchTodos() {
  return async (dispatch) => {
    dispatch({ type: FETCH_TODOS_START });

    try {
      const response = await fetch('/api/todos');
      const data = await response.json();
      dispatch({ type: FETCH_TODOS_SUCCESS, payload: data });
    } catch (error) {
      dispatch({ type: FETCH_TODOS_ERROR, payload: error.message });
    }
  };
}

// Reducer
function todosReducer(state = { data: [], loading: false, error: null }, action) {
  switch (action.type) {
    case FETCH_TODOS_START:
      return { ...state, loading: true, error: null };
    case FETCH_TODOS_SUCCESS:
      return { ...state, loading: false, data: action.payload };
    case FETCH_TODOS_ERROR:
      return { ...state, loading: false, error: action.payload };
    default:
      return state;
  }
}
```

**RTK (conciso):**
```javascript
import { createSlice, createAsyncThunk } from '@reduxjs/toolkit';

// Async thunk
export const fetchTodos = createAsyncThunk(
  'todos/fetchTodos',
  async () => {
    const response = await fetch('/api/todos');
    return response.json();
  }
);

const todosSlice = createSlice({
  name: 'todos',
  initialState: {
    data: [],
    loading: false,
    error: null
  },
  reducers: {},
  extraReducers: (builder) => {
    builder
      .addCase(fetchTodos.pending, (state) => {
        state.loading = true;
        state.error = null;
      })
      .addCase(fetchTodos.fulfilled, (state, action) => {
        state.loading = false;
        state.data = action.payload;
      })
      .addCase(fetchTodos.rejected, (state, action) => {
        state.loading = false;
        state.error = action.error.message;
      });
  }
});

export default todosSlice.reducer;
```

**Uso no component:**
```javascript
import { useEffect } from 'react';
import { useDispatch, useSelector } from 'react-redux';
import { fetchTodos } from './slices/todosSlice';

function TodoList() {
  const dispatch = useDispatch();
  const { data: todos, loading, error } = useSelector((state) => state.todos);

  useEffect(() => {
    dispatch(fetchTodos());
  }, [dispatch]);

  if (loading) return <div>Loading...</div>;
  if (error) return <div>Error: {error}</div>;

  return (
    <ul>
      {todos.map(todo => (
        <li key={todo.id}>{todo.text}</li>
      ))}
    </ul>
  );
}
```

### 13.4.6 createAsyncThunk com Params

**Thunk com argumentos:**
```javascript
export const fetchUserById = createAsyncThunk(
  'users/fetchById',
  async (userId) => {
    const response = await fetch(`/api/users/${userId}`);
    return response.json();
  }
);

// Uso
dispatch(fetchUserById(123));
```

**Thunk com error handling:**
```javascript
export const fetchUserById = createAsyncThunk(
  'users/fetchById',
  async (userId, { rejectWithValue }) => {
    try {
      const response = await fetch(`/api/users/${userId}`);

      if (!response.ok) {
        throw new Error('User not found');
      }

      return response.json();
    } catch (error) {
      return rejectWithValue(error.message);
    }
  }
);

// Reducer
extraReducers: (builder) => {
  builder
    .addCase(fetchUserById.rejected, (state, action) => {
      state.error = action.payload; // Error message customizada
    });
}
```

**Thunk com dispatch/getState:**
```javascript
export const fetchTodosIfNeeded = createAsyncThunk(
  'todos/fetchIfNeeded',
  async (_, { getState, dispatch }) => {
    const state = getState();

    // N√£o fetch se j√° tem data
    if (state.todos.data.length > 0) {
      return state.todos.data;
    }

    const response = await fetch('/api/todos');
    return response.json();
  }
);
```

### 13.4.7 Exemplo Completo: Todo App com RTK

**1. Store:**
```javascript
// app/store.js
import { configureStore } from '@reduxjs/toolkit';
import todosReducer from '../features/todos/todosSlice';
import filterReducer from '../features/filters/filterSlice';

export const store = configureStore({
  reducer: {
    todos: todosReducer,
    filter: filterReducer
  }
});
```

**2. Todos Slice:**
```javascript
// features/todos/todosSlice.js
import { createSlice, createAsyncThunk } from '@reduxjs/toolkit';

export const fetchTodos = createAsyncThunk(
  'todos/fetchTodos',
  async () => {
    const response = await fetch('/api/todos');
    return response.json();
  }
);

export const addTodoAsync = createAsyncThunk(
  'todos/addTodo',
  async (text) => {
    const response = await fetch('/api/todos', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ text })
    });
    return response.json();
  }
);

const todosSlice = createSlice({
  name: 'todos',
  initialState: {
    items: [],
    loading: false,
    error: null
  },
  reducers: {
    toggleTodo: (state, action) => {
      const todo = state.items.find(todo => todo.id === action.payload);
      if (todo) {
        todo.completed = !todo.completed;
      }
    },

    deleteTodo: (state, action) => {
      state.items = state.items.filter(todo => todo.id !== action.payload);
    }
  },
  extraReducers: (builder) => {
    builder
      // Fetch todos
      .addCase(fetchTodos.pending, (state) => {
        state.loading = true;
      })
      .addCase(fetchTodos.fulfilled, (state, action) => {
        state.loading = false;
        state.items = action.payload;
      })
      .addCase(fetchTodos.rejected, (state, action) => {
        state.loading = false;
        state.error = action.error.message;
      })
      // Add todo
      .addCase(addTodoAsync.fulfilled, (state, action) => {
        state.items.push(action.payload);
      });
  }
});

export const { toggleTodo, deleteTodo } = todosSlice.actions;
export default todosSlice.reducer;
```

**3. Filter Slice:**
```javascript
// features/filters/filterSlice.js
import { createSlice } from '@reduxjs/toolkit';

const filterSlice = createSlice({
  name: 'filter',
  initialState: 'all',
  reducers: {
    setFilter: (state, action) => {
      return action.payload;
    }
  }
});

export const { setFilter } = filterSlice.actions;
export default filterSlice.reducer;
```

**4. Selectors:**
```javascript
// features/todos/todosSelectors.js
import { createSelector } from '@reduxjs/toolkit';

export const selectTodos = (state) => state.todos.items;
export const selectFilter = (state) => state.filter;

export const selectFilteredTodos = createSelector(
  [selectTodos, selectFilter],
  (todos, filter) => {
    if (filter === 'active') {
      return todos.filter(todo => !todo.completed);
    }
    if (filter === 'completed') {
      return todos.filter(todo => todo.completed);
    }
    return todos;
  }
);
```

**5. Components:**
```javascript
// features/todos/TodoList.js
import { useEffect } from 'react';
import { useDispatch, useSelector } from 'react-redux';
import { fetchTodos, toggleTodo, deleteTodo } from './todosSlice';
import { selectFilteredTodos } from './todosSelectors';

function TodoList() {
  const dispatch = useDispatch();
  const todos = useSelector(selectFilteredTodos);
  const loading = useSelector((state) => state.todos.loading);

  useEffect(() => {
    dispatch(fetchTodos());
  }, [dispatch]);

  if (loading) return <div>Loading...</div>;

  return (
    <ul>
      {todos.map(todo => (
        <li key={todo.id}>
          <input
            type="checkbox"
            checked={todo.completed}
            onChange={() => dispatch(toggleTodo(todo.id))}
          />
          {todo.text}
          <button onClick={() => dispatch(deleteTodo(todo.id))}>
            Delete
          </button>
        </li>
      ))}
    </ul>
  );
}

// features/todos/AddTodoForm.js
import { useState } from 'react';
import { useDispatch } from 'react-redux';
import { addTodoAsync } from './todosSlice';

function AddTodoForm() {
  const dispatch = useDispatch();
  const [text, setText] = useState('');

  const handleSubmit = (e) => {
    e.preventDefault();
    if (text.trim()) {
      dispatch(addTodoAsync(text));
      setText('');
    }
  };

  return (
    <form onSubmit={handleSubmit}>
      <input
        value={text}
        onChange={(e) => setText(e.target.value)}
        placeholder="Add todo..."
      />
      <button type="submit">Add</button>
    </form>
  );
}

// features/filters/FilterButtons.js
import { useDispatch, useSelector } from 'react-redux';
import { setFilter } from './filterSlice';

function FilterButtons() {
  const dispatch = useDispatch();
  const currentFilter = useSelector((state) => state.filter);

  return (
    <div>
      <button
        onClick={() => dispatch(setFilter('all'))}
        disabled={currentFilter === 'all'}
      >
        All
      </button>
      <button
        onClick={() => dispatch(setFilter('active'))}
        disabled={currentFilter === 'active'}
      >
        Active
      </button>
      <button
        onClick={() => dispatch(setFilter('completed'))}
        disabled={currentFilter === 'completed'}
      >
        Completed
      </button>
    </div>
  );
}

// App.js
import { Provider } from 'react-redux';
import { store } from './app/store';
import AddTodoForm from './features/todos/AddTodoForm';
import TodoList from './features/todos/TodoList';
import FilterButtons from './features/filters/FilterButtons';

function App() {
  return (
    <Provider store={store}>
      <div>
        <h1>Todo App</h1>
        <AddTodoForm />
        <FilterButtons />
        <TodoList />
      </div>
    </Provider>
  );
}
```

### 13.4.8 RTK Query (Bonus)

**Data fetching built-in:**
```javascript
// services/api.js
import { createApi, fetchBaseQuery } from '@reduxjs/toolkit/query/react';

export const api = createApi({
  reducerPath: 'api',
  baseQuery: fetchBaseQuery({ baseUrl: '/api' }),
  endpoints: (builder) => ({
    getTodos: builder.query({
      query: () => 'todos'
    }),

    addTodo: builder.mutation({
      query: (text) => ({
        url: 'todos',
        method: 'POST',
        body: { text }
      })
    }),

    updateTodo: builder.mutation({
      query: ({ id, ...patch }) => ({
        url: `todos/${id}`,
        method: 'PATCH',
        body: patch
      })
    })
  })
});

export const { useGetTodosQuery, useAddTodoMutation, useUpdateTodoMutation } = api;
```

**Store setup:**
```javascript
import { configureStore } from '@reduxjs/toolkit';
import { api } from './services/api';

export const store = configureStore({
  reducer: {
    [api.reducerPath]: api.reducer
  },
  middleware: (getDefaultMiddleware) =>
    getDefaultMiddleware().concat(api.middleware)
});
```

**Uso:**
```javascript
import { useGetTodosQuery, useAddTodoMutation } from './services/api';

function TodoList() {
  const { data: todos, isLoading, error } = useGetTodosQuery();
  const [addTodo] = useAddTodoMutation();

  if (isLoading) return <div>Loading...</div>;
  if (error) return <div>Error</div>;

  return (
    <div>
      <button onClick={() => addTodo('New todo')}>Add</button>
      <ul>
        {todos.map(todo => (
          <li key={todo.id}>{todo.text}</li>
        ))}
      </ul>
    </div>
  );
}
```

---

## üéØ Aplicabilidade e Contextos

### RTK vs Redux Cl√°ssico

| Feature | Redux Cl√°ssico | RTK |
|---------|---------------|-----|
| **Boilerplate** | ‚ùå Verbose | ‚úÖ Conciso |
| **Setup** | ‚ùå Manual | ‚úÖ Autom√°tico |
| **DevTools** | ‚ö†Ô∏è Manual | ‚úÖ Built-in |
| **Immer** | ‚ùå Manual | ‚úÖ Built-in |
| **Learning curve** | ‚ö†Ô∏è Steeper | ‚úÖ Easier |

### Quando Usar RTK

**‚úÖ Use RTK quando:**
- Novo projeto Redux
- Migrar Redux cl√°ssico
- Reduzir boilerplate
- Defaults inteligentes

**‚ùå N√£o use RTK quando:**
- Precisa controle total (cases raros)
- Bundle size cr√≠tico (RTK maior que Redux)

---

## ‚ö†Ô∏è Limita√ß√µes e Considera√ß√µes

### Abstra√ß√£o

**RTK esconde complexidade:**
- Bom: Menos c√≥digo, mais produtividade
- Ruim: Menos controle, "magic" para iniciantes

### Bundle Size

**RTK = ~40kb (Redux + Immer + Reselect + Thunk)**

Para compara√ß√£o:
- Redux cl√°ssico: ~5kb
- Context: 0kb (built-in)

### Learning Curve

**RTK precisa entender Redux primeiro:**
- Store, actions, reducers
- Immutability
- Middleware

---

## üîó Interconex√µes Conceituais

### Rela√ß√£o com Immer

RTK usa **Immer** internamente:
```javascript
// Parece mutation
state.count++;

// Na verdade √© imut√°vel (Immer cria draft)
```

### Rela√ß√£o com Reselect

RTK exporta `createSelector` (Reselect):
```javascript
import { createSelector } from '@reduxjs/toolkit';

export const selectActiveTodos = createSelector(
  (state) => state.todos,
  (todos) => todos.filter(todo => !todo.completed)
);
```

---

## üöÄ Pr√≥ximos Conceitos

**13.5 Alternativas Modernas** - Zustand, Jotai (lightweight alternatives)

**13.6 State Management Patterns** - Decis√£o frameworks

---

## üìö Conclus√£o

### Pontos-Chave

1. **RTK = Redux moderno (oficial)**
2. **configureStore**: Setup autom√°tico
3. **createSlice**: Actions + reducer em 1 arquivo
4. **createAsyncThunk**: Async simplificado
5. **70% menos boilerplate** que Redux cl√°ssico
6. **RTK Query**: Data fetching built-in

### Best Practices

1. **Use RTK** (n√£o Redux cl√°ssico)
2. **Feature-based folders** (todos, users, etc)
3. **createSelector** para computed values
4. **createAsyncThunk** para async
5. **RTK Query** para data fetching (considere)

### Quando Usar

**RTK √© ideal para:**
- Qualquer projeto Redux novo
- Apps m√©dias/grandes
- Reduzir boilerplate

**Alternativas:**
- Context (apps pequenas)
- Zustand/Jotai (lightweight)
- React Query (data fetching only)

**RTK = Redux sem dor. Modern, powerful, productive.**

---

## üìñ Recursos Adicionais

**Documenta√ß√£o:**
- RTK Docs: https://redux-toolkit.js.org/
- RTK Tutorial: https://redux-toolkit.js.org/tutorials/quick-start

**Redux Docs recomendam RTK** como padr√£o oficial.
