# Formul√°rios Controlados no React

## üéØ Introdu√ß√£o e Defini√ß√£o

### Defini√ß√£o Conceitual

**Formul√°rios Controlados** (Controlled Components) s√£o elementos de formul√°rio cujo **valor √© controlado pelo estado React** - o state √© a "fonte √∫nica da verdade" (single source of truth). Cada mudan√ßa no input dispara onChange que atualiza state, que por sua vez atualiza o valor do input via prop `value`. √â um **fluxo unidirecional** de dados totalmente gerenciado por React.

Conceitualmente, transforma inputs de "auto-gerenciados" (DOM mant√©m valor) para "React-gerenciados" (state mant√©m valor). O input se torna **declarativo** - seu valor √© sempre reflexo do state, n√£o de intera√ß√£o direta do usu√°rio com DOM. React tem controle total: pode validar, transformar, ou rejeitar entrada antes de aceitar.

**Met√°fora:** Se input n√£o controlado √© "caixa preta" (DOM gerencia internamente), input controlado √© "painel de vidro" - voc√™ v√™ e controla tudo que acontece dentro, em tempo real.

### Contexto Hist√≥rico e Motiva√ß√£o

**Evolu√ß√£o dos formul√°rios:**

**1990s-2000s: Forms HTML Puro**
```html
<form action="/submit" method="POST">
  <input name="email" type="email">
  <button type="submit">Enviar</button>
</form>
<!-- DOM mant√©m valores, servidor recebe ao submit -->
```

**2010s: jQuery Era**
```javascript
$('#email').on('change', function() {
  var email = $(this).val(); // Ler do DOM
  // Validar, etc.
});
```

**2013 - React: Controlled Components**
React inverteu controle:
```javascript
const [email, setEmail] = useState('');

<input
  value={email}           // React controla valor
  onChange={(e) => setEmail(e.target.value)} // Atualiza state
/>
```

**Motiva√ß√£o:**
- **Single source of truth**: State, n√£o DOM
- **Valida√ß√£o em tempo real**: Interceptar toda mudan√ßa
- **Transforma√ß√£o**: Uppercase, trim, mask
- **Submiss√£o program√°tica**: Valores sempre dispon√≠veis no state

**Filosofia:** "React deve controlar dados, n√£o DOM" - formul√°rios s√£o dados, logo React deve gerenciar.

### Problema Fundamental que Resolve

**Sem controle (uncontrolled):**

```javascript
function UncontrolledForm() {
  const handleSubmit = (e) => {
    e.preventDefault();
    // ‚ùå Precisa ler do DOM
    const email = e.target.elements.email.value;
    console.log(email);
  };

  return (
    <form onSubmit={handleSubmit}>
      <input name="email" type="email" />
      <button type="submit">Enviar</button>
    </form>
  );
}

// Problemas:
// - N√£o sabe valor at√© submit
// - N√£o pode validar em tempo real
// - N√£o pode transformar input
// - Dif√≠cil resetar form
```

**Com controle (controlled):**

```javascript
function ControlledForm() {
  const [email, setEmail] = useState('');
  const [error, setError] = useState('');

  const handleChange = (e) => {
    const value = e.target.value;
    setEmail(value);

    // ‚úÖ Valida√ß√£o em tempo real
    if (value && !value.includes('@')) {
      setError('Email inv√°lido');
    } else {
      setError('');
    }
  };

  const handleSubmit = (e) => {
    e.preventDefault();
    // ‚úÖ Valor j√° est√° no state
    console.log(email);
  };

  return (
    <form onSubmit={handleSubmit}>
      <input
        type="email"
        value={email}
        onChange={handleChange}
      />
      {error && <span>{error}</span>}
      <button type="submit">Enviar</button>
    </form>
  );
}

// Vantagens:
// ‚úÖ Valida√ß√£o em tempo real
// ‚úÖ Transforma√ß√£o de entrada
// ‚úÖ Valor sempre dispon√≠vel
// ‚úÖ F√°cil resetar (setEmail(''))
```

### Import√¢ncia no Ecossistema

Controlled components s√£o **padr√£o React** para formul√°rios:

- **Valida√ß√£o**: Em tempo real, on blur, on submit
- **UX**: Feedback imediato ao usu√°rio
- **Transforma√ß√£o**: Masks, uppercase, trim
- **Estado global**: Integra√ß√£o com Redux/Context
- **Testing**: F√°cil testar l√≥gica de formul√°rio

---

## üìã Sum√°rio Conceitual

### Aspectos Te√≥ricos Centrais

1. **Single source of truth**: State controla valor
2. **Fluxo unidirecional**: onChange ‚Üí setState ‚Üí value
3. **Imutabilidade**: Criar novo state, n√£o mutar
4. **Controlled = value + onChange**: Ambos necess√°rios
5. **Tipos de inputs**: text, select, checkbox, radio

### Pilares Fundamentais

- **value prop**: Vincula input ao state
- **onChange handler**: Atualiza state
- **Computed property name**: `[name]: value` para m√∫ltiplos inputs
- **Imutabilidade**: Spread operator para objetos/arrays
- **Form state**: Objeto √∫nico para todos campos

---

## üß† Fundamentos Te√≥ricos

### Anatomia de Controlled Component

```javascript
function ControlledInput() {
  const [value, setValue] = useState('');

  return (
    <input
      value={value}                       // 1. Value do state
      onChange={(e) => setValue(e.target.value)} // 2. Atualiza state
    />
  );
}

// Fluxo:
// Usu√°rio digita 'a'
//   ‚Üí onChange dispara
//   ‚Üí setValue('a')
//   ‚Üí Re-render
//   ‚Üí value='a' (input mostra 'a')
```

### value vs defaultValue

**value (controlled):**
```javascript
<input value={state} onChange={handler} />
// React controla valor
```

**defaultValue (uncontrolled):**
```javascript
<input defaultValue="inicial" />
// DOM controla valor (uncontrolled)
```

**‚ùå Misturar causa warning:**
```javascript
// Warning: A component is changing an uncontrolled input to be controlled
const [value, setValue] = useState(); // undefined!

<input value={value} onChange={(e) => setValue(e.target.value)} />
// value undefined ‚Üí controlled se torna uncontrolled
```

**‚úÖ Sempre inicialize:**
```javascript
const [value, setValue] = useState(''); // String vazia
```

### Tipos de Inputs

**Text input:**
```javascript
<input
  type="text"
  value={value}
  onChange={(e) => setValue(e.target.value)}
/>
```

**Textarea:**
```javascript
<textarea
  value={value}
  onChange={(e) => setValue(e.target.value)}
/>
```

**Select:**
```javascript
<select value={selected} onChange={(e) => setSelected(e.target.value)}>
  <option value="op1">Op√ß√£o 1</option>
  <option value="op2">Op√ß√£o 2</option>
</select>
```

**Checkbox:**
```javascript
<input
  type="checkbox"
  checked={checked}          // checked, n√£o value!
  onChange={(e) => setChecked(e.target.checked)}
/>
```

**Radio:**
```javascript
<input
  type="radio"
  value="op1"
  checked={selected === 'op1'}
  onChange={(e) => setSelected(e.target.value)}
/>
```

---

## üîç An√°lise Conceitual Profunda

### 10.1.1 Input Text Controlado

```javascript
function TextInput() {
  const [name, setName] = useState('');

  return (
    <div>
      <input
        type="text"
        value={name}
        onChange={(e) => setName(e.target.value)}
        placeholder="Digite seu nome"
      />
      <p>Voc√™ digitou: {name}</p>
    </div>
  );
}
```

**Com transforma√ß√£o (uppercase):**
```javascript
function UppercaseInput() {
  const [name, setName] = useState('');

  const handleChange = (e) => {
    const value = e.target.value.toUpperCase();
    setName(value);
  };

  return (
    <input
      type="text"
      value={name}
      onChange={handleChange}
    />
  );
}
```

**Com valida√ß√£o:**
```javascript
function ValidatedInput() {
  const [email, setEmail] = useState('');
  const [error, setError] = useState('');

  const handleChange = (e) => {
    const value = e.target.value;
    setEmail(value);

    // Valida√ß√£o em tempo real
    if (value && !value.includes('@')) {
      setError('Email deve conter @');
    } else {
      setError('');
    }
  };

  return (
    <div>
      <input
        type="email"
        value={email}
        onChange={handleChange}
      />
      {error && <span style={{ color: 'red' }}>{error}</span>}
    </div>
  );
}
```

### 10.1.2 Select Controlado

```javascript
function SelectExample() {
  const [country, setCountry] = useState('');

  return (
    <div>
      <select value={country} onChange={(e) => setCountry(e.target.value)}>
        <option value="">Selecione um pa√≠s</option>
        <option value="br">Brasil</option>
        <option value="us">Estados Unidos</option>
        <option value="uk">Reino Unido</option>
      </select>
      <p>Pa√≠s selecionado: {country}</p>
    </div>
  );
}
```

**Multiple select:**
```javascript
function MultipleSelect() {
  const [selected, setSelected] = useState([]);

  const handleChange = (e) => {
    const options = Array.from(e.target.selectedOptions);
    const values = options.map(option => option.value);
    setSelected(values);
  };

  return (
    <select multiple value={selected} onChange={handleChange}>
      <option value="op1">Op√ß√£o 1</option>
      <option value="op2">Op√ß√£o 2</option>
      <option value="op3">Op√ß√£o 3</option>
    </select>
  );
}
```

### 10.1.3 Checkbox Controlado

```javascript
function CheckboxExample() {
  const [agreed, setAgreed] = useState(false);

  return (
    <label>
      <input
        type="checkbox"
        checked={agreed}
        onChange={(e) => setAgreed(e.target.checked)}
      />
      Aceito os termos
    </label>
  );
}
```

**M√∫ltiplos checkboxes:**
```javascript
function MultipleCheckboxes() {
  const [interests, setInterests] = useState({
    sports: false,
    music: false,
    reading: false
  });

  const handleChange = (e) => {
    const { name, checked } = e.target;
    setInterests(prev => ({
      ...prev,
      [name]: checked
    }));
  };

  return (
    <div>
      <label>
        <input
          type="checkbox"
          name="sports"
          checked={interests.sports}
          onChange={handleChange}
        />
        Esportes
      </label>
      <label>
        <input
          type="checkbox"
          name="music"
          checked={interests.music}
          onChange={handleChange}
        />
        M√∫sica
      </label>
      <label>
        <input
          type="checkbox"
          name="reading"
          checked={interests.reading}
          onChange={handleChange}
        />
        Leitura
      </label>
      <pre>{JSON.stringify(interests, null, 2)}</pre>
    </div>
  );
}
```

### 10.1.4 Radio Controlado

```javascript
function RadioExample() {
  const [gender, setGender] = useState('');

  return (
    <div>
      <label>
        <input
          type="radio"
          value="male"
          checked={gender === 'male'}
          onChange={(e) => setGender(e.target.value)}
        />
        Masculino
      </label>
      <label>
        <input
          type="radio"
          value="female"
          checked={gender === 'female'}
          onChange={(e) => setGender(e.target.value)}
        />
        Feminino
      </label>
      <p>G√™nero: {gender}</p>
    </div>
  );
}
```

### 10.1.5 Formul√°rio Completo com M√∫ltiplos Inputs

```javascript
function CompleteForm() {
  const [formData, setFormData] = useState({
    name: '',
    email: '',
    country: '',
    gender: '',
    newsletter: false,
    bio: ''
  });

  // Handler √∫nico para todos os inputs
  const handleChange = (e) => {
    const { name, value, type, checked } = e.target;

    setFormData(prev => ({
      ...prev,
      [name]: type === 'checkbox' ? checked : value
    }));
  };

  const handleSubmit = (e) => {
    e.preventDefault();
    console.log('Form submitted:', formData);
  };

  return (
    <form onSubmit={handleSubmit}>
      <input
        name="name"
        type="text"
        value={formData.name}
        onChange={handleChange}
        placeholder="Nome"
      />

      <input
        name="email"
        type="email"
        value={formData.email}
        onChange={handleChange}
        placeholder="Email"
      />

      <select name="country" value={formData.country} onChange={handleChange}>
        <option value="">Pa√≠s</option>
        <option value="br">Brasil</option>
        <option value="us">EUA</option>
      </select>

      <div>
        <label>
          <input
            type="radio"
            name="gender"
            value="male"
            checked={formData.gender === 'male'}
            onChange={handleChange}
          />
          Masculino
        </label>
        <label>
          <input
            type="radio"
            name="gender"
            value="female"
            checked={formData.gender === 'female'}
            onChange={handleChange}
          />
          Feminino
        </label>
      </div>

      <label>
        <input
          type="checkbox"
          name="newsletter"
          checked={formData.newsletter}
          onChange={handleChange}
        />
        Receber newsletter
      </label>

      <textarea
        name="bio"
        value={formData.bio}
        onChange={handleChange}
        placeholder="Bio"
        rows={4}
      />

      <button type="submit">Enviar</button>

      <pre>{JSON.stringify(formData, null, 2)}</pre>
    </form>
  );
}
```

### 10.1.6 Resetar Formul√°rio

```javascript
function ResettableForm() {
  const initialState = {
    name: '',
    email: ''
  };

  const [formData, setFormData] = useState(initialState);

  const handleChange = (e) => {
    const { name, value } = e.target;
    setFormData(prev => ({ ...prev, [name]: value }));
  };

  const handleSubmit = (e) => {
    e.preventDefault();
    console.log('Submitted:', formData);
    // Resetar ap√≥s submit
    setFormData(initialState);
  };

  const handleReset = () => {
    setFormData(initialState);
  };

  return (
    <form onSubmit={handleSubmit}>
      <input name="name" value={formData.name} onChange={handleChange} />
      <input name="email" value={formData.email} onChange={handleChange} />
      <button type="submit">Enviar</button>
      <button type="button" onClick={handleReset}>Resetar</button>
    </form>
  );
}
```

### 10.1.7 Inputs Din√¢micos (Array)

```javascript
function DynamicInputs() {
  const [items, setItems] = useState(['']);

  const handleChange = (index, value) => {
    setItems(prev => {
      const newItems = [...prev];
      newItems[index] = value;
      return newItems;
    });
  };

  const handleAdd = () => {
    setItems(prev => [...prev, '']);
  };

  const handleRemove = (index) => {
    setItems(prev => prev.filter((_, i) => i !== index));
  };

  return (
    <div>
      {items.map((item, index) => (
        <div key={index}>
          <input
            value={item}
            onChange={(e) => handleChange(index, e.target.value)}
          />
          <button onClick={() => handleRemove(index)}>Remover</button>
        </div>
      ))}
      <button onClick={handleAdd}>Adicionar Item</button>
      <pre>{JSON.stringify(items, null, 2)}</pre>
    </div>
  );
}
```

---

## üéØ Aplicabilidade e Contextos

### Quando Usar Controlled Components

‚úÖ **Use controlled quando:**
- Precisa valida√ß√£o em tempo real
- Precisa transformar input (uppercase, mask)
- Precisa acessar valor fora de submit
- Precisa desabilitar submit baseado em valida√ß√£o
- Precisa sincronizar m√∫ltiplos campos

‚ùå **Considere uncontrolled quando:**
- Form simples (apenas submit)
- N√£o precisa valida√ß√£o em tempo real
- Performance cr√≠tica (muitos inputs)
- Integrando com libs n√£o-React

### Patterns Comuns

**1. Handler √∫nico para m√∫ltiplos inputs:**
```javascript
const handleChange = (e) => {
  const { name, value } = e.target;
  setFormData(prev => ({ ...prev, [name]: value }));
};
```

**2. Valida√ß√£o em tempo real:**
```javascript
const handleChange = (e) => {
  const value = e.target.value;
  setValue(value);
  validate(value);
};
```

**3. Transforma√ß√£o:**
```javascript
const handleChange = (e) => {
  const value = e.target.value.toUpperCase();
  setValue(value);
};
```

---

## ‚ö†Ô∏è Limita√ß√µes e Considera√ß√µes

### Performance

**Re-render em cada tecla:**
```javascript
// Toda tecla ‚Üí onChange ‚Üí setState ‚Üí re-render
<input value={value} onChange={(e) => setValue(e.target.value)} />
```

**Solu√ß√£o para forms grandes:** Debounce ou uncontrolled.

### Sempre Inicializar State

```javascript
// ‚ùå Warning
const [value, setValue] = useState(); // undefined

// ‚úÖ Correto
const [value, setValue] = useState(''); // String vazia
```

### Checkbox/Radio: checked n√£o value

```javascript
// ‚úÖ Checkbox
<input type="checkbox" checked={bool} onChange={(e) => setBool(e.target.checked)} />

// ‚úÖ Radio
<input type="radio" checked={selected === 'value'} onChange={handler} />
```

---

## üîó Interconex√µes Conceituais

### Rela√ß√£o com Uncontrolled Components

Controlled = React controla. Uncontrolled = DOM controla.

### Rela√ß√£o com Valida√ß√£o

Controlled permite valida√ß√£o em tempo real (onChange).

### Rela√ß√£o com Libraries

React Hook Form otimiza controlled forms (menos re-renders).

---

## üöÄ Evolu√ß√£o e Pr√≥ximos Conceitos

### Progress√£o Natural

```
Controlled components b√°sico
    ‚Üì
Valida√ß√£o em tempo real
    ‚Üì
Formul√°rios complexos (nested, arrays)
    ‚Üì
Libraries (React Hook Form, Formik)
```

---

## üìö Conclus√£o

Controlled Components s√£o **padr√£o React** para formul√°rios. Princ√≠pios:

1. **Single source of truth**: State controla valor
2. **value + onChange**: Ambos necess√°rios
3. **Valida√ß√£o**: Em tempo real poss√≠vel
4. **Transforma√ß√£o**: Interceptar e modificar input
5. **Tipos**: text, select, checkbox (checked), radio

**Recomenda√ß√µes:**
- Sempre inicialize state (evitar undefined)
- Handler √∫nico para m√∫ltiplos inputs (computed property name)
- Checkbox/Radio usa `checked`, n√£o `value`
- Valida√ß√£o em onChange para feedback imediato
- Considere libraries para forms complexos

**Dominar controlled components = formul√°rios React idiom√°ticos.**
