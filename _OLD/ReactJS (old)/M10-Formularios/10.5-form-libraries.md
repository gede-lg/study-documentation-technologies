# Form Libraries no React

## üéØ Introdu√ß√£o e Defini√ß√£o

### Defini√ß√£o Conceitual

**Form Libraries** s√£o bibliotecas especializadas que **abstraem** complexidade de formul√°rios: state management, valida√ß√£o, error handling, touched/dirty tracking, submit handling. As principais s√£o **React Hook Form** (performance-first, uncontrolled) e **Formik** (developer experience, controlled). Representam **years of best practices** encapsuladas em APIs ergon√¥micas.

Essas bibliotecas resolvem problemas recorrentes: re-renders excessivos, boilerplate de valida√ß√£o, sincroniza√ß√£o de erros, reset de forms, valida√ß√£o ass√≠ncrona, integra√ß√£o com schemas (Yup/Zod). **Trade-off:** adicionar depend√™ncia vs economizar centenas de linhas de c√≥digo boilerplate. Para forms complexos, ROI √© **imenso**.

**Filosofia:** "Don't reinvent the wheel." Formul√°rios s√£o problema **solved** - bibliotecas maduras existem. Usar vanilla React para forms complexos √© como escrever HTTP client do zero ao inv√©s de usar axios/fetch. **Pragmatismo.**

### Import√¢ncia no Ecossistema

Form libraries s√£o **essenciais** para:

- **Enterprise apps**: Formul√°rios extensos s√£o rotina
- **Performance**: React Hook Form elimina re-renders desnecess√°rios
- **Developer Experience**: Menos c√≥digo, mais features
- **Valida√ß√£o**: Integra√ß√£o nativa com Yup/Zod

**Contexto:** React Hook Form tem **40k+ stars** no GitHub. Formik foi padr√£o por anos (~33k stars). Investimento em aprender essas bibliotecas paga dividendos em **todo projeto**.

---

## üìã Sum√°rio Conceitual

### T√≥picos Cobertos

1. **React Hook Form**: Uncontrolled, performance-first
2. **Formik**: Controlled, DX-first
3. **Valida√ß√£o com Schemas**: Yup e Zod
4. **Field Arrays**: Arrays din√¢micos
5. **Compara√ß√£o**: RHF vs Formik

---

## üîç Fundamentos Te√≥ricos

### Controlled vs Uncontrolled Philosophy

**Formik (Controlled):**
```javascript
// Cada input sincroniza com state React
<input value={values.email} onChange={handleChange} />
// Re-render a CADA keystroke
```

**React Hook Form (Uncontrolled):**
```javascript
// Inputs mant√™m pr√≥prio state (DOM)
<input {...register('email')} />
// Re-render APENAS quando necess√°rio (submit, valida√ß√£o)
```

### Performance Impact

**Controlled (Formik):**
- 10 inputs = 10 re-renders por keystroke
- Form grande = performance issues

**Uncontrolled (RHF):**
- 10 inputs = 0 re-renders por keystroke (at√© valida√ß√£o)
- Form grande = performance mantida

**Trade-off:** RHF √© mais r√°pido, Formik √© mais "React-like" (familiar).

---

## üîç An√°lise Conceitual Profunda

### 10.5.1 React Hook Form - B√°sico

**Instala√ß√£o:**
```bash
npm install react-hook-form
```

**Exemplo b√°sico:**
```javascript
import { useForm } from 'react-hook-form';

function BasicForm() {
  const { register, handleSubmit, formState: { errors } } = useForm();

  const onSubmit = (data) => {
    console.log(data);
  };

  return (
    <form onSubmit={handleSubmit(onSubmit)}>
      <input {...register('name', { required: 'Nome √© obrigat√≥rio' })} />
      {errors.name && <span>{errors.name.message}</span>}

      <input
        {...register('email', {
          required: 'Email √© obrigat√≥rio',
          pattern: {
            value: /\S+@\S+\.\S+/,
            message: 'Email inv√°lido'
          }
        })}
      />
      {errors.email && <span>{errors.email.message}</span>}

      <button type="submit">Enviar</button>
    </form>
  );
}
```

**Como funciona:**
- `register()` retorna props para input: `ref`, `name`, `onChange`, `onBlur`
- `handleSubmit()` wrapper que valida antes de chamar `onSubmit`
- `errors` cont√©m mensagens de erro
- **Zero re-renders** ao digitar (valores vivem no DOM via refs)

**Valores padr√£o:**
```javascript
const { register } = useForm({
  defaultValues: {
    name: 'Jo√£o',
    email: 'joao@example.com'
  }
});
```

**Valida√ß√£o built-in:**
```javascript
<input
  {...register('age', {
    required: 'Idade √© obrigat√≥ria',
    min: { value: 18, message: 'Deve ser maior de 18 anos' },
    max: { value: 120, message: 'Idade inv√°lida' }
  })}
  type="number"
/>
```

### 10.5.2 React Hook Form - Avan√ßado

**Watch (observar valores):**
```javascript
function FormWithWatch() {
  const { register, watch } = useForm();

  // Watch specific field
  const password = watch('password');

  // Watch all fields
  const allValues = watch();

  return (
    <form>
      <input {...register('password')} type="password" />
      <p>Senha digitada: {password}</p>

      {/* Conditional field baseado em watch */}
      {watch('hasOtherAddress') && (
        <input {...register('otherAddress')} />
      )}
    </form>
  );
}
```

**GetValues (ler valores sem re-render):**
```javascript
const { register, getValues } = useForm();

const handleCustomAction = () => {
  const currentEmail = getValues('email'); // N√£o causa re-render
  console.log(currentEmail);
};
```

**SetValue (setar valores programaticamente):**
```javascript
const { register, setValue } = useForm();

const handleLoadFromAPI = async () => {
  const data = await fetch('/api/user').then(r => r.json());
  setValue('name', data.name);
  setValue('email', data.email);
};
```

**Reset form:**
```javascript
const { register, reset } = useForm();

const handleReset = () => {
  reset(); // Reset para defaultValues

  // Ou reset para valores espec√≠ficos
  reset({ name: '', email: '' });
};
```

**Valida√ß√£o custom:**
```javascript
<input
  {...register('username', {
    validate: async (value) => {
      const response = await fetch(`/api/check-username?username=${value}`);
      const { available } = await response.json();
      return available || 'Username j√° est√° em uso';
    }
  })}
/>
```

**Valida√ß√£o com m√∫ltiplas regras:**
```javascript
<input
  {...register('password', {
    required: 'Senha √© obrigat√≥ria',
    minLength: {
      value: 8,
      message: 'Senha deve ter no m√≠nimo 8 caracteres'
    },
    validate: {
      hasUpperCase: (value) =>
        /[A-Z]/.test(value) || 'Deve conter letra mai√∫scula',
      hasNumber: (value) =>
        /[0-9]/.test(value) || 'Deve conter n√∫mero'
    }
  })}
/>
```

### 10.5.3 React Hook Form - Field Arrays

**Arrays din√¢micos:**
```javascript
import { useForm, useFieldArray } from 'react-hook-form';

function DynamicArray() {
  const { register, control, handleSubmit } = useForm({
    defaultValues: {
      employees: [{ name: '', email: '' }]
    }
  });

  const { fields, append, remove } = useFieldArray({
    control,
    name: 'employees'
  });

  const onSubmit = (data) => {
    console.log(data);
  };

  return (
    <form onSubmit={handleSubmit(onSubmit)}>
      {fields.map((field, index) => (
        <div key={field.id}> {/* field.id gerado automaticamente */}
          <input
            {...register(`employees.${index}.name`, {
              required: 'Nome √© obrigat√≥rio'
            })}
            placeholder="Nome"
          />
          <input
            {...register(`employees.${index}.email`, {
              required: 'Email √© obrigat√≥rio'
            })}
            placeholder="Email"
          />
          <button type="button" onClick={() => remove(index)}>
            Remover
          </button>
        </div>
      ))}

      <button
        type="button"
        onClick={() => append({ name: '', email: '' })}
      >
        Adicionar
      </button>

      <button type="submit">Enviar</button>
    </form>
  );
}
```

### 10.5.4 React Hook Form + Yup

**Schema validation:**
```javascript
import { useForm } from 'react-hook-form';
import { yupResolver } from '@hookform/resolvers/yup';
import * as yup from 'yup';

const schema = yup.object().shape({
  name: yup.string().required('Nome √© obrigat√≥rio').min(3),
  email: yup.string().required('Email √© obrigat√≥rio').email('Email inv√°lido'),
  age: yup.number().required().min(18, 'Deve ser maior de 18 anos'),
  password: yup
    .string()
    .required('Senha √© obrigat√≥ria')
    .min(8)
    .matches(/[A-Z]/, 'Deve conter letra mai√∫scula'),
  confirmPassword: yup
    .string()
    .oneOf([yup.ref('password')], 'Senhas n√£o conferem')
});

function FormWithYup() {
  const { register, handleSubmit, formState: { errors } } = useForm({
    resolver: yupResolver(schema)
  });

  const onSubmit = (data) => {
    console.log(data);
  };

  return (
    <form onSubmit={handleSubmit(onSubmit)}>
      <input {...register('name')} />
      {errors.name && <span>{errors.name.message}</span>}

      <input {...register('email')} />
      {errors.email && <span>{errors.email.message}</span>}

      <input {...register('age')} type="number" />
      {errors.age && <span>{errors.age.message}</span>}

      <input {...register('password')} type="password" />
      {errors.password && <span>{errors.password.message}</span>}

      <input {...register('confirmPassword')} type="password" />
      {errors.confirmPassword && <span>{errors.confirmPassword.message}</span>}

      <button type="submit">Enviar</button>
    </form>
  );
}
```

### 10.5.5 React Hook Form + Zod

**Schema com Zod:**
```javascript
import { useForm } from 'react-hook-form';
import { zodResolver } from '@hookform/resolvers/zod';
import { z } from 'zod';

const schema = z.object({
  name: z.string().min(3, 'Nome deve ter no m√≠nimo 3 caracteres'),
  email: z.string().email('Email inv√°lido'),
  age: z.number().min(18, 'Deve ser maior de 18 anos'),
  password: z
    .string()
    .min(8, 'Senha deve ter no m√≠nimo 8 caracteres')
    .regex(/[A-Z]/, 'Deve conter letra mai√∫scula'),
  confirmPassword: z.string()
}).refine((data) => data.password === data.confirmPassword, {
  message: 'Senhas n√£o conferem',
  path: ['confirmPassword']
});

function FormWithZod() {
  const { register, handleSubmit, formState: { errors } } = useForm({
    resolver: zodResolver(schema)
  });

  return (
    <form onSubmit={handleSubmit((data) => console.log(data))}>
      <input {...register('name')} />
      {errors.name && <span>{errors.name.message}</span>}

      <input {...register('email')} />
      {errors.email && <span>{errors.email.message}</span>}

      <input {...register('age', { valueAsNumber: true })} type="number" />
      {errors.age && <span>{errors.age.message}</span>}

      <input {...register('password')} type="password" />
      {errors.password && <span>{errors.password.message}</span>}

      <input {...register('confirmPassword')} type="password" />
      {errors.confirmPassword && <span>{errors.confirmPassword.message}</span>}

      <button type="submit">Enviar</button>
    </form>
  );
}
```

### 10.5.6 Formik - B√°sico

**Instala√ß√£o:**
```bash
npm install formik
```

**Exemplo b√°sico:**
```javascript
import { useFormik } from 'formik';

function BasicFormik() {
  const formik = useFormik({
    initialValues: {
      name: '',
      email: ''
    },
    validate: (values) => {
      const errors = {};

      if (!values.name) {
        errors.name = 'Nome √© obrigat√≥rio';
      }

      if (!values.email) {
        errors.email = 'Email √© obrigat√≥rio';
      } else if (!/\S+@\S+\.\S+/.test(values.email)) {
        errors.email = 'Email inv√°lido';
      }

      return errors;
    },
    onSubmit: (values) => {
      console.log(values);
    }
  });

  return (
    <form onSubmit={formik.handleSubmit}>
      <input
        name="name"
        value={formik.values.name}
        onChange={formik.handleChange}
        onBlur={formik.handleBlur}
      />
      {formik.touched.name && formik.errors.name && (
        <span>{formik.errors.name}</span>
      )}

      <input
        name="email"
        value={formik.values.email}
        onChange={formik.handleChange}
        onBlur={formik.handleBlur}
      />
      {formik.touched.email && formik.errors.email && (
        <span>{formik.errors.email}</span>
      )}

      <button type="submit">Enviar</button>
    </form>
  );
}
```

**Componente Formik (alternative):**
```javascript
import { Formik, Form, Field, ErrorMessage } from 'formik';

function FormikComponent() {
  return (
    <Formik
      initialValues={{ name: '', email: '' }}
      validate={(values) => {
        const errors = {};
        if (!values.email) {
          errors.email = 'Email √© obrigat√≥rio';
        }
        return errors;
      }}
      onSubmit={(values) => {
        console.log(values);
      }}
    >
      <Form>
        <Field name="name" placeholder="Nome" />
        <ErrorMessage name="name" component="span" />

        <Field name="email" type="email" placeholder="Email" />
        <ErrorMessage name="email" component="span" />

        <button type="submit">Enviar</button>
      </Form>
    </Formik>
  );
}
```

### 10.5.7 Formik + Yup

**Valida√ß√£o com schema:**
```javascript
import { Formik, Form, Field, ErrorMessage } from 'formik';
import * as yup from 'yup';

const schema = yup.object().shape({
  name: yup.string().required('Nome √© obrigat√≥rio').min(3),
  email: yup.string().required('Email √© obrigat√≥rio').email('Email inv√°lido'),
  password: yup.string().required('Senha √© obrigat√≥ria').min(8),
  confirmPassword: yup
    .string()
    .oneOf([yup.ref('password')], 'Senhas n√£o conferem')
});

function FormikWithYup() {
  return (
    <Formik
      initialValues={{
        name: '',
        email: '',
        password: '',
        confirmPassword: ''
      }}
      validationSchema={schema}
      onSubmit={(values) => {
        console.log(values);
      }}
    >
      {({ isSubmitting }) => (
        <Form>
          <Field name="name" />
          <ErrorMessage name="name" component="span" />

          <Field name="email" type="email" />
          <ErrorMessage name="email" component="span" />

          <Field name="password" type="password" />
          <ErrorMessage name="password" component="span" />

          <Field name="confirmPassword" type="password" />
          <ErrorMessage name="confirmPassword" component="span" />

          <button type="submit" disabled={isSubmitting}>
            {isSubmitting ? 'Enviando...' : 'Enviar'}
          </button>
        </Form>
      )}
    </Formik>
  );
}
```

### 10.5.8 Formik - FieldArray

**Arrays din√¢micos:**
```javascript
import { Formik, Form, Field, FieldArray, ErrorMessage } from 'formik';

function FormikFieldArray() {
  return (
    <Formik
      initialValues={{
        employees: [{ name: '', email: '' }]
      }}
      onSubmit={(values) => {
        console.log(values);
      }}
    >
      {({ values }) => (
        <Form>
          <FieldArray name="employees">
            {({ push, remove }) => (
              <div>
                {values.employees.map((employee, index) => (
                  <div key={index}>
                    <Field name={`employees.${index}.name`} placeholder="Nome" />
                    <ErrorMessage name={`employees.${index}.name`} component="span" />

                    <Field name={`employees.${index}.email`} placeholder="Email" />
                    <ErrorMessage name={`employees.${index}.email`} component="span" />

                    <button type="button" onClick={() => remove(index)}>
                      Remover
                    </button>
                  </div>
                ))}

                <button type="button" onClick={() => push({ name: '', email: '' })}>
                  Adicionar
                </button>
              </div>
            )}
          </FieldArray>

          <button type="submit">Enviar</button>
        </Form>
      )}
    </Formik>
  );
}
```

---

## üéØ Aplicabilidade e Contextos

### Quando Usar Form Libraries

**‚úÖ Use biblioteca quando:**
- Form com >5 campos
- Valida√ß√£o complexa (m√∫ltiplas regras, ass√≠ncrona)
- Arrays din√¢micos
- Multi-step forms
- Performance cr√≠tica (RHF)

**‚ùå N√£o use quando:**
- Form de 1-2 campos (login simples)
- Prot√≥tipo r√°pido
- Bundle size cr√≠tico (app min√∫sculo)

### React Hook Form vs Formik

| Crit√©rio | React Hook Form | Formik |
|----------|----------------|---------|
| **Performance** | ‚úÖ Excelente (uncontrolled) | ‚ö†Ô∏è Re-renders (controlled) |
| **Bundle size** | ‚úÖ ~9kb | ‚ö†Ô∏è ~13kb |
| **DX** | ‚ö†Ô∏è Menos familiar | ‚úÖ Mais "React-like" |
| **TypeScript** | ‚úÖ Excelente | ‚úÖ Bom |
| **Comunidade** | ‚úÖ Crescendo r√°pido | ‚ö†Ô∏è Mantido, mas menos ativo |
| **Learning curve** | ‚ö†Ô∏è Conceitos novos | ‚úÖ Mais familiar |

**Recomenda√ß√£o:**
- **Novo projeto:** React Hook Form (performance, modernidade)
- **Projeto existente Formik:** Manter Formik (n√£o vale migrar)
- **Performance cr√≠tica:** React Hook Form
- **Time j√∫nior:** Formik (mais familiar)

---

## ‚ö†Ô∏è Limita√ß√µes e Considera√ß√µes

### Bundle Size

**Adicionar biblioteca tem custo:**
- React Hook Form: ~9kb gzipped
- Formik: ~13kb gzipped
- Yup: ~15kb gzipped
- Zod: ~8kb gzipped

**Trade-off:** Para forms complexos, economia de c√≥digo (centenas de linhas) **justifica** custo de bundle.

### Learning Curve

**RHF tem conceitos espec√≠ficos:**
- `register()`, `control`, `watch()`
- Uncontrolled philosophy
- Refs internos

**Formik √© mais familiar:**
- `values`, `handleChange` (igual useState)
- Controlled (React tradicional)

### Over-engineering

**‚ùå Usar biblioteca para form trivial:**
```javascript
// Overkill para login simples
<Formik initialValues={{ email: '', password: '' }}>
  {/* 50 linhas de setup */}
</Formik>

// ‚úÖ useState suficiente
const [email, setEmail] = useState('');
const [password, setPassword] = useState('');
```

---

## üîó Interconex√µes Conceituais

### Rela√ß√£o com Custom Hooks

Form libraries s√£o essencialmente **custom hooks sofisticados**:
```javascript
// React Hook Form √© basicamente:
function useForm() {
  const [errors, setErrors] = useState({});
  const refs = useRef({});
  // ... l√≥gica complexa
  return { register, handleSubmit, errors };
}
```

### Rela√ß√£o com Valida√ß√£o

Bibliotecas abstraem valida√ß√£o:
```javascript
// Vanilla React (verbose)
const validateEmail = (email) => {
  if (!email) return 'Obrigat√≥rio';
  if (!/\S+@\S+/.test(email)) return 'Inv√°lido';
  return '';
};

// RHF (conciso)
register('email', {
  required: 'Obrigat√≥rio',
  pattern: { value: /\S+@\S+/, message: 'Inv√°lido' }
})
```

### Rela√ß√£o com Schemas (Yup/Zod)

Integra√ß√£o nativa com schemas:
```javascript
// Sem biblioteca: precisa integrar manualmente
const errors = await schema.validate(formData);

// Com biblioteca: integra√ß√£o autom√°tica
useForm({ resolver: yupResolver(schema) })
```

---

## üöÄ Evolu√ß√£o e Pr√≥ximos Conceitos

### Tend√™ncias

**React Hook Form est√° vencendo:**
- Performance superior
- Bundle menor
- Desenvolvimento ativo
- Ado√ß√£o crescente

**Formik ainda relevante:**
- 33k+ stars, base instalada gigante
- Ainda mantido (apenas menos features novas)
- Familiaridade

### Server Components

**React Server Components mudam jogo:**
```javascript
// Future: Forms com Server Actions
<form action={serverAction}>
  <input name="email" />
  <button>Submit</button>
</form>
// Valida√ß√£o no servidor, zero JS no cliente
```

**Bibliotecas est√£o se adaptando** (RHF 8.0 com server actions).

### Pr√≥ximos Passos

Este m√≥dulo cobriu form libraries. Pr√≥ximo:

**10.6 Forms Acess√≠veis** - ARIA, WCAG, keyboard navigation

**Prepara√ß√£o:** Bibliotecas facilitam acessibilidade (error IDs autom√°ticos, aria attributes), mas entender fundamentos √© essencial.

---

## üìö Conclus√£o

### Pontos-Chave

Form libraries no React oferecem:

1. **React Hook Form**: Uncontrolled, performance-first, moderno
2. **Formik**: Controlled, familiar, maduro
3. **Integra√ß√£o com schemas**: Yup/Zod para valida√ß√£o declarativa
4. **Field Arrays**: Arrays din√¢micos simplificados
5. **Trade-off**: Bundle size vs economia de c√≥digo

### Recomenda√ß√µes

1. **Use biblioteca para forms >5 campos**
2. **Prefira React Hook Form** (performance + modernidade)
3. **Formik ainda v√°lido** (projetos existentes, times j√∫nior)
4. **Sempre integre com Yup/Zod** (valida√ß√£o declarativa)
5. **N√£o over-engineer** forms triviais

### Best Practices

**React Hook Form:**
```javascript
// ‚úÖ Bom: Valida√ß√£o no register
<input {...register('email', { required: true, pattern: /\S+@\S+/ })} />

// ‚úÖ Melhor: Schema com Yup/Zod
useForm({ resolver: yupResolver(schema) })

// ‚úÖ Arrays: useFieldArray
const { fields, append, remove } = useFieldArray({ control, name: 'items' });
```

**Formik:**
```javascript
// ‚úÖ Bom: validationSchema com Yup
<Formik validationSchema={schema}>

// ‚úÖ Arrays: FieldArray
<FieldArray name="items">
  {({ push, remove }) => ...}
</FieldArray>
```

### Filosofia

**"Don't reinvent the wheel, but understand how it works."**

Form libraries s√£o **essenciais** para produtividade. Centenas de linhas de boilerplate ‚Üí poucas linhas de API ergon√¥mica. Mas entender **vanilla forms** (M√≥dulos 10.1-10.4) √© **crucial** para:
- Apreciar valor das bibliotecas
- Debugar issues complexos
- Tomar decis√µes arquiteturais

**Dominar form libraries = aplica√ß√µes enterprise-ready com menos c√≥digo.**
