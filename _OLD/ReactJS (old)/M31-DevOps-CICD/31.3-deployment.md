# Deployment de Aplica√ß√µes React

## üéØ Introdu√ß√£o e Defini√ß√£o

### Defini√ß√£o Conceitual

**Deployment** √© o processo de **publicar aplica√ß√£o React** para **servidores de produ√ß√£o**, tornando-a **acess√≠vel a usu√°rios finais** atrav√©s de **build otimizado, CDN e dom√≠nio configurado**. Conceitualmente, representa **entrega final** - transformar c√≥digo local em aplica√ß√£o web p√∫blica, perform√°tica e escal√°vel.

### Problema que Resolve

**Sem Deployment Adequado**:
- App lento (sem otimiza√ß√µes)
- Downtime durante deploys
- Custo alto (servidor dedicado)
- Dif√≠cil escalar

**Com Deployment Adequado**:
- App r√°pido (CDN global)
- Zero downtime
- Custo baixo (serverless/static)
- Escal√°vel automaticamente

---

## üåê Op√ß√µes de Hosting

### Compara√ß√£o

```
Platform        | Type        | Free Tier | CDN | Custom Domain | DX
----------------|-------------|-----------|-----|---------------|----
Vercel          | Static/SSR  | ‚úÖ Sim    | ‚úÖ  | ‚úÖ            | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê
Netlify         | Static      | ‚úÖ Sim    | ‚úÖ  | ‚úÖ            | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê
GitHub Pages    | Static      | ‚úÖ Sim    | ‚úÖ  | ‚úÖ            | ‚≠ê‚≠ê‚≠ê
AWS S3+CF       | Static      | ‚ùå N√£o    | ‚úÖ  | ‚úÖ            | ‚≠ê‚≠ê‚≠ê
Firebase        | Static/SSR  | ‚úÖ Sim    | ‚úÖ  | ‚úÖ            | ‚≠ê‚≠ê‚≠ê‚≠ê
Cloudflare P    | Static/SSR  | ‚úÖ Sim    | ‚úÖ  | ‚úÖ            | ‚≠ê‚≠ê‚≠ê‚≠ê
```

---

## ‚ö° Vercel (Recomendado)

### Setup Inicial

```bash
# 1. Install Vercel CLI
npm install -g vercel

# 2. Login
vercel login

# 3. Deploy
vercel

# 4. Deploy para production
vercel --prod
```

### Configura√ß√£o

```json
// vercel.json
{
  "buildCommand": "npm run build",
  "outputDirectory": "dist",
  "devCommand": "npm run dev",
  "installCommand": "npm install",

  "env": {
    "VITE_API_URL": "https://api.example.com"
  },

  "build": {
    "env": {
      "VITE_API_URL": "@api_url_production"
    }
  },

  "headers": [
    {
      "source": "/(.*)",
      "headers": [
        {
          "key": "X-Frame-Options",
          "value": "DENY"
        },
        {
          "key": "X-Content-Type-Options",
          "value": "nosniff"
        }
      ]
    }
  ],

  "redirects": [
    {
      "source": "/old-path",
      "destination": "/new-path",
      "permanent": true
    }
  ],

  "rewrites": [
    {
      "source": "/api/:path*",
      "destination": "https://api.example.com/:path*"
    }
  ]
}
```

### GitHub Integration

```
1. Push para GitHub
2. Vercel ‚Üí New Project
3. Import GitHub repo
4. Deploy automaticamente em push!

Preview Deploys:
- Cada PR = preview URL
- Merge to main = production
```

---

## üåç Netlify

### Deploy via CLI

```bash
# 1. Install
npm install -g netlify-cli

# 2. Login
netlify login

# 3. Init
netlify init

# 4. Deploy
netlify deploy

# 5. Production
netlify deploy --prod
```

### netlify.toml

```toml
[build]
  command = "npm run build"
  publish = "dist"

[build.environment]
  VITE_API_URL = "https://api.example.com"

[[redirects]]
  from = "/*"
  to = "/index.html"
  status = 200

[[headers]]
  for = "/*"
  [headers.values]
    X-Frame-Options = "DENY"
    X-Content-Type-Options = "nosniff"
    Referrer-Policy = "strict-origin-when-cross-origin"

[[redirects]]
  from = "/api/*"
  to = "https://api.example.com/:splat"
  status = 200
  force = true
```

---

## üìÑ GitHub Pages

### Setup

```json
// package.json
{
  "homepage": "https://username.github.io/repo-name",
  "scripts": {
    "predeploy": "npm run build",
    "deploy": "gh-pages -d dist"
  }
}
```

```bash
npm install --save-dev gh-pages
npm run deploy
```

### Configura√ß√£o Vite

```typescript
// vite.config.ts
export default defineConfig({
  base: '/repo-name/',  // Nome do reposit√≥rio
  build: {
    outDir: 'dist'
  }
});
```

---

## ‚òÅÔ∏è AWS S3 + CloudFront

### Build e Upload

```bash
# 1. Build
npm run build

# 2. Upload para S3
aws s3 sync dist/ s3://my-bucket --delete

# 3. Invalidar CloudFront cache
aws cloudfront create-invalidation \
  --distribution-id E1234567890ABC \
  --paths "/*"
```

### S3 Bucket Policy (Public Read)

```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Sid": "PublicReadGetObject",
      "Effect": "Allow",
      "Principal": "*",
      "Action": "s3:GetObject",
      "Resource": "arn:aws:s3:::my-bucket/*"
    }
  ]
}
```

### CloudFront Distribution

```
Settings:
- Origin: S3 bucket
- Viewer Protocol Policy: Redirect HTTP to HTTPS
- Compress Objects: Yes
- Default Root Object: index.html

Custom Error Responses:
- 404 ‚Üí /index.html (200) # SPA routing
- 403 ‚Üí /index.html (200)
```

---

## üî• Firebase Hosting

### Setup

```bash
# 1. Install
npm install -g firebase-tools

# 2. Login
firebase login

# 3. Init
firebase init hosting

# 4. Build
npm run build

# 5. Deploy
firebase deploy
```

### firebase.json

```json
{
  "hosting": {
    "public": "dist",
    "ignore": ["firebase.json", "**/.*", "**/node_modules/**"],
    "rewrites": [
      {
        "source": "**",
        "destination": "/index.html"
      }
    ],
    "headers": [
      {
        "source": "**/*.@(jpg|jpeg|gif|png|svg|webp)",
        "headers": [
          {
            "key": "Cache-Control",
            "value": "max-age=31536000"
          }
        ]
      }
    ]
  }
}
```

---

## üéØ Otimiza√ß√µes de Deploy

### 1. Build Optimization

```typescript
// vite.config.ts
export default defineConfig({
  build: {
    // Minify
    minify: 'terser',
    terserOptions: {
      compress: {
        drop_console: true, // Remove console.log em prod
        drop_debugger: true
      }
    },

    // Chunk splitting
    rollupOptions: {
      output: {
        manualChunks: {
          react: ['react', 'react-dom'],
          router: ['react-router-dom'],
          vendor: ['axios', 'date-fns']
        }
      }
    },

    // Sourcemaps apenas em staging
    sourcemap: process.env.VERCEL_ENV === 'preview'
  }
});
```

### 2. Caching Strategy

```toml
# netlify.toml
[[headers]]
  for = "/assets/*"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
  for = "/*.html"
  [headers.values]
    Cache-Control = "public, max-age=0, must-revalidate"

[[headers]]
  for = "/sw.js"
  [headers.values]
    Cache-Control = "no-cache"
```

### 3. Compression

```json
// vercel.json
{
  "headers": [
    {
      "source": "/assets/(.*)",
      "headers": [
        {
          "key": "Cache-Control",
          "value": "public, max-age=31536000, immutable"
        }
      ]
    }
  ]
}
```

**Gzip/Brotli**: Vercel/Netlify comprimem automaticamente

---

## üåç Custom Domain

### Vercel

```bash
# CLI
vercel domains add example.com

# Web UI
Project Settings ‚Üí Domains ‚Üí Add ‚Üí example.com
```

**DNS Records**:
```
Type  | Name | Value
------|------|------
A     | @    | 76.76.21.21
CNAME | www  | cname.vercel-dns.com
```

### Netlify

```bash
netlify domains:add example.com
```

**DNS Records**:
```
Type  | Name | Value
------|------|------
A     | @    | 75.2.60.5
CNAME | www  | your-site.netlify.app
```

---

## üîê HTTPS

### Automatic HTTPS

**Vercel/Netlify/Cloudflare**:
- ‚úÖ HTTPS autom√°tico (Let's Encrypt)
- ‚úÖ Renova√ß√£o autom√°tica
- ‚úÖ Redirect HTTP ‚Üí HTTPS

**AWS CloudFront**:
- Request SSL certificate (AWS Certificate Manager)
- Attach to CloudFront distribution
- Redirect HTTP ‚Üí HTTPS via CloudFront

---

## üìä Deployment Checklist

```
Pre-Deploy:
‚ñ° npm run build funciona
‚ñ° Tests passam
‚ñ° Lint/Type check OK
‚ñ° .env.production configurado
‚ñ° Secrets n√£o commitados

Deploy:
‚ñ° Build otimizado
‚ñ° Sourcemaps apenas staging
‚ñ° Compression habilitada
‚ñ° CDN configurado

Post-Deploy:
‚ñ° HTTPS funcionando
‚ñ° Custom domain configurado
‚ñ° Redirects HTTP‚ÜíHTTPS
‚ñ° Cache headers corretos
‚ñ° Monitoring configurado (Sentry)
‚ñ° Analytics configurado (GA)
```

---

## üöÄ Conclus√£o

Deployment de React inclui:
- **Plataformas**: Vercel (recomendado), Netlify, GitHub Pages, AWS
- **CI/CD**: Deploy autom√°tico em push
- **Otimiza√ß√µes**: Code splitting, minify, compression
- **Caching**: max-age para assets, revalidate para HTML
- **Custom Domain**: DNS + HTTPS autom√°tico
- **Monitoring**: Sentry, Analytics

**Recomenda√ß√£o**: **Vercel** para SPAs e SSR (Next.js) - melhor DX, deploy instant√¢neo, preview URLs, edge functions.

Deploy n√£o √© apenas "colocar online" - √© otimizar, cachear, monitorar e escalar.
