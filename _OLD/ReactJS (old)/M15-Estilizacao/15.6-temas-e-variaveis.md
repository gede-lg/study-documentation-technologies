# Temas e Vari√°veis CSS no React: Uma An√°lise Conceitual Profunda

## üéØ Introdu√ß√£o e Defini√ß√£o

### Defini√ß√£o Conceitual

Temas e Vari√°veis CSS no React referem-se ao uso de **CSS Custom Properties (vari√°veis CSS nativas)** e **Context API do React** para implementar sistemas de tematiza√ß√£o din√¢mica, permitindo que aplica√ß√µes alterem sua apar√™ncia visual em runtime sem recarregar a p√°gina. Conceitualmente, representa a **separa√ß√£o entre tokens de design (valores) e aplica√ß√£o de design (como valores s√£o usados)**, criando camada de abstra√ß√£o que permite personaliza√ß√£o em escala.

**CSS Custom Properties** (tamb√©m chamadas CSS Variables) s√£o vari√°veis nativas CSS definidas com prefixo `--` e acessadas via fun√ß√£o `var()`:

```css
:root {
  --primary-color: #3b82f6;
}

.button {
  background: var(--primary-color);
}
```

**Tematiza√ß√£o Light/Dark Mode** √© o caso de uso mais comum: alternar entre esquemas de cores claro e escuro baseado em prefer√™ncia do usu√°rio ou configura√ß√£o do sistema.

### Contexto Hist√≥rico e Motiva√ß√£o

CSS Variables foram introduzidas no **CSS3** (especifica√ß√£o finalizada em 2015-2016) e ganharam suporte universal dos navegadores por volta de 2017-2018.

**Antes das CSS Variables**: Tematiza√ß√£o exigia:
- Pr√©-processadores (Sass variables) - mas compilam em build-time, n√£o runtime
- Classes condicionais (`.theme-dark .button`, `.theme-light .button`) - verboso e dif√≠cil de manter
- JavaScript inline styles - overhead de performance

**Problemas que motivaram CSS Variables**:

1. **Sass Variables S√£o Est√°ticas**: Compilam para valores fixos. Mudar tema exige recompilar CSS.
   ```scss
   $primary: blue; // Build-time
   .button { background: $primary; } // Compila para: background: blue;
   ```

2. **Duplica√ß√£o para Temas**: Cada tema exigia CSS duplicado:
   ```css
   .theme-light .button { background: white; color: black; }
   .theme-dark .button { background: black; color: white; }
   ```

3. **Sem Dinamismo em Runtime**: CSS est√°tico n√£o pode responder a mudan√ßas de prefer√™ncias sem recarregar p√°gina.

**A revolu√ß√£o das CSS Variables**: Vari√°veis que **mudam em runtime** via JavaScript, permitindo tematiza√ß√£o din√¢mica sem duplica√ß√£o de CSS.

**No contexto React**: Context API + CSS Variables √© padr√£o elegante:
- **Context API** gerencia estado do tema (light/dark)
- **CSS Variables** aplicam valores do tema
- Mudan√ßa de tema = atualizar vari√°veis = re-estiliza√ß√£o instant√¢nea

**Populariza√ß√£o do Dark Mode**: Com iOS 13 (2019) e Android 10 (2019) adicionando dark mode nativo, demanda por tematiza√ß√£o em apps web explodiu.

### Problema Fundamental que Resolve

CSS Variables + Tematiza√ß√£o resolvem desafios espec√≠ficos:

**1. Tematiza√ß√£o Din√¢mica em Runtime**:
```javascript
// Mudar tema sem recarregar p√°gina
document.documentElement.style.setProperty('--primary-color', 'red');
```

**2. Design Tokens Centralizados**:
```css
:root {
  --spacing-1: 8px;
  --spacing-2: 16px;
  --spacing-3: 24px;
  --color-primary: #3b82f6;
  --color-text: #1f2937;
}
```

Um lugar para definir, todos componentes consomem.

**3. Prefer√™ncias de Sistema (prefers-color-scheme)**:
```css
@media (prefers-color-scheme: dark) {
  :root {
    --background: #1a1a1a;
    --text: #ffffff;
  }
}
```

Respeita configura√ß√£o do OS do usu√°rio.

**4. Tematiza√ß√£o Sem Duplica√ß√£o**:
```css
/* Um conjunto de regras CSS */
.button {
  background: var(--button-bg);
  color: var(--button-text);
}

/* Valores mudam por tema */
[data-theme="light"] {
  --button-bg: white;
  --button-text: black;
}

[data-theme="dark"] {
  --button-bg: black;
  --button-text: white;
}
```

**5. Personaliza√ß√£o por Usu√°rio**: Permitir usu√°rios escolherem cores, fontes, espa√ßamentos customizados.

### Import√¢ncia no Ecossistema

Temas e CSS Variables s√£o **fundamentais** no React moderno:

**Expectativa de Usu√°rio**:
- Dark mode √© feature esperada em 2024+
- Usu√°rios exigem personaliza√ß√£o (acessibilidade, prefer√™ncia)

**Acessibilidade**:
- Contraste alto para baixa vis√£o
- Cores personalizadas para daltonismo
- Tamanhos de fonte ajust√°veis

**Branding**:
- Apps white-label (mesma plataforma, branding diferente por cliente)
- Personaliza√ß√£o por usu√°rio ou organiza√ß√£o

**Performance**:
- CSS Variables s√£o **nativas** - zero overhead de JavaScript
- Mudan√ßa de tema √© altera√ß√£o de propriedade CSS - extremamente r√°pida

**Padr√£o Universal**:
- Todas as ferramentas modernas (Tailwind, MUI, Chakra) usam vari√°veis CSS
- Design systems (como Material Design 3) s√£o baseados em tokens

---

## üìã Sum√°rio Conceitual

### Aspectos Te√≥ricos Centrais

1. **CSS Variables S√£o Propriedades CSS**: Herdam, cascateiam, t√™m especificidade
2. **Escopo de Vari√°veis**: Global (`:root`) ou local (qualquer seletor)
3. **Runtime Mutability**: JavaScript pode alterar valores dinamicamente
4. **Fallback Values**: `var(--color, blue)` - usa `blue` se `--color` n√£o definida
5. **Cascata e Heran√ßa**: Vari√°veis herdam de elementos pais

### Pilares Fundamentais

- **Declara√ß√£o**: `--var-name: value;`
- **Uso**: `var(--var-name)`
- **Escopo Global**: `:root { }` (pseudo-classe para `<html>`)
- **Escopo Local**: Qualquer seletor (`.component { --local-var: value; }`)
- **Manipula√ß√£o JS**: `element.style.setProperty('--var', 'value')`
- **Media Queries**: `@media (prefers-color-scheme: dark)`

### Vis√£o Geral das Nuances

- **Tokens Sem√¢nticos vs Primitivos**: Abstra√ß√£o em camadas
- **Data Attributes para Temas**: `[data-theme="dark"]`
- **LocalStorage**: Persistir prefer√™ncia de tema
- **System Preference**: Respeitar `prefers-color-scheme`
- **FOUC (Flash of Unstyled Content)**: Evitar flash de tema errado
- **Transi√ß√µes**: Animar mudan√ßas de tema

---

## üß† Fundamentos Te√≥ricos

### Como Funcionam CSS Variables

#### Declara√ß√£o e Uso

```css
/* Declara√ß√£o */
:root {
  --primary-color: #3b82f6;
  --text-color: #1f2937;
  --spacing: 16px;
}

/* Uso */
.button {
  background: var(--primary-color);
  color: white;
  padding: var(--spacing);
}

.text {
  color: var(--text-color);
}
```

**Conceito**: `--variavel` √© propriedade CSS customizada. `var(--variavel)` acessa valor.

#### Escopo e Heran√ßa

```css
:root {
  --color: blue; /* Global */
}

.container {
  --color: red; /* Local - sobrescreve para filhos */
}

.child {
  color: var(--color);
  /* Dentro de .container: red */
  /* Fora de .container: blue */
}
```

**Conceito**: Vari√°veis **herdam**. Filhos veem vari√°veis de pais. Redefinir vari√°vel cria novo escopo.

#### Fallback Values

```css
.button {
  background: var(--button-bg, #3b82f6);
  /* Se --button-bg n√£o definida, usa #3b82f6 */
}

.text {
  color: var(--text-color, var(--fallback-color, black));
  /* Chain de fallbacks */
}
```

**Conceito**: Segundo argumento de `var()` √© fallback. Permite valores padr√£o robustos.

#### C√°lculos com calc()

```css
:root {
  --spacing-unit: 8px;
}

.component {
  padding: calc(var(--spacing-unit) * 2); /* 16px */
  margin: calc(var(--spacing-unit) / 2);  /* 4px */
}
```

**Conceito**: Vari√°veis podem ser usadas em c√°lculos. Permite escalas matem√°ticas.

### Manipula√ß√£o via JavaScript

#### Leitura de Vari√°veis

```javascript
// Ler vari√°vel do :root
const root = document.documentElement;
const primaryColor = getComputedStyle(root).getPropertyValue('--primary-color');
console.log(primaryColor); // '#3b82f6'

// Ler de elemento espec√≠fico
const button = document.querySelector('.button');
const buttonBg = getComputedStyle(button).getPropertyValue('--button-bg');
```

#### Defini√ß√£o de Vari√°veis

```javascript
// Definir em :root (global)
document.documentElement.style.setProperty('--primary-color', 'red');

// Definir em elemento espec√≠fico
const container = document.querySelector('.container');
container.style.setProperty('--local-color', 'blue');

// Remover vari√°vel
document.documentElement.style.removeProperty('--primary-color');
```

**Conceito**: JavaScript manipula vari√°veis CSS como qualquer propriedade inline. Mudan√ßa √© instant√¢nea e re-estiliza automaticamente.

### Media Query: prefers-color-scheme

```css
/* Light mode (padr√£o) */
:root {
  --background: white;
  --text: black;
}

/* Dark mode (sistema) */
@media (prefers-color-scheme: dark) {
  :root {
    --background: #1a1a1a;
    --text: #ffffff;
  }
}

body {
  background: var(--background);
  color: var(--text);
}
```

**JavaScript para detectar**:
```javascript
const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches;

// Listener para mudan√ßas
window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
  const newMode = e.matches ? 'dark' : 'light';
  console.log('Sistema mudou para:', newMode);
});
```

**Conceito**: `prefers-color-scheme` l√™ configura√ß√£o do OS. CSS pode responder automaticamente.

---

## üîç An√°lise Conceitual Profunda

### Design Tokens: Primitivos vs Sem√¢nticos

#### Tokens Primitivos

**Defini√ß√£o**: Valores brutos sem contexto.

```css
:root {
  /* Cores */
  --blue-50: #eff6ff;
  --blue-500: #3b82f6;
  --blue-900: #1e3a8a;

  --gray-100: #f3f4f6;
  --gray-500: #6b7280;
  --gray-900: #111827;

  /* Espa√ßamentos */
  --space-1: 4px;
  --space-2: 8px;
  --space-4: 16px;
  --space-8: 32px;
}
```

#### Tokens Sem√¢nticos

**Defini√ß√£o**: Mapeiam primitivos para contextos de uso.

```css
:root {
  /* Cores sem√¢nticas */
  --color-primary: var(--blue-500);
  --color-text: var(--gray-900);
  --color-text-muted: var(--gray-500);
  --color-background: white;
  --color-surface: var(--gray-100);

  /* Espa√ßamentos sem√¢nticos */
  --spacing-component-padding: var(--space-4);
  --spacing-section-gap: var(--space-8);
}
```

**Vantagem**: Mudar tema = mudar mapeamento sem√¢ntico, n√£o todos os usos.

```css
/* Light theme */
:root {
  --color-background: white;
  --color-text: var(--gray-900);
}

/* Dark theme */
[data-theme="dark"] {
  --color-background: var(--gray-900);
  --color-text: var(--gray-100);
}

/* Componentes usam tokens sem√¢nticos */
body {
  background: var(--color-background);
  color: var(--color-text);
}
```

**Conceito**: **Abstra√ß√£o em camadas**. Primitivos ‚Üí Sem√¢nticos ‚Üí Componentes.

### Implementa√ß√£o de Tematiza√ß√£o no React

#### Context API para Gerenciar Tema

```javascript
// ThemeContext.jsx
import { createContext, useContext, useState, useEffect } from 'react';

const ThemeContext = createContext();

export function ThemeProvider({ children }) {
  const [theme, setTheme] = useState(() => {
    // Ler do localStorage ou sistema
    const saved = localStorage.getItem('theme');
    if (saved) return saved;

    // Checar prefer√™ncia do sistema
    return window.matchMedia('(prefers-color-scheme: dark)').matches
      ? 'dark'
      : 'light';
  });

  useEffect(() => {
    // Aplicar tema ao HTML
    document.documentElement.setAttribute('data-theme', theme);
    localStorage.setItem('theme', theme);
  }, [theme]);

  const toggleTheme = () => {
    setTheme(prev => prev === 'light' ? 'dark' : 'light');
  };

  return (
    <ThemeContext.Provider value={{ theme, setTheme, toggleTheme }}>
      {children}
    </ThemeContext.Provider>
  );
}

export function useTheme() {
  const context = useContext(ThemeContext);
  if (!context) throw new Error('useTheme must be used within ThemeProvider');
  return context;
}
```

#### CSS com Data Attributes

```css
/* styles.css */

/* Light theme (padr√£o) */
:root {
  --color-background: #ffffff;
  --color-text: #1f2937;
  --color-primary: #3b82f6;
  --color-surface: #f3f4f6;
}

/* Dark theme */
[data-theme="dark"] {
  --color-background: #1a1a1a;
  --color-text: #f9fafb;
  --color-primary: #60a5fa;
  --color-surface: #374151;
}

/* Componentes usam vari√°veis */
body {
  background: var(--color-background);
  color: var(--color-text);
  transition: background-color 0.3s, color 0.3s;
}

.button {
  background: var(--color-primary);
  color: white;
}

.card {
  background: var(--color-surface);
  padding: 16px;
  border-radius: 8px;
}
```

#### Componente Toggle

```javascript
// ThemeToggle.jsx
import { useTheme } from './ThemeContext';

function ThemeToggle() {
  const { theme, toggleTheme } = useTheme();

  return (
    <button onClick={toggleTheme}>
      {theme === 'light' ? 'üåô Dark Mode' : '‚òÄÔ∏è Light Mode'}
    </button>
  );
}
```

#### Uso na Aplica√ß√£o

```javascript
// App.jsx
import { ThemeProvider } from './ThemeContext';
import ThemeToggle from './ThemeToggle';
import './styles.css';

function App() {
  return (
    <ThemeProvider>
      <header>
        <h1>My App</h1>
        <ThemeToggle />
      </header>
      <main>
        <div className="card">
          <p>Este card muda com o tema!</p>
        </div>
      </main>
    </ThemeProvider>
  );
}
```

**Fluxo Conceitual**:
1. User clica toggle
2. Context atualiza estado `theme`
3. `useEffect` aplica `data-theme` ao `<html>`
4. CSS re-aplica vari√°veis do seletor `[data-theme="dark"]`
5. Todos componentes re-estilizam automaticamente

### Tematiza√ß√£o Avan√ßada: M√∫ltiplos Temas

```javascript
// Suporte a m√∫ltiplos temas
const themes = {
  light: {
    background: '#ffffff',
    text: '#1f2937',
    primary: '#3b82f6',
  },
  dark: {
    background: '#1a1a1a',
    text: '#f9fafb',
    primary: '#60a5fa',
  },
  forest: {
    background: '#1e3a1e',
    text: '#e8f5e9',
    primary: '#4caf50',
  },
  ocean: {
    background: '#0d1b2a',
    text: '#e0f7fa',
    primary: '#00bcd4',
  }
};

function applyTheme(themeName) {
  const theme = themes[themeName];
  Object.entries(theme).forEach(([key, value]) => {
    document.documentElement.style.setProperty(`--color-${key}`, value);
  });
}
```

**Conceito**: JavaScript como "gerenciador de tokens". CSS consome tokens via vari√°veis.

### Prevenindo FOUC (Flash of Unstyled Content)

**Problema**: Ao carregar p√°gina, tema pode "piscar" de light ‚Üí dark se usu√°rio preferir dark.

**Solu√ß√£o**: Aplicar tema **antes** de React renderizar:

```html
<!-- index.html -->
<script>
  // Executado ANTES de React carregar
  (function() {
    const savedTheme = localStorage.getItem('theme');
    const systemPrefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
    const theme = savedTheme || (systemPrefersDark ? 'dark' : 'light');
    document.documentElement.setAttribute('data-theme', theme);
  })();
</script>
```

**Conceito**: Script inline executa s√≠ncronamente antes de CSS/React. Define tema antes de qualquer renderiza√ß√£o.

### Transi√ß√µes Suaves

```css
/* Transi√ß√£o em todas as propriedades que usam vari√°veis */
* {
  transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;
}

/* Ou em componentes espec√≠ficos */
body,
.card,
.button {
  transition: background-color 0.3s, color 0.3s;
}
```

**Conceito**: Mudan√ßa de vari√°vel CSS dispara transi√ß√£o automaticamente em propriedades que as usam.

**Otimiza√ß√£o**: Adicionar classe tempor√°ria para transi√ß√£o:

```javascript
function changeTheme(newTheme) {
  // Habilita transi√ß√µes
  document.documentElement.classList.add('theme-transition');

  // Aplica tema
  applyTheme(newTheme);

  // Remove classe ap√≥s transi√ß√£o completar
  setTimeout(() => {
    document.documentElement.classList.remove('theme-transition');
  }, 300);
}
```

```css
.theme-transition,
.theme-transition * {
  transition: background-color 0.3s, color 0.3s !important;
}
```

### Tematiza√ß√£o com CSS-in-JS

**Styled Components**:
```javascript
import { ThemeProvider } from 'styled-components';

const lightTheme = {
  background: '#ffffff',
  text: '#1f2937',
  primary: '#3b82f6',
};

const darkTheme = {
  background: '#1a1a1a',
  text: '#f9fafb',
  primary: '#60a5fa',
};

function App() {
  const [isDark, setIsDark] = useState(false);

  return (
    <ThemeProvider theme={isDark ? darkTheme : lightTheme}>
      <GlobalStyle />
      <Button onClick={() => setIsDark(!isDark)}>Toggle</Button>
    </ThemeProvider>
  );
}

const Button = styled.button`
  background: ${props => props.theme.primary};
  color: ${props => props.theme.text};
`;
```

**Conceito**: Theme object passado via Context, acess√≠vel em todos styled components.

**Trade-off**:
- **CSS Variables**: Mudam instantaneamente (CSS nativo)
- **CSS-in-JS Theme**: Re-renderiza componentes (pode ser mais lento)

---

## üéØ Aplicabilidade e Contextos

### Quando Usar CSS Variables para Tematiza√ß√£o

#### 1. Dark Mode Obrigat√≥rio

**Contexto**: Expectativa de usu√°rio, acessibilidade.

**Raz√£o**: CSS Variables s√£o abordagem nativa, perform√°tica, e universal.

#### 2. Customiza√ß√£o por Usu√°rio

**Contexto**: Apps que permitem personaliza√ß√£o (Slack, Discord, Notion).

**Raz√£o**: Usu√°rios mudam cores/temas ‚Üí JavaScript atualiza vari√°veis ‚Üí UI atualiza instantaneamente.

#### 3. White-Label Apps

**Contexto**: Mesma plataforma, branding diferente por cliente.

**Raz√£o**: Cada cliente tem tema (cores, logos) ‚Üí carregar tokens via API ‚Üí aplicar via vari√°veis.

#### 4. Acessibilidade

**Contexto**: Contraste alto, daltonismo, prefer√™ncias visuais.

**Raz√£o**: Usu√°rios configuram vari√°veis para suas necessidades ‚Üí acessibilidade nativa.

### Quando Considerar Alternativas

**CSS-in-JS**: Se toda estiliza√ß√£o j√° √© CSS-in-JS, usar theme object pode ser mais consistente.

**Tailwind**: Tailwind tem dark mode nativo (`dark:bg-gray-900`) - pode ser suficiente para casos simples.

---

## ‚ö†Ô∏è Limita√ß√µes e Considera√ß√µes

### Restri√ß√µes

#### 1. Suporte de Navegadores

CSS Variables: **IE11 n√£o suporta**.

**Solu√ß√£o**: Polyfills ou fallbacks:
```css
.button {
  background: #3b82f6; /* Fallback para IE11 */
  background: var(--primary-color);
}
```

#### 2. N√£o Funcionam em Media Queries

```css
:root {
  --breakpoint: 768px;
}

/* ‚ùå N√£o funciona */
@media (min-width: var(--breakpoint)) {
  /* ... */
}
```

**Raz√£o**: Media queries s√£o processadas antes de vari√°veis serem resolvidas.

#### 3. Performance com Muitas Vari√°veis

Milhares de vari√°veis podem impactar performance de recalcular estilos.

**Mitiga√ß√£o**: Usar apenas vari√°veis necess√°rias, evitar excesso.

---

## üöÄ Conclus√£o

CSS Variables + Context API para tematiza√ß√£o √© **padr√£o moderno e robusto**:

**Vantagens**:
- Nativas (performance m√°xima)
- Din√¢micas (mudam em runtime)
- Universais (funcionam com qualquer abordagem CSS)
- Acess√≠veis (respeitar prefer√™ncias do sistema)

**Quando usar**: Dark mode, customiza√ß√£o, white-label, acessibilidade.

Tematiza√ß√£o n√£o √© luxo - √© **expectativa fundamental** de UX moderna. CSS Variables tornam implementa√ß√£o trivial e perform√°tica.
