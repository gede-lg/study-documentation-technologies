# React Testing Library (RTL)

## üéØ Introdu√ß√£o e Defini√ß√£o

### Defini√ß√£o Conceitual

**React Testing Library** √© uma **biblioteca de testes** que encoraja **boas pr√°ticas** ao testar componentes React da forma como **usu√°rios interagem** com eles, focando em **acessibilidade** e **comportamento** ao inv√©s de detalhes de implementa√ß√£o. Conceitualmente, representa **user-centric testing** - "quanto mais seus testes se parecem com o uso real, mais confian√ßa eles te d√£o".

### Contexto Hist√≥rico

Antes da RTL (pr√©-2018):
- Enzyme (Airbnb) - testava detalhes de implementa√ß√£o
- Foco em state, props, m√©todos internos
- Testes quebravam com refatora√ß√£o

RTL (2018+):
- Criada por Kent C. Dodds
- Foca em acessibilidade e DOM
- Testes resilientes a mudan√ßas

### Problema que Resolve

**Com Enzyme/Shallow Rendering**:
- Testa detalhes internos (state, lifecycle)
- Testes quebram ao refatorar
- N√£o testa o que o usu√°rio v√™

**Com RTL**:
- Testa comportamento vis√≠vel
- Testes resilientes
- Garante acessibilidade
- Simula uso real

---

## üìã Filosofia da RTL

### Princ√≠pios Fundamentais

1. **Teste o que o usu√°rio v√™**
   - N√£o teste state interno
   - N√£o teste props
   - Teste DOM renderizado

2. **Use queries acess√≠veis**
   - getByRole (ARIA roles)
   - getByLabelText (labels de formul√°rio)
   - getByText (conte√∫do vis√≠vel)

3. **Evite detalhes de implementa√ß√£o**
   - N√£o teste m√©todos privados
   - N√£o teste hooks internos
   - Teste comportamento p√∫blico

4. **Interaja como um usu√°rio**
   - Use userEvent (n√£o fireEvent)
   - Simule clicks, typing, navega√ß√£o
   - Aguarde mudan√ßas ass√≠ncronas

---

## üîç Renderizando Componentes

### Render B√°sico

```javascript
import { render, screen } from '@testing-library/react';
import Button from './Button';

test('renderiza bot√£o', () => {
  render(<Button>Click me</Button>);

  // screen - acessa o DOM renderizado
  const button = screen.getByText('Click me');
  expect(button).toBeInTheDocument();
});
```

### Render com Props

```javascript
function Greeting({ name }) {
  return <h1>Hello, {name}!</h1>;
}

test('renderiza sauda√ß√£o', () => {
  render(<Greeting name="John" />);
  expect(screen.getByText('Hello, John!')).toBeInTheDocument();
});
```

### Render com Providers

```javascript
import { ThemeProvider } from './ThemeContext';

function renderWithTheme(ui, { theme = 'light', ...options } = {}) {
  return render(
    <ThemeProvider value={theme}>
      {ui}
    </ThemeProvider>,
    options
  );
}

test('renderiza com tema', () => {
  renderWithTheme(<Button>Click</Button>, { theme: 'dark' });
  expect(screen.getByRole('button')).toHaveClass('dark');
});
```

### Custom Render Helper

```javascript
// test-utils.js
import { render } from '@testing-library/react';
import { BrowserRouter } from 'react-router-dom';
import { QueryClientProvider } from 'react-query';

const AllTheProviders = ({ children }) => {
  return (
    <BrowserRouter>
      <QueryClientProvider client={queryClient}>
        {children}
      </QueryClientProvider>
    </BrowserRouter>
  );
};

const customRender = (ui, options) =>
  render(ui, { wrapper: AllTheProviders, ...options });

export * from '@testing-library/react';
export { customRender as render };
```

---

## üéØ Queries - Encontrando Elementos

### Hierarquia de Queries (Priority)

```javascript
// 1. getByRole - MAIS RECOMENDADO (acessibilidade)
screen.getByRole('button', { name: 'Submit' });
screen.getByRole('heading', { level: 1 });
screen.getByRole('textbox', { name: 'Email' });

// 2. getByLabelText - Formul√°rios
screen.getByLabelText('Username');
screen.getByLabelText(/email/i);

// 3. getByPlaceholderText
screen.getByPlaceholderText('Enter email');

// 4. getByText - Conte√∫do vis√≠vel
screen.getByText('Hello World');
screen.getByText(/hello/i);

// 5. getByDisplayValue - Inputs com valor
screen.getByDisplayValue('John Doe');

// 6. getByAltText - Imagens
screen.getByAltText('Profile picture');

// 7. getByTitle - Atributo title
screen.getByTitle('Close');

// 8. getByTestId - √öLTIMO RECURSO
screen.getByTestId('custom-element');
```

### Variantes de Queries

```javascript
// get - lan√ßa erro se n√£o encontrar (uso s√≠ncrono)
const button = screen.getByRole('button');

// query - retorna null se n√£o encontrar
const button = screen.queryByRole('button');
if (button) {
  // fazer algo
}

// find - retorna Promise (uso ass√≠ncrono)
const button = await screen.findByRole('button');

// M√∫ltiplos elementos
const buttons = screen.getAllByRole('button'); // []
const buttons = screen.queryAllByRole('button'); // []
const buttons = await screen.findAllByRole('button'); // Promise<[]>
```

### Quando Usar Cada Query

```javascript
// get - elemento DEVE estar no DOM
test('bot√£o existe', () => {
  render(<Button>Click</Button>);
  expect(screen.getByRole('button')).toBeInTheDocument();
});

// query - verificar aus√™ncia
test('erro n√£o est√° vis√≠vel', () => {
  render(<Form />);
  expect(screen.queryByText('Error')).not.toBeInTheDocument();
});

// find - aguardar elemento aparecer
test('dados carregam', async () => {
  render(<UserList />);
  expect(await screen.findByText('John')).toBeInTheDocument();
});
```

---

## üéØ Queries por Role (ARIA)

### Roles Comuns

```javascript
// Bot√µes
screen.getByRole('button'); // <button>, <input type="button">
screen.getByRole('button', { name: 'Submit' }); // texto ou aria-label

// Links
screen.getByRole('link'); // <a href="...">
screen.getByRole('link', { name: 'Home' });

// Headings
screen.getByRole('heading'); // <h1> - <h6>
screen.getByRole('heading', { level: 1 }); // <h1>
screen.getByRole('heading', { name: /welcome/i });

// Inputs
screen.getByRole('textbox'); // <input type="text">
screen.getByRole('spinbutton'); // <input type="number">
screen.getByRole('checkbox'); // <input type="checkbox">
screen.getByRole('radio'); // <input type="radio">
screen.getByRole('combobox'); // <select>

// Estrutura
screen.getByRole('navigation'); // <nav>
screen.getByRole('list'); // <ul>, <ol>
screen.getByRole('listitem'); // <li>
screen.getByRole('table'); // <table>
screen.getByRole('row'); // <tr>
screen.getByRole('cell'); // <td>

// Outros
screen.getByRole('img'); // <img>, role="img"
screen.getByRole('alert'); // role="alert"
screen.getByRole('dialog'); // role="dialog"
```

### Options para getByRole

```javascript
// name - texto acess√≠vel
screen.getByRole('button', { name: 'Submit' });
screen.getByRole('button', { name: /submit/i }); // regex

// level - n√≠vel de heading
screen.getByRole('heading', { level: 2 });

// checked - estado de checkbox/radio
screen.getByRole('checkbox', { checked: true });

// selected - op√ß√£o selecionada
screen.getByRole('option', { selected: true });

// current - navega√ß√£o ativa
screen.getByRole('link', { current: 'page' });

// expanded - acorde√£o/dropdown
screen.getByRole('button', { expanded: true });

// pressed - bot√£o toggle
screen.getByRole('button', { pressed: true });
```

---

## üéØ Matchers Customizados

```javascript
// @testing-library/jest-dom

// Presen√ßa no DOM
expect(element).toBeInTheDocument();
expect(element).not.toBeInTheDocument();

// Visibilidade
expect(element).toBeVisible();
expect(element).not.toBeVisible();

// Estado
expect(element).toBeDisabled();
expect(element).toBeEnabled();
expect(element).toBeChecked();
expect(element).not.toBeChecked();

// Valores
expect(input).toHaveValue('John');
expect(input).toHaveDisplayValue('John');

// Texto
expect(element).toHaveTextContent('Hello');
expect(element).toHaveTextContent(/hello/i);

// Atributos
expect(element).toHaveAttribute('href', '/home');
expect(element).toHaveClass('active');
expect(element).toHaveStyle({ color: 'red' });

// Focus
expect(element).toHaveFocus();

// Form
expect(form).toHaveFormValues({
  username: 'john',
  email: 'john@test.com'
});
```

---

## üîÑ Testando Intera√ß√µes

### FireEvent vs UserEvent

```javascript
import { fireEvent } from '@testing-library/react';
import userEvent from '@testing-library/user-event';

// ‚ùå fireEvent - dispara evento √∫nico
fireEvent.click(button);
fireEvent.change(input, { target: { value: 'text' } });

// ‚úÖ userEvent - simula intera√ß√£o completa
const user = userEvent.setup();
await user.click(button); // mousedown + mouseup + click
await user.type(input, 'text'); // keydown + keypress + keyup por letra
```

### Clicks

```javascript
test('clica em bot√£o', async () => {
  const user = userEvent.setup();
  const handleClick = jest.fn();

  render(<button onClick={handleClick}>Click me</button>);

  await user.click(screen.getByRole('button'));

  expect(handleClick).toHaveBeenCalledTimes(1);
});

// Double click
await user.dblClick(button);

// Right click
await user.pointer({ keys: '[MouseRight]', target: button });
```

### Typing

```javascript
test('digita em input', async () => {
  const user = userEvent.setup();

  render(<input type="text" />);
  const input = screen.getByRole('textbox');

  await user.type(input, 'Hello World');

  expect(input).toHaveValue('Hello World');
});

// Clear
await user.clear(input);

// Type com delay
await user.type(input, 'slow', { delay: 100 }); // 100ms entre teclas
```

### Keyboard

```javascript
test('pressiona teclas', async () => {
  const user = userEvent.setup();

  render(<input type="text" onKeyDown={handleKeyDown} />);
  const input = screen.getByRole('textbox');

  // Enter
  await user.type(input, '{Enter}');

  // Escape
  await user.keyboard('{Escape}');

  // Modificadores
  await user.keyboard('{Control>}a{/Control}'); // Ctrl+A
  await user.keyboard('{Shift>}Tab{/Shift}'); // Shift+Tab
});
```

### Select/Dropdown

```javascript
test('seleciona op√ß√£o', async () => {
  const user = userEvent.setup();

  render(
    <select>
      <option value="">Select...</option>
      <option value="1">Option 1</option>
      <option value="2">Option 2</option>
    </select>
  );

  await user.selectOptions(
    screen.getByRole('combobox'),
    '2'
  );

  expect(screen.getByRole('option', { name: 'Option 2' })).toBeSelected();
});
```

### Upload de Arquivo

```javascript
test('faz upload de arquivo', async () => {
  const user = userEvent.setup();
  const file = new File(['hello'], 'hello.png', { type: 'image/png' });

  render(<input type="file" />);

  const input = screen.getByRole('button', { name: /upload/i });
  await user.upload(input, file);

  expect(input.files[0]).toBe(file);
  expect(input.files).toHaveLength(1);
});
```

---

## ‚è±Ô∏è Testando C√≥digo Ass√≠ncrono

### waitFor

```javascript
import { waitFor } from '@testing-library/react';

test('aguarda dados carregarem', async () => {
  render(<UserList />);

  await waitFor(() => {
    expect(screen.getByText('John')).toBeInTheDocument();
  });

  // Ou com find (prefer√≠vel)
  expect(await screen.findByText('John')).toBeInTheDocument();
});

// Options
await waitFor(
  () => expect(element).toBeInTheDocument(),
  {
    timeout: 3000, // 3s
    interval: 100  // checa a cada 100ms
  }
);
```

### waitForElementToBeRemoved

```javascript
test('aguarda loading desaparecer', async () => {
  render(<DataLoader />);

  const loading = screen.getByText('Loading...');

  await waitForElementToBeRemoved(loading);

  expect(screen.getByText('Data loaded')).toBeInTheDocument();
});
```

### findBy Queries

```javascript
// findBy = getBy + waitFor
test('aguarda elemento aparecer', async () => {
  render(<AsyncComponent />);

  // Aguarda at√© 1s (padr√£o) por elemento aparecer
  const element = await screen.findByText('Loaded');

  expect(element).toBeInTheDocument();
});

// Com timeout customizado
const element = await screen.findByText(
  'Loaded',
  {},
  { timeout: 5000 }
);
```

---

## üöÄ Conclus√£o

React Testing Library oferece:
- **Queries**: getByRole, getByLabelText (foco em acessibilidade)
- **Variantes**: get (s√≠ncrono), query (nullable), find (ass√≠ncrono)
- **Matchers**: toBeInTheDocument, toHaveValue, toBeDisabled
- **Intera√ß√µes**: userEvent.click, type, keyboard
- **Async**: waitFor, findBy, waitForElementToBeRemoved

Filosofia: testar componentes como usu√°rios usam, focando em acessibilidade e comportamento, n√£o em detalhes de implementa√ß√£o.
