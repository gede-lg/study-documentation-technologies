# Fundamentos de Teste no React

## üéØ Introdu√ß√£o e Defini√ß√£o

### Defini√ß√£o Conceitual

**Testing** no React √© a pr√°tica de **verificar automaticamente** que componentes, hooks e l√≥gica funcionam conforme esperado, atrav√©s de **testes unit√°rios** (fun√ß√µes isoladas), **testes de integra√ß√£o** (componentes com intera√ß√µes), e **testes E2E** (fluxos completos). Conceitualmente, representa **seguran√ßa e confian√ßa** - garantir que c√≥digo funciona hoje e continuar√° funcionando ap√≥s mudan√ßas, com **feedback r√°pido** e **documenta√ß√£o viva**.

### Problema que Resolve

**Sem Testes**:
- Bugs descobertos em produ√ß√£o
- Medo de refatorar (pode quebrar)
- Regress√µes constantes
- Debugging manual demorado

**Com Testes**:
- Bugs capturados antes de produ√ß√£o
- Refatora√ß√£o segura
- Documenta√ß√£o de comportamento esperado
- Feedback instant√¢neo

---

## üìã Pir√¢mide de Testes

```
        /\
       /E2E\      ‚Üê Poucos, lentos, caros
      /------\
     /Integration\ ‚Üê Quantidade m√©dia
    /------------\
   /  Unit Tests  \ ‚Üê Muitos, r√°pidos, baratos
  /----------------\
```

### Unit Tests (Base)
- **O qu√™**: Fun√ß√µes isoladas, utils, hooks
- **Quantidade**: 70% dos testes
- **Velocidade**: Muito r√°pido (~ms)
- **Custo**: Baixo

### Integration Tests (Meio)
- **O qu√™**: Componentes com intera√ß√µes, m√∫ltiplos m√≥dulos
- **Quantidade**: 20% dos testes
- **Velocidade**: R√°pido (~100ms)
- **Custo**: M√©dio

### E2E Tests (Topo)
- **O qu√™**: Fluxos completos (login ‚Üí dashboard ‚Üí checkout)
- **Quantidade**: 10% dos testes
- **Velocidade**: Lento (~segundos)
- **Custo**: Alto

---

## üß† Padr√£o AAA (Arrange, Act, Assert)

```javascript
test('incrementa contador ao clicar', () => {
  // Arrange (Preparar) - setup inicial
  render(<Counter initialCount={0} />);
  const button = screen.getByText('Increment');

  // Act (Agir) - executar a√ß√£o
  fireEvent.click(button);

  // Assert (Verificar) - verificar resultado
  expect(screen.getByText('Count: 1')).toBeInTheDocument();
});
```

### Arrange (Preparar)
- Criar estado inicial
- Renderizar componentes
- Preparar mocks/stubs
- Configurar dados de teste

### Act (Agir)
- Executar a a√ß√£o que est√° testando
- Simular intera√ß√£o do usu√°rio
- Chamar fun√ß√£o
- Disparar evento

### Assert (Verificar)
- Verificar resultado esperado
- Checar DOM, estado, chamadas
- Validar efeitos colaterais

---

## üéØ Tipos de Testes

### 1. Unit Tests

```javascript
// Testar fun√ß√£o pura
function add(a, b) {
  return a + b;
}

test('add soma dois n√∫meros', () => {
  expect(add(2, 3)).toBe(5);
  expect(add(-1, 1)).toBe(0);
});

// Testar hook customizado
function useCounter(initialValue = 0) {
  const [count, setCount] = useState(initialValue);
  const increment = () => setCount(c => c + 1);
  return { count, increment };
}

test('useCounter incrementa', () => {
  const { result } = renderHook(() => useCounter());

  expect(result.current.count).toBe(0);

  act(() => {
    result.current.increment();
  });

  expect(result.current.count).toBe(1);
});
```

### 2. Integration Tests

```javascript
// Testar componente com intera√ß√µes
function LoginForm({ onSubmit }) {
  const [email, setEmail] = useState('');
  const [password, setPassword] = useState('');

  const handleSubmit = (e) => {
    e.preventDefault();
    onSubmit({ email, password });
  };

  return (
    <form onSubmit={handleSubmit}>
      <input
        type="email"
        value={email}
        onChange={e => setEmail(e.target.value)}
        placeholder="Email"
      />
      <input
        type="password"
        value={password}
        onChange={e => setPassword(e.target.value)}
        placeholder="Password"
      />
      <button type="submit">Login</button>
    </form>
  );
}

test('submete formul√°rio com credenciais', async () => {
  const mockSubmit = jest.fn();
  const user = userEvent.setup();

  render(<LoginForm onSubmit={mockSubmit} />);

  // Preencher formul√°rio
  await user.type(screen.getByPlaceholderText('Email'), 'test@test.com');
  await user.type(screen.getByPlaceholderText('Password'), 'password123');

  // Submeter
  await user.click(screen.getByText('Login'));

  // Verificar
  expect(mockSubmit).toHaveBeenCalledWith({
    email: 'test@test.com',
    password: 'password123'
  });
});
```

### 3. E2E Tests (Conceito)

```javascript
// Cypress/Playwright
test('fluxo completo de compra', async () => {
  await page.goto('/');
  await page.click('text=Login');
  await page.fill('input[name=email]', 'user@test.com');
  await page.fill('input[name=password]', 'password');
  await page.click('button[type=submit]');

  await page.click('text=Produtos');
  await page.click('text=Adicionar ao Carrinho');
  await page.click('text=Finalizar Compra');

  await expect(page.locator('text=Pedido confirmado')).toBeVisible();
});
```

---

## üîç O Que Testar?

### ‚úÖ Deve Testar

1. **Comportamento do Usu√°rio**
   - Componente renderiza corretamente
   - Intera√ß√µes funcionam (clicks, inputs)
   - Navega√ß√£o funciona

2. **L√≥gica de Neg√≥cio**
   - C√°lculos corretos
   - Valida√ß√µes funcionam
   - Regras de neg√≥cio aplicadas

3. **Casos Extremos**
   - Valores vazios
   - Valores m√°ximos/m√≠nimos
   - Estados de erro

4. **Integra√ß√£o**
   - Componentes funcionam juntos
   - Context/Redux atualiza corretamente
   - API calls retornam dados esperados

### ‚ùå N√£o Deve Testar

1. **Detalhes de Implementa√ß√£o**
   - Nomes de vari√°veis internas
   - Estrutura de estado interno
   - Calls de fun√ß√µes privadas

2. **Bibliotecas Terceiras**
   - React Router funciona (j√° testado)
   - React Query funciona (j√° testado)

3. **Estiliza√ß√£o Visual**
   - CSS exato (use testes visuais)
   - Cores, tamanhos (fr√°gil)

---

## üéØ Princ√≠pios de Bons Testes

### 1. Testes Independentes

```javascript
// ‚ùå Testes dependentes
let user;

test('cria usu√°rio', () => {
  user = createUser({ name: 'John' });
  expect(user.name).toBe('John');
});

test('atualiza usu√°rio', () => {
  user.name = 'Jane'; // Depende do teste anterior!
  expect(user.name).toBe('Jane');
});

// ‚úÖ Testes independentes
test('cria usu√°rio', () => {
  const user = createUser({ name: 'John' });
  expect(user.name).toBe('John');
});

test('atualiza usu√°rio', () => {
  const user = createUser({ name: 'John' });
  user.name = 'Jane';
  expect(user.name).toBe('Jane');
});
```

### 2. Testes R√°pidos

```javascript
// ‚ùå Lento - delay desnecess√°rio
test('mostra mensagem', async () => {
  render(<Message />);
  await new Promise(r => setTimeout(r, 3000)); // 3s delay!
  expect(screen.getByText('Hello')).toBeInTheDocument();
});

// ‚úÖ R√°pido - sem delays artificiais
test('mostra mensagem', () => {
  render(<Message />);
  expect(screen.getByText('Hello')).toBeInTheDocument();
});
```

### 3. Testes Leg√≠veis

```javascript
// ‚ùå Dif√≠cil entender
test('t1', () => {
  const c = render(<C p={1} />);
  expect(c.container.querySelector('div').textContent).toBe('1');
});

// ‚úÖ Claro e descritivo
test('Counter exibe valor inicial', () => {
  render(<Counter initialValue={1} />);
  expect(screen.getByText('Count: 1')).toBeInTheDocument();
});
```

### 4. Testar Comportamento, N√£o Implementa√ß√£o

```javascript
// ‚ùå Testa implementa√ß√£o
test('chama setState ao clicar', () => {
  const setState = jest.fn();
  useState.mockReturnValue([0, setState]);
  render(<Counter />);
  fireEvent.click(screen.getByText('Increment'));
  expect(setState).toHaveBeenCalled(); // Detalhes internos!
});

// ‚úÖ Testa comportamento
test('incrementa contador ao clicar', () => {
  render(<Counter />);
  expect(screen.getByText('Count: 0')).toBeInTheDocument();

  fireEvent.click(screen.getByText('Increment'));

  expect(screen.getByText('Count: 1')).toBeInTheDocument();
});
```

---

## üöÄ Conclus√£o

Fundamentos de Teste garantem:
- **Confian√ßa**: C√≥digo funciona como esperado
- **Refatora√ß√£o Segura**: Testes pegam regress√µes
- **Documenta√ß√£o**: Testes mostram como usar
- **Feedback R√°pido**: Bugs encontrados cedo

**Pir√¢mide**: Muitos unit tests, alguns integration, poucos E2E.

**Padr√£o AAA**: Arrange ‚Üí Act ‚Üí Assert.

**Princ√≠pios**: Independentes, r√°pidos, leg√≠veis, testam comportamento.

Essencial para aplica√ß√µes production-ready e manuten√≠veis.
