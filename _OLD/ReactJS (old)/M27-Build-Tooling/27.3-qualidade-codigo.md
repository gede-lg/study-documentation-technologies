# Ferramentas de Qualidade de C√≥digo

## üéØ Introdu√ß√£o e Defini√ß√£o

### Defini√ß√£o Conceitual

**Ferramentas de Qualidade de C√≥digo** s√£o **sistemas automatizados** que **analisam, formatam e validam c√≥digo**, garantindo **consist√™ncia, legibilidade e aus√™ncia de erros comuns**. Conceitualmente, representam **guardrails do c√≥digo** - previnem problemas antes de chegarem ao c√≥digo-base, aplicam standards e educam desenvolvedores sobre best practices.

### Problema que Resolve

**Sem Ferramentas de Qualidade**:
- Estilo inconsistente (tabs vs spaces, ' vs ")
- Bugs silenciosos (vari√°veis n√£o usadas)
- Vulnerabilidades de seguran√ßa
- Code reviews discutem formata√ß√£o

**Com Ferramentas de Qualidade**:
- Estilo consistente e autom√°tico
- Bugs capturados antes de commit
- Vulnerabilidades detectadas
- Code reviews focam em l√≥gica

---

## üé® Prettier (Formata√ß√£o)

### Instala√ß√£o

```bash
npm install --save-dev prettier
```

### Configura√ß√£o

```json
// .prettierrc
{
  "semi": true,
  "singleQuote": true,
  "tabWidth": 2,
  "useTabs": false,
  "trailingComma": "es5",
  "printWidth": 80,
  "bracketSpacing": true,
  "arrowParens": "always",
  "endOfLine": "lf"
}
```

### Ignore Files

```bash
# .prettierignore
dist
build
coverage
node_modules
*.min.js
*.svg
```

### Scripts

```json
// package.json
{
  "scripts": {
    "format": "prettier --write \"src/**/*.{ts,tsx,js,jsx,json,css,md}\"",
    "format:check": "prettier --check \"src/**/*.{ts,tsx,js,jsx,json,css,md}\""
  }
}
```

### VS Code Integration

```json
// .vscode/settings.json
{
  "editor.defaultFormatter": "esbenp.prettier-vscode",
  "editor.formatOnSave": true,
  "[typescript]": {
    "editor.defaultFormatter": "esbenp.prettier-vscode"
  },
  "[typescriptreact]": {
    "editor.defaultFormatter": "esbenp.prettier-vscode"
  }
}
```

---

## üîç ESLint (Linting)

### Instala√ß√£o

```bash
npm install --save-dev eslint @typescript-eslint/parser @typescript-eslint/eslint-plugin
npm install --save-dev eslint-plugin-react eslint-plugin-react-hooks
npm install --save-dev eslint-config-prettier  # Desabilita regras que conflitam com Prettier
```

### Configura√ß√£o

```json
// .eslintrc.json
{
  "env": {
    "browser": true,
    "es2021": true,
    "node": true
  },
  "extends": [
    "eslint:recommended",
    "plugin:react/recommended",
    "plugin:react-hooks/recommended",
    "plugin:@typescript-eslint/recommended",
    "prettier" // SEMPRE √∫ltimo (sobrescreve conflitos)
  ],
  "parser": "@typescript-eslint/parser",
  "parserOptions": {
    "ecmaVersion": "latest",
    "sourceType": "module",
    "ecmaFeatures": {
      "jsx": true
    }
  },
  "plugins": [
    "react",
    "react-hooks",
    "@typescript-eslint"
  ],
  "rules": {
    // React
    "react/react-in-jsx-scope": "off", // N√£o precisa import React
    "react/prop-types": "off", // Usa TypeScript

    // React Hooks
    "react-hooks/rules-of-hooks": "error",
    "react-hooks/exhaustive-deps": "warn",

    // TypeScript
    "@typescript-eslint/no-unused-vars": "error",
    "@typescript-eslint/no-explicit-any": "warn",
    "@typescript-eslint/explicit-function-return-type": "off",

    // Geral
    "no-console": ["warn", { "allow": ["warn", "error"] }],
    "prefer-const": "error",
    "no-var": "error"
  },
  "settings": {
    "react": {
      "version": "detect"
    }
  }
}
```

### Scripts

```json
// package.json
{
  "scripts": {
    "lint": "eslint . --ext .ts,.tsx,.js,.jsx",
    "lint:fix": "eslint . --ext .ts,.tsx,.js,.jsx --fix"
  }
}
```

### Regras Importantes

```json
{
  "rules": {
    // Prevenir bugs
    "react-hooks/exhaustive-deps": "warn",
    "@typescript-eslint/no-unused-vars": "error",
    "no-unreachable": "error",

    // Best practices
    "prefer-const": "error",
    "no-var": "error",
    "eqeqeq": ["error", "always"],

    // Seguran√ßa
    "no-eval": "error",
    "no-implied-eval": "error",

    // Acessibilidade (com eslint-plugin-jsx-a11y)
    "jsx-a11y/alt-text": "error",
    "jsx-a11y/label-has-associated-control": "error"
  }
}
```

---

## üîí TypeScript (Type Checking)

### tsconfig.json Strict

```json
{
  "compilerOptions": {
    // Strict mode (TODOS enabled)
    "strict": true,

    // Ou individualmente:
    "noImplicitAny": true,
    "strictNullChecks": true,
    "strictFunctionTypes": true,
    "strictBindCallApply": true,
    "strictPropertyInitialization": true,
    "noImplicitThis": true,
    "alwaysStrict": true,

    // Checks adicionais
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "noImplicitReturns": true,
    "noFallthroughCasesInSwitch": true,
    "noUncheckedIndexedAccess": true,

    // Module resolution
    "module": "ESNext",
    "moduleResolution": "bundler",
    "target": "ES2020",
    "lib": ["ES2020", "DOM", "DOM.Iterable"],

    // React
    "jsx": "react-jsx",

    // Path aliases
    "baseUrl": ".",
    "paths": {
      "@/*": ["src/*"]
    },

    // Outros
    "esModuleInterop": true,
    "skipLibCheck": true,
    "resolveJsonModule": true,
    "isolatedModules": true
  },
  "include": ["src"],
  "exclude": ["node_modules", "dist", "build"]
}
```

### Type Check Script

```json
// package.json
{
  "scripts": {
    "type-check": "tsc --noEmit",
    "type-check:watch": "tsc --noEmit --watch"
  }
}
```

---

## üé£ Husky + lint-staged (Git Hooks)

### Instala√ß√£o

```bash
npm install --save-dev husky lint-staged
npx husky install
npm pkg set scripts.prepare="husky install"
```

### Configura√ß√£o

```bash
# Criar pre-commit hook
npx husky add .husky/pre-commit "npx lint-staged"
```

```json
// package.json
{
  "lint-staged": {
    "*.{ts,tsx,js,jsx}": [
      "eslint --fix",
      "prettier --write"
    ],
    "*.{json,md,css}": [
      "prettier --write"
    ]
  }
}
```

**Resultado**: Antes de commit, automaticamente formata e corrige c√≥digo!

### pre-commit hook completo

```bash
#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

# Lint-staged
npx lint-staged

# Type check
npm run type-check

# Run tests
npm run test:changed
```

---

## ‚úÖ Commitlint (Mensagens de Commit)

### Instala√ß√£o

```bash
npm install --save-dev @commitlint/cli @commitlint/config-conventional
```

### Configura√ß√£o

```javascript
// commitlint.config.js
module.exports = {
  extends: ['@commitlint/config-conventional'],
  rules: {
    'type-enum': [
      2,
      'always',
      [
        'feat',     // Nova feature
        'fix',      // Bug fix
        'docs',     // Documenta√ß√£o
        'style',    // Formata√ß√£o
        'refactor', // Refatora√ß√£o
        'perf',     // Performance
        'test',     // Testes
        'chore',    // Build/config
        'revert'    // Revert commit
      ]
    ]
  }
};
```

### Husky Hook

```bash
npx husky add .husky/commit-msg 'npx --no-install commitlint --edit "$1"'
```

### Exemplos de Mensagens

```bash
# ‚úÖ V√°lidos
git commit -m "feat: add user authentication"
git commit -m "fix: resolve memory leak in useEffect"
git commit -m "docs: update API documentation"

# ‚ùå Inv√°lidos
git commit -m "update stuff"
git commit -m "WIP"
git commit -m "fixed bug"
```

---

## üîê Dependency Audit

### npm audit

```bash
# Verificar vulnerabilidades
npm audit

# Ver detalhes
npm audit --json

# Corrigir automaticamente
npm audit fix

# Corrigir incluindo breaking changes
npm audit fix --force
```

### dependabot (GitHub)

```yaml
# .github/dependabot.yml
version: 2
updates:
  - package-ecosystem: "npm"
    directory: "/"
    schedule:
      interval: "weekly"
    open-pull-requests-limit: 10
    ignore:
      - dependency-name: "react"
        update-types: ["version-update:semver-major"]
```

---

## üìä CI/CD Quality Checks

### GitHub Actions

```yaml
# .github/workflows/quality.yml
name: Code Quality

on:
  pull_request:
    branches: [main]

jobs:
  quality:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v3

      - uses: actions/setup-node@v3
        with:
          node-version: '18'
          cache: 'npm'

      - run: npm ci

      # Lint
      - name: ESLint
        run: npm run lint

      # Format check
      - name: Prettier
        run: npm run format:check

      # Type check
      - name: TypeScript
        run: npm run type-check

      # Tests
      - name: Tests
        run: npm run test:coverage

      # Upload coverage
      - name: Upload coverage
        uses: codecov/codecov-action@v3
        with:
          files: ./coverage/coverage-final.json
```

---

## üöÄ Conclus√£o

Ferramentas de Qualidade incluem:
- **Prettier**: Formata√ß√£o autom√°tica (tabs, ', ;)
- **ESLint**: Linting (bugs, best practices, a11y)
- **TypeScript**: Type checking (strict mode)
- **Husky + lint-staged**: Git hooks (pre-commit)
- **Commitlint**: Conventional commits
- **Audit**: Vulnerabilidades (npm audit, dependabot)

**Setup Recomendado**:
1. Prettier (format on save)
2. ESLint + TypeScript strict
3. Husky pre-commit (lint-staged)
4. CI/CD checks (lint, type-check, test)

Resultado: C√≥digo consistente, bugs prevenidos, equipe produtiva.
