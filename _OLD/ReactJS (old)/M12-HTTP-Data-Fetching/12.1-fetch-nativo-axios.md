# Fetch Nativo e Axios no React

## üéØ Introdu√ß√£o e Defini√ß√£o

### Defini√ß√£o Conceitual

**Fetch API** √© interface nativa do browser para requisi√ß√µes HTTP, baseada em **Promises**. **Axios** √© biblioteca third-party que abstrai HTTP requests com API mais ergon√¥mica e features extras (interceptors, auto JSON parsing, timeout). Ambos permitem **comunica√ß√£o com APIs** REST - GET (ler), POST (criar), PUT/PATCH (atualizar), DELETE (deletar).

Fetch √© **standard web** (zero depend√™ncias), mas verboso e com gotchas (n√£o rejeita em 404/500, precisa `.json()` manual). Axios √© **convenience layer** - menos c√≥digo, melhor DX, features avan√ßadas. Trade-off: adicionar depend√™ncia (~13kb) vs usar primitivo do browser.

**Filosofia:** "Fetch is primitive, Axios is ergonomic." Fetch para apps simples ou quando bundle size √© cr√≠tico. Axios para produtividade e features (interceptors, cancelamento, defaults globais).

### Import√¢ncia no Ecossistema

HTTP requests s√£o **essenciais** para:

- **Consumir APIs**: REST, GraphQL endpoints
- **CRUD operations**: Create, Read, Update, Delete
- **Autentica√ß√£o**: Login, logout, token refresh
- **File upload**: Multipart form data

**Contexto:** Toda SPA moderna consome APIs. Fetch (nativo desde 2015) substituiu XMLHttpRequest. Axios (2014) continua popular por ergonomia, mas Fetch evoluiu (AbortController, streaming).

---

## üìã Sum√°rio Conceitual

### T√≥picos Cobertos

1. **Fetch API B√°sico**: GET, POST, Headers, Body
2. **Fetch Avan√ßado**: Error handling, JSON parsing, AbortController
3. **Axios B√°sico**: Instala√ß√£o, GET, POST, Config
4. **Axios Avan√ßado**: Interceptors, Instances, Defaults
5. **Fetch vs Axios**: Compara√ß√£o, quando usar cada

---

## üîç Fundamentos Te√≥ricos

### HTTP Methods

**GET:** Ler dados (idempotente, cacheable)
```
GET /api/users/123
```

**POST:** Criar recurso (n√£o idempotente)
```
POST /api/users
Body: { name: "Jo√£o", email: "joao@example.com" }
```

**PUT:** Atualizar completo (idempotente)
```
PUT /api/users/123
Body: { name: "Jo√£o Silva", email: "joao@example.com" }
```

**PATCH:** Atualizar parcial (idempotente)
```
PATCH /api/users/123
Body: { name: "Jo√£o Silva" }
```

**DELETE:** Deletar recurso (idempotente)
```
DELETE /api/users/123
```

### REST API Response Format

**Success (200-299):**
```json
{
  "data": { "id": 123, "name": "Jo√£o" },
  "message": "Success"
}
```

**Error (400-599):**
```json
{
  "error": "User not found",
  "code": 404
}
```

---

## üîç An√°lise Conceitual Profunda

### 12.1.1 Fetch API - GET Request

**B√°sico:**
```javascript
fetch('https://api.example.com/users')
  .then(response => response.json())
  .then(data => console.log(data))
  .catch(error => console.error('Error:', error));
```

**Com async/await:**
```javascript
async function fetchUsers() {
  try {
    const response = await fetch('https://api.example.com/users');
    const data = await response.json();
    console.log(data);
  } catch (error) {
    console.error('Error:', error);
  }
}
```

**Em componente React:**
```javascript
import { useState, useEffect } from 'react';

function UsersList() {
  const [users, setUsers] = useState([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);

  useEffect(() => {
    const fetchUsers = async () => {
      try {
        const response = await fetch('https://api.example.com/users');
        const data = await response.json();
        setUsers(data);
      } catch (err) {
        setError(err.message);
      } finally {
        setLoading(false);
      }
    };

    fetchUsers();
  }, []);

  if (loading) return <div>Loading...</div>;
  if (error) return <div>Error: {error}</div>;

  return (
    <ul>
      {users.map(user => (
        <li key={user.id}>{user.name}</li>
      ))}
    </ul>
  );
}
```

### 12.1.2 Fetch API - POST Request

**POST com JSON:**
```javascript
async function createUser(userData) {
  try {
    const response = await fetch('https://api.example.com/users', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify(userData)
    });

    const data = await response.json();
    return data;
  } catch (error) {
    console.error('Error:', error);
  }
}

// Uso
createUser({ name: 'Jo√£o', email: 'joao@example.com' });
```

**Em form component:**
```javascript
function CreateUserForm() {
  const [formData, setFormData] = useState({ name: '', email: '' });
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState(null);

  const handleSubmit = async (e) => {
    e.preventDefault();
    setLoading(true);
    setError(null);

    try {
      const response = await fetch('https://api.example.com/users', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(formData)
      });

      if (!response.ok) {
        throw new Error('Failed to create user');
      }

      const data = await response.json();
      console.log('User created:', data);
      setFormData({ name: '', email: '' }); // Reset form
    } catch (err) {
      setError(err.message);
    } finally {
      setLoading(false);
    }
  };

  return (
    <form onSubmit={handleSubmit}>
      <input
        value={formData.name}
        onChange={(e) => setFormData({ ...formData, name: e.target.value })}
        placeholder="Name"
      />
      <input
        value={formData.email}
        onChange={(e) => setFormData({ ...formData, email: e.target.value })}
        placeholder="Email"
      />
      {error && <p style={{ color: 'red' }}>{error}</p>}
      <button type="submit" disabled={loading}>
        {loading ? 'Creating...' : 'Create User'}
      </button>
    </form>
  );
}
```

### 12.1.3 Fetch API - PUT/PATCH/DELETE

**PUT (atualizar completo):**
```javascript
async function updateUser(id, userData) {
  const response = await fetch(`https://api.example.com/users/${id}`, {
    method: 'PUT',
    headers: {
      'Content-Type': 'application/json'
    },
    body: JSON.stringify(userData)
  });

  return response.json();
}
```

**PATCH (atualizar parcial):**
```javascript
async function updateUserName(id, name) {
  const response = await fetch(`https://api.example.com/users/${id}`, {
    method: 'PATCH',
    headers: {
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({ name })
  });

  return response.json();
}
```

**DELETE:**
```javascript
async function deleteUser(id) {
  const response = await fetch(`https://api.example.com/users/${id}`, {
    method: 'DELETE'
  });

  if (!response.ok) {
    throw new Error('Failed to delete user');
  }

  // DELETE pode n√£o retornar body
  if (response.status === 204) {
    return null; // No content
  }

  return response.json();
}
```

### 12.1.4 Fetch API - Headers e Autentica√ß√£o

**Headers customizados:**
```javascript
fetch('https://api.example.com/users', {
  headers: {
    'Content-Type': 'application/json',
    'Authorization': 'Bearer YOUR_TOKEN_HERE',
    'X-Custom-Header': 'value'
  }
});
```

**Bearer token (JWT):**
```javascript
async function fetchProtectedData() {
  const token = localStorage.getItem('token');

  const response = await fetch('https://api.example.com/protected', {
    headers: {
      'Authorization': `Bearer ${token}`
    }
  });

  return response.json();
}
```

**Basic Auth:**
```javascript
const username = 'user';
const password = 'pass';
const credentials = btoa(`${username}:${password}`);

fetch('https://api.example.com/data', {
  headers: {
    'Authorization': `Basic ${credentials}`
  }
});
```

### 12.1.5 Fetch API - Error Handling

**‚ö†Ô∏è Fetch N√ÉO rejeita em 404/500:**
```javascript
fetch('https://api.example.com/users')
  .then(response => response.json())
  .then(data => console.log(data))
  .catch(error => {
    // S√≥ captura network errors (sem internet, DNS fail)
    // N√ÉO captura 404, 500, etc.
  });
```

**‚úÖ Check response.ok:**
```javascript
async function fetchUsers() {
  try {
    const response = await fetch('https://api.example.com/users');

    if (!response.ok) {
      throw new Error(`HTTP error! Status: ${response.status}`);
    }

    const data = await response.json();
    return data;
  } catch (error) {
    console.error('Error:', error);
  }
}
```

**Error handling completo:**
```javascript
async function fetchWithErrorHandling(url) {
  try {
    const response = await fetch(url);

    // Check status code
    if (!response.ok) {
      // Tentar parse error message do body
      let errorMessage = `HTTP error! Status: ${response.status}`;

      try {
        const errorData = await response.json();
        errorMessage = errorData.message || errorMessage;
      } catch {
        // Body n√£o √© JSON v√°lido
      }

      throw new Error(errorMessage);
    }

    // Parse JSON
    const data = await response.json();
    return data;
  } catch (error) {
    // Network error ou parsing error
    console.error('Fetch error:', error);
    throw error;
  }
}
```

### 12.1.6 Fetch API - AbortController (Cancelamento)

**Cancelar request:**
```javascript
const controller = new AbortController();
const signal = controller.signal;

fetch('https://api.example.com/users', { signal })
  .then(response => response.json())
  .then(data => console.log(data))
  .catch(error => {
    if (error.name === 'AbortError') {
      console.log('Request aborted');
    } else {
      console.error('Error:', error);
    }
  });

// Cancelar
controller.abort();
```

**Em React (cleanup):**
```javascript
useEffect(() => {
  const controller = new AbortController();

  const fetchUsers = async () => {
    try {
      const response = await fetch('https://api.example.com/users', {
        signal: controller.signal
      });

      const data = await response.json();
      setUsers(data);
    } catch (error) {
      if (error.name === 'AbortError') {
        console.log('Request cancelled');
      } else {
        setError(error.message);
      }
    }
  };

  fetchUsers();

  // Cleanup: cancela request se component unmount
  return () => {
    controller.abort();
  };
}, []);
```

### 12.1.7 Axios - Instala√ß√£o e B√°sico

**Instala√ß√£o:**
```bash
npm install axios
```

**GET request:**
```javascript
import axios from 'axios';

// Simples
axios.get('https://api.example.com/users')
  .then(response => console.log(response.data))
  .catch(error => console.error('Error:', error));

// Async/await
async function fetchUsers() {
  try {
    const response = await axios.get('https://api.example.com/users');
    console.log(response.data);
  } catch (error) {
    console.error('Error:', error);
  }
}
```

**POST request:**
```javascript
// Axios auto-stringifica JSON e seta Content-Type
const response = await axios.post('https://api.example.com/users', {
  name: 'Jo√£o',
  email: 'joao@example.com'
});

console.log(response.data);
```

**PUT/PATCH/DELETE:**
```javascript
// PUT
await axios.put(`https://api.example.com/users/${id}`, userData);

// PATCH
await axios.patch(`https://api.example.com/users/${id}`, { name: 'Jo√£o' });

// DELETE
await axios.delete(`https://api.example.com/users/${id}`);
```

### 12.1.8 Axios - Configura√ß√£o

**Headers:**
```javascript
await axios.get('https://api.example.com/users', {
  headers: {
    'Authorization': 'Bearer TOKEN',
    'X-Custom-Header': 'value'
  }
});
```

**Query params:**
```javascript
await axios.get('https://api.example.com/users', {
  params: {
    page: 2,
    limit: 10,
    role: 'admin'
  }
});
// URL: https://api.example.com/users?page=2&limit=10&role=admin
```

**Timeout:**
```javascript
await axios.get('https://api.example.com/users', {
  timeout: 5000 // 5 segundos
});
```

**Response interceptor (transform data):**
```javascript
const response = await axios.get('https://api.example.com/users', {
  transformResponse: [(data) => {
    const parsed = JSON.parse(data);
    // Transform data aqui
    return parsed.results || parsed;
  }]
});
```

### 12.1.9 Axios - Instances

**Criar instance com defaults:**
```javascript
const api = axios.create({
  baseURL: 'https://api.example.com',
  timeout: 10000,
  headers: {
    'Content-Type': 'application/json'
  }
});

// Uso
await api.get('/users'); // https://api.example.com/users
await api.post('/users', userData);
```

**Instance com token:**
```javascript
const api = axios.create({
  baseURL: 'https://api.example.com'
});

// Setar token ap√≥s login
const token = localStorage.getItem('token');
api.defaults.headers.common['Authorization'] = `Bearer ${token}`;

// Todas requisi√ß√µes incluem token
await api.get('/protected'); // Inclui Authorization header
```

### 12.1.10 Axios - Interceptors

**Request interceptor (adicionar token):**
```javascript
const api = axios.create({
  baseURL: 'https://api.example.com'
});

api.interceptors.request.use(
  (config) => {
    const token = localStorage.getItem('token');

    if (token) {
      config.headers.Authorization = `Bearer ${token}`;
    }

    return config;
  },
  (error) => {
    return Promise.reject(error);
  }
);
```

**Response interceptor (refresh token):**
```javascript
api.interceptors.response.use(
  (response) => {
    // Response OK, retorna direto
    return response;
  },
  async (error) => {
    const originalRequest = error.config;

    // Se 401 e n√£o j√° tentou refresh
    if (error.response?.status === 401 && !originalRequest._retry) {
      originalRequest._retry = true;

      try {
        // Refresh token
        const refreshToken = localStorage.getItem('refreshToken');
        const response = await axios.post('/auth/refresh', { refreshToken });

        const newToken = response.data.token;
        localStorage.setItem('token', newToken);

        // Retry original request com novo token
        originalRequest.headers.Authorization = `Bearer ${newToken}`;
        return api(originalRequest);
      } catch (refreshError) {
        // Refresh falhou, logout
        localStorage.removeItem('token');
        window.location.href = '/login';
        return Promise.reject(refreshError);
      }
    }

    return Promise.reject(error);
  }
);
```

**Response interceptor (error handling global):**
```javascript
api.interceptors.response.use(
  (response) => response,
  (error) => {
    if (error.response) {
      // Server respondeu com status fora de 2xx
      const { status, data } = error.response;

      switch (status) {
        case 400:
          console.error('Bad Request:', data.message);
          break;
        case 401:
          console.error('Unauthorized');
          window.location.href = '/login';
          break;
        case 403:
          console.error('Forbidden');
          break;
        case 404:
          console.error('Not Found');
          break;
        case 500:
          console.error('Server Error');
          break;
        default:
          console.error('Error:', data.message);
      }
    } else if (error.request) {
      // Request enviado mas sem resposta
      console.error('Network Error');
    } else {
      // Erro ao setup request
      console.error('Error:', error.message);
    }

    return Promise.reject(error);
  }
);
```

### 12.1.11 Axios - Cancelamento

**Cancel token (deprecated):**
```javascript
const CancelToken = axios.CancelToken;
const source = CancelToken.source();

axios.get('/users', {
  cancelToken: source.token
});

// Cancelar
source.cancel('Request cancelled');
```

**AbortController (recomendado v0.22+):**
```javascript
const controller = new AbortController();

axios.get('/users', {
  signal: controller.signal
});

// Cancelar
controller.abort();
```

**Em React:**
```javascript
useEffect(() => {
  const controller = new AbortController();

  const fetchUsers = async () => {
    try {
      const response = await axios.get('/users', {
        signal: controller.signal
      });
      setUsers(response.data);
    } catch (error) {
      if (axios.isCancel(error)) {
        console.log('Request cancelled');
      } else {
        setError(error.message);
      }
    }
  };

  fetchUsers();

  return () => {
    controller.abort();
  };
}, []);
```

---

## üéØ Aplicabilidade e Contextos

### Fetch vs Axios

| Feature | Fetch | Axios |
|---------|-------|-------|
| **Built-in** | ‚úÖ Nativo | ‚ùå Depend√™ncia (+13kb) |
| **JSON auto-parse** | ‚ùå Manual `.json()` | ‚úÖ Autom√°tico |
| **Error on 404/500** | ‚ùå N√£o rejeita | ‚úÖ Rejeita |
| **Interceptors** | ‚ùå N√£o tem | ‚úÖ Request/Response |
| **Timeout** | ‚ùå N√£o nativo | ‚úÖ Built-in |
| **Cancel** | ‚úÖ AbortController | ‚úÖ AbortController |
| **Upload progress** | ‚ùå Complexo | ‚úÖ F√°cil |

### Quando Usar Cada

**Use Fetch quando:**
- App simples, poucas requisi√ß√µes
- Bundle size cr√≠tico (zero depend√™ncias)
- Only modern browsers (IE n√£o suporta)
- Preferir web standards

**Use Axios quando:**
- M√∫ltiplas requisi√ß√µes, API complexa
- Precisa interceptors (auth, logging)
- Timeout, retry logic
- Upload progress
- Melhor DX (menos c√≥digo)

---

## ‚ö†Ô∏è Limita√ß√µes e Considera√ß√µes

### Fetch Gotchas

**1. N√£o rejeita em HTTP errors:**
```javascript
// ‚ùå PEGADINHA
fetch('/404')
  .then(data => console.log(data)) // Executa!
  .catch(error => console.error(error)); // N√£o executa

// ‚úÖ Check response.ok
fetch('/404')
  .then(response => {
    if (!response.ok) throw new Error('HTTP error');
    return response.json();
  })
  .catch(error => console.error(error)); // Agora executa
```

**2. JSON parsing manual:**
```javascript
// ‚ùå Esquecer .json()
const data = await fetch('/users'); // Response object, n√£o data

// ‚úÖ Parse JSON
const data = await (await fetch('/users')).json();
```

**3. Credentials n√£o enviados por padr√£o:**
```javascript
// ‚ùå Cookies n√£o enviados
fetch('https://api.example.com/data');

// ‚úÖ Incluir cookies
fetch('https://api.example.com/data', {
  credentials: 'include'
});
```

### Axios Considera√ß√µes

**Bundle size:** +13kb gzipped (considerar em apps min√∫sculos).

**Over-engineering:** Para 2-3 requests simples, Fetch pode ser suficiente.

---

## üîó Interconex√µes Conceituais

### Rela√ß√£o com useEffect

Fetch em React sempre dentro de useEffect:
```javascript
useEffect(() => {
  fetchData();
}, [dependencies]);
```

### Rela√ß√£o com Estado

Fetch atualiza state (loading, data, error):
```javascript
const [data, setData] = useState(null);
const [loading, setLoading] = useState(false);
const [error, setError] = useState(null);
```

### Rela√ß√£o com Custom Hooks

Abstrair fetch logic:
```javascript
function useFetch(url) {
  const [data, setData] = useState(null);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    fetch(url).then(r => r.json()).then(setData).finally(() => setLoading(false));
  }, [url]);

  return { data, loading };
}
```

---

## üöÄ Evolu√ß√£o e Pr√≥ximos Conceitos

### Fetch evolu√ß√£o

**Streaming (Response.body):**
```javascript
const response = await fetch('/large-file');
const reader = response.body.getReader();

while (true) {
  const { done, value } = await reader.read();
  if (done) break;
  console.log('Chunk:', value);
}
```

### Pr√≥ximos Passos

Este m√≥dulo cobriu fetch primitivo. Pr√≥ximos:

1. **12.3 Fetch Patterns** - Custom hooks, loading states, pagination
2. **12.4 Advanced Data Fetching** - Caching, optimistic updates, polling
3. **12.5 React Query** - Biblioteca especializada (game changer)

---

## üìö Conclus√£o

### Pontos-Chave

1. **Fetch**: Nativo, verboso, gotchas (n√£o rejeita 404)
2. **Axios**: Ergon√¥mico, interceptors, auto JSON parse
3. **HTTP Methods**: GET, POST, PUT, PATCH, DELETE
4. **Error handling**: SEMPRE check response.ok (Fetch)
5. **Cancelamento**: AbortController (ambos)

### Best Practices

1. **SEMPRE check response.ok** com Fetch
2. **AbortController em useEffect** (cleanup)
3. **Interceptors para auth** (Axios)
4. **Axios instance para API** (baseURL, defaults)
5. **Try/catch para error handling**

### Recomenda√ß√£o

**Para apps produ√ß√£o: Axios** (interceptors, DX, features).
**Para apps simples: Fetch** (zero deps, standard).
**Para apps complexos: React Query** (pr√≥ximo m√≥dulo - melhor solu√ß√£o).

**Dominar fetch/axios = fundamento para data fetching avan√ßado.**
