# React Router Avan√ßado

## üéØ Introdu√ß√£o e Defini√ß√£o

### Defini√ß√£o Conceitual

**React Router Avan√ßado** cobre **rotas aninhadas** (nested routes), **layouts compartilhados**, e **componente Outlet** para renderiza√ß√£o hier√°rquica. Rotas aninhadas permitem estruturas URL complexas (`/dashboard/profile`, `/dashboard/settings`) onde **layouts s√£o reutilizados** e apenas conte√∫do interno muda. Representa arquitetura **DRY** (Don't Repeat Yourself) para rotas com UI compartilhada.

Nested routes refletem **hierarquia de UI**: dashboard tem sidebar/header compartilhado, mas conte√∫do interno varia por rota. `<Outlet />` √© **slot** onde child routes renderizam - similar a `props.children`, mas controlado por roteamento. Pattern resolve **layout duplication** e cria apps com navega√ß√£o fluida onde apenas por√ß√µes da tela mudam.

**Filosofia:** "Routes mirror UI hierarchy." Estrutura de rotas deve **refletir** estrutura de componentes. Se `/dashboard/profile` e `/dashboard/settings` compartilham layout, isso deve ser **expl√≠cito** na defini√ß√£o de rotas.

### Import√¢ncia no Ecossistema

Nested routes s√£o **essenciais** para:

- **Layouts compartilhados**: Sidebar, header, footer consistentes
- **Admin panels**: Dashboard com m√∫ltiplas sub-p√°ginas
- **Multi-level navigation**: Categorias ‚Üí Subcategorias ‚Üí Produtos
- **Protected sections**: Auth layout compartilhado

**Contexto:** Nested routes eram **verbosos** em React Router v5 (`<Route><Route /></Route>`). V6 simplificou radicalmente com API **declarativa** e `<Outlet />`.

---

## üìã Sum√°rio Conceitual

### T√≥picos Cobertos

1. **Nested Routes**: Rotas hier√°rquicas
2. **Outlet Component**: Slot para child routes
3. **Index Routes**: Rota padr√£o de se√ß√£o
4. **Layout Routes**: Wrapper routes sem path
5. **Rotas 404 e Wildcard**: Catch-all routes

---

## üîç Fundamentos Te√≥ricos

### Rotas Aninhadas: Estrutura

**Flat routes (repetitivo):**
```javascript
<Routes>
  <Route path="/dashboard" element={<DashboardLayout><Overview /></DashboardLayout>} />
  <Route path="/dashboard/profile" element={<DashboardLayout><Profile /></DashboardLayout>} />
  <Route path="/dashboard/settings" element={<DashboardLayout><Settings /></DashboardLayout>} />
</Routes>
// DashboardLayout repetido 3x
```

**Nested routes (DRY):**
```javascript
<Routes>
  <Route path="/dashboard" element={<DashboardLayout />}>
    <Route index element={<Overview />} />
    <Route path="profile" element={<Profile />} />
    <Route path="settings" element={<Settings />} />
  </Route>
</Routes>
// DashboardLayout definido 1x, child routes renderizam via <Outlet />
```

### Outlet: Rendering Child Routes

```javascript
function DashboardLayout() {
  return (
    <div>
      <Sidebar />
      <main>
        <Outlet /> {/* Child route renderiza aqui */}
      </main>
    </div>
  );
}

// URL: /dashboard/profile
// Outlet renderiza: <Profile />
```

---

## üîç An√°lise Conceitual Profunda

### 11.3.1 Nested Routes B√°sico

**Exemplo simples:**
```javascript
import { Routes, Route, Outlet, Link } from 'react-router-dom';

function App() {
  return (
    <Routes>
      <Route path="/" element={<Home />} />

      {/* Nested routes */}
      <Route path="/dashboard" element={<DashboardLayout />}>
        <Route index element={<Overview />} />
        <Route path="profile" element={<Profile />} />
        <Route path="settings" element={<Settings />} />
      </Route>
    </Routes>
  );
}

function DashboardLayout() {
  return (
    <div className="dashboard">
      <aside className="sidebar">
        <h2>Dashboard</h2>
        <nav>
          <Link to="/dashboard">Overview</Link>
          <Link to="/dashboard/profile">Profile</Link>
          <Link to="/dashboard/settings">Settings</Link>
        </nav>
      </aside>

      <main className="content">
        <Outlet /> {/* Child route renderiza aqui */}
      </main>
    </div>
  );
}

function Overview() {
  return <h1>Overview</h1>;
}

function Profile() {
  return <h1>Profile</h1>;
}

function Settings() {
  return <h1>Settings</h1>;
}
```

**Como funciona:**
- URL `/dashboard` ‚Üí Renderiza `<DashboardLayout />` com `<Outlet />` renderizando `<Overview />`
- URL `/dashboard/profile` ‚Üí Renderiza `<DashboardLayout />` com `<Outlet />` renderizando `<Profile />`
- Sidebar permanece, apenas `<Outlet />` muda

### 11.3.2 Index Routes

**Index route = rota padr√£o do parent:**
```javascript
<Route path="/dashboard" element={<DashboardLayout />}>
  <Route index element={<Overview />} />
  {/* index: renderiza em /dashboard (sem trailing path) */}
  <Route path="profile" element={<Profile />} />
</Route>
```

**Sem index route:**
```javascript
<Route path="/dashboard" element={<DashboardLayout />}>
  <Route path="profile" element={<Profile />} />
</Route>

// URL: /dashboard ‚Üí Outlet renderiza nada (vazio)
// URL: /dashboard/profile ‚Üí Outlet renderiza <Profile />
```

**Com index route:**
```javascript
<Route path="/dashboard" element={<DashboardLayout />}>
  <Route index element={<Overview />} />
  <Route path="profile" element={<Profile />} />
</Route>

// URL: /dashboard ‚Üí Outlet renderiza <Overview />
// URL: /dashboard/profile ‚Üí Outlet renderiza <Profile />
```

**Index route √© shorthand para:**
```javascript
<Route path="" element={<Overview />} />
// Equivalente a <Route index element={<Overview />} />
```

### 11.3.3 M√∫ltiplos N√≠veis de Nesting

**3 n√≠veis:**
```javascript
<Routes>
  <Route path="/app" element={<AppLayout />}>
    <Route index element={<AppHome />} />

    <Route path="products" element={<ProductsLayout />}>
      <Route index element={<ProductsList />} />
      <Route path=":id" element={<ProductDetail />} />
      <Route path=":id/reviews" element={<ProductReviews />} />
    </Route>
  </Route>
</Routes>
```

**URLs correspondentes:**
- `/app` ‚Üí `<AppLayout>` + `<AppHome />`
- `/app/products` ‚Üí `<AppLayout>` + `<ProductsLayout>` + `<ProductsList />`
- `/app/products/123` ‚Üí `<AppLayout>` + `<ProductsLayout>` + `<ProductDetail />`
- `/app/products/123/reviews` ‚Üí `<AppLayout>` + `<ProductsLayout>` + `<ProductReviews />`

**Componentes:**
```javascript
function AppLayout() {
  return (
    <div>
      <header>App Header</header>
      <Outlet /> {/* ProductsLayout renderiza aqui */}
      <footer>App Footer</footer>
    </div>
  );
}

function ProductsLayout() {
  return (
    <div>
      <aside>Products Sidebar</aside>
      <div>
        <Outlet /> {/* ProductsList/ProductDetail/ProductReviews renderiza aqui */}
      </div>
    </div>
  );
}
```

### 11.3.4 Layout Routes (Pathless Routes)

**Route sem path = layout wrapper:**
```javascript
<Routes>
  <Route element={<AuthLayout />}>
    {/* AuthLayout wraps todas essas rotas */}
    <Route path="/login" element={<Login />} />
    <Route path="/register" element={<Register />} />
    <Route path="/forgot-password" element={<ForgotPassword />} />
  </Route>

  <Route element={<AppLayout />}>
    {/* AppLayout wraps essas */}
    <Route path="/" element={<Home />} />
    <Route path="/about" element={<About />} />
  </Route>
</Routes>
```

**AuthLayout (sem auth UI):**
```javascript
function AuthLayout() {
  return (
    <div className="auth-layout">
      <div className="auth-container">
        <img src="/logo.png" alt="Logo" />
        <Outlet /> {/* Login/Register/ForgotPassword */}
      </div>
    </div>
  );
}
```

**Vantagem:** Centralizar layout comum sem repetir path prefix.

### 11.3.5 Relative Routes

**Paths relativos em nested routes:**
```javascript
<Route path="/dashboard" element={<DashboardLayout />}>
  <Route path="profile" element={<Profile />} />
  {/* path "profile" (sem /) = relativo a parent */}
  {/* Full path: /dashboard/profile */}

  <Route path="/settings" element={<Settings />} />
  {/* path "/settings" (com /) = absoluto */}
  {/* Full path: /settings (ignora parent) */}
</Route>
```

**Best practice: Use paths relativos** (sem `/` inicial).

### 11.3.6 Rotas 404 em Nested Routes

**404 global:**
```javascript
<Routes>
  <Route path="/" element={<Home />} />
  <Route path="/about" element={<About />} />
  <Route path="*" element={<NotFound />} />
</Routes>
```

**404 scoped (em nested route):**
```javascript
<Routes>
  <Route path="/dashboard" element={<DashboardLayout />}>
    <Route index element={<Overview />} />
    <Route path="profile" element={<Profile />} />
    <Route path="*" element={<DashboardNotFound />} />
  </Route>
</Routes>

// URL: /dashboard/invalid
// Renderiza <DashboardLayout> + <DashboardNotFound />
```

**404 com layout:**
```javascript
<Routes>
  <Route element={<AppLayout />}>
    <Route path="/" element={<Home />} />
    <Route path="/about" element={<About />} />
  </Route>

  {/* 404 fora de AppLayout (sem sidebar/header) */}
  <Route path="*" element={<NotFound />} />
</Routes>
```

### 11.3.7 Compartilhando Dados entre Parent e Child

**Via Context:**
```javascript
import { createContext, useContext } from 'react';
import { Outlet } from 'react-router-dom';

const DashboardContext = createContext();

export const useDashboard = () => useContext(DashboardContext);

function DashboardLayout() {
  const [user, setUser] = useState(null);

  useEffect(() => {
    fetchUser().then(setUser);
  }, []);

  return (
    <DashboardContext.Provider value={{ user, setUser }}>
      <div>
        <Sidebar />
        <Outlet />
      </div>
    </DashboardContext.Provider>
  );
}

// Child route
function Profile() {
  const { user } = useDashboard();

  return <div>Welcome, {user?.name}</div>;
}
```

**Via Outlet context:**
```javascript
function DashboardLayout() {
  const [user, setUser] = useState(null);

  return (
    <div>
      <Sidebar />
      <Outlet context={{ user, setUser }} />
    </div>
  );
}

// Child route
import { useOutletContext } from 'react-router-dom';

function Profile() {
  const { user } = useOutletContext();

  return <div>Welcome, {user?.name}</div>;
}
```

### 11.3.8 Exemplo Completo: Admin Panel

**Estrutura de rotas:**
```javascript
import { Routes, Route, Outlet, Link, NavLink } from 'react-router-dom';

function App() {
  return (
    <Routes>
      {/* Public routes */}
      <Route path="/" element={<Landing />} />
      <Route path="/login" element={<Login />} />

      {/* Admin routes */}
      <Route path="/admin" element={<AdminLayout />}>
        <Route index element={<AdminDashboard />} />

        <Route path="users" element={<UsersLayout />}>
          <Route index element={<UsersList />} />
          <Route path=":id" element={<UserDetail />} />
          <Route path=":id/edit" element={<UserEdit />} />
        </Route>

        <Route path="products" element={<ProductsLayout />}>
          <Route index element={<ProductsList />} />
          <Route path="new" element={<ProductCreate />} />
          <Route path=":id" element={<ProductDetail />} />
          <Route path=":id/edit" element={<ProductEdit />} />
        </Route>

        <Route path="settings" element={<Settings />} />
      </Route>

      {/* 404 */}
      <Route path="*" element={<NotFound />} />
    </Routes>
  );
}

function AdminLayout() {
  return (
    <div className="admin-layout">
      <aside className="sidebar">
        <h2>Admin Panel</h2>
        <nav>
          <NavLink to="/admin" end>Dashboard</NavLink>
          <NavLink to="/admin/users">Users</NavLink>
          <NavLink to="/admin/products">Products</NavLink>
          <NavLink to="/admin/settings">Settings</NavLink>
        </nav>
      </aside>

      <main className="content">
        <Outlet />
      </main>
    </div>
  );
}

function UsersLayout() {
  return (
    <div>
      <h1>Users Management</h1>
      <nav>
        <Link to="/admin/users">All Users</Link>
      </nav>
      <Outlet />
    </div>
  );
}

function ProductsLayout() {
  return (
    <div>
      <h1>Products Management</h1>
      <nav>
        <Link to="/admin/products">All Products</Link>
        <Link to="/admin/products/new">Create Product</Link>
      </nav>
      <Outlet />
    </div>
  );
}
```

**URLs resultantes:**
- `/admin` ‚Üí AdminLayout + AdminDashboard
- `/admin/users` ‚Üí AdminLayout + UsersLayout + UsersList
- `/admin/users/42` ‚Üí AdminLayout + UsersLayout + UserDetail
- `/admin/products` ‚Üí AdminLayout + ProductsLayout + ProductsList
- `/admin/products/new` ‚Üí AdminLayout + ProductsLayout + ProductCreate

---

## üéØ Aplicabilidade e Contextos

### Quando Usar Nested Routes

**‚úÖ Use quando:**
- M√∫ltiplas rotas compartilham layout (sidebar, header)
- Navega√ß√£o hier√°rquica (/category/subcategory/item)
- Admin panels, dashboards
- Se√ß√µes protegidas com layout comum

**‚ùå N√£o use quando:**
- Rotas completamente independentes (/, /about, /contact)
- Cada rota tem layout √∫nico
- Over-engineering (nested desnecess√°rio)

### Index Route vs First Child

**Index route (recomendado):**
```javascript
<Route path="/dashboard" element={<DashboardLayout />}>
  <Route index element={<Overview />} />
</Route>
// URL: /dashboard ‚Üí Overview
```

**First child (n√£o recomendado):**
```javascript
<Route path="/dashboard" element={<DashboardLayout />}>
  <Route path="overview" element={<Overview />} />
</Route>
// URL: /dashboard ‚Üí Outlet vazio
// URL: /dashboard/overview ‚Üí Overview (path mais longo)
```

---

## ‚ö†Ô∏è Limita√ß√µes e Considera√ß√µes

### Outlet Obrigat√≥rio

**‚ùå Sem Outlet:**
```javascript
function DashboardLayout() {
  return (
    <div>
      <Sidebar />
      <main>
        {/* Sem Outlet - child routes n√£o renderizam! */}
      </main>
    </div>
  );
}
```

**‚úÖ Com Outlet:**
```javascript
function DashboardLayout() {
  return (
    <div>
      <Sidebar />
      <main>
        <Outlet /> {/* Necess√°rio! */}
      </main>
    </div>
  );
}
```

### Performance de Nested Routes

**Cada nested route = component extra:**
```javascript
// 3 n√≠veis = 3 components renderizados
<AppLayout> {/* N√≠vel 1 */}
  <ProductsLayout> {/* N√≠vel 2 */}
    <ProductDetail /> {/* N√≠vel 3 */}
  </ProductsLayout>
</AppLayout>
```

**Solu√ß√£o:** Use React.memo em layouts se necess√°rio:
```javascript
const AdminLayout = React.memo(() => {
  return (
    <div>
      <Sidebar />
      <Outlet />
    </div>
  );
});
```

### Path Relativos vs Absolutos

**‚ö†Ô∏è Cuidado ao misturar:**
```javascript
<Route path="/dashboard" element={<DashboardLayout />}>
  <Route path="profile" element={<Profile />} />
  {/* Relativo: /dashboard/profile */}

  <Route path="/settings" element={<Settings />} />
  {/* Absoluto: /settings (ignora /dashboard) */}
</Route>
```

**Best practice:** Use sempre relativos (sem `/`).

---

## üîó Interconex√µes Conceituais

### Rela√ß√£o com Component Composition

Nested routes = composition pattern aplicado a rotas:
```javascript
// Composition de componentes
<Layout>
  <Sidebar />
  <Content>
    {children}
  </Content>
</Layout>

// Nested routes (similar)
<Route element={<Layout />}>
  <Route element={<Content />}>
    <Route path="/" element={<Home />} />
  </Route>
</Route>
```

### Rela√ß√£o com Context API

**Layout routes + Context = data sharing:**
```javascript
function DashboardLayout() {
  const [user, setUser] = useState(null);

  return (
    <DashboardContext.Provider value={{ user }}>
      <Outlet />
    </DashboardContext.Provider>
  );
}
// Child routes acessam user via useContext
```

### Rela√ß√£o com useOutletContext

**Alternative to Context API:**
```javascript
<Outlet context={{ user }} />

// Child
const { user } = useOutletContext();
```

---

## üöÄ Evolu√ß√£o e Pr√≥ximos Conceitos

### React Router v5 vs v6

**v5 (verboso):**
```javascript
<Route path="/dashboard">
  <DashboardLayout>
    <Route exact path="/dashboard" component={Overview} />
    <Route path="/dashboard/profile" component={Profile} />
  </DashboardLayout>
</Route>
```

**v6 (declarativo):**
```javascript
<Route path="/dashboard" element={<DashboardLayout />}>
  <Route index element={<Overview />} />
  <Route path="profile" element={<Profile />} />
</Route>
```

### Pr√≥ximos Passos

Este m√≥dulo cobriu nested routes. Pr√≥ximo:

**11.4 Router Features Avan√ßados** - Protected routes, lazy loading, data loaders (v6.4+), error boundaries

**Prepara√ß√£o:** Nested routes s√£o fundamento para features avan√ßadas. Protected routes (11.4) usam layout routes para wrapping auth checks.

---

## üìö Conclus√£o

### Pontos-Chave

React Router Avan√ßado envolve:

1. **Nested routes**: Hierarquia de rotas
2. **Outlet**: Slot para child routes renderizarem
3. **Index routes**: Rota padr√£o do parent
4. **Layout routes**: Pathless routes para wrapping
5. **Relative paths**: Paths sem `/` (relativos ao parent)

### Best Practices

1. **Use nested routes para layouts compartilhados**
2. **Index route para rota padr√£o** (n√£o first child)
3. **Paths relativos** (sem `/` inicial)
4. **Outlet obrigat√≥rio** em parent routes
5. **Layout routes para auth/admin sections**

### Pattern T√≠pico

```javascript
<Routes>
  {/* Public */}
  <Route path="/" element={<Home />} />

  {/* Auth section (layout route) */}
  <Route element={<AuthLayout />}>
    <Route path="/login" element={<Login />} />
    <Route path="/register" element={<Register />} />
  </Route>

  {/* Admin section (nested) */}
  <Route path="/admin" element={<AdminLayout />}>
    <Route index element={<Dashboard />} />
    <Route path="users" element={<Users />} />
    <Route path="products" element={<Products />} />
  </Route>

  {/* 404 */}
  <Route path="*" element={<NotFound />} />
</Routes>
```

### Filosofia

**"Routes mirror UI hierarchy, Outlet mirrors props.children."**

Nested routes refletem estrutura de componentes - se UI √© hier√°rquica, rotas devem ser tamb√©m. `<Outlet />` √© slot onde child routes renderizam, similar a `props.children` mas controlado por URL. Resultado: layouts DRY, navega√ß√£o fluida, estrutura escal√°vel.

**Dominar nested routes = apps complexas com arquitetura limpa.**
