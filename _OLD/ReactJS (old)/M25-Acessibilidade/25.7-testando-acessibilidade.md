# Testando Acessibilidade no React

## ğŸ¯ IntroduÃ§Ã£o e DefiniÃ§Ã£o

### DefiniÃ§Ã£o Conceitual

**Testar Acessibilidade** Ã© a prÃ¡tica de **verificar automaticamente e manualmente** que aplicaÃ§Ãµes React atendem **padrÃµes de acessibilidade** (WCAG, ARIA), atravÃ©s de **linters**, **testes automatizados**, **auditorias** e **testes com tecnologias assistivas reais**. Conceitualmente, representa **validaÃ§Ã£o de inclusÃ£o** - garantir que aplicaÃ§Ã£o nÃ£o apenas funciona, mas funciona para **todos**.

### Problema que Resolve

**Sem Testes de Acessibilidade**:
- Bugs descobertos por usuÃ¡rios
- Processos judiciais (ADA compliance)
- Retrabalho caro
- ExclusÃ£o de usuÃ¡rios

**Com Testes de Acessibilidade**:
- Bugs encontrados cedo
- Compliance preventivo
- Menor custo de correÃ§Ã£o
- InclusÃ£o garantida

---

## ğŸ” Ferramentas de Teste

### NÃ­veis de Teste

```
Desenvolvimento:
â”œâ”€â”€ ESLint Plugin (jsx-a11y) â† AnÃ¡lise estÃ¡tica
â”œâ”€â”€ TypeScript â† Type safety
â””â”€â”€ IDE Warnings â† Feedback imediato

CI/CD:
â”œâ”€â”€ Jest + jest-axe â† Testes unitÃ¡rios
â”œâ”€â”€ Playwright/Cypress + axe â† E2E
â””â”€â”€ Lighthouse CI â† Auditorias

Manual:
â”œâ”€â”€ Screen Reader (NVDA, VoiceOver) â† Teste real
â”œâ”€â”€ Keyboard Only â† NavegaÃ§Ã£o
â””â”€â”€ Browser DevTools â† InspeÃ§Ã£o
```

---

## ğŸ“ ESLint jsx-a11y

### InstalaÃ§Ã£o e ConfiguraÃ§Ã£o

```bash
npm install --save-dev eslint-plugin-jsx-a11y
```

```json
// .eslintrc.json
{
  "extends": [
    "plugin:jsx-a11y/recommended"
  ],
  "plugins": ["jsx-a11y"],
  "rules": {
    "jsx-a11y/anchor-is-valid": "error",
    "jsx-a11y/alt-text": "error",
    "jsx-a11y/aria-props": "error",
    "jsx-a11y/aria-proptypes": "error",
    "jsx-a11y/aria-role": "error",
    "jsx-a11y/click-events-have-key-events": "error",
    "jsx-a11y/label-has-associated-control": "error",
    "jsx-a11y/no-autofocus": "warn"
  }
}
```

### Erros Comuns Capturados

```jsx
// âŒ ESLint Error: img elements must have an alt prop
<img src="cat.jpg" />

// âœ… Fix
<img src="cat.jpg" alt="Orange tabby cat" />

// âŒ ESLint Error: Form label must be associated
<label>Name</label>
<input type="text" />

// âœ… Fix
<label htmlFor="name">Name</label>
<input id="name" type="text" />

// âŒ ESLint Error: onClick must be accompanied by onKeyDown/onKeyUp
<div onClick={handleClick}>Click me</div>

// âœ… Fix
<button onClick={handleClick}>Click me</button>
```

---

## ğŸ§ª jest-axe - Testes UnitÃ¡rios

### InstalaÃ§Ã£o

```bash
npm install --save-dev jest-axe
```

### Setup

```javascript
// setupTests.js
import { toHaveNoViolations } from 'jest-axe';

expect.extend(toHaveNoViolations);
```

### Testes BÃ¡sicos

```javascript
import { render } from '@testing-library/react';
import { axe } from 'jest-axe';

test('Button nÃ£o tem violaÃ§Ãµes de a11y', async () => {
  const { container } = render(<button>Click me</button>);

  const results = await axe(container);

  expect(results).toHaveNoViolations();
});

test('Form nÃ£o tem violaÃ§Ãµes de a11y', async () => {
  const { container } = render(
    <form>
      <label htmlFor="email">Email</label>
      <input id="email" type="email" />
      <button type="submit">Submit</button>
    </form>
  );

  const results = await axe(container);

  expect(results).toHaveNoViolations();
});
```

### Configurar Regras

```javascript
test('Modal nÃ£o tem violaÃ§Ãµes (exceto color-contrast)', async () => {
  const { container } = render(<Modal />);

  const results = await axe(container, {
    rules: {
      'color-contrast': { enabled: false } // Desabilitar regra especÃ­fica
    }
  });

  expect(results).toHaveNoViolations();
});
```

### Testar Apenas Regras EspecÃ­ficas

```javascript
test('verifica apenas aria-roles', async () => {
  const { container } = render(<Component />);

  const results = await axe(container, {
    runOnly: {
      type: 'rule',
      values: ['aria-roles', 'aria-valid-attr']
    }
  });

  expect(results).toHaveNoViolations();
});
```

---

## ğŸ¯ Testing Library - Queries AcessÃ­veis

### Prioridade de Queries

```javascript
// 1. getByRole (MELHOR - testa acessibilidade)
screen.getByRole('button', { name: 'Submit' });
screen.getByRole('heading', { level: 1 });

// 2. getByLabelText (FormulÃ¡rios)
screen.getByLabelText('Email');

// 3. getByPlaceholderText
screen.getByPlaceholderText('Search...');

// 4. getByText
screen.getByText('Hello World');

// 5. getByDisplayValue
screen.getByDisplayValue('John');

// 6. getByAltText
screen.getByAltText('Profile picture');

// 7. getByTitle
screen.getByTitle('Close');

// 8. getByTestId (ÃšLTIMO RECURSO)
screen.getByTestId('custom-element');
```

### Testar ARIA Attributes

```javascript
test('modal tem atributos ARIA corretos', () => {
  render(<Modal isOpen title="Confirm" />);

  const dialog = screen.getByRole('dialog');

  expect(dialog).toHaveAttribute('aria-modal', 'true');
  expect(dialog).toHaveAttribute('aria-labelledby');
});

test('input invÃ¡lido tem aria-invalid', () => {
  render(<EmailInput error="Invalid email" />);

  const input = screen.getByRole('textbox');

  expect(input).toHaveAttribute('aria-invalid', 'true');
  expect(input).toHaveAttribute('aria-describedby');
});
```

### Testar NavegaÃ§Ã£o por Teclado

```javascript
import userEvent from '@testing-library/user-event';

test('tabs navegam com arrow keys', async () => {
  const user = userEvent.setup();

  render(<Tabs tabs={mockTabs} />);

  const tab1 = screen.getByRole('tab', { name: 'Tab 1' });
  const tab2 = screen.getByRole('tab', { name: 'Tab 2' });

  tab1.focus();
  expect(tab1).toHaveFocus();

  await user.keyboard('{ArrowRight}');

  expect(tab2).toHaveFocus();
});

test('modal fecha com Escape', async () => {
  const user = userEvent.setup();
  const onClose = jest.fn();

  render(<Modal isOpen onClose={onClose} />);

  await user.keyboard('{Escape}');

  expect(onClose).toHaveBeenCalled();
});
```

---

## ğŸŒ Lighthouse - Auditorias

### Via Chrome DevTools

```
1. Abrir Chrome DevTools (F12)
2. Aba "Lighthouse"
3. Selecionar "Accessibility"
4. Clicar "Analyze page load"
5. Ver score (0-100) e violaÃ§Ãµes
```

### Via CLI

```bash
npm install -g lighthouse

lighthouse https://example.com --only-categories=accessibility --output=json --output-path=./report.json
```

### Lighthouse CI (GitHub Actions)

```yaml
# .github/workflows/lighthouse.yml
name: Lighthouse CI

on: [push]

jobs:
  lighthouse:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
      - run: npm ci
      - run: npm run build
      - run: npm install -g @lhci/cli
      - run: lhci autorun
```

```javascript
// lighthouserc.js
module.exports = {
  ci: {
    collect: {
      startServerCommand: 'npm run serve',
      url: ['http://localhost:3000']
    },
    assert: {
      assertions: {
        'categories:accessibility': ['error', { minScore: 0.9 }],
        'aria-allowed-attr': 'error',
        'aria-required-attr': 'error',
        'color-contrast': 'warn',
        'label': 'error'
      }
    }
  }
};
```

---

## ğŸ­ Playwright/Cypress com axe

### Playwright + axe-playwright

```bash
npm install --save-dev @axe-core/playwright
```

```javascript
// playwright.config.js
import { test, expect } from '@playwright/test';
import AxeBuilder from '@axe-core/playwright';

test('homepage nÃ£o tem violaÃ§Ãµes de a11y', async ({ page }) => {
  await page.goto('http://localhost:3000');

  const accessibilityScanResults = await new AxeBuilder({ page })
    .analyze();

  expect(accessibilityScanResults.violations).toEqual([]);
});

test('modal tem acessibilidade correta', async ({ page }) => {
  await page.goto('http://localhost:3000');

  await page.click('text=Open Modal');

  const accessibilityScanResults = await new AxeBuilder({ page })
    .include('#modal') // Escanear apenas modal
    .analyze();

  expect(accessibilityScanResults.violations).toEqual([]);
});
```

### Cypress + cypress-axe

```bash
npm install --save-dev cypress-axe axe-core
```

```javascript
// cypress/support/e2e.js
import 'cypress-axe';

// cypress/e2e/accessibility.cy.js
describe('Accessibility Tests', () => {
  beforeEach(() => {
    cy.visit('/');
    cy.injectAxe();
  });

  it('homepage nÃ£o tem violaÃ§Ãµes', () => {
    cy.checkA11y();
  });

  it('formulÃ¡rio nÃ£o tem violaÃ§Ãµes', () => {
    cy.get('form').checkA11y();
  });

  it('ignora violaÃ§Ãµes de color-contrast', () => {
    cy.checkA11y(null, {
      rules: {
        'color-contrast': { enabled: false }
      }
    });
  });
});
```

---

## ğŸ–¥ï¸ Testes Manuais

### Checklist de Keyboard

```
â–¡ Tab navega para todos elementos interativos
â–¡ Shift+Tab navega para trÃ¡s
â–¡ Enter ativa links e botÃµes
â–¡ Space ativa checkboxes e botÃµes
â–¡ Escape fecha modals e dropdowns
â–¡ Arrow keys navegam em menus/tabs
â–¡ Foco visÃ­vel em todos elementos
â–¡ Ordem de foco lÃ³gica
â–¡ Sem keyboard traps
```

### Checklist de Screen Reader

```
NVDA (Windows):
â–¡ Headings anunciados (H / Shift+H)
â–¡ Links anunciados (K / Shift+K)
â–¡ Form fields tÃªm labels
â–¡ Erros anunciados automaticamente
â–¡ Live regions funcionam
â–¡ ARIA attributes corretos

VoiceOver (macOS):
â–¡ Cmd+F5 liga/desliga
â–¡ VO+Right/Left navega
â–¡ VO+U abre Web Rotor
â–¡ Landmarks identificados
```

### Browser DevTools

```
Chrome DevTools:
1. Elements tab â†’ Accessibility pane
   - Ver Ã¡rvore de acessibilidade
   - Checar computed properties

2. Lighthouse â†’ Accessibility
   - Score geral
   - Lista de violaÃ§Ãµes

3. Rendering â†’ Emulate vision deficiencies
   - Simular daltonismo
   - Simular visÃ£o embaÃ§ada
```

---

## ğŸ“Š RelatÃ³rios e Monitoramento

### Pa11y CI

```bash
npm install --save-dev pa11y-ci
```

```json
// .pa11yci.json
{
  "defaults": {
    "standard": "WCAG2AA",
    "timeout": 10000
  },
  "urls": [
    "http://localhost:3000",
    "http://localhost:3000/about",
    "http://localhost:3000/contact"
  ]
}
```

```json
// package.json
{
  "scripts": {
    "test:a11y": "pa11y-ci"
  }
}
```

---

## ğŸš€ ConclusÃ£o

Testar Acessibilidade requer:
- **ESLint jsx-a11y**: Feedback imediato no cÃ³digo
- **jest-axe**: Testes unitÃ¡rios automatizados
- **RTL Queries**: getByRole, getByLabelText (acessÃ­veis)
- **Lighthouse**: Auditorias e score
- **Playwright/Cypress + axe**: E2E com verificaÃ§Ã£o a11y
- **Testes Manuais**: Screen reader, keyboard, DevTools

Combinar testes automatizados (80%) com manuais (20%) garante acessibilidade real, nÃ£o apenas compliance superficial.
